"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[78615],{78615:(t,r,s)=>{s.r(r),s.d(r,{AppCanvasTemplate:()=>d});class e{constructor(t,r,s){this.x=t,this.y=r,this.z=s}static times(t,r){return new e(t*r.x,t*r.y,t*r.z)}static minus(t,r){return new e(t.x-r.x,t.y-r.y,t.z-r.z)}static plus(t,r){return new e(t.x+r.x,t.y+r.y,t.z+r.z)}static dot(t,r){return t.x*r.x+t.y*r.y+t.z*r.z}static mag(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static norm(t){var r=e.mag(t),s=0===r?1/0:1/r;return e.times(s,t)}static cross(t,r){return new e(t.y*r.z-t.z*r.y,t.z*r.x-t.x*r.z,t.x*r.y-t.y*r.x)}}class n{constructor(t,r,s){this.r=t,this.g=r,this.b=s}static scale(t,r){return new n(t*r.r,t*r.g,t*r.b)}static plus(t,r){return new n(t.r+r.r,t.g+r.g,t.b+r.b)}static times(t,r){return new n(t.r*r.r,t.g*r.g,t.b*r.b)}static toDrawingColor(t){var r=t=>t>1?1:t;return[Math.floor(255*r(t.r)),Math.floor(255*r(t.g)),Math.floor(255*r(t.b))]}}n.white=new n(1,1,1),n.grey=new n(.5,.5,.5),n.black=new n(.05,.05,.05),n.background=n.black,n.defaultColor=n.black;class i{constructor(t,r){this.pos=t,this.forward=void 0,this.right=void 0,this.up=void 0;var s=new e(0,-1,0);this.forward=e.norm(e.minus(r,this.pos)),this.right=e.times(1.5,e.norm(e.cross(this.forward,s))),this.up=e.times(1.5,e.norm(e.cross(this.forward,this.right)))}}class o{constructor(t){!function(t){const r=document.getElementById(t),s=document.createElement("canvas");s.width=512,s.height=512,r.append(s);const o=s.getContext("2d");(new l).render({things:[new h(new e(0,1,0),0,a.checkerboard),new u(new e(0,1,-.25),1,a.shiny),new u(new e(-6,3,-5),1,a.shiny),new u(new e(-6,8,15),5,a.shiny),new u(new e(-1,.5,1.5),.5,a.shiny)],lights:[{pos:new e(-2,2.5,0),color:new n(1,1,1)},{pos:new e(0,3.5,0),color:new n(.21,.21,.35)}],camera:new i(new e(3,2,4),new e(-1,.5,0))},o,512,512)}(t)}}let a;var c;(c=a||(a={})).shiny={diffuse:function(t){return n.white},specular:function(t){return n.grey},reflect:function(t){return 0},roughness:250},c.checkerboard={diffuse:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?n.white:n.black},specular:function(t){return n.white},reflect:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?.1:.7},roughness:150};class u{constructor(t,r,s){this.center=t,this.surface=s,this.radius2=void 0,this.radius2=r*r}intersect(t){var r=e.minus(this.center,t.start),s=e.dot(r,t.dir),n=0;if(s>=0){var i=this.radius2-(e.dot(r,r)-s*s);i>=0&&(n=s-Math.sqrt(i))}return 0===n?null:{thing:this,ray:t,dist:n}}normal(t){return e.norm(e.minus(t,this.center))}}class h{constructor(t,r,s){this.surface=s,this.intersect=void 0,this.normal=void 0,this.normal=function(r){return t},this.intersect=s=>{var n=e.dot(t,s.dir);if(!(n>0))return{thing:this,ray:s,dist:(e.dot(t,s.start)+r)/-n}}}}class l{constructor(){this.maxDepth=100}intersections(t,r){let s,e=1/0;for(let n in r.things){let i=r.things[n].intersect(t);null!=i&&i.dist<e&&(s=i,e=i.dist)}return s}testRay(t,r){const s=this.intersections(t,r);return void 0===s?void 0:s.dist}traceRay(t,r,s){const e=this.intersections(t,r);return void 0===e?n.background:this.shade(e,r,s)}shade(t,r,s){var i=t.ray.dir,o=e.plus(e.times(t.dist,i),t.ray.start),a=t.thing.normal(o),c=e.minus(i,e.times(2,e.times(e.dot(a,i),a))),u=n.plus(n.background,this.getNaturalColor(t.thing,o,a,c,r)),h=s>=this.maxDepth?n.grey:this.getReflectionColor(t.thing,o,a,c,r,s);return n.plus(u,h)}getReflectionColor(t,r,s,e,i,o){return n.scale(t.surface.reflect(r),this.traceRay({start:r,dir:e},i,o+1))}getNaturalColor(t,r,s,i,o){return o.lights.reduce(((a,c)=>{const u=e.minus(c.pos,r),h=e.norm(u),l=this.testRay({start:r,dir:h},o);if(void 0!==l&&l<=e.mag(u))return a;{const o=e.dot(h,s),u=o>0?n.scale(o,c.color):n.defaultColor,l=e.dot(h,e.norm(i)),d=l>0?n.scale(Math.pow(l,t.surface.roughness),c.color):n.defaultColor;return n.plus(a,n.plus(n.times(t.surface.diffuse(r),u),n.times(t.surface.specular(r),d)))}}),n.defaultColor)}render(t,r,s,i){for(var o=(t,r,n)=>e.norm(e.plus(n.forward,e.plus(e.times((t=>(t-s/2)/2/s)(t),n.right),e.times((t=>-(t-i/2)/2/i)(r),n.up)))),a=0;a<i;a++)for(var c=0;c<s;c++){var u=this.traceRay({start:t.camera.pos,dir:o(c,a,t.camera)},t,0),h=n.toDrawingColor(u);r.fillStyle="rgb("+String(h[0])+", "+String(h[1])+", "+String(h[2])+")",r.fillRect(c,a,c+1,a+1)}}}class d{static Init(t){new d(t).Dummy()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";this.implementation=void 0,this.implementation=new o(t),console.log("AppCanvasTemplate 1000")}Dummy(){}}}}]);
//# sourceMappingURL=78615.ca6bf084.chunk.js.map