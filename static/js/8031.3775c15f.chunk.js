"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[8031],{98031:function(e,t,i){i.r(t),i.d(t,{Solution:function(){return u}});var r=i(74165),n=i(15861),a=i(15671),o=i(43144),s=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]),u=function(){function e(t){(0,a.Z)(this,e),this.divHost=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.pipelineObj=void 0,this.divHost=document.getElementById(t),this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.initWebGPU()}return(0,o.Z)(e,[{key:"initWebGPU",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){var t,i,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.gpu){e.next=2;break}throw new Error("Not Support WebGPU");case 2:return e.next=4,navigator.gpu.requestAdapter({powerPreference:"high-performance"});case 4:if(t=e.sent){e.next=7;break}throw new Error("No Adapter Found");case 7:return e.next=9,t.requestDevice();case 9:i=e.sent,this.ctx=this.canvas.getContext("webgpu"),n=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(t),window.devicePixelRatio||1,this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.ctx.configure({device:i,format:n,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=i,this.format=n,this.initPipeline(this.device,this.format);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){}},{key:"initPipeline",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n,a,o,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:t.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}\n"}),entryPoint:"main",targets:[{format:i}]},primitive:{topology:"triangle-list"}});case 2:n=e.sent,a=t.createBuffer({label:"GPUBuffer store vertex",size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(a,0,s),o=t.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(o,0,new Float32Array([1,1,0,1])),u=t.createBindGroup({label:"Uniform Group with colorBuffer",layout:n.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:o}}]}),this.pipelineObj={pipeline:n,vertexBuffer:a,colorBuffer:o,uniformGroup:u},this.run();case 10:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"draw",value:function(e,t,i){var r=e.createCommandEncoder(),n={colorAttachments:[{view:t.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},a=r.beginRenderPass(n);a.setPipeline(i.pipeline),a.setBindGroup(0,i.uniformGroup),a.setVertexBuffer(0,i.vertexBuffer),a.draw(3),a.end(),e.queue.submit([r.finish()])}},{key:"run",value:function(){var e,t,i=this;this.draw(this.device,this.ctx,this.pipelineObj),null===(e=document.querySelector('input[type="color"]'))||void 0===e||e.addEventListener("input",(function(e){var t=e.target.value,r=+("0x"+t.slice(1,3))/255,n=+("0x"+t.slice(3,5))/255,a=+("0x"+t.slice(5,7))/255;i.device.queue.writeBuffer(i.pipelineObj.colorBuffer,0,new Float32Array([r,n,a,1])),i.draw(i.device,i.ctx,i.pipelineObj)})),null===(t=document.querySelector('input[type="range"]'))||void 0===t||t.addEventListener("input",(function(e){var t=+e.target.value;s[0]=0+t,s[3]=-.5+t,s[6]=.5+t,i.device.queue.writeBuffer(i.pipelineObj.vertexBuffer,0,s),i.draw(i.device,i.ctx,i.pipelineObj)})),window.addEventListener("resize",(function(){i.canvas.width=i.divHost.clientWidth,i.canvas.height=i.divHost.clientHeight,i.draw(i.device,i.ctx,i.pipelineObj)}))}}]),e}()}}]);
//# sourceMappingURL=8031.3775c15f.chunk.js.map