"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[3455],{83455:function(e,t,i){i.r(t),i.d(t,{Solution:function(){return g}});var r=i(39880),s=i(88679);class n{constructor(e){this.solution=void 0,this.canvas=void 0,this.modelMatrix=void 0,this.mvpMatrix=void 0,this.vMatrix=void 0,this.vpMatrix=void 0,this.rotation=s.al(0,0,0),this.translation=s.al(0,0,0),this.vp=void 0,this.projection=r.Ue(),this.eye=s.al(1,1,0),this.center=s.al(0,0,0),this.up=s.al(0,1,0),this.solution=e,this.canvas=e.canvas,this.modelMatrix=r.Ue(),this.mvpMatrix=r.Ue(),this.vMatrix=r.Ue(),this.vpMatrix=r.Ue(),this.vp=p(this.canvas.width/this.canvas.height),this.vpMatrix=this.vp.viewProjectionMatrix,r.jI(this.modelMatrix,this.modelMatrix,0),r.bA(this.modelMatrix,this.modelMatrix,[1,1,1]),r.zB(this.vMatrix,this.eye,this.center,this.up)}update(){r.zB(this.vMatrix,this.eye,this.center,this.up),r.Jp(this.projection,this.vp.projectionMatrix,this.vMatrix),m(this.modelMatrix,this.translation,this.rotation),r.Jp(this.mvpMatrix,this.projection,this.modelMatrix)}rotateZ(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.rotation[1]+=e}translateX(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.translation[0]+=e}}const a=i(4095);class o{constructor(e){this.renderer=void 0,this.size=void 0,this.pipeline=void 0,this.rotation=void 0,this.normalMatrix=void 0,this.modelMatrix=void 0,this.translateMatrix=void 0,this.uniformBuffer=void 0,this.uniformBindGroup=void 0,this.textureView=void 0,this.depthTexture=void 0,this.renderPassDescription=void 0,this.numberOfVertices=void 0,this.vertexBuffer=void 0,this.colorBuffer=void 0,this.renderer=e,this.normalMatrix=r.Ue(),this.modelMatrix=r.Ue(),this.translateMatrix=r.Ue(),m(this.translateMatrix,[0,0,0],[0,0,0],[1,1,1]),this.initPipeline()}async initPipeline(){const e={positions:new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]),colors:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1])};this.numberOfVertices=e.positions.length/3,this.vertexBuffer=h(this.renderer.device,e.positions),this.colorBuffer=h(this.renderer.device,e.colors),console.log(a);const t=await f(a);this.pipeline=this.renderer.device.createRenderPipeline({layout:"auto",vertex:{module:this.renderer.device.createShaderModule({code:t}),entryPoint:"vs_main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:12,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:this.renderer.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:this.renderer.format}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.uniformBuffer=this.renderer.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup=this.renderer.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer,offset:0,size:64}}]}),this.textureView=this.renderer.ctx.getCurrentTexture().createView(),this.depthTexture=this.renderer.device.createTexture({size:[this.renderer.canvas.width,this.renderer.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:0,g:0,b:0,a:1},loadValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}}render(){r.Jp(this.translateMatrix,this.renderer.camera.mvpMatrix,this.modelMatrix),r.Jp(this.translateMatrix,this.renderer.camera.projection,this.translateMatrix),this.renderer.device.queue.writeBuffer(this.uniformBuffer,0,this.translateMatrix),this.textureView=this.renderer.ctx.getCurrentTexture().createView(),this.renderPassDescription.colorAttachments[0].view=this.textureView,this.renderer.commandEncoder=this.renderer.device.createCommandEncoder();const e=this.renderer.commandEncoder.beginRenderPass(this.renderPassDescription);e.setPipeline(this.pipeline),e.setVertexBuffer(0,this.vertexBuffer),e.setVertexBuffer(1,this.colorBuffer),e.setBindGroup(0,this.uniformBindGroup),e.draw(this.numberOfVertices),e.end(),this.renderer.device.queue.submit([this.renderer.commandEncoder.finish()])}}const h=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST;const r=e.createBuffer({size:t.byteLength,usage:i,mappedAtCreation:!0});return new Float32Array(r.getMappedRange()).set(t),r.unmap(),r};class d{constructor(e){this.numberOfVertices=0,this.vertexBuffer=void 0,this.normalBuffer=void 0,this.uvBuffer=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.commandEncoder=void 0,this.textureView=void 0,this.renderPassDescription=void 0,this.pipeline=void 0,this.isAnimation=!0,this.renderer=void 0,this.modelMatrix=void 0,this.translation=s.al(0,0,0),this.rotation=s.al(0,0,0),this.renderer=e;const t=u(1.5,70,40);this.numberOfVertices=(null===t||void 0===t?void 0:t.vertexData).length/3,this.vertexBuffer=x(this.renderer.device,null===t||void 0===t?void 0:t.vertexData),this.normalBuffer=x(this.renderer.device,null===t||void 0===t?void 0:t.normalData),this.uvBuffer=x(this.renderer.device,null===t||void 0===t?void 0:t.uvData);const i=c();this.pipeline=this.renderer.device.createRenderPipeline({layout:"auto",vertex:{module:this.renderer.device.createShaderModule({code:i.vertex}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]}]},fragment:{module:this.renderer.device.createShaderModule({code:i.fragment}),entryPoint:"main",targets:[{format:this.renderer.format}]},primitive:{topology:"line-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.modelMatrix=r.Ue(),this.rotation=s.al(0,0,0),this.uniformBuffer=this.renderer.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup=this.renderer.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer,offset:0,size:64}}]}),this.textureView=this.renderer.ctx.getCurrentTexture().createView();const n=this.renderer.device.createTexture({size:[this.renderer.canvas.width,this.renderer.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:.2,g:.247,b:.314,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:n.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}}render(e,t){this.isAnimation,m(this.modelMatrix,this.translation,this.rotation),r.Jp(this.renderer.camera.mvpMatrix,this.renderer.camera.vpMatrix,this.modelMatrix),this.renderer.device.queue.writeBuffer(this.uniformBuffer,0,this.renderer.camera.mvpMatrix),this.textureView=this.renderer.ctx.getCurrentTexture().createView(),this.renderPassDescription.colorAttachments[0].view=this.textureView;const i=e.beginRenderPass(this.renderPassDescription);i.setPipeline(this.pipeline),i.setVertexBuffer(0,this.vertexBuffer),i.setBindGroup(0,this.uniformBindGroup),i.draw(this.numberOfVertices),i.end()}}const c=()=>({vertex:"\n        struct Uniforms {\n            mvpMatrix : mat4x4<f32>,\n        };\n        @binding(0) @group(0) var<uniform> uniforms : Uniforms;\n        \n        @vertex\n        fn main(@location(0) pos: vec4<f32>) ->  @builtin(position) vec4<f32> {\n            return uniforms.mvpMatrix * pos;     \n        }",fragment:"\n        @fragment\n        fn main() -> @location(0) vec4<f32> {\n            return vec4<f32>(1.0, 1.0, 0.0, 1.0);            \n        }"}),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(t<2||i<2)return;let o,h=[];for(let s=0;s<t;s++){let n=[];for(let a=0;a<i;a++)o=l(e,180*s/(t-1),360*a/(i-1),r),n.push(o);h.push(n)}let d,c,u,v,f,p,m,x,g,M,w,P,B,U,b=[],y=[],A=[];for(let l=0;l<t-1;l++)for(let t=0;t<i-1;t++)g=h[l][t],M=h[l+1][t],w=h[l+1][t+1],P=h[l][t+1],B=s.Ue(),U=s.Ue(),s.$X(B,w,g),s.$X(U,M,P),b.push([g[0],g[1],g[2],M[0],M[1],M[2],P[0],P[1],P[2],M[0],M[1],M[2],w[0],w[1],w[2],P[0],P[1],P[2]]),y.push([g[0]/e,g[1]/e,g[2]/e,M[0]/e,M[1]/e,M[2]/e,P[0]/e,P[1]/e,P[2]/e,M[0]/e,M[1]/e,M[2]/e,w[0]/e,w[1]/e,w[2]/e,P[0]/e,P[1]/e,P[2]/e]),d=n*(.5+Math.atan2(g[0]/e,g[2]/e)/Math.PI/2),c=n*(.5+Math.atan2(M[0]/e,M[2]/e)/Math.PI/2),u=n*(.5+Math.atan2(w[0]/e,w[2]/e)/Math.PI/2),v=n*(.5+Math.atan2(P[0]/e,P[2]/e)/Math.PI/2),f=a*(.5-Math.asin(g[1]/e)/Math.PI),p=a*(.5-Math.asin(M[1]/e)/Math.PI),m=a*(.5-Math.asin(w[1]/e)/Math.PI),x=a*(.5-Math.asin(P[1]/e)/Math.PI),A.push([d,f,c,p,v,x,c,p,u,m,v,x]);return{vertexData:new Float32Array(b.flat()),normalData:new Float32Array(y.flat()),uvData:new Float32Array(A.flat())}},l=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],n=Math.sin(t*Math.PI/180),a=Math.cos(t*Math.PI/180),o=Math.sin(i*Math.PI/180),h=Math.cos(i*Math.PI/180);return s.al(e*n*h+r[0],e*a+r[1],-e*n*o+r[2])};i(4095);class v{constructor(e){this.divHost=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.commandEncoder=void 0,this.cube=void 0,this.line=void 0,this.sphereWire=void 0,this.sphereWire0=void 0,this.tri=void 0,this.camera=void 0,this.isAnimation=!0,this.requestAni=void 0,this.loop=()=>{this.isAnimation&&(this.requestAni=requestAnimationFrame(this.loop)),this.camera.update(),this.drawing()},this.canvas=e,this.divHost=this.canvas.parentElement,this.init()}destroy(){for(this.device.destroy(),cancelAnimationFrame(this.requestAni);this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}async init(){console.log(1),await this.initWebGPU(),this.camera=new n(this),console.log(2),console.log(3),console.log(4),this.cube=new o(this),this.sphereWire=new d(this),this.sphereWire0=new d(this)}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!e)throw new Error("No Adapter Found");const t=await e.requestDevice();this.ctx=this.canvas.getContext("webgpu");const i=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(e);window.devicePixelRatio;this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.ctx.configure({device:t,format:i,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=t,this.format=i,this.requestAni=requestAnimationFrame(this.loop)}drawing(){this.commandEncoder=this.device.createCommandEncoder(),this.sphereWire.rotation[1]+=.01,this.sphereWire.translation[1]+=.01,this.sphereWire0.render(this.commandEncoder,0),this.sphereWire.render(this.commandEncoder,1),console.log("loop..."),this.device.queue.submit([this.commandEncoder.finish()])}}const f=async e=>fetch("".concat(e)).then((e=>e.text())).catch((e=>{})),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0];const n=r.Ue(),a=r.Ue(),o=r.Ue();r.G3(a,2*Math.PI/5,e,.1,100),r.zB(n,t,i,s),r.Jp(o,a,n);return{viewMatrix:n,projectionMatrix:a,viewProjectionMatrix:o,cameraOption:{eye:t,center:i,zoomMax:100,zoomSpeed:2}}},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const n=r.Ue(),a=r.Ue(),o=r.Ue(),h=r.Ue(),d=r.Ue();r.vc(h,t),r.aC(n,i[0]),r.gT(a,i[1]),r.QO(o,i[2]),r.xJ(d,s),r.Jp(e,n,d),r.Jp(e,a,e),r.Jp(e,o,e),r.Jp(e,h,e)},x=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST;const r=e.createBuffer({size:t.byteLength,usage:i,mappedAtCreation:!0});return new Float32Array(r.getMappedRange()).set(t),r.unmap(),r};class g{constructor(e){this.divHost=void 0,this.canvas=void 0,this.renderer=void 0,this.divHost=document.getElementById(e),this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.init()}init(){this.renderer=new v(this.canvas)}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}},88679:function(e,t,i){i.d(t,{$X:function(){return o},IH:function(){return a},Ue:function(){return s},al:function(){return n},kC:function(){return d},od:function(){return h}});var r=i(50907);function s(){var e=new r.WT(3);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function n(e,t,i){var s=new r.WT(3);return s[0]=e,s[1]=t,s[2]=i,s}function a(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function o(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function h(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function d(e,t,i){var r=t[0],s=t[1],n=t[2],a=i[0],o=i[1],h=i[2];return e[0]=s*h-n*o,e[1]=n*a-r*h,e[2]=r*o-s*a,e}!function(){var e=s()}()},4095:function(e,t,i){e.exports=i.p+"static/media/sha.497e874e6453fbda04c6.wgsl"}}]);
//# sourceMappingURL=3455.1314101f.chunk.js.map