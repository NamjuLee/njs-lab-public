"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[4544],{14544:function(t,i,e){e.r(i),e.d(i,{BindingNNA:function(){return mt}});class s{constructor(t){this.window=void 0,this.window=t}addIconTopPanel(t){let i=document.createElement("button");i.style.width="".concat(t.width,"px"),i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.textContent=t.text,i.onclick=()=>t.callBack(),this.window.builder.divFulldownArea.appendChild(i)}addToggleTopPanel(t){let i=document.createElement("button");i.style.width="".concat(t.width,"px"),i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.textContent=t.text,i.onclick=()=>t.callBack(),this.window.builder.divFulldownArea.appendChild(i)}addIconLeftPanel(t){let i=document.createElement("button");i.style.height="50px",i.style.width="50px",i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.style.color="#000000",i.style.background="#fafafa",i.textContent=t.text,i.onclick=()=>t.callBack(),i.onmouseenter=()=>{i.style.color="#ffffff",i.style.background="#888888"},i.onmouseleave=()=>{i.style.color="#000000",i.style.background="#fafafa"},this.window.builder.divLeftUI.appendChild(i)}addIconLeft(){}}class n{constructor(t){this.window=void 0,this.divMain=void 0,this.divMainBody=void 0,this.divTopArea=void 0,this.divFulldownArea=void 0,this.divLeftUI=void 0,this.divBottomArea=void 0,this.divForGraphicContext=void 0,this.colorTopMenu="#dfdfdf",this.colorBGmenu="#f3f3f3",this.window=t}initPanel(t){this.initDivMain(),this.initDivTopArea(),this.initDivFulldownArea();const i=document.createElement("div");i.style.float="left",i.style.height="100%",i.style.padding="10px",i.style.background="#ff0000",this.divTopArea.appendChild(i);const e=document.createElement("div");e.style.float="left",e.style.padding="10px",e.textContent=t,this.divTopArea.appendChild(e),this.initDivContextArea(),this.initDivLeftArea(),this.divForGraphicContext=document.createElement("div"),this.divForGraphicContext.style.height="100%",this.divForGraphicContext.id="divForGraphicContext",this.divMainBody.appendChild(this.divForGraphicContext);const s=document.createElement("button");s.style.top="0px",s.style.left="0px",s.style.height="20px",s.style.width="20px",s.style.zIndex="13",s.style.float="right",s.style.padding="0px",s.style.zIndex="20",s.textContent="X",s.onclick=()=>{this.window.remove()},this.divTopArea.appendChild(s),this.initBottomArea(this.divMain);const n=document.createElement("div");n.style.height="100%",n.style.width="100px",n.style.float="left",this.divBottomArea.appendChild(n);const o=document.createElement("div");o.style.height="100%",o.style.width="80%",o.style.float="left",this.divBottomArea.appendChild(o)}initDivTopArea(){let t=document.createElement("div");t.style.width="100%",t.style.height="40px",t.style.background=this.colorTopMenu,t.style.zIndex="11";let i=!1,e=[0,0];t.ondrag=t=>{},t.onmouseenter=t=>{},t.ondrag=t=>{},t.onmousemove=t=>{if(i){const i=t.clientX-e[0],s=t.clientY-e[1];this.divMain.style.top=parseFloat(this.divMain.style.top)+s+"px",this.divMain.style.left=parseFloat(this.divMain.style.left)+i+"px",e[0]=t.clientX,e[1]=t.clientY}},t.onmousedown=t=>{e[0]=t.clientX,e[1]=t.clientY,i=!0,this.window.updateZindex()},t.onmouseup=t=>{i=!1},t.onmouseout=t=>{if(i){const i=t.clientX-e[0],s=t.clientY-e[1];this.divMain.style.top=parseFloat(this.divMain.style.top)+s+"px",this.divMain.style.left=parseFloat(this.divMain.style.left)+i+"px",e[0]=t.clientX,e[1]=t.clientY}},this.divTopArea=t,this.divMain.appendChild(t)}appendCloseTop(){}initBottomArea(t){let i=document.createElement("div");i.style.top=parseFloat(t.style.height)-parseFloat(t.style.top)-10+"px",i.style.width="100%",i.style.height="40px",i.style.background=this.colorBGmenu,i.style.zIndex="11";let e=!1,s=[0,0];i.ondrag=t=>{},i.onmouseenter=t=>{},i.ondrag=t=>{},i.onmousemove=n=>{if(e){const e=n.clientX-s[0],o=n.clientY-s[1];t.style.width=parseFloat(t.style.width)+e+"px",t.style.height=parseFloat(t.style.height)+o+"px",i.style.top=parseFloat(i.style.top)+o+"px",i.style.left=parseFloat(i.style.left)+e+"px",s[0]=n.clientX,s[1]=n.clientY}},i.onmousedown=t=>{s[0]=t.clientX,s[1]=t.clientY,e=!0},i.onmouseup=t=>{e=!1},i.onmouseout=n=>{if(this.window.updateResize=setTimeout((()=>{if(e){const e=n.clientX-s[0],o=n.clientY-s[1];t.style.width=parseFloat(t.style.width)+e+"px",t.style.height=parseFloat(t.style.height)+o+"px",i.style.top=parseFloat(i.style.top)+o+"px",i.style.left=parseFloat(i.style.left)+e+"px",s[0]=n.clientX,s[1]=n.clientY}}),300),e){const e=n.clientX-s[0],o=n.clientY-s[1];t.style.width=parseFloat(t.style.width)+e+"px",t.style.height=parseFloat(t.style.height)+o+"px",i.style.top=parseFloat(i.style.top)+o+"px",i.style.left=parseFloat(i.style.left)+e+"px",s[0]=n.clientX,s[1]=n.clientY}},this.divBottomArea=i,t.appendChild(i)}initDivMain(){this.divMain=document.createElement("div"),this.divMain.style.width="".concat(this.window.width,"px"),this.divMain.style.height="".concat(this.window.height,"px"),this.divMain.style.position="absolute",this.divMain.style.zIndex="10",this.divMain.id="NWindow",this.divMain.style.top="100px",this.divMain.style.left="200px",this.window.divHost.appendChild(this.divMain)}initDivFulldownArea(){this.divFulldownArea=document.createElement("div"),this.divFulldownArea.style.height="50px",this.divFulldownArea.style.width="100%",this.divFulldownArea.style.background=this.colorBGmenu,this.divMain.appendChild(this.divFulldownArea)}initDivContextArea(){this.divMainBody=document.createElement("div"),this.divMainBody.style.height="100%",this.divMainBody.style.width="100%",this.divMainBody.id="divContext",this.divMain.appendChild(this.divMainBody)}initDivLeftArea(){this.divLeftUI=document.createElement("div"),this.divLeftUI.style.height="100%",this.divLeftUI.style.width="100px",this.divLeftUI.style.background=this.colorBGmenu,this.divLeftUI.style.float="left",this.divMainBody.appendChild(this.divLeftUI)}}class o{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NJS Sandbox",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;this.divHost=void 0,this.updateResize=void 0,this.width=600,this.height=400,this.controller=void 0,this.builder=void 0,this.divHost=t,this.width=e,this.height=o,this.controller=new s(this),this.builder=new n(this),this.builder.initPanel(i)}addIconTopPanel(t){this.controller.addIconTopPanel(t)}addToggleTopPanel(t){this.controller.addToggleTopPanel(t)}addIconLeftPanel(t){this.controller.addIconLeftPanel(t)}addIconLeft(){this.controller.addIconLeft()}getContext(){return this.builder.divForGraphicContext}remove(){this.divHost.removeChild(this.builder.divMain)}updateZindex(){}}var h=e(92621),a=e(14404),r=e(78952);class l{constructor(t){this.app=void 0,this.app=t,this.OpenGeoJsonEx01("")}async OpenGeoJsonEx01(t){}}class d{constructor(t){this.app=void 0,this.app=t,this.AppendMapViewEvent()}AppendMapViewEvent(){this.app.mapView.watch("extent",(()=>{})),this.app.mapView.watch("stationary",(t=>{this.app.renderer.isPanning=!t})),this.app.mapView.watch("ready",(t=>{})),this.app.mapView.on("resize",(t=>{this.app.canvas.ResizeCanvas(t.width,t.height)}))}}class c{constructor(t){this.app=void 0,this.ToMap=(t,i)=>{let e=this.app.mapView.toMap({x:t,y:i}).clone();return[e.longitude,e.latitude,e.x,e.y]},this.ToScreen=(t,i)=>{this.app.mPoint.longitude=t,this.app.mPoint.latitude=i,this.app.mPoint.spatialReference=this.app.mapView.spatialReference;let e=this.app.mapView.toScreen(this.app.mPoint);return[e.x,e.y]},this.app=t}ToScreenFromProjected(t,i){this.app.mPoint.x=t,this.app.mPoint.y=i,this.app.mPoint.spatialReference=this.app.mapView.spatialReference;let e=this.app.mapView.toScreen(this.app.mPoint);return[e.x,e.y]}ToScreenFromGeoPos(t,i){let e=this.app.mapView.toMap({x:t,y:i}).clone();e.longitude=t,e.latitude=i;let s=this.app.mapView.toScreen(e);return[s.x,s.y]}ToScreenFromProjectedPos(t,i){let e=this.app.mapView.toMap({x:t,y:i}).clone(),s=this.app.mapView.toScreen(e);return[s.x,s.y]}ToScreenOld(t,i){let e=this.app.mapView.toMap({x:t,y:i}).clone();e.spatialReference.wkid=102100,e.longitude=t,e.latitude=i;let s=this.app.mapView.toScreen(e);return[s.x,s.y]}}class p{constructor(t){this.t=void 0,this.frameRate=void 0,this.canvas=void 0,this.hostDiv=void 0,this.id=void 0,this.ctx=void 0,this.xOff=void 0,this.yOff=void 0,this.xOffCurrent=void 0,this.yOffCurrent=void 0,this.xOffPre=void 0,this.yOffPre=void 0,this.zoomFactor=void 0,this.zoomFactorPre=void 0,this.zoomFactorCurrent=void 0,this.div3d=void 0,this.smoothingEnabled=!0,this.dropRate=void 0,this.isRenderSkip=void 0,this.isLoop=void 0,this.timeLastRender=void 0,this.delta=void 0,this.now=void 0,this.then=0,this.interval=0,this.last=0,this.frameVisTimer=void 0,this.theDate=void 0,this.asyncSafeGuard=0,this.App=void 0,this.App=t,this.canvas=document.createElement("canvas"),this.canvas.id="App",this.canvas.style.zIndex="1",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),t.divHost.appendChild(this.canvas),this.ctx.globalCompositeOperation="source-over",this.canvas.width=t.divHost.clientWidth,this.canvas.height=t.divHost.clientHeight,this.Start(this.ctx)}Start(t){this.App.renderer.Init(t),this.Draw(this.ctx)}Draw(t){requestAnimationFrame((()=>{this.Draw(t)})),this.Clear(t),this.Render(t)}Clear(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}Render(t){this.App.renderer.Render(t)}ResizeCanvas(t,i){this.ctx.canvas.width=t,this.ctx.canvas.height=i}}var g=e(26004);class u{constructor(t){this.app=void 0,this.app=t,u.mouseEventDataPre=new g.$E,this.InitArcGISMapEventV4x()}InitArcGISMapEventV4x(){this.app.mapView.on("click",(t=>{const i=this.CommonEventBuilderArcGIS(t);i.type=g.zK.LEFT,2===t.native.button?i.type=g.zK.RIGHT:1===t.native.button&&(i.type=g.zK.MIDDLE),this.app.MouseEvent(i)})),this.app.mapView.on("pointer-down",(t=>{const i=this.CommonEventBuilderArcGIS(t);i.type=g.zK.DOWN,this.app.MouseEvent(i)})),this.app.mapView.on("pointer-up",(t=>{const i=this.CommonEventBuilderArcGIS(t);i.type=g.zK.UP,this.app.MouseEvent(i)})),this.app.mapView.on("pointer-move",(t=>{const i=this.CommonEventBuilderArcGIS(t);i.type=g.zK.MOVE,this.app.MouseEvent(i)})),this.app.mapView.on("drag",(t=>{const i=this.CommonEventBuilderArcGIS(t);i.type=g.zK.DRAG,this.app.MouseEvent(i),this.app.ableToPan||t.stopPropagation()})),this.app.mapView.on("key-down",(t=>{"Arrow"!==t.key.slice(0,5)&&"-"!==t.key&&"="!==t.key&&"d"!==t.key||t.stopPropagation(),this.KeyDownJSAPI4X(t.native)})),this.app.mapView.on("key-up",(t=>{"Arrow"!==t.key.slice(0,5)&&"-"!==t.key&&"="!==t.key&&"d"!==t.key||t.stopPropagation(),this.KeyDownJSAPI4X(t.native)}))}MouseClickLeftArcGIS(t){let i=this.CommonEventBuilderArcGIS(t);this.app.MouseEvent(i)}CommonEventBuilderArcGIS(t){let i=new g.$E;return i.preX=u.mouseEventDataPre.x,i.preY=u.mouseEventDataPre.y,i.x=t.x,i.y=t.y,i.yGLPicking=t.native.target.getBoundingClientRect().bottom-t.native.clientY,i.pressedShift=t.native.shiftKey,i.pressedAlt=t.native.altKey,i.pressedCtrl=t.native.ctrlKey,i.native=t.native,u.mouseEventDataPre=i,i}KeyDownJSAPI4X(t){let i=this.CommonEventBuilder(t);this.app.KeyEvent(i)}CommonEventBuilder(t){let i=new g.ON;return i.key=t.key,i.keyCode=t.keyCode,i.code=t.code,i.hasCtrlKey=t.ctrlKey,i.hasShiftKey=t.shiftKey,i.hasAltKey=t.altKey,i.hasMetaCommand=t.metaKey,i}}u.mouseEventDataPre=void 0;class v{constructor(t){this.sandbox=void 0,this.p=[],this.num=0,this.isPanning=!1,this.renderer=[],this.sandbox=t}Init(t){}Render(t){for(let i=0;i<this.renderer.length;++i)this.renderer[i](t,this.isPanning)}}class m{static start(t){new m(t)}constructor(t){this.mapView=void 0,this.map=void 0,this.mPoint=void 0,this.divHost=void 0,this.arcGIS=void 0,this.io=void 0,this.canvas=void 0,this.projection=void 0,this.eventInteraction=void 0,this.renderer=void 0,this.ableToPan=!0,this.keyEvents=[],this.MouseEvents=[],this.renderer=new v(this);const i=new a.Z({basemap:"dark-gray-vector"});this.map=i,new h.Z({map:i,container:t,center:[-73.989502,40.741286],zoom:13}).when((t=>{this.mapView=t,this.mapView.spatialReference=r.Z.WebMercator,this.mPoint=this.mapView.toMap({x:0,y:0}),this.divHost=this.mapView.container,this.io=new l(this),this.eventInteraction=new u(this),this.projection=new c(this),this.canvas=new p(this),this.arcGIS=new d(this)}))}appendRenderer(t){this.renderer.renderer.push(t)}appendEventListener(t){this.MouseEvents.push(t.mouse),this.keyEvents.push(t.keyboard)}MouseEvent(t){for(let i=0;i<this.MouseEvents.length;++i)this.MouseEvents[i](t)}KeyEvent(t){for(let i=0;i<this.keyEvents.length;++i)this.keyEvents[i](t)}}var y=e(39890);const x=(t,i,e,s,n)=>(t-i)*(n-s)/(e-i)+s,w=(t,i)=>Math.random()*(i-t)+t;var f=e(44945);class C{constructor(t){this.HTMLView=void 0,this.div=void 0,this.HTMLView=t,this.initPanel()}remove(){this.HTMLView.networkUI=void 0}initPanel(){let t=document.createElement("div");t.style.width="200px",t.style.height="400px",t.style.background="#ffffff",t.style.position="absolute",t.style.zIndex="10",t.style.top="100px";let i=document.createElement("div");i.style.width="100%",i.style.height="60px",i.style.background="#efefef",i.style.position="relative",i.style.zIndex="11",i.textContent="NNA V3 controller";let e=!1,s=[0,0];i.ondrag=t=>{},i.onmouseenter=t=>{},i.ondrag=t=>{},i.onmousemove=i=>{if(e){const e=i.clientX-s[0],n=i.clientY-s[1];t.style.top=parseFloat(t.style.top)+n+"px",t.style.left=parseFloat(t.style.left)+e+"px",s[0]=i.clientX,s[1]=i.clientY}},i.onmousedown=t=>{s[0]=t.clientX,s[1]=t.clientY,e=!0},i.onmouseup=t=>{e=!1},i.onmouseout=i=>{if(e){const e=i.clientX-s[0],n=i.clientY-s[1];t.style.top=parseFloat(t.style.top)+n+"px",t.style.left=parseFloat(t.style.left)+e+"px",s[0]=i.clientX,s[1]=i.clientY}},t.appendChild(i);let n=document.createElement("button");n.style.height="70px",n.style.width="60px",n.style.zIndex="13;",n.style.position="relative",n.textContent="Import",n.onclick=()=>{},t.appendChild(n),n=document.createElement("button"),n.style.height="70px",n.style.width="60px",n.style.zIndex="13;",n.style.position="relative",n.textContent="Origin",n.onclick=()=>{this.HTMLView.app.apiCall(y.lw.NETWORK,"addOrigin",void 0)},t.appendChild(n),n=document.createElement("button"),n.style.height="70px",n.style.width="60px",n.style.zIndex="13;",n.style.position="relative",n.textContent="Destin",n.onclick=()=>{},t.appendChild(n),n=document.createElement("button"),n.style.height="70px",n.style.width="60px",n.style.zIndex="13;",n.style.position="relative",n.textContent="Destin",n.onclick=()=>{},t.appendChild(n),n=document.createElement("button"),n.style.height="70px",n.style.width="60px",n.style.zIndex="13;",n.style.position="relative",n.textContent="Destin",n.onclick=()=>{},t.appendChild(n),n=document.createElement("button"),n.style.top="0px",n.style.left="180px",n.style.height="20px",n.style.width="20px",n.style.zIndex="13",n.style.position="absolute",n.style.padding="0px",n.style.zIndex="20",n.textContent="X",n.onclick=()=>{this.remove()},t.appendChild(n),this.div=t}}class P{constructor(t){this.app=void 0,this.networkUI=void 0,this.app=t}reset(){this.removePanelNetwork()}initPanelNetwork(){this.networkUI||(this.networkUI=new C(this))}removePanelNetwork(){this.networkUI&&this.networkUI.remove()}}class E{constructor(t){this.nnaEngine=void 0,this.inspection=!0,this.m=new f.h9(0,0),this.dataOrigins=void 0,this.destinationOrigins=void 0,this.nnaEngine=t}async execution(t,i,e){t===y.lw.NETWORK&&("initPanel"===i&&this.nnaEngine.view.initPanelNetwork(),"addOrigin"===i&&(this.dataOrigins=e,this.nnaEngine.core.graphSystem.initByCPoint(e)),"addOrigins"===i&&(this.dataOrigins=e,this.dataOrigins&&this.nnaEngine.core.graphSystem.initByCPoints(this.dataOrigins)),"addDestinations"===i&&(this.destinationOrigins=e,this.destinationOrigins&&this.nnaEngine.core.graphSystem.initByCPointsBackpro(this.destinationOrigins))),t===y.lw.AGENCY&&"runAgent"===i&&this.nnaEngine.core.graphSystem.initAgentVis(),t===y.lw.GA&&"pathOptimization"===i&&e&&this.nnaEngine.core.agencySystem.gaSystem.initByCPoint(e)}mouseEvent(t){switch(this.m.x=t.x,this.m.y=t.y,t.type){case y.zK.DOWN:break;case y.zK.LEFT:this.nnaEngine.core.graphSystem.getPath(t.x,t.y);break;case y.zK.MOVE:break;case y.zK.DRAG:this.dataOrigins&&this.nnaEngine.core.graphSystem.initByCPoints(this.dataOrigins),this.destinationOrigins&&this.nnaEngine.core.graphSystem.initByCPointsBackpro(this.destinationOrigins),this.nnaEngine.core.agencySystem.gaSystem.pointData&&this.nnaEngine.core.agencySystem.update()}}}class b{constructor(t,i,e,s){this.vec=void 0,this.id=-1,this.vec=new f.h9(t,i,0),this.vec.long=e,this.vec.lat=s}distanceTo(t){return this.vec.distanceTo(t.vec)}}class M{constructor(t){this.pathsOrigin=[],this.nodes=[],this.fitness=0,this.distance=0,this.pathsOrigin=t,this.nodes=[],this.fitness=0,this.distance=0;for(let i=0;i<this.pathsOrigin.length;++i)this.nodes.push(void 0)}generateIndividual(){for(let t=0;t<this.pathsOrigin.length;++t)this.setCityInit(t,this.pathsOrigin[t]);(t=>{for(var i,e,s=t.length;0!==s;)e=Math.floor(Math.random()*s),i=t[s-=1],t[s]=t[e],t[e]=i})(this.nodes)}setCityInit(t,i){this.nodes[t]=i,this.fitness=0,this.distance=0}getFitness(){return 0===this.fitness&&(this.fitness=1/this.getDistance()),this.fitness}getDistance(){if(0===this.distance){let t=0;for(let i=0;i<this.nodes.length;++i){let e=this.nodes[i];if(e){let s;s=i===this.nodes.length-1?this.nodes[0]:this.nodes[i+1],s&&(t+=e.distanceTo(s))}}this.distance=t}return this.distance}containsCity(t){for(let i=0;i<this.nodes.length;++i)if(this.nodes[i]===t)return!0;return!1}}class I{constructor(t,i,e){this.paths=[],this.paths=[];for(let s=0;s<i;++s)this.paths.push(void 0);if(e)for(let s=0;s<i;++s){let i=new M(t);i.generateIndividual(),this.paths[s]=i}}getFittestPath(){let t=this.paths[0];for(let i=0;i<this.paths.length;++i){let e=this.paths[i];t&&e&&t.getFitness()<=e.getFitness()&&(t=e)}return t}}class S{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.nodes=void 0,this.mutationRate=void 0,this.nodeSize=void 0,this.elitism=void 0,this.nodes=t,this.mutationRate=i,this.nodeSize=e,this.elitism=s}evolvePopulation(t){const i=new I(this.nodes,t.paths.length,!1);let e=0;if(this.elitism){const s=t.getFittestPath();s&&(i.paths[0]=s,e=1)}for(let s=e;s<i.paths.length;++s){let e=this.tournamentSelection(t),n=this.tournamentSelection(t);if(e&&n){let t=this.crossover(e,n);i.paths[s]=t}}for(let s=e;s<i.paths.length;++s){let t=i.paths[s];t&&this.mutate(t)}return i}crossover(t,i){let e=new M(this.nodes),s=Math.floor(Math.random()*t.nodes.length),n=Math.floor(Math.random()*t.nodes.length);for(let o=0;o<e.nodes.length;++o){const i=t.nodes[o];i&&(s<n&&o>s&&o<n||s>n&&!1===(o<s&&o>n))&&e.setCityInit(o,i)}for(let o=0;o<i.nodes.length;++o){const t=i.nodes[o];if(t&&!1===e.containsCity(t))for(let i=0;i<e.nodes.length;++i)if(void 0===e.nodes[i]){e.setCityInit(i,t);break}}return e}mutate(t){for(let i=0;i<t.nodes.length;++i)if(Math.random()<this.mutationRate){let e=Math.floor(t.nodes.length*Math.random()),s=t.nodes[i],n=t.nodes[e];s&&n&&(t.setCityInit(e,s),t.setCityInit(i,n))}}tournamentSelection(t){let i=new I(this.nodes,this.nodeSize,!1);for(let e=0;e<this.nodeSize;++e){let s=Math.floor(Math.random()*t.paths.length);i.paths[e]=t.paths[s]}return i.getFittestPath()}}class A{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.agencySystem=void 0,this.cities=void 0,this.placesAll=void 0,this.ga=void 0,this.pop=void 0,this.pathFittest=void 0,this.timer=0,this.cost=Number.MAX_VALUE,this.pos=[],this.pointData=void 0,this.random=void 0,this.agencySystem=t,this.random=(t=>{var i=4294967295,e=123456789+t&i,s=987654321-t&i;return function(){return(((s=36969*(65535&s)+(s>>>16)&i)<<16)+(65535&(e=18e3*(65535&e)+(e>>>16)&i))>>>0)/4294967296}})(i),this.pos=[],this.init()}mouseClick(t,i){}init(){let t=this.pos.length;this.placesAll=[];for(let i=0;i<this.pos.length;++i);this.pop=new I(this.placesAll,5,!0),this.pathFittest=this.pop.getFittestPath(),this.pathFittest,this.ga=new S(this.placesAll,.1,t)}initByCPoint(t){if(void 0!==t&&(this.pointData=t),this.pointData){let t=5,i=.1,e=this.pointData.length;this.placesAll=[];for(let s=0;s<this.pointData.length;++s){let t=this.pointData[s];const i=this.agencySystem.nnaEngine.app.toMap(t[0],t[1]),e=new b(t[0],t[1],i[0],i[1]);e.vec=t.v,e.id=this.placesAll.length,this.placesAll.push(e)}this.pop=new I(this.placesAll,t,!0),this.pathFittest=this.pop.getFittestPath(),this.pathFittest,this.ga=new S(this.placesAll,i,e)}}optimize(){if(this.pop=this.ga.evolvePopulation(this.pop),this.pathFittest=this.pop.getFittestPath(),this.pathFittest){const t=this.pathFittest.getDistance();t<this.cost&&(this.cost=t),this.timer++}}render(t,i){if(this.optimize(),t.fillStyle="#ff0000",t.strokeStyle="#ff0000",t.lineWidth=1,i)for(let e=0;e<this.placesAll.length;++e);if(this.pathFittest)for(let e=0;e<this.pathFittest.nodes.length-1;e++){let i=this.pathFittest.nodes[e],s=this.pathFittest.nodes[e+1];i&&s&&(t.beginPath(),t.moveTo(i.vec.x,i.vec.y),t.lineTo(s.vec.x,s.vec.y),t.closePath(),t.stroke())}for(let e=0;e<this.placesAll.length;++e){t.beginPath();const i=this.placesAll[e];t.arc(i.vec.x,i.vec.y,10,0,2*Math.PI),t.closePath(),t.fill()}}}class D{constructor(t){this.nnaEngine=void 0,this.gaSystem=void 0,this.nnaEngine=t,this.gaSystem=new A(this)}render(t,i){this.gaSystem.render(t,i)}mouseClick(t,i){this.gaSystem.mouseClick(t,i)}update(){this.gaSystem.initByCPoint(void 0)}}class B{constructor(t){this.gs=void 0,this.gs=t}}class R{constructor(t){this.graphCore=void 0,this.nodes=[],this.edges=[],this.minPt=new f.h9(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxPt=new f.h9(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this.nodeOrigin=void 0,this.graphCore=t}initGraph(t){return this.nodes=[],this.edges=[],this.AddEdgeByLines(t),!0}AddEdgeByLines(t){let i=[];for(let e=0;e<t.length;++e){let s=t[e].p0,n=t[e].p1;this.minPt.long>s.long&&(this.minPt.long=s.long),this.minPt.lat>s.lat&&(this.minPt.lat=s.lat),this.minPt.elevation>s.elevation&&(this.minPt.elevation=s.elevation),this.maxPt.long<s.long&&(this.maxPt.long=s.long),this.maxPt.lat<s.lat&&(this.maxPt.lat=s.lat),this.maxPt.elevation<s.elevation&&(this.maxPt.elevation=s.elevation),this.minPt.long>n.long&&(this.minPt.long=n.long),this.minPt.lat>n.lat&&(this.minPt.lat=n.lat),this.minPt.elevation>n.elevation&&(this.minPt.elevation=n.elevation),this.maxPt.long<n.long&&(this.maxPt.long=n.long),this.maxPt.lat<n.lat&&(this.maxPt.lat=n.lat),this.maxPt.elevation<n.elevation&&(this.maxPt.elevation=n.elevation),i.push(this.AddNode(s)),i.push(this.AddNode(n))}for(let e=0;e<i.length;e+=2)this.AddEdge(i[e],i[e+1])}AddEdge(t,i){if(t===i)return;const e=this.FindEdge(t,i);if(void 0!==e)return e;let s=new k(t,i);return s.id=this.edges.length,this.edges.push(s),s}AddNode(t){for(let e=0;e<this.nodes.length;++e)if(t.distanceTo(this.nodes[e].point)<.1)return this.nodes[e];let i=new G(t);return i.id=this.nodes.length,this.nodes.push(i),i}FindEdge(t,i){for(let e=0;e<this.edges.length;++e)if(this.edges[e].n0===t&&this.edges[e].n1===i||this.edges[e].n0===i&&this.edges[e].n1===t)return this.edges[e]}FindClosestNode(t){if(0===this.nodes.length)return;let i=-1,e=Number.MAX_VALUE;for(let s=0;s<this.nodes.length;++s){let n=this.nodes[s].point.distanceTo(t);n<e&&(i=s,e=n)}return this.nodes[i]}updatePropagation(t,i,e){for(let s=0;s<this.nodes.length;++s)this.nodes[s].networkDistance=-1,this.nodes[s].euclideanDistance=-1;for(let s=0;s<t.length;++s){let n=this.nodes[t[s].nodeOrigin.id];n.networkDistance=0,n.euclideanDistance=0,this.updatePropagationByNode(n,i,e)}}updatePropagationByNodes(t,i,e){for(let s=0;s<this.nodes.length;++s)this.nodes[s].reset();for(let s=0;s<t.length;++s){let n=t[s];n.networkDistance=0,n.euclideanDistance=0;let o=[];o.push(t[s]);for(let t=0;t<1e6&&0!==o.length;++t){let t=o[0],s=t.point.distanceToGeo(n.point);(-1===t.euclideanDistance||s<t.euclideanDistance)&&(t.euclideanDistance=t.point.distanceToGeo(n.point)),o.shift();for(let n=0;n<t.nodes.length;++n){let s=t.nodes[n],h=i(t,s,e),a=t.networkDistance+h;(-1===s.networkDistance||a<s.networkDistance)&&(s.networkDistance=a,o.push(s))}}}}updatePropagationByNode(t,i,e){this.nodeOrigin=t;for(let n=0;n<this.nodes.length;++n)this.nodes[n].reset();let s=[];s.push(t);for(let n=0;n<1e6&&0!==s.length;++n){let n=s[0],o=n.point.distanceToGeo(t.point);(-1===n.euclideanDistance||o<n.euclideanDistance)&&(n.euclideanDistance=n.point.distanceToGeo(t.point)),s.shift();for(let t=0;t<n.nodes.length;++t){let o=n.nodes[t],h=i(n,o,e),a=n.networkDistance+h;(-1===o.networkDistance||a<o.networkDistance)&&(o.networkDistance=a,s.push(o))}}}updateBackpropagation(t){let i=[],e=0,s=0,n=0;for(e=0;e<t.length;++e){let o=this.FindClosestNode(t[e]),h=[];if(-1!==o.networkDistance){h.push(this.nodes[o.id]);let t=o;for(s=0;s<1e5;++s){let e=t;for(e.countVisit++,n=0;n<t.nodes.length;++n){let i=t.nodes[n];i.networkDistance<e.networkDistance&&(e=i)}if(e===t){h.push(this.nodeOrigin),i.push(h);break}t=e,h.push(this.nodes[t.id])}}}return i}}class k{constructor(t,i){this.id=-1,this.n0=void 0,this.n1=void 0,this.mp=void 0,this.CONNECTIVITY=void 0,this.n0=t,this.n1=i,this.n0.edges.push(this),this.n1.edges.push(this),t.nodes.push(i),i.nodes.push(t),this.mp=this.GetMidPoint(),this.CONNECTIVITY=y._6.CONNECTED}GetMidPoint(){return f.h9.getMidVec(this.n0.point,this.n1.point)}updateScreenPos(t){this.n0.updateScreenPos(t),this.n1.updateScreenPos(t)}}class G{constructor(t){this.id=-1,this.point=void 0,this.edges=[],this.nodes=[],this.networkDistance=-1,this.euclideanDistance=0,this.countVisit=0,this.countOrigin=1,this.countDestination=1,this.countVisitTemp=0,this.point=new f.h9(t.x,t.y,t.z),this.point.lat=t.lat,this.point.long=t.long}reset(){this.networkDistance=-1,this.euclideanDistance=0,this.countVisit=0,this.countVisitTemp=0}deepCopy(){let t=new G(this.point);return t.id=this.id,t}updateScreenPos(t){const i=t(this.point.long,this.point.lat);this.point.x=i[0],this.point.y=i[1]}}class N{constructor(t,i){this.gc=void 0,this.Optimizer=void 0,this.edges=[],this.nodes=[],this.nodeDestinations=[],this.nodeOrigin=void 0,this.pointOrigin=void 0,this.polylines=[],this.paths=[],this.gc=t,this.duplicateGraph(),this.updateOriginByPt(i)}updateOriginByPt(t){let i=this.gc.graph.FindClosestNode(t);i&&(this.nodeOrigin=this.nodes[i.id],this.pointOrigin=new f.h9(t.x,t.y,t.z))}updatePropagation(t,i){this.Optimizer=t;for(let s=0;s<this.nodes.length;++s)this.nodes[s].networkDistance=-1;let e=[];this.nodeOrigin.networkDistance=0,e.push(this.nodeOrigin);for(let s=0;s<1e6&&0!==e.length;++s){let s=e[0];s.euclideanDistance=s.point.distanceTo(this.nodeOrigin.point),e.shift();for(let n=0;n<s.nodes.length;++n){let o=s.nodes[n],h=t(s,o,i),a=s.networkDistance+h;(-1===o.networkDistance||a<o.networkDistance)&&(o.networkDistance=a,e.push(o))}}}updateBackpropagation(t){this.nodeDestinations=G[t.length];let i=[],e=0,s=0,n=0;for(e=0;e<t.length;++e){let o=this.nodes[t[e]];this.nodeDestinations[e]=o;let h=[];if(-1!==o.networkDistance){h.push(this.nodes[o.id]);let t=o;for(s=0;s<1e5;++s){let e=t;for(e.countVisit++,n=0;n<t.nodes.length;++n){let i=t.nodes[n];i.networkDistance<e.networkDistance&&(e=i)}if(e===t){h.push(this.nodeOrigin),h[0].euclideanDistance=h[0].point.distanceTo(this.nodeOrigin.point),i.push(h);break}t=e,h.push(this.nodes[t.id])}}}return this.paths=i,i}GetPathsPolylines(t,i){let e=[];for(let s=0;s<this.paths.length;++s){let n=new g.W7;for(let t=0;t<this.paths[s].length;++t)n.push(this.paths[s][t].point);t<this.paths[s][0].networkDistance&&this.paths[s][0].networkDistance<i&&e.push(n)}return this.polylines=e,this.polylines}duplicateGraph(){let t=0,i=-1,e=-1;for(this.nodes=[],this.edges=[],t=0;t<this.gc.graph.nodes.length;++t)this.nodes.push(this.gc.graph.nodes[t].deepCopy());for(t=0;t<this.gc.graph.edges.length;++t){i=this.gc.graph.edges[t].n0.id,e=this.gc.graph.edges[t].n1.id;let s=new k(this.nodes[i],this.nodes[e]);s.id=this.gc.graph.edges[t].id,this.edges.push(s)}}}const T=function(t,i){return(0,f.MX)(i.point,t.point)};class V{constructor(t){this.gs=void 0,this.trees=[],this.destinations=[],this.idDestination=[],this.graph=void 0,this.gs=t,this.trees=[],this.destinations=[],this.idDestination=[]}initGraph(t){this.graph=new R(this),this.graph.initGraph(t)}setUnit(t){}computePath(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.trees=[];this.computePathWeighted(t,[],i,[],e)}computePathWeighted(t,i,e,s){for(;t.length<i.length;)i.push(1);for(;e.length<s.length;)s.push(1);this.updatePropagation(t,i),this.updateBackpropagation(e,s),this.mergeAgents()}updatePropagation(t,i){for(let e=0;e<t.length;++e){let i=t[e];if(e===this.trees.length-1)this.trees[e].pointOrigin.distanceToGeo(i)<.1||this.trees[e].updateOriginByPt(i),this.trees[e].updatePropagation(T,.002);else{let t=new N(this,i);t.updatePropagation(T,.002),this.trees.push(t)}}}updateBackpropagation(t,i){for(let e=0;e<t.length;++e)if(e===this.destinations.length-1)if(t[e].distanceToGeo(this.destinations[e])<.1)this.idDestination.push(this.idDestination[e]);else{let i=this.graph.FindClosestNode(t[e]);i&&(this.idDestination[e]=i.id,this.destinations[e]=t[e])}else{let i=this.graph.FindClosestNode(t[e]);i&&(this.idDestination.push(i.id),this.destinations.push(t[e]))}for(let e=0;e<this.trees.length;++e){this.trees[e].updateBackpropagation(this.idDestination)}}mergeAgents(){this.graph.updatePropagation(this.trees,T,.002);for(let t=0;t<this.trees.length;++t)for(let i=0;i<this.trees[t].nodes.length;++i)this.graph.nodes[i].countVisit+=this.trees[t].nodes[i].countVisit,this.graph.nodes[i].countOrigin+=this.trees[t].nodes[i].countOrigin,this.graph.nodes[i].countDestination+=this.trees[t].nodes[i].countDestination}}class F{constructor(){this.lineWidth=.5,this.strokeStyle="rgba(0, 255, 0, 0.5)"}}class L{constructor(t){this.gs=void 0,this.BoidsBehaviors=void 0,this.start=void 0,this.end=void 0,this.path=[],this.selPath=void 0,this.time=0,this.properties=new F,this.gs=t}render(t,i){var e;if(t.lineWidth=this.properties.lineWidth,t.strokeStyle=this.properties.strokeStyle,null!==(e=this.gs.graphCore.graph)&&void 0!==e&&e.edges)for(let a=0;a<this.gs.graphCore.graph.edges.length;++a){const e=this.gs.graphCore.graph.edges[a];i&&e.updateScreenPos(this.gs.nnaEngine.app.toScreen),t.beginPath();const s=(0,g.GM)(.001*e.n0.networkDistance);t.strokeStyle="rgba(".concat(s[0],", ").concat(s[1],", ").concat(s[2],", 1.0) "),t.moveTo(e.n0.point.x,e.n0.point.y),t.lineTo(e.n1.point.x,e.n1.point.y),t.stroke();const n=e.n0.point.distanceToGeo(e.n1.point);!i&&this.gs.nnaEngine.app.controller.inspection&&(t.font="10px Arial",t.fillStyle="#000000",t.fillText("".concat(n.toFixed(2)),e.n0.point.x+.5*(e.n1.point.x-e.n0.point.x),e.n0.point.y+.5*(e.n1.point.y-e.n0.point.y)))}t.fillStyle="#ffffff",this.start&&(t.beginPath(),t.arc(this.start.x,this.start.y,5,0,2*Math.PI),t.closePath(),t.fill()),this.end&&(t.beginPath(),t.arc(this.end.x,this.end.y,15,0,2*Math.PI),t.closePath(),t.fill());let s=-1,n=Number.MAX_SAFE_INTEGER;const o=this.gs.nnaEngine.app.controller.m.x,h=this.gs.nnaEngine.app.controller.m.y;t.globalCompositeOperation=y.kz.COLOR_DODGE;for(let a=0;a<this.path.length;++a){t.strokeStyle="rgba(255, 255, 10, 1)",t.lineWidth=2.4,t.setLineDash([5,4]),t.beginPath(),t.moveTo(this.path[a][0].point.x,this.path[a][0].point.y);let i=(0,f.tl)(this.path[a][0].point.x,this.path[a][0].point.y,o,h);i<n&&(n=i,s=a);for(let e=1;e<this.path[a].length;++e)this.path[a][e]&&(t.lineTo(this.path[a][e].point.x,this.path[a][e].point.y),i=(0,f.tl)(this.path[a][e].point.x,this.path[a][e].point.y,o,h),i<n&&(n=i,s=a));t.stroke(),t.lineDashOffset=-5*this.time,t.setLineDash([])}if(this.path.length>0&&n<10){this.selPath=this.path[s],t.beginPath(),t.moveTo(this.selPath[0].point.x,this.selPath[0].point.y);for(let i=1;i<this.selPath.length;++i)this.selPath[i]&&t.lineTo(this.selPath[i].point.x,this.selPath[i].point.y);t.lineWidth=4.4,t.stroke(),t.lineDashOffset=-5*this.time,t.setLineDash([])}else this.selPath=void 0;t.globalCompositeOperation=y.kz.SOURCE_OVER,this.time+=.1,this.BoidsBehaviors&&(this.BoidsBehaviors.Update(),this.BoidsBehaviors.Render(t))}getPath(t,i){this.selPath}}class O{constructor(t){this.r=5,this.nodes=void 0,this.nodes=[],this.r=t}AddNode(t){this.nodes.push(t)}GetNodes(){let t=[];for(let i=0;i<this.nodes.length;++i)t.push(new f.h9(this.nodes[i].x,this.nodes[i].y,0));return t}}class z{constructor(t,i,e){this.MAX_FORCE=void 0,this.position=void 0,this.velocity=void 0,this.maxVelocity=void 0,this.desired=void 0,this.steering=void 0,this.mass=void 0,this.boidsPath=void 0,this.currentNode=void 0,this.pathDir=void 0,this.rotation=void 0,this.vec=void 0,this.preVec=void 0,this.avoidance=void 0,this.ahead=void 0,this.alpha=void 0,this.isOriented=void 0,this.activeBase64ID=" ",this.angle=void 0,z.MAX_FORCE=z.MAX_VELOCITY,this.MAX_FORCE=z.MAX_FORCE,this.position=new f.h9(t,i),this.velocity=new f.h9(-1,-2),this.desired=new f.h9(0,0),this.steering=new f.h9(0,0),this.vec=new f.h9(0,0),this.rotation=0,this.mass=e,this.currentNode=0,this.pathDir=1,this.angle=0,this.isOriented=!1,this.avoidance=new f.h9(0,0),this.maxVelocity=this.MAX_FORCE*(.8+.6*Math.random()),this.Truncate(this.velocity,this.maxVelocity),this.preVec=[]}CollisionAvoidance(){let t,i=this.velocity.Clone();return i.normalize(),i.scale(z.MAX_AVOID_AHEAD*this.velocity.Length()/this.maxVelocity),this.ahead=this.position.Clone().Add(i),void 0!==t?(this.alpha=.4,this.avoidance.normalize(),this.avoidance.scale(z.AVOID_FORCE)):(this.alpha=1,this.avoidance.scale(0)),this.avoidance}Distance(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))}Truncate(t,i){let e=i/t.Length();e=e<1?e:1,t.scale(e)}GetAngle(t){return Math.atan2(t.y,t.x)}Update(){if(this.steering=this.PathFollowing(),this.steering=this.steering.Add(this.CollisionAvoidance()),this.Truncate(this.steering,this.MAX_FORCE),this.steering.scale(1/this.mass),this.velocity=this.velocity.Add(this.steering),this.Truncate(this.velocity,this.maxVelocity),this.position=this.position.Add(this.velocity),this.isOriented){let t=new f.h9(this.velocity.x,this.velocity.y);this.rotation=t.GetAngle()}this.vec=new f.h9(this.position.x,this.position.y),this.AddVecHistory()}AddVecHistory(){this.preVec.push(new f.h9(this.vec.x,this.vec.y)),this.preVec.length>20&&this.preVec.shift()}Render(t){if(this.DrawTail(t)," "!==this.activeBase64ID){t.globalCompositeOperation="source-over";let i=new Image;i.src=this.activeBase64ID,t.save(),t.globalAlpha=.85,t.translate(this.vec.x,this.vec.y),t.rotate(this.rotation),t.drawImage(i,-i.width/2,-i.width/2),t.restore(),t.globalCompositeOperation="lighter"}else t.beginPath(),t.fillStyle="rgba(0,255,0,0.7)",t.arc(this.vec.x,this.vec.y,5,0,6.28);t.closePath(),t.fill()}DrawTail(t){let i=this.preVec.length;for(;i--;)t.beginPath(),t.fillStyle="rgba(0,255,0,".concat(x(i,0,this.preVec.length,.01,.175),")"),t.arc(this.preVec[i].x,this.preVec[i].y,x(i,0,this.preVec.length,.1,10),0,6.28),t.closePath(),t.fill()}DrawShape(t){t.fillStyle="#FF0000",t.lineWidth=.1,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-20),t.lineTo(10,20),t.lineTo(-10,20),t.lineTo(0,-20),t.closePath(),t.moveTo(0,0)}DrawForces(t){let i=this.velocity.Clone(),e=this.steering.Clone(),s=this.desired.Clone();i.normalize(),e.normalize(),s.normalize(),this.DrawForceVector(t,i,"#00FF00"),this.DrawForceVector(t,s,"#0000FF")}DrawForceVector(t,i,e){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;t.strokeStyle=e,t.beginPath(),t.moveTo(this.vec.x,this.vec.y),t.lineTo(this.vec.x+i.x*s,this.vec.y+i.y*s),t.closePath(),t.stroke()}Seek(t){let i;return this.desired=t.Sub(this.position),this.desired.normalize(),this.desired.scale(this.maxVelocity),i=this.desired.Sub(this.velocity),i}PathFollowing(){let t,i=this.boidsPath.GetNodes();return t=i[this.currentNode],this.Distance(this.position,t)<=this.boidsPath.r&&(this.currentNode+=this.pathDir,(this.currentNode>=i.length||this.currentNode<0)&&(this.pathDir*=-1,this.currentNode+=this.pathDir)),void 0!==t?this.Seek(t):new f.h9(0,0,0)}}z.MAX_VELOCITY=5,z.MAX_FORCE=3,z.MAX_AVOID_AHEAD=50,z.AVOID_FORCE=600,z.MAX_QUEUE_AHEAD=30,z.MAX_QUEUE_RADIUS=30,z.MAX_SEPARATION=2,z.SEPARATION_RADIUS=30;class _{constructor(t,i){this.boids=[],this.boidsPath=void 0,this.t=void 0,this.isOriented=void 0,this.activeBase64ID=void 0,_.instance=this,_.width=t,_.height=i,this.isOriented=!1,this.t=0}InitPathByAPolyline(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;this.boidsPath=t,this.InitBoid(i)}InitPathByNode(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;this.boidsPath=new O(10);for(let e=0;e<t.length;++e)t[e]&&this.boidsPath.AddNode(t[e].point);this.InitBoid(i)}InitPath(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;this.boidsPath=t,this.Init(i,e)}Init(t,i){this.reset(),this.boidsPath.r=30;let e=t;for(let s=0;s<e;s++){let t=new f.h9(_.width*s/e+50,_.height*Math.random()*.8+20,0);this.boidsPath.AddNode(t)}this.InitBoid(i)}InitBoid(){let t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;for(let e=0;e<i;e++)t=new z(_.width/2+50*Math.random(),20*Math.random(),20+20*Math.random()),t.activeBase64ID=this.activeBase64ID,t.boidsPath=this.boidsPath,this.boids.push(t)}ShiftSpeed(t,i){for(let e of this.boids)e.maxVelocity=w(t,i)}IncreasePathRadius(){_.showForces=!0,this.boidsPath.r+=2}DecreasePathRadius(){_.showForces=!0,this.boidsPath.r-=2}ToggleShowForces(){_.showForces=!_.showForces}ShiftRadius(t){this.boidsPath.r=t}ShiftForce(t,i){for(let e of this.boids)e.maxVelocity=w(t,i)}ShiftOriented(t){for(let i of this.boids)i.isOriented=t}reset(){}Update(){for(let t=0;t<this.boids.length;t++)this.boids[t].Update();this.t>16&&(this.t=0),this.t+=.5}Render(t){t.globalCompositeOperation="lighter",this.drawPath(t);for(let i=0;i<this.boids.length;i++)this.boids[i].Render(t);t.globalCompositeOperation="source-over"}drawPath(t){let i=this.boidsPath.GetNodes();for(let e=0;e<i.length;++e)this.drawPathPoint(t,i[e],"#FF00CC"),_.showForces&&this.drawCircle(t,i[e],"gray",this.boidsPath.r);t.beginPath(),t.lineWidth=.2,t.strokeStyle="#ffffff",t.setLineDash([4,4]),t.lineDashOffset=-this.t,t.moveTo(i[0].x,i[0].y);for(let e=1;e<i.length;++e)t.lineTo(i[e].x,i[e].y);t.stroke(),t.setLineDash([0,0]),t.beginPath(),t.lineWidth=.3,t.strokeStyle="#000000",t.setLineDash([4,8]),t.lineDashOffset=-this.t,t.moveTo(i[0].x,i[0].y);for(let e=1;e<i.length;++e)t.lineTo(i[e].x,i[e].y);t.stroke(),t.setLineDash([0,0])}drawPathPoint(t,i,e){t.fillStyle="rgba(255,0,0,0.6)",t.beginPath(),t.arc(i.x,i.y,2.5,0,6.28),t.closePath(),t.fill(),t.stroke()}drawCircle(t,i,e,s){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,2,0,6.28),t.closePath(),t.fill(),t.stroke()}set IsOrient(t){this.isOriented=t,this.ShiftOriented(t)}get IsOrient(){return this.isOriented}}_.mouse=new f.h9(100,100,0),_.width=400,_.height=400,_.showForces=!1,_.instance=void 0;class j{constructor(t){this.nnaEngine=void 0,this.analysis=void 0,this.graphCore=void 0,this.renderGraph=void 0,this.nnaEngine=t,this.analysis=new B(this),this.graphCore=new V(this),this.renderGraph=new L(this)}initGraph(t){this.graphCore.initGraph(t)}setUnit(t){this.graphCore.setUnit(t)}computePath(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.graphCore.computePath(t,i,e)}render(t,i){this.renderGraph.render(t,i)}mouseClick(t,i){this.initTwoPoint();const e=this.graphCore.graph.FindClosestNode(this.renderGraph.start),s=function(t,i){return.5*i.point.distanceTo(t.point)};e&&this.graphCore.graph.updatePropagationByNode(e,s,.02)}getPath(t,i){this.renderGraph.getPath(t,i)}initByCPoints(t){const i=[];for(let e=0;e<t.length;++e){const s=this.graphCore.graph.FindClosestNode(t[e].v);i.push(s)}this.graphCore.graph.updatePropagationByNodes(i,T,.02)}initByCPointsBackpro(t){const i=[];for(let s=0;s<t.length;++s)i.push(t[s].v);const e=this.graphCore.graph.updateBackpropagation(i);this.renderGraph.path=e}initByCPoint(t){if(t.length>0){const i=t[0].v,e=[];for(let n=1;n<t.length;++n)e.push(t[n].v);const s=this.graphCore.graph.FindClosestNode(i);if(this.renderGraph.start=s.point,s){this.graphCore.graph.updatePropagationByNode(s,T,.02);const t=this.graphCore.graph.updateBackpropagation(e);this.renderGraph.path=t,this.initAgentVis()}}}initAgentVis(){var t;this.renderGraph.path[0]&&void 0===this.renderGraph.BoidsBehaviors&&(this.renderGraph.BoidsBehaviors=new _(500,500),null===(t=this.renderGraph.BoidsBehaviors)||void 0===t||t.InitPathByNode(this.renderGraph.path[0],10))}initTwoPoint(){const t=this.graphCore.graph.maxPt.x-this.graphCore.graph.minPt.x,i=this.graphCore.graph.maxPt.y-this.graphCore.graph.minPt.y;let e=this.graphCore.graph.minPt.x+t*Math.random(),s=this.graphCore.graph.minPt.y+i*Math.random();this.renderGraph.start=this.graphCore.graph.nodes[Math.floor((this.graphCore.graph.nodes.length-1)*Math.random())].point,e=this.graphCore.graph.minPt.x+t*Math.random(),s=this.graphCore.graph.minPt.y+i*Math.random(),this.renderGraph.end=this.graphCore.graph.nodes[Math.floor((this.graphCore.graph.nodes.length-1)*Math.random())].point}}class U{constructor(t){this.nnaEngine=void 0,this.nnaEngine=t}}class X{constructor(t){this.app=void 0,this.agencySystem=void 0,this.graphSystem=void 0,this.voxelSystem=void 0,this.app=t,this.agencySystem=new D(this),this.graphSystem=new j(this),this.voxelSystem=new U(this)}initGraph(t){this.graphSystem.initGraph(t)}setUnit(t){this.graphSystem.setUnit(t)}computePath(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.graphSystem.computePath(t,i,e)}render(t,i){this.graphSystem.render(t,i),this.agencySystem.render(t,i),t.fillStyle="#ffffff",t.font="12px Arial";const e=this.app.toMap(this.app.controller.m.x,this.app.controller.m.y);t.fillText("Lat: ".concat(e[0],", Lon: ").concat(e[1],", Zoom level: "),150,20)}}class K{constructor(t){this.NNAEngineV3=void 0,this.NNAEngineV3=t}async importCSV(t){return fetch(t).then((t=>t.text())).then((t=>t)).catch((t=>{}))}}class H{toScreen(t,i){return[t,i]}toMap(t,i){return[t,i]}constructor(){this.view=void 0,this.core=void 0,this.io=void 0,this.controller=void 0,this.data=void 0,this.lastCalledTime=Date.now(),this.fps=30,this.delta=1,this.controller=new E(this),this.view=new P(this),this.core=new X(this),this.io=new K(this);(0,g.Mo)()}importDummyData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://raw.githubusercontent.com/NamjuLee/data/master/NYC/NY_street_lat_long.csv";this.io.importCSV(t).then((t=>{this.data=new g.UO,this.data.ComputeCSV(t),this.data.initLines(((t,i)=>this.toScreen(t,i))),this.core.graphSystem.initGraph(this.data.lineTest)}))}updateProjection(t){this.toScreen=t.toScreen,this.toMap=t.toMap}apiCall(t,i,e){this.controller.execution(t,i,e)}initGraph(t){this.core.initGraph(t)}reset(){this.view.reset()}setUnit(t){this.core.setUnit(t)}computePath(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.core.computePath(t,i,e)}mouseEvent(t){this.controller.mouseEvent(t)}keyEvent(t){}render(t,i){this.core.render(t,i),this.ComputeFPS()}ComputeFPS(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}}class W{constructor(t){this.activeCommandController=void 0,this.type=y.NI.SELECT,this.activeCommandController=t}mouseEvent(t){switch(t.type){case y.zK.LEFT:return void this.MouseLeftClickPre(t);case y.zK.MIDDLE:return void this.MouseMiddleClickPre(t);case y.zK.RIGHT:return void this.MouseRightClickPre(t);case y.zK.DOUBLE:return void this.MouseDoubleClickPre(t);case y.zK.MOVE:return void this.MouseMovePre(t);case y.zK.DRAG:return void this.MouseDragPre(t);case y.zK.DOWN:return void this.MouseDownPre(t);case y.zK.UP:return void this.MouseUpPre(t);case y.zK.WHEEL:return void this.MouseWheelPre(t)}}MouseDown(t){}MouseDownPre(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.MouseDown(t)}MouseLeftClick(t){}MouseLeftClickPre(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.activeCommandController.drawingEngine.scene.capture?this.activeCommandController.drawingEngine.scene.capture.isSelected=!this.activeCommandController.drawingEngine.scene.capture.isSelected:this.activeCommandController.drawingEngine.geometryCommon.resetSelections(),this.MouseLeftClick(t)}MouseMiddleClick(t){}MouseMiddleClickPre(t){this.MouseMiddleClick(t)}MouseRightClick(t){}MouseRightClickPre(t){this.MouseRightClick(t)}MouseUp(t){}MouseUpPre(t){this.activeCommandController.drawingEngine.scene.capture=void 0,this.MouseUp(t)}MouseDoubleClick(t){}MouseDoubleClickPre(t){this.MouseDoubleClick(t)}MouseMove(t){}MouseMovePre(t){this.activeCommandController.drawingEngine.geometryCommon.updateHover(t.x,t.y),this.MouseMove(t)}MouseDrag(t){}MouseDragPre(t){if(this.activeCommandController.drawingEngine.scene.capture){const i=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);this.activeCommandController.drawingEngine.scene.capture.translate(t.x,t.y,i[0],i[1])}this.MouseDrag(t)}MouseWheel(t){}MouseWheelPre(t){this.MouseWheel(t)}}class Y{constructor(t){this.geometryBase=void 0,this.isCollided=!1,this.neighborShapes=[],this.minVec=void 0,this.maxVec=void 0,this.isVisited=!1,this.numOrder=-1,this.geometryBase=t;this.minVec=new f.h9(this.geometryBase.v.x-5,this.geometryBase.v.y-5,0),this.maxVec=new f.h9(this.geometryBase.v.x+5,this.geometryBase.v.y+5,0)}Reset(){this.neighborShapes=[],this.numOrder=-1,this.geometryBase.numVisit=0,this.geometryBase.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}}class J{constructor(t,i,e){this.scene=void 0,this.v=void 0,this.type=void 0,this.id="",this.numVisit=0,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.collision=void 0,this.scene=t,this.v=new f.h9(i,e,0),this.id=(()=>{let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){let e=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===i?e:3&e|8).toString(16)}))})(),this.collision=new Y(this)}toJson(){return{}}translate(t,i,e,s){}isInside(t,i){return!1}update(t,i){}render(t,i){}renderPost(t,i){}}class Z extends J{constructor(t,i){super(t,i.x,i.y),this.r=5,this.id=void 0,this.t=0,this.color="#00ff00",this.colorHover="#0ffff0",this.collision=void 0,this.type=y.mB.point,this.v=new f.h9(i.x,i.y,i.z)}translate(t,i,e,s){this.v.x=t,this.v.y=i,this.v.long=e,this.v.lat=s}isInside(t,i){return(0,f.tl)(this.v.x,this.v.y,t,i)<this.r+3?(this.isHover=!0,!0):(this.isHover=!1,!1)}update(t,i){if(t&&this.scene.drawingEngine.projection.isCustom){const t=i(this.v.long,this.v.lat);this.v.x=t[0],this.v.y=t[1]}}toJson(){return{x:this.v.x,y:this.v.y}}renderPost(t,i){let e=this.r+Math.sin(this.t);this.isHover?(e+=3,t.fillStyle=this.colorHover):t.fillStyle=this.color,t.beginPath(),t.arc(this.v.x,this.v.y,e,0,2*Math.PI),t.closePath(),t.fill(),this.isSelected&&(t.lineWidth=3,t.strokeStyle="#ffffff",t.stroke()),this.t+=.06}}class q extends W{constructor(t){super(t),this.type=y.NI.SELECT}MouseLeftClick(t){}}class Q extends W{constructor(t){super(t),this.type=y.NI.POINT}MouseLeftClick(t){const i=new Z(this.activeCommandController.drawingEngine.scene,{x:t.x,y:t.y,z:0}),e=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);i.v.long=e[0],i.v.lat=e[1],this.activeCommandController.drawingEngine.scene.addGeometry(i),this.activeCommandController.hasShift||this.activeCommandController.drawingEngine.setCommand()}}class $ extends W{constructor(t){super(t),this.type=y.NI.LINE}MouseLeftClick(t){}}var tt=e(59475);class it{constructor(t){this.drawingEngine=void 0,this.activeCommand=void 0,this.commands={},this.hasShift=!1,this.inspection=!1,this.drawingEngine=t,this.commands={SELECT:new q(this),POINT:new Q(this),LINE:new $(this)},this.activeCommand=this.commands[y.NI.SELECT]}setCommander(t){switch(t){case y.NI.SELECT:case y.NI.POINT:case y.NI.LINE:this.activeCommand=this.commands[t]}}apiCall(t){switch(t){case"getSelectedCPoint":return this.drawingEngine.geometryCommon.getSelCPoint();case"importZipData":return this.popZipData();case"importClustering":return this.drawingEngine.addon.InitClustering();case"importClusteringCollision":return this.drawingEngine.addon.InitClusteringCollision();case"save":return this.drawingEngine.geometryCommon.toJson()}}async popZipData(){const t=await(0,tt.rd)("https://raw.githubusercontent.com/NamjuLee/data/master/US/zip.json");let i=0;for(let e of t.pos){if(this.greatePointByGeoPos(e[0],e[1]).t+=10*Math.random(),i++>2e3)return}}greatePointByGeoPos(t,i){const e=this.drawingEngine.projection.toScreen(t,i),s=new Z(this.drawingEngine.scene,{x:e[0],y:e[1],z:0});return s.v.long=t,s.v.lat=i,this.drawingEngine.scene.addGeometry(s),s}}class et{constructor(t){this.drawingEngine=void 0,this.isCustom=!1,this.drawingEngine=t}updateProjection(t){this.toMap=t.toMap,this.toScreen=t.toScreen,this.isCustom=!0}toScreen(t,i){return[t,i]}toMap(t,i){return[t,i]}}class st{constructor(t){this.drawingEngine=void 0,this.firebaseConfig={apiKey:"AIzaSyA1yKg85WGZoshbk8xR23cXr3SwpqXVgIc",authDomain:"njs-data.firebaseapp.com",projectId:"njs-data",storageBucket:"njs-data.appspot.com",messagingSenderId:"635991152770",appId:"1:635991152770:web:722f5356e0d14cea50fc9b"},this.getData=t=>{let i=t.val();for(let e in i);},this.getError=t=>{console.error(t)},this.drawingEngine=t}sendData(t){}}class nt{constructor(t){this.drawingEngine=void 0,this.drawingEngine=t}find(t,i){for(let e in this.drawingEngine.scene.geoDict)if(this.drawingEngine.scene.geoDict[e].isInside(t,i))return this.drawingEngine.scene.geoDict[e]}resetSelections(){for(let t=0;t<this.drawingEngine.scene.geometryList.length;++t)this.drawingEngine.scene.geometryList[t].isSelected=!1}getAllVecFromCPoint(){const t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i].v);return t}getAllFromCPoint(){const t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i]);return t}getSelCPoint(){const t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)this.drawingEngine.scene.pointList[i].isSelected&&t.push(this.drawingEngine.scene.pointList[i]);return t}updateHover(t,i){for(let e=0;e<this.drawingEngine.scene.geometryList.length;++e)this.drawingEngine.scene.geometryList[e].isInside(t,i)}toJson(){const t=[];for(let i=0;i<this.drawingEngine.scene.geometryList.length;++i)t.push(this.drawingEngine.scene.geometryList[i].toJson());return t}}var ot=e(92522),ht=e(43891);class at{constructor(t,i){this.renderer=void 0,this.points=void 0,this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new ht.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new ht.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.minVec=void 0,this.maxVec=void 0,this.vec=new ht.h9(0,0,0),this.t=1,this.GridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=t,this.points=i;for(let e=0;e<this.points.length;++e)this.vec.x+=this.points[e].v.x,this.vec.y+=this.points[e].v.y,this.UpdateBoundingBox(this.points[e].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new ht.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new ht.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}IsInside(t){return(0,ht.TE)(this.vec,t)<this.r1?(this.isHover=!0,!0):(this.isHover=!1,!1)}AddPost(t){if(!this.points.includes(t)){this.points.push(t),this.vec=new ht.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new ht.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new ht.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}NeedDecompose(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.GridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.GridResolution}Split(){this.DeepRemove();const t=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution,i=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution,e=this.buildGrid(t,i);this.BuildSubCluster(e,t,i)}Merge(t){this.points.concat(t.points),this.vec=new ht.h9(0,0,0);for(let i=0;i<this.points.length;++i)this.vec.x+=this.points[i].v.x,this.vec.y+=this.points[i].v.y,this.UpdateBoundingBox(this.points[i].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new ht.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new ht.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),t.DeepRemove()}DeepRemove(){this.renderer.RemoveCluster(this)}buildGrid(t,i){this.tempGeoGridList=[];let e=[];for(let s=0;s<i;++s){const i=this.boundingBoxMin.y+s*this.GridResolution,n=[];for(let s=0;s<t;++s){const t=this.boundingBoxMin.x+s*this.GridResolution;e.push(new ht.h9(t,i));const o=[];n.push(o)}this.tempGeoGridList.push(n)}return this.tempVecGridList=e,e}BuildSubCluster(t,i,e){for(let s=0;s<this.points.length;++s)this.GetCellAtPoint(this.points[s].v,i,e).push(this.points[s]);for(let s=0;s<this.tempGeoGridList.length;++s)for(let t=0;t<this.tempGeoGridList[s].length;++t)this.tempGeoGridList[s][t]&&(1===this.tempGeoGridList[s][t].length?this.tempGeoGridList[s][t][0].collision.Reset():this.tempGeoGridList[s][t].length>1&&this.renderer.clustersRPoint.push(new at(this.renderer,this.tempGeoGridList[s][t])))}GetCellAtPoint(t,i,e){let s=new ht.h9(t.x-this.boundingBoxMin.x,t.y-this.boundingBoxMin.y),n=Math.round(s.x/this.GridResolution),o=Math.round(s.y/this.GridResolution);return n>=i&&(n=i-1),o>=e&&(o=e-1),n<0&&(n=0),o<0&&(o=0),n=Math.round(n),o=Math.round(o),this.tempGeoGridList[o][n]}Draw(t,i,e){if(this.UpdateTimeer(),e){this.vec=new ht.h9(0,0,0),this.boundingBoxMin=new ht.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new ht.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new ht.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new ht.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(i.optimizer.inspection&&(t.beginPath(),t.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),t.closePath(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(),t.lineWidth=.5,t.beginPath(),t.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),t.closePath(),t.stroke(),this.tempVecGridList.length>0))for(let s=0;s<this.tempVecGridList.length;++s)t.beginPath(),t.rect(this.tempVecGridList[s].x,this.tempVecGridList[s].y,this.GridResolution,this.GridResolution),t.closePath(),t.stroke()}UpdateTimeer(){this.t-=.1,this.t=this.t<.4?.4:this.t}UpdateBoundingBox(t){this.boundingBoxMin.x=t.x<this.boundingBoxMin.x?t.x:this.boundingBoxMin.x,this.boundingBoxMin.y=t.y<this.boundingBoxMin.y?t.y:this.boundingBoxMin.y,this.boundingBoxMax.x=t.x>this.boundingBoxMax.x?t.x:this.boundingBoxMax.x,this.boundingBoxMax.y=t.y>this.boundingBoxMax.y?t.y:this.boundingBoxMax.y}}class rt{constructor(t){this.clustersRPoint=[],this.optimizer=void 0,this.optimizer=t}InitGeometry(){this.clustersRPoint=[]}addClusterByGeometries(t){for(let i=0;i<t.length;++i)this.clustersRPoint.push(new at(this,t[i]))}RemoveCluster(t){this.clustersRPoint.splice(this.clustersRPoint.indexOf(t),1)}Render(t,i){if(this.clustersRPoint.length>0)for(let e=0;e<this.clustersRPoint.length;++e)this.clustersRPoint[e].Draw(t,this,i)}}var lt=e(84638);class dt{constructor(t){this.optimizer=void 0,this.pointList=[],this.optimizer=t}update(){this.updatePoints(),this.pointList=this.BuildConnectivity(this.pointList),this.initGeometry();const t=this.buildGraph(this.pointList);if(void 0!==t){this.addClusterByGeometries(t),this.PostUpdateCollisionBasedonGraph();const i=this.NeedDecompose();i.length>0&&(this.SplitClusters(i),this.PostMergeCluster())}}initGeometry(){this.optimizer.renderer.InitGeometry()}addClusterByGeometries(t){this.optimizer.renderer.addClusterByGeometries(t)}updatePoints(){this.pointList=[];for(let t=0;t<this.optimizer.points.length;++t)if(!this.optimizer.points[t].isHidden&&this.optimizer.points[t].isRenderable){const i=this.optimizer.points[t];i.collision.Reset(),this.pointList.push(i)}}BuildConnectivity(t){for(let i=0;i<t.length;++i){const e=t[i];for(let s=i+1;s<t.length;++s){const i=t[s];!i.isCollapse&&i!==e&&(0,lt.Y4)([e.collision.minVec,e.collision.maxVec],[i.collision.minVec,i.collision.maxVec])&&(e.collision.isCollided=!0,e.isCollapse=!0,e.numVisit=0,e.collision.neighborShapes.push(i),i.collision.isCollided=!0,i.isCollapse=!0,i.numVisit=0,i.collision.neighborShapes.push(e))}}return t}buildGraph(t){let i=[];for(let e=0;e<t.length;++e){let s=[],n=[t[e]];n[0].collision.isVisited=!0,s.push(n[0]);let o,h=0;for(;void 0!==(o=n.shift());){for(let t=0;t<o.collision.neighborShapes.length;++t)o.collision.neighborShapes[t].collision.isVisited||(o.collision.neighborShapes[t].collision.isVisited=!0,n.push(o.collision.neighborShapes[t]),s.push(o.collision.neighborShapes[t]));if(h++>1e3)return void console.debug("fail to optimize")}s.length>1&&i.push(s)}return i}PostUpdateCollisionBasedonGraph(){for(let t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.UpdateByQueue(this.optimizer.renderer.clustersRPoint[t],this.pointList)}UpdateByQueue(t,i){let e=0;const s=[...i];for(;s.length;){const n=s.shift();if(n){if(n.numVisit>100){n.numVisit=0;break}if(0===s.length&&i.length<e++)break;n.collision.isCollided||((0,lt.Y4)([n.collision.minVec,n.collision.maxVec],[t.minVec,t.maxVec])?(n.collision.isCollided=!0,n.isCollapse=!0,n.numVisit=0,t.AddPost(n)):(n.numVisit++,s.push(n)))}}}NeedDecompose(){const t=[];for(let i=0;i<this.optimizer.renderer.clustersRPoint.length;++i)this.optimizer.renderer.clustersRPoint[i].NeedDecompose()&&t.push(this.optimizer.renderer.clustersRPoint[i]);return t}SplitClusters(t){for(let i=0;i<t.length;++i)t[i].Split()}PostMergeCluster(){this.PostMergeClusterCompute(this.optimizer.renderer.clustersRPoint)}PostMergeClusterCompute(t){for(let i=0;i<t.length-1;++i){const e=t[i];for(let s=i+1;s<t.length;++s){const i=t[s];i.isVisited||(0,lt.TE)(e.vec,i.vec)<e.r1+20&&(i.isVisited=!0,e.Merge(i))}}}}class ct{constructor(){this.graphClustering=void 0,this.renderer=void 0,this.mv=new ht.h9(0,0),this.inspection=!0,this.points=[],this.graphClustering=new dt(this),this.renderer=new rt(this)}push(t){this.points=t,this.update()}mouseInteraction(t,i){}update(){this.graphClustering.update()}getCellAtPoint(t){}render(t,i){this.renderer.Render(t,i)}}class pt{constructor(t){this.drawingEngine=void 0,this.clustering=void 0,this.clusteringCollisionBasedGraph=void 0,this.drawingEngine=t}async InitClustering(){return Promise.resolve().then(e.bind(e,92522)).then((t=>{let{Clustering:i}=t;const e=this.drawingEngine.geometryCommon.getAllVecFromCPoint();this.clustering=new i(ot.OPTIMIZER.GRID),this.clustering.optimizer.rx=9,this.clustering.optimizer.ry=5,this.clustering.push(e,this.drawingEngine.renderer.ctx.canvas.width,this.drawingEngine.renderer.ctx.canvas.height)})).catch((t=>{}))}async InitClusteringCollision(){return Promise.resolve().then(e.bind(e,92522)).then((t=>{let{Clustering:i}=t;const e=this.drawingEngine.geometryCommon.getAllFromCPoint();this.clusteringCollisionBasedGraph=new ct,this.clusteringCollisionBasedGraph.push(e)})).catch((t=>{}))}mouseInteraction(t){var i;switch(t.type){case y.zK.LEFT:case y.zK.MIDDLE:case y.zK.RIGHT:case y.zK.DOUBLE:break;case y.zK.MOVE:null===(i=this.clustering)||void 0===i||i.mouseInteraction(t.x,t.y);case y.zK.DRAG:case y.zK.DOWN:case y.zK.UP:case y.zK.WHEEL:}}render(t,i){var e,s;null===(e=this.clustering)||void 0===e||e.render(t,i,this.drawingEngine.renderer.ctx.canvas.width,this.drawingEngine.renderer.ctx.canvas.height),null===(s=this.clusteringCollisionBasedGraph)||void 0===s||s.render(t,i)}}class gt{constructor(t){this.drawingEngine=void 0,this.lastCalledTime=Date.now(),this.delta=1,this.fps=30,this.ctx=void 0,this.drawingEngine=t}render(t,i){this.ctx=t,this.update(i),this.renderPost(t,i)}update(t){for(let i in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[i].update(t,this.drawingEngine.projection.toScreen)}renderPost(t,i){for(let e in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[e].renderPost(t,i);this.ComputeFPS()}ComputeFPS(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}}class ut{constructor(t){this.drawingEngine=void 0,this._capture=void 0,this.geometryList=[],this.pointList=[],this.geoDict={},this.drawingEngine=t}get capture(){return this._capture}set capture(t){this.drawingEngine.ableToPan=!t,this._capture=t}addGeometry(t){this.geoDict[t.id]=t,this.geometryList.push(t),t.type===y.mB.point&&this.pointList.push(t)}}class vt{constructor(){this.activeCommand=void 0,this.projection=void 0,this.geometryCommon=void 0,this.scene=void 0,this.addon=void 0,this.renderer=void 0,this.io=void 0,this._ableToPan=!0,this.io=new st(this),this.addon=new pt(this),this.projection=new et(this),this.geometryCommon=new nt(this),this.activeCommand=new it(this),this.scene=new ut(this),this.renderer=new gt(this)}apiCall(t){return this.activeCommand.apiCall(t)}updateProjection(t){this.projection.updateProjection(t)}setCommand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SELECT";this.activeCommand.setCommander(t)}mouseEvent(t){this.activeCommand.activeCommand.mouseEvent(t),this.addon.mouseInteraction(t)}keyEvent(t){}render(t,i){this.renderer.render(t,i),this.addon.render(t,i)}set ableToPan(t){this._ableToPan=t,this.bindAbleToPan(t)}bindAbleToPan(t){}}class mt{constructor(t){this.njsSandbox=void 0,this.drawingEngine=void 0,this.nna=void 0,this.njsSandbox=t}async initBinding(){this.njsSandbox.win=new o(this.njsSandbox.div,"NNA Engine V4 by NJSTUDIO",1200,600),this.njsSandbox.env=await new m(this.njsSandbox.win.getContext()),this.drawingEngine=new vt,this.drawingEngine.updateProjection({toMap:(t,i)=>this.njsSandbox.env.projection.ToMap(t,i),toScreen:(t,i)=>this.njsSandbox.env.projection.ToScreen(t,i)}),this.drawingEngine.bindAbleToPan=t=>{this.njsSandbox.env.ableToPan=t},this.njsSandbox.env.appendEventListener({mouse:t=>this.drawingEngine.mouseEvent(t),keyboard:t=>this.drawingEngine.keyEvent(t)}),this.nna=new H,this.nna.updateProjection({toMap:(t,i)=>this.njsSandbox.env.projection.ToMap(t,i),toScreen:(t,i)=>this.njsSandbox.env.projection.ToScreen(t,i)}),this.njsSandbox.env.appendEventListener({mouse:t=>this.nna.mouseEvent(t),keyboard:t=>this.nna.keyEvent(t)}),this.njsSandbox.env.appendRenderer(((t,i)=>this.nna.render(t,i))),this.njsSandbox.env.appendRenderer(((t,i)=>this.drawingEngine.render(t,i))),this.njsSandbox.win.addIconLeftPanel({text:"save",callBack:()=>this.drawingEngine.setCommand("save")}),this.njsSandbox.win.addIconLeftPanel({text:"load",callBack:()=>this.drawingEngine.setCommand("load")}),this.njsSandbox.win.addIconLeftPanel({text:"Select",callBack:()=>this.drawingEngine.setCommand("SELECT")}),this.njsSandbox.win.addIconLeftPanel({text:"Point",callBack:()=>this.drawingEngine.setCommand("POINT")}),this.njsSandbox.win.addIconLeftPanel({text:"Line",callBack:()=>this.drawingEngine.setCommand("LINE")}),this.njsSandbox.win.addIconLeftPanel({text:"Polyl",callBack:()=>this.drawingEngine.setCommand("POLYLINE")}),this.njsSandbox.win.addIconLeftPanel({text:"Circle",callBack:()=>this.drawingEngine.setCommand("CIRCLE")}),this.njsSandbox.win.addIconLeftPanel({text:"Rect",callBack:()=>this.drawingEngine.setCommand("RECTANGLE")}),this.njsSandbox.win.addIconLeftPanel({text:"ZipData",callBack:()=>this.drawingEngine.apiCall("importZipData")}),this.njsSandbox.win.addIconLeftPanel({text:"clusterGrid",callBack:()=>this.drawingEngine.apiCall("importClustering")}),this.njsSandbox.win.addIconLeftPanel({text:"clusterCol",callBack:()=>this.drawingEngine.apiCall("importClusteringCollision")}),this.njsSandbox.win.addIconTopPanel({text:"import",width:60,callBack:()=>this.nna.importDummyData()}),this.njsSandbox.win.addIconTopPanel({text:"Origin",width:60,callBack:()=>{this.nna.apiCall(g.lw.NETWORK,"addOrigins",this.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Destination",width:90,callBack:()=>{this.nna.apiCall(g.lw.NETWORK,"addDestinations",this.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Agent",width:90,callBack:()=>{this.nna.apiCall(g.lw.AGENCY,"runAgent",void 0)}}),this.njsSandbox.win.addIconTopPanel({text:"pathOpti",width:90,callBack:()=>{this.nna.apiCall(g.lw.GA,"pathOptimization",this.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Inspection",width:90,callBack:()=>{this.nna.controller.inspection=!this.nna.controller.inspection,this.drawingEngine.activeCommand.inspection=!this.drawingEngine.activeCommand.inspection}}),this.njsSandbox.win.addIconTopPanel({text:"Capture",width:60,callBack:()=>this.nna.apiCall(g.lw.NETWORK,"capture",void 0)}),this.njsSandbox.win.addIconTopPanel({text:"Download",width:60,callBack:()=>this.nna.apiCall(g.lw.NETWORK,"download",void 0)})}}},92522:function(t,i,e){e.r(i),e.d(i,{Clustering:function(){return l},OPTIMIZER:function(){return n}});var s=e(43891);let n;!function(t){t.NONE="NONE",t.GRID="GRID",t.GRID_SCREEN="GRID_SCREEN",t.COLLISION="COLLISION",t.AGENT="AGENT"}(n||(n={}));class o{constructor(){this.xInterval=0,this.yInterval=0,this.rx=9,this.ry=7,this.cells=[],this.points=[]}update(t,i){this.initGrid(t,i)}initGrid(t,i){this.cells=[],this.xInterval=t/(this.rx-1),this.yInterval=i/(this.ry-1);for(let e=0;e<this.ry;e++){const t=[];for(let i=0;i<this.rx;i++)t.push(new h(this,i,e));this.cells.push(t)}for(let e=0;e<this.points.length;++e){const t=this.points[e];this.getCellAtPoint(t).push(t)}for(let e=0;e<this.ry;++e)for(let t=0;t<this.rx;++t)this.cells[e][t].points.length<2&&(this.cells[e][t].isRenderable=!1)}getCellAtPoint(t){let i=Math.round(t.x/this.xInterval),e=Math.round(t.y/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}render(t){for(let i=0;i<this.cells.length;i++)for(let e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t)}}class h{constructor(t,i,e){this.grid=void 0,this.r0=16,this.r1=24,this.vec=void 0,this.vecRender=void 0,this.xI=void 0,this.yI=void 0,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=t,this.xI=i,this.yI=e,this.vec=new s.h9(i*this.grid.xInterval,e*this.grid.yInterval)}push(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new s.h9(0,0,0);for(let i=0;i<this.points.length;++i)this.vecRender.x+=this.points[i].x,this.vecRender.y+=this.points[i].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}get isRenderable(){return this._isRenderable}set isRenderable(t){if(!t){for(let t=0;t<this.points.length;++t)this.points[t].isRenderable=!0;this.points=[]}this._isRenderable=t}draw(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke(),!this.isRenderable)return;if(i){this.vecRender=new s.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}const e=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*e,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,e,0,2*Math.PI),t.closePath(),t.fill()}}class a{constructor(){this.xInterval=0,this.yInterval=0,this.width=0,this.height=0,this.rx=9,this.ry=7,this.cells=[],this.points=[],this.minP=new s.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new s.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER)}update(t,i){this.initGrid(t,i)}initGrid(t,i){this.minP=new s.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new s.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let e=0;e<this.points.length;++e){const t=this.points[e];this.minP.x>t.x&&(this.minP.x=t.x),this.minP.y>t.y&&(this.minP.y=t.y),this.minP.z>t.z&&(this.minP.z=t.z),this.maxP.x<t.x&&(this.maxP.x=t.x),this.maxP.y<t.y&&(this.maxP.y=t.y),this.maxP.z<t.z&&(this.maxP.z=t.z)}this.cells=[],this.width=this.maxP.x-this.minP.x,this.height=this.maxP.y-this.minP.y,this.xInterval=this.width/(this.rx-1),this.yInterval=this.height/(this.ry-1);for(let e=0;e<this.ry;e++){const t=[];for(let i=0;i<this.rx;i++)t.push(new r(this,i,e));this.cells.push(t)}for(let e=0;e<this.points.length;++e){const t=this.points[e];this.getCellAtPoint(t).push(t)}for(let e=0;e<this.ry;++e)for(let t=0;t<this.rx;++t)this.cells[e][t].points.length<1&&(this.cells[e][t].isRenderable=!1)}getCellAtPoint(t){let i=Math.round((t.x-this.minP.x)/this.xInterval),e=Math.round((t.y-this.minP.y)/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}render(t){for(let i=0;i<this.cells.length;i++)for(let e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t);t.beginPath(),t.rect(this.minP.x,this.minP.y,this.maxP.x-this.minP.x,this.maxP.y-this.minP.y),t.stroke()}}class r{constructor(t,i,e){this.grid=void 0,this.r0=16,this.r1=24,this.vec=void 0,this.vecRender=void 0,this.xI=void 0,this.yI=void 0,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=t,this.xI=i,this.yI=e,this.vec=new s.h9(t.minP.x+i*this.grid.xInterval,t.minP.y+e*this.grid.yInterval)}push(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new s.h9(0,0,0);for(let i=0;i<this.points.length;++i)this.vecRender.x+=this.points[i].x,this.vecRender.y+=this.points[i].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}get isRenderable(){return this._isRenderable}set isRenderable(t){if(!t){for(let t=0;t<this.points.length;++t)this.points[t].isRenderable=!0;this.points=[]}this._isRenderable=t}draw(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isRenderable)return t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),void t.stroke();if(i){this.vecRender=new s.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}const e=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*e,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,e,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke()}}class l{constructor(t){switch(this.optimizerType=void 0,this.optimizer=void 0,this.mv=new s.h9(0,0),this.inspection=!0,this.optimizerType=t,t){case n.GRID_SCREEN:this.optimizer=new o;break;case n.GRID:this.optimizer=new a}console.debug("clustering... v 0.1.5")}push(t,i,e){this.optimizer.points=t,this.update(i,e)}mouseInteraction(t,i){this.mv=this.optimizer.getCellAtPoint(new s.h9(t,i)).vec}update(t,i){this.optimizer.update(t,i)}render(t,i,e,s){i&&this.update(e,s),this.optimizer.render(t),this.mv&&(t.fillStyle="#00ff00",t.beginPath(),t.arc(this.mv.x,this.mv.y,9,0,6.28),t.closePath(),t.fill())}}},43891:function(t,i,e){e.d(i,{TE:function(){return s.TE},h9:function(){return s.h9}});var s=e(26004)},84638:function(t,i,e){e.d(i,{MO:function(){return h},TE:function(){return n},Y4:function(){return s},h9:function(){return o}});const s=(t,i)=>{const e=t[0].x,s=t[1].x,n=i[0].x,o=i[1].x,h=t[0].y,a=t[1].y,r=i[0].y,l=i[1].y;return e<=o&&s>=n&&h<=l&&a>=r},n=(t,i)=>Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z));class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=0,this.y=0,this.z=0,this.lon=0,this.lat=0,this.elevation=0,this.d=!0,this.isRenderable=!0,this.x=t,this.y=i,this.z=e}}class h{constructor(t,i){this.vec=void 0,this.id="",this.numVisit=0,this.radius=10,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.collision=void 0,this.vec=new o(t,i,0),this.updateBounding()}updateBounding(){this.collision=new a(this)}render(t){t.beginPath(),t.arc(this.vec.x,this.vec.y,this.radius,0,2*Math.PI),t.closePath(),this.isCollapse?t.fillStyle="#f00":t.fillStyle="#0f0",t.fill(),this.renderBoundingBox(t)}renderBoundingBox(t){t.beginPath(),t.rect(this.collision.minVec.x,this.collision.minVec.y,this.collision.maxVec.x-this.collision.minVec.x,this.collision.maxVec.y-this.collision.minVec.y),t.stroke()}}class a{constructor(t){this.base=void 0,this.isCollided=!1,this.neighborShapes=[],this.minVec=void 0,this.maxVec=void 0,this.isVisited=!1,this.numOrder=-1,this.base=t;const i=this.base.radius;this.minVec=new o(this.base.vec.x-i,this.base.vec.y-i,0),this.maxVec=new o(this.base.vec.x+i,this.base.vec.y+i,0)}Reset(){this.neighborShapes=[],this.numOrder=-1,this.base.numVisit=0,this.base.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}}}}]);
//# sourceMappingURL=4544.33826188.chunk.js.map