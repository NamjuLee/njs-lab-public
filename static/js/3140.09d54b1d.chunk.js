"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[3140],{11574:(e,t,r)=>{r.r(t),r.d(t,{App:()=>O,Solution:()=>D});const a=r.p+"static/media/shadow-vert.684f342c270a82849192.wgsl",n=r.p+"static/media/shadow-frag.632b2b5c19c2f577ef0e.wgsl",s=r.p+"static/media/shadow-depth.a39dc88390f9deafcc32.wgsl";var i=r(39880);r(27089);const f=navigator.gpu?"Great, your current browser supports WebGPU!":"Your current browser does not support WebGPU! Make sure you are on a system \n    with WebGPU enabled.",o=function(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.primitiveType=void 0===e.primitiveType?"triangle-list":e.primitiveType,e.cullMode=void 0===e.cullMode?"none":e.cullMode,e.isDepthStencil=void 0===e.isDepthStencil||e.isDepthStencil,e.vsEntry=void 0===e.vsEntry?"vs_main":e.vsEntry,e.fsEntry=void 0===e.fsEntry?"fs_main":e.fsEntry,e.shader&&(e.vsShader=e.shader,e.fsShader=e.shader),e.indexFormat=void 0===e.indexFormat?"uint32":e.indexFormat,e.primitiveType.includes("strip")&&(t=e.indexFormat);let a={layout:"auto",vertex:{module:e.init.device.createShaderModule({code:e.vsShader}),entryPoint:e.vsEntry,buffers:e.buffers},fragment:r?{module:e.init.device.createShaderModule({code:e.fsShader}),entryPoint:e.fsEntry,targets:[{format:e.init.format}]}:void 0,primitive:{topology:e.primitiveType,stripIndexFormat:t,cullMode:e.cullMode},multisample:{count:e.init.msaaCount}};return e.isDepthStencil&&(a.depthStencil={format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}),a},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const n=e.length,s=t.length,i=a.length;let f=[];if(0===s)for(let o=0;o<n;o++){let t=4*parseInt(e[o].split("x")[1]),r=0===i?o:a[o];f.push({arrayStride:t,attributes:[{shaderLocation:r,format:e[o],offset:0}]})}else{let n=[],o=0;for(let r=0;r<s;r++){o+=4*parseInt(e[r].split("x")[1]);let s=0===i?r:a[r];n.push({shaderLocation:s,format:e[r],offset:t[r]})}r>0&&(o=r),f=[{arrayStride:r,attributes:n}]}return f},d=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=e.init.msaaCount>1?e.textureView:e.init.context.getCurrentTexture().createView(),a=e.init.msaaCount>1?e.init.context.getCurrentTexture().createView():void 0;return{colorAttachments:t?[{view:r,resolveTarget:a,clearValue:e.init.background,loadOp:"clear",storeOp:"store"}]:[],depthStencilAttachment:e.depthView?{view:e.depthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}:void 0}};let c;!function(e){e[e.Uniform=0]="Uniform",e[e.Vertex=1]="Vertex",e[e.Index=2]="Index",e[e.Storage=3]="Storage",e[e.VertexStorage=4]="VertexStorage",e[e.IndexStorage=5]="IndexStorage",e[e.Indirect=6]="Indirect",e[e.IndirectStorage=7]="IndirectStorage",e[e.Read=8]="Read",e[e.Write=9]="Write"}(c||(c={}));const l=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.Uniform,a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;return r===c.Vertex?a=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.Index?a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.Storage?a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.VertexStorage?a=GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.IndexStorage?a=GPUBufferUsage.INDEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.Indirect?a=GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.IndirectStorage?a=GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.Read?a=GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST:r===c.Write&&(a=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),e.createBuffer({size:t,usage:a})},g=e=>Object.prototype.toString.call(e).split(/\W/)[2],U=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.Vertex,a=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;r===c.Uniform?a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.Storage?a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.Index?a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC:r===c.VertexStorage?a=GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.IndexStorage?a=GPUBufferUsage.INDEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.Indirect?a=GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.IndirectStorage?a=GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST:r===c.Read?a=GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST:r===c.Write&&(a=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);let n=g(t);r===c.Vertex&&n.includes("Uint")&&(a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC);const s=e.createBuffer({size:t.byteLength,usage:a,mappedAtCreation:!0});return n.includes("Uint32")?new Uint32Array(s.getMappedRange()).set(t):n.includes("Uint16")?new Uint16Array(s.getMappedRange()).set(t):n.includes("Float64")?new Float64Array(s.getMappedRange()).set(t):new Float32Array(s.getMappedRange()).set(t),s.unmap(),s},p=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=[],s=r.length,i=a.length,f=s+i;for(let o=0;o<f;o++)o<s&&s>0?n.push({binding:o,resource:{buffer:r[o]}}):o>=s&&i>0&&n.push({binding:o,resource:a[o-s]});return e.createBindGroup({layout:t,entries:n})},B=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1];const a=i.Ue();return i.Iu(a,a,e),i.lM(a,a,t[0]),i.uD(a,a,t[1]),i.jI(a,a,t[2]),i.bA(a,a,r),a},v=e=>{const t=i.Ue();return i.U_(t,e),i.p4(t,t),t};var h=r(88679);const P=3.1415926,m=e=>Math.sin(e),G=e=>Math.cos(e),x=(e,t,r,a)=>{let n=(e+t*G(a))*G(r),s=t*m(a),i=-(e+t*G(a))*m(r);return h.al(n,s,i)},C=(e,t,r,a)=>{if(r<2||a<2)return;let n,s,i,f,o=[],u=[],d=.02*P/a;for(let U=0;U<=r;U++){let c=2*U*P/r;for(let r=0;r<=a;r++){let l=2*r*P/a;n=x(e,t,c,l),o.push(n[0],n[1],n[2]),c-d>=0?(s=x(e,t,c-d,l),i=h.$X(h.Ue(),n,s)):(s=x(e,t,c+d,l),i=h.$X(h.Ue(),s,n)),l-d>=0?(s=x(e,t,c,l-d),f=h.$X(h.Ue(),n,s)):(s=x(e,t,c,l+d),f=h.$X(h.Ue(),s,n));let g=h.kC(h.Ue(),f,i);h.Fv(g,g),u.push(g[0],g[1],g[2])}}let c=a+1,l=[],g=[];for(let U=0;U<r;U++)for(let e=0;e<a;e++){let t=e+U*c,r=e+1+U*c,a=e+1+(U+1)*c,n=e+(U+1)*c;l.push(t,r,a,a,n,t),g.push(t,r,t,n)}return{positions:new Float32Array(o),normals:new Float32Array(u),indices:new Uint32Array(l),indices2:new Uint32Array(g)}};var S=r(13958);class w{constructor(e){R(e)}}const T=async(e,t,r)=>{const i=await(0,S.bD)(a),f=await(0,S.bD)(n),d=await(0,S.bD)(s),g=o({init:e,vsShader:i,fsShader:f,buffers:u(["float32x3","float32x3"])}),B=await e.device.createRenderPipelineAsync(g),v=o({init:e,vsShader:d,buffers:u(["float32x3","float32x3"])},!1),h=await e.device.createRenderPipelineAsync(v),P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"depth24plus";return e.device.createTexture({size:e.size,format:t,sampleCount:e.msaaCount,usage:GPUTextureUsage.RENDER_ATTACHMENT})}(e),m=e.device.createTexture({size:[2048,2048],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),G=t.cubeData,x=U(e.device,G.positions),C=U(e.device,G.normals),w=U(e.device,G.indices),T=t.torusData,R=U(e.device,T.positions),y=U(e.device,T.normals),O=U(e.device,T.indices),D=t.torusData2,I=U(e.device,D.positions),_=U(e.device,D.normals),E=U(e.device,D.indices),A=l(e.device,64),b=l(e.device,64*r,c.Storage),Y=l(e.device,64*r,c.Storage),M=l(e.device,16*r,c.Storage),V=l(e.device,64),F=l(e.device,48),N=l(e.device,16),X=p(e.device,B.getBindGroupLayout(0),[A,b,Y,V,M]),q=p(e.device,B.getBindGroupLayout(1),[F,N],[m.createView(),e.device.createSampler({compare:"less"})]),z=p(e.device,h.getBindGroupLayout(0),[b,V]);return{pipelines:[B,h],vertexBuffers:[x,C,w,R,y,O,I,_,E],uniformBuffers:[A,b,Y,V,M,F,N],uniformBindGroups:[X,q,z],depthTextures:[P,m]}},R=async e=>{const t=document.createElement("canvas");t.width=e.clientWidth,t.height=e.clientHeight,e.appendChild(t);const r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.format=void 0===e.format?navigator.gpu.getPreferredCanvasFormat():e.format,e.msaaCount=void 0===e.msaaCount?1:e.msaaCount,f.includes("does not support WebGPU"))throw f;const r=await navigator.gpu.requestAdapter(),a=await r.requestDevice(t),n=e.canvas.getContext("webgpu"),s=(window.devicePixelRatio,{width:e.canvas.width,height:e.canvas.height});return n.configure({device:a,format:e.format,alphaMode:"opaque",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),{device:a,context:n,format:e.format,size:s,background:{r:.009,g:.0125,b:.0164,a:1},msaaCount:e.msaaCount}}({canvas:t});const a={cubeData:function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)/2;return{positions:new Float32Array([r,r,r,r,r,-r,r,-r,r,r,-r,-r,-r,r,-r,-r,r,r,-r,-r,-r,-r,-r,r,-r,r,-r,r,r,-r,-r,r,r,r,r,r,-r,-r,r,r,-r,r,-r,-r,-r,r,-r,-r,-r,r,r,r,r,r,-r,-r,r,r,-r,r,r,r,-r,-r,r,-r,r,-r,-r,-r,-r,-r]),colors:new Float32Array([1,1,1,1,1,0,1,0,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,1,0,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,0,0,0,1,0,0,0,1,1,1,1,1,0,0,1,1,0,1,1,1,0,0,1,0,1,0,0,0,0,0]),normals:new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),uvs:new Float32Array([0,t,e,t,0,0,e,0,0,t,e,t,0,0,e,0,0,t,e,t,0,0,e,0,0,t,e,t,0,0,e,0,0,t,e,t,0,0,e,0,0,t,e,t,0,0,e,0]),indices:new Uint32Array([0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21]),indices2:new Uint32Array([8,9,9,11,11,10,10,8,14,15,15,13,13,12,12,14,11,13,9,15,8,14,10,12])}}(),torusData:C(1.5,.1,60,20),torusData2:C(.8,.3,20,10)},n=await T(r,a,3);let s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[2,2,4],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,1,0];const a=i.Ue();return i.zB(a,e,t,r),{viewMat:a,cameraOptions:{eye:e,center:t,zoomMax:1e3,zoomSpeed:2}}}([0,10,20]),o=((e,t)=>{const r=i.Ue();return i.Jp(r,t,e),r})(s.viewMat,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=i.Ue();return i.G3(t,2*Math.PI/5,e,.1,1e3),t}(r.size.width/r.size.height));r.device.queue.writeBuffer(n.uniformBuffers[0],0,o);let u=new Float32Array(s.cameraOptions.eye);r.device.queue.writeBuffer(n.uniformBuffers[5],16,u);const d=1,c="#ffffff",l=.4,g=.04,U=.4,p=30,P=[],m=new Float32Array(48),G=new Float32Array(48),x=new Float32Array(12);{let e=h.al(0,-13,-20);const t=h.al(0,0,0),r=h.al(30,.1,20);let a=B(e,t,r),n=v(a);m.set(a,0),G.set(n,0),x.set([.5,.5,.7,1],0),P.push({translation:e,rotation:t,scale:r})}{let e=h.al(0,-5,-20),t=h.al(Math.PI/2,0,0),r=h.al(4,4,4),a=B(e,t,r),n=v(a);m.set(a,16),G.set(n,16),x.set([Math.random(),Math.random(),Math.random()],4),P.push({translation:e,rotation:t,scale:r})}{let e=h.al(0,-5,-20),t=h.al(Math.PI,0,0),r=h.al(4,4,4),a=B(e,t,r),n=v(a);m.set(a,16),G.set(n,16),x.set([Math.random(),Math.random(),Math.random()],4),P.push({translation:e,rotation:t,scale:r})}r.device.queue.writeBuffer(n.uniformBuffers[4],0,x);const S=i.Ue(),w=i.Ue(),R=h.al(0,100,0);let O=performance.now();const D=()=>{let e=d*(performance.now()-O)/1e3;R[0]=50*Math.sin(e),R[2]=50*Math.cos(e),r.device.queue.writeBuffer(n.uniformBuffers[5],0,R),r.device.queue.writeBuffer(n.uniformBuffers[5],32,(e=>{const[t,r,a]=e.match(/\w\w/g).map((e=>parseInt(e,16)/255));return new Float32Array([t,r,a,1])})(c)),r.device.queue.writeBuffer(n.uniformBuffers[6],0,new Float32Array([l,g,U,p])),i.zB(S,R,[0,0,0],[0,1,0]),i.M5(w,-40,40,-40,40,-50,200),i.Jp(w,w,S),r.device.queue.writeBuffer(n.uniformBuffers[3],0,w);const t=P[1];t.translation[0]<-20||t.translation[0],t.translation[1]<-5||t.translation[1];let s=B(t.translation,t.rotation,t.scale),f=v(s);m.set(s,16),G.set(f,16),r.device.queue.writeBuffer(n.uniformBuffers[1],0,m),r.device.queue.writeBuffer(n.uniformBuffers[2],0,G),y(r,n,a,3),requestAnimationFrame(D)};D()},y=(e,t,r,a)=>{const n=e.device.createCommandEncoder();let s=d({init:e,depthView:t.depthTextures[1].createView()},!1),i=n.beginRenderPass(s);i.setPipeline(t.pipelines[1]),i.setBindGroup(0,t.uniformBindGroups[2]),i.setVertexBuffer(0,t.vertexBuffers[0]),i.setVertexBuffer(1,t.vertexBuffers[1]),i.setIndexBuffer(t.vertexBuffers[2],"uint32"),i.drawIndexed(r.cubeData.indices.length,1,0,0,0),i.setVertexBuffer(0,t.vertexBuffers[3]),i.setVertexBuffer(1,t.vertexBuffers[4]),i.setIndexBuffer(t.vertexBuffers[5],"uint32"),i.drawIndexed(r.torusData.indices.length,1,0,0,1),i.setVertexBuffer(0,t.vertexBuffers[6]),i.setVertexBuffer(1,t.vertexBuffers[7]),i.setIndexBuffer(t.vertexBuffers[8],"uint32"),i.drawIndexed(r.torusData2.indices.length,1,0,0,1),i.end(),s=d({init:e,depthView:t.depthTextures[0].createView()});let f=n.beginRenderPass(s);f.setPipeline(t.pipelines[0]),f.setBindGroup(0,t.uniformBindGroups[0]),f.setBindGroup(1,t.uniformBindGroups[1]);for(let o in r);f.setVertexBuffer(0,t.vertexBuffers[0]),f.setVertexBuffer(1,t.vertexBuffers[1]),f.setIndexBuffer(t.vertexBuffers[2],"uint32"),f.drawIndexed(r.cubeData.indices.length,1,0,0,0),f.setVertexBuffer(0,t.vertexBuffers[3]),f.setVertexBuffer(1,t.vertexBuffers[4]),f.setIndexBuffer(t.vertexBuffers[5],"uint32"),f.drawIndexed(r.torusData.indices.length,1,0,0,1),f.setVertexBuffer(0,t.vertexBuffers[6]),f.setVertexBuffer(1,t.vertexBuffers[7]),f.setIndexBuffer(t.vertexBuffers[8],"uint32"),f.drawIndexed(r.torusData2.indices.length,1,0,0,1),f.end(),e.device.queue.submit([n.finish()])};class O{constructor(e){this.divHost=void 0,this.controller=void 0,this.renderer=void 0,this.scene=void 0,this.divHost=document.getElementById(e),new w(this.divHost),this.init()}async init(){}destroy(){}}class D{constructor(e){this.app=void 0,this.app=new O(e)}destroy(){this.app.destroy()}}},13958:(e,t,r)=>{r.d(t,{bD:()=>n,pg:()=>i,zM:()=>s});var a=r(39880);const n=async e=>fetch("".concat(e)).then((e=>e.text())).catch((e=>{console.debug(e)})),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const s=a.Ue(),i=a.Ue(),f=a.Ue(),o=a.Ue(),u=a.Ue();a.vc(o,t),a.aC(s,r[0]),a.gT(i,r[1]),a.QO(f,r[2]),a.xJ(u,n),a.Jp(e,s,u),a.Jp(e,i,e),a.Jp(e,f,e),a.Jp(e,o,e)},i=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST;const a=e.createBuffer({size:t.byteLength,usage:r,mappedAtCreation:!0});return new Float32Array(a.getMappedRange()).set(t),a.unmap(),a}}}]);
//# sourceMappingURL=3140.09d54b1d.chunk.js.map