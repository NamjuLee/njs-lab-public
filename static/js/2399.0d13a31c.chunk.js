"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[2399],{92399:function(t,e,i){i.r(e),i.d(e,{App:function(){return w},Solution:function(){return b}});class s{constructor(t){this.app=void 0,this.pos=[0,0],this.isDown=!1,this.app=t}init(){this.appendEvent()}appendEvent(){this.app.renderer.canvas.addEventListener("ondrag",(t=>{}),!1),this.app.renderer.canvas.addEventListener("click",(t=>{}),!1),this.app.renderer.canvas.addEventListener("dblclick",(t=>{}),!1),this.app.renderer.canvas.addEventListener("drag",(t=>{}),!0),this.app.renderer.canvas.addEventListener("mouseup",(t=>{}),!1),this.app.renderer.canvas.addEventListener("mousedown",(t=>{this.isDown=!0,this.pos[0]=t.offsetX,this.pos[1]=t.offsetY}),!1),this.app.renderer.canvas.addEventListener("mouseup",(t=>{this.isDown=!1}),!1),this.app.renderer.canvas.addEventListener("mousemove",(t=>{if(this.isDown){const e=this.pos[0]-t.offsetX,i=this.pos[1]-t.offsetY;this.app.renderer.cameraController.arcRotation(e,i),this.pos[0]=t.offsetX,this.pos[1]=t.offsetY}}),!1),this.app.renderer.canvas.addEventListener("wheel",(t=>{this.app.renderer.cameraController.zoomWheel(t.deltaY)}),!1)}}var r=i(39880),n=i(88679),a=i(50907);!function(){var t=function(){var t=new a.WT(2);return a.WT!=Float32Array&&(t[0]=0,t[1]=0),t}()}();class o{constructor(t){this.solution=void 0,this.canvas=void 0,this.camera=void 0,this.modelMatrix=r.Ue(),this.mvpMatrix=r.Ue(),this.rotation=n.al(0,0,0),this.translation=n.al(0,0,0),this.screen2=function(t,e){var i=new a.WT(2);return i[0]=t,i[1]=e,i}(0,0),this.angleXY=2.5,this.angleZ=.6,this.distance=5,this.solution=t,this.canvas=t.canvas;const e=n.al(2.6451475620269775,-3.130298137664795,2.864337205886841),i=n.al(0,0,0),s=n.al(0,0,1);this.camera=new h(this.canvas.width/this.canvas.height,e,i,s),this.update()}zoomWheel(t){this.distance+=.01*t,this.arcRotation(0,0)}update(){this.camera.update(),c(this.modelMatrix,this.translation,this.rotation),r.Jp(this.mvpMatrix,this.camera.viewProjectionMatrix,this.modelMatrix)}rotateZ(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.rotation[2]+=t,this.update()}translateX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.translation[0]+=t,this.update()}get getMatrix(){return this.mvpMatrix}arcRotation(t,e){t*=.01,e*=.01,this.angleXY-=t,this.angleZ-=e,this.camera.eye[0]=this.camera.center[0]+Math.sin(this.angleXY)*Math.cos(this.angleZ)*this.distance,this.camera.eye[1]=this.camera.center[1]+Math.cos(this.angleXY)*Math.cos(this.angleZ)*this.distance,this.camera.eye[2]=this.camera.center[2]+Math.sin(this.angleZ)*this.distance,this.update()}}class h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0];this.viewMatrix=r.Ue(),this.projectionMatrix=r.Ue(),this.viewProjectionMatrix=r.Ue(),this.zoomMax=100,this.zoomSpeed=2,this.near=.01,this.far=1e4,this.mvpMatrix=r.Ue(),this.eye=n.al(2.6451475620269775,-3.130298137664795,2.864337205886841),this.center=n.al(0,0,0),this.up=n.al(0,1,0),this.eye=e,this.center=i,this.up=s,r.G3(this.projectionMatrix,2*Math.PI/5,t,this.near,this.far),this.update()}update(){r.zB(this.viewMatrix,this.eye,this.center,this.up),r.Jp(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix)}}const c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const n=r.Ue(),a=r.Ue(),o=r.Ue(),h=r.Ue(),c=r.Ue();r.vc(h,e),r.aC(n,i[0]),r.gT(a,i[1]),r.QO(o,i[2]),r.xJ(c,s),r.Jp(t,n,c),r.Jp(t,a,t),r.Jp(t,o,t),r.Jp(t,h,t)};let d;!function(t){t.PointList="point-list",t.LineList="line-list",t.LineStrip="line-strip",t.TriangleList="triangle-list",t.TriangleStrip="triangle-strip"}(d||(d={}));class u{constructor(t){this.renderer=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.commandEncoder=void 0,this.PrimitiveTopology=d,this.renderer=t}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("No Adapter Found");const e=await t.requestDevice();this.ctx=this.renderer.canvas.getContext("webgpu"),this.format="bgra8unorm",this.ctx.configure({device:e,format:this.format,alphaMode:"opaque"}),this.device=e}destroy(){this.device.destroy()}}class p{constructor(t){this.app=void 0,this.canvas=void 0,this.cameraController=void 0,this.webGPU=void 0,this.isAnimation=!0,this.requestAni=void 0,this.loop=()=>{this.isAnimation&&(this.requestAni=requestAnimationFrame(this.loop)),this.drawing()},this.app=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.app.divHost.clientWidth,this.canvas.height=this.app.divHost.clientHeight,this.app.divHost.appendChild(this.canvas),this.webGPU=new u(this)}async init(){await this.webGPU.initWebGPU(),this.cameraController=new o(this),this.requestAni=requestAnimationFrame(this.loop)}drawing(){this.app.scene.render()}destroy(){for(this.webGPU.destroy(),cancelAnimationFrame(this.requestAni);this.app.divHost.lastElementChild;)this.app.divHost.removeChild(this.app.divHost.lastElementChild)}}class l{constructor(t){this.scene=void 0,this.webGPU=void 0,this.scene=t,this.webGPU=t.app.renderer.webGPU,this.scene.objects.push(this)}async initPipeline(){}update(){}render(){}}const v=i(80722);class f extends l{constructor(t){super(t),this.buffer=void 0,this.bufferLayout=void 0,this.uniformBuffer=void 0,this.pipeline=void 0,this.bindGroup=void 0,this.t=0,this.isRenderable=!1;const e=new Float32Array([0,0,1.5,1,0,0,0,-1.5,-1.5,0,1,0,0,1.5,-1.5,0,0,1]),i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,s={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=this.webGPU.device.createBuffer(s),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap(),this.bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]},this.initPipeline()}async initPipeline(){this.uniformBuffer=this.webGPU.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.webGPU.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.webGPU.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const e=this.webGPU.device.createPipelineLayout({bindGroupLayouts:[t]}),i=await(async t=>fetch("".concat(t)).then((t=>t.text())).catch((t=>{console.debug(t)})))(v);this.pipeline=this.webGPU.device.createRenderPipeline({vertex:{module:this.webGPU.device.createShaderModule({code:i}),entryPoint:"vs_main",buffers:[this.bufferLayout]},fragment:{module:this.webGPU.device.createShaderModule({code:i}),entryPoint:"fs_main",targets:[{format:this.webGPU.format}]},primitive:{topology:"triangle-list"},layout:e}),this.isRenderable=!0}render(){if(!this.isRenderable)return;this.t+=.01,this.t,Math.PI;let t=r.Ue();const e=Math.PI/4,i=this.webGPU.renderer.canvas.width/this.webGPU.renderer.canvas.height;r.G3(t,e,i,.1,10);let s=r.Ue();const a=n.al(-2,0,2),o=n.al(0,0,0),h=n.al(0,0,1);r.zB(s,a,o,h);const c=r.Ue();r.Iu(c,c,[Math.sin(this.t),0,0]);t=this.webGPU.renderer.cameraController.camera.projectionMatrix,s=this.webGPU.renderer.cameraController.camera.viewMatrix,this.webGPU.device.queue.writeBuffer(this.uniformBuffer,0,c),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,64,s),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,128,t);const d=this.webGPU.device.createCommandEncoder(),u=this.webGPU.ctx.getCurrentTexture().createView(),p=d.beginRenderPass({colorAttachments:[{view:u,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});p.setPipeline(this.pipeline),p.setVertexBuffer(0,this.buffer),p.setBindGroup(0,this.bindGroup),p.draw(3,1,0,0),p.end(),this.webGPU.device.queue.submit([d.finish()])}}class m{constructor(t){this.app=void 0,this.objects=[],this.t=0,this.app=t}async init(){new f(this)}render(){for(let t=0;t<this.objects.length;++t)this.objects[t].update(),this.objects[t].render();this.t,this.t+=.1}}class w{constructor(t){this.divHost=void 0,this.controller=void 0,this.renderer=void 0,this.scene=void 0,this.divHost=document.getElementById(t),this.renderer=new p(this),this.controller=new s(this),this.scene=new m(this),this.init()}async init(){this.controller.init(),await this.renderer.init(),await this.scene.init()}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class b{constructor(t){this.app=void 0,this.app=new w(t)}destroy(){this.app.destroy()}}},88679:function(t,e,i){i.d(e,{$X:function(){return o},IH:function(){return a},Ue:function(){return r},al:function(){return n},kC:function(){return c},od:function(){return h}});var s=i(50907);function r(){var t=new s.WT(3);return s.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t,e,i){var r=new s.WT(3);return r[0]=t,r[1]=e,r[2]=i,r}function a(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function h(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t}function c(t,e,i){var s=e[0],r=e[1],n=e[2],a=i[0],o=i[1],h=i[2];return t[0]=r*h-n*o,t[1]=n*a-s*h,t[2]=s*o-r*a,t}!function(){var t=r()}()},80722:function(t,e,i){t.exports=i.p+"static/media/shaders.e990e63b41897d82dc9c.wgsl"}}]);
//# sourceMappingURL=2399.0d13a31c.chunk.js.map