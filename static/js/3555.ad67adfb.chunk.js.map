{"version":3,"file":"static/js/3555.ad67adfb.chunk.js","mappings":"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","sources":["njslab/Lab/image-filter/CFilter.ts","njslab/Lab/image-filter/index.ts"],"sourcesContent":["\nclass CoreWebGL2 {\n    private positionBuffer: WebGLBuffer;\n    private texCoordBuffer: WebGLBuffer;\n    private vertexShader: WebGLShader;\n    private fragmentShader: WebGLShader;\n    private texture: WebGLTexture;\n    private canvasGL: HTMLCanvasElement;\n    private img: HTMLImageElement;\n    public program: WebGLProgram;\n    public gl: WebGLRenderingContext;\n    constructor(img: HTMLImageElement, vertexShaderSource: string, fragmentShaderSource: string) {\n        this.canvasGL = document.createElement('canvas');\n        this.canvasGL.width = img.width;\n        this.canvasGL.height = img.height;\n        this.gl = this.canvasGL.getContext('webgl2');\n        this.img = img;\n        this.init(vertexShaderSource, fragmentShaderSource )\n    }\n    public get canvas() {\n        return this.canvasGL;\n    }\n    private init(vertexShaderSource: string, fragmentShaderSource: string) {\n        const gl = this.gl;\n        this.texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.img);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n        this.vertexShader = gl.createShader(gl.VERTEX_SHADER);\n        gl.shaderSource(this.vertexShader, vertexShaderSource);\n        gl.compileShader(this.vertexShader);\n\n        this.fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(this.fragmentShader, fragmentShaderSource);\n        gl.compileShader(this.fragmentShader);\n\n        this.program = gl.createProgram();\n        gl.attachShader(this.program, this.vertexShader);\n        gl.attachShader(this.program, this.fragmentShader);\n        gl.linkProgram(this.program);\n        gl.useProgram(this.program);\n\n        const positionAttributeLocation: number = gl.getAttribLocation(this.program, 'a_position');\n        const texCoordAttributeLocation: number = gl.getAttribLocation(this.program, 'a_texCoord');\n        const textureUniformLocation: WebGLUniformLocation = gl.getUniformLocation(this.program, 'u_texture');\n        gl.uniform1i(textureUniformLocation, 0);\n\n        this.positionBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]), gl.STATIC_DRAW);\n        gl.enableVertexAttribArray(positionAttributeLocation);\n        gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);\n\n        this.texCoordBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.texCoordBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]), gl.STATIC_DRAW);\n        gl.enableVertexAttribArray(texCoordAttributeLocation);\n        gl.vertexAttribPointer(texCoordAttributeLocation, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n    }\n    public destroy() {\n        this.gl.deleteProgram(this.program);\n        this.gl.deleteTexture(this.texture);\n        this.gl.deleteShader(this.vertexShader);\n        this.gl.deleteShader(this.fragmentShader);\n        this.gl.deleteBuffer(this.positionBuffer);\n        this.gl.deleteBuffer(this.texCoordBuffer);\n        console.log('removed');\n    }\n}\n\nexport class CFilter {\n    private vertexShaderSource = `\n        attribute vec2 a_position;\n        attribute vec2 a_texCoord;\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = vec4(a_position, 0, 1);\n            v_texCoord = a_texCoord;\n        }\n    `;\n\n    private fragmentShaderSource = `\n        precision mediump float;\n        \n        uniform vec2 u_resolution;\n        uniform float u_blurRadius;\n        uniform float u_sepia;\n        uniform float u_contrast;\n        uniform float u_brightness;\n        uniform float u_saturation;\n        uniform float u_hueRotation;\n        uniform sampler2D u_texture;\n        varying vec2 v_texCoord;\n\n        vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n            vec4 color = vec4(0.0);\n            vec2 off1 = vec2(1.3333333333333333) * direction;\n            color += texture2D(image, uv) * 0.29411764705882354;\n            color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n            color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n            return color; \n        }\n\n        void main() {\n            vec2 flippedTexCoord = vec2(v_texCoord.x, 1.0 - v_texCoord.y);\n            vec4 color = texture2D(u_texture, flippedTexCoord);\n\n            float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n\n            // ..................\n            if (u_sepia > .0) {\n                vec3 sepia = vec3(1.0, 0.95, 0.82);\n                color = mix(color, vec4(gray * sepia, color.a), u_sepia);\n            }\n\n\n            // ..................\n            // if ((u_brightness != 1.0) || (u_contrast != 1.0)) {\n                vec3 colorRgb = color.rgb * u_brightness;\n                colorRgb = (colorRgb - vec3(0.5)) * max(u_contrast, 0.0) + vec3(0.5);\n                color = vec4(colorRgb, color.a);\n            // }\n\n\n            // ..................\n            color = vec4(mix(vec3(gray), color.rgb, u_saturation), color.a);\n\n            \n            // ..................\n            if (u_hueRotation != .0){\n                float angle = u_hueRotation * 3.14159265358979323846264 / 180.0;\n                float s = sin(angle);\n                float c = cos(angle);\n                mat3 hueRotationMatrix = mat3(\n                    0.213 + 0.787 * c - 0.213 * s, 0.715 - 0.715 * c - 0.715 * s, 0.072 - 0.072 * c + 0.928 * s,\n                    0.213 - 0.213 * c + 0.143 * s, 0.715 + 0.285 * c + 0.140 * s, 0.072 - 0.072 * c - 0.283 * s,\n                    0.213 - 0.213 * c - 0.787 * s, 0.715 - 0.715 * c + 0.715 * s, 0.072 + 0.928 * c + 0.072 * s\n                );\n                colorRgb = color.rgb * hueRotationMatrix;\n                color = vec4(colorRgb, color.a);\n            }\n\n            // ..................\n            gl_FragColor = color;\n        }\n    `;\n    private img: HTMLImageElement;\n    private params = {\n        \"blur\": 0,\n        \"sepia\": 0,\n        \"contrast\": 1,\n        \"brightness\": 1,\n        \"saturate\": 1,\n        \"hueRotate\": 0,\n    };\n    private core: CoreWebGL2;\n    constructor(img: HTMLImageElement) {\n        this.img = img;\n        this.core = new CoreWebGL2(img, this.vertexShaderSource, this.fragmentShaderSource);\n    }\n    public applyFilter(ctx: CanvasRenderingContext2D, param: any) {\n        this.params = param;\n        const gl = this.core.gl;\n\n        const sepiaUniformLocation = gl.getUniformLocation(this.core.program, 'u_sepia');\n        gl.uniform1f(sepiaUniformLocation, this.params.sepia);\n        const saturationUniformLocation = gl.getUniformLocation(this.core.program, 'u_saturation');\n        gl.uniform1f(saturationUniformLocation, this.params.saturate);\n        const brightnessUniformLocation = gl.getUniformLocation(this.core.program, 'u_brightness');\n        gl.uniform1f(brightnessUniformLocation, this.params.brightness);\n        const contrastUniformLocation = gl.getUniformLocation(this.core.program, 'u_contrast');\n        gl.uniform1f(contrastUniformLocation, this.params.contrast);\n        const hueRotationUniformLocation = gl.getUniformLocation(this.core.program, 'u_hueRotation');\n        gl.uniform1f(hueRotationUniformLocation, this.params.hueRotate);\n        const blurUniformLocation = gl.getUniformLocation(this.core.program, 'u_blurRadius');\n        gl.uniform1f(blurUniformLocation, 1.8);\n        const resolutionUniform = gl.getUniformLocation(this.core.program, 'u_resolution');\n        gl.uniform2f(resolutionUniform, gl.canvas.width, gl.canvas.height);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.drawImage(this.core.canvas, 0, 0);\n    }\n    public destroy() {\n        this.core.destroy();\n    }\n}","import { RendererCanvas, getImgFromURL } from '../../../lib';\r\nimport { CFilter } from './CFilter';\r\nexport enum ColorCorrection {\r\n    AutoContrast = 'autoContrast',\r\n    None = 'None'\r\n};\r\nexport class Solution {\r\n    public divHost: HTMLElement;\r\n    public renderer: Renderer;\r\n\r\n    constructor(divHost: any) {\r\n        this.divHost = divHost;\r\n\r\n        // Center align\r\n        this.divHost.style.display = 'flex';\r\n        this.divHost.style.alignItems = 'center';\r\n        const div = document.createElement('div');\r\n        div.style.marginLeft = 'auto';\r\n        div.style.marginRight = 'auto';\r\n        div.style.backgroundColor = '#555';\r\n        div.style.margin = '50px';\r\n        div.style.background = 'rgba(0,0,0,0)';\r\n        this.divHost.appendChild(div);\r\n\r\n        this.renderer = new Renderer(div);\r\n    }\r\n    public destroy() {\r\n        this.renderer.destroy();\r\n        while (this.divHost.lastElementChild) {\r\n            this.divHost.removeChild(this.divHost.lastElementChild);\r\n        }\r\n    }\r\n};\r\nexport class Renderer extends RendererCanvas {\r\n    img: HTMLImageElement | undefined = undefined;\r\n    rotation = 0.0;\r\n    m: number[] = [0, 0];\r\n\r\n    switch = true;\r\n    isDithering = false;\r\n    typeCorrection: ColorCorrection = ColorCorrection.AutoContrast;\r\n    \r\n    params = {\r\n        \"blur\" : 0,\r\n        \"sepia\": 0,\r\n        \"contrast\": 1,\r\n        \"brightness\": 1,\r\n        \"saturate\": 1,\r\n        \"hueRotate\": 0,\r\n    };\r\n    public cFilter: CFilter;\r\n\r\n    constructor(div: any) {\r\n        super(div);\r\n        this.ctx = this.canvas.getContext('2d', { willReadFrequently: true }) as CanvasRenderingContext2D;\r\n\r\n        this.isStatic = true;\r\n\r\n        this.canvas.style.position = 'relative';\r\n        this.canvas.style.width = '100%';\r\n        this.canvas.style.height = '100%';\r\n\r\n        \r\n        getImgFromURL('https://www.glenstone.org/wp-content/uploads/2018/07/AV_Landscape-Hero-Contour-2993-1276x800.jpg').then((img: HTMLImageElement) => {\r\n            // getImgFromURL('https://upload.wikimedia.org/wikipedia/commons/f/ff/Mozilla_Firefox_logo_2013.png').then((img: HTMLImageElement) => {\r\n            this.img = img;\r\n            this.img.onload = (ev) => {\r\n                this.update(img);\r\n            };\r\n        });\r\n\r\n        const divInput = document.createElement('input');\r\n        divInput.value = 'https://upload.wikimedia.org/wikipedia/commons/f/ff/Mozilla_Firefox_logo_2013.png';\r\n        divInput.addEventListener('keydown', (e: KeyboardEvent) => {\r\n            if (e.code === 'Enter') {\r\n                getImgFromURL(divInput.value).then((img: HTMLImageElement) => {\r\n                    this.img = img;\r\n                    this.img.onload = (ev) => {\r\n                        this.update(img);\r\n                    };\r\n                });\r\n            }\r\n        });\r\n        this.divHost.appendChild(divInput);\r\n\r\n        const slType = getSlider('saturate', 0, 200)\r\n        slType.slider.defaultValue = '100';\r\n        this.divHost.appendChild(slType.div);\r\n        slType.slider.oninput = () => {\r\n            const value = parseInt(slType.slider.value) * 0.01;\r\n            // console.log(value);\r\n            this.params.saturate = value;\r\n            this.render(this.ctx);\r\n        };\r\n        const slType2 = getSlider('hueRotate', -360, 360)\r\n        slType2.slider.defaultValue = '0';\r\n        this.divHost.appendChild(slType2.div);\r\n        slType2.slider.oninput = () => {\r\n            const value = parseInt(slType2.slider.value) * 1;\r\n            // console.log(value);\r\n            this.params.hueRotate = value;\r\n            this.render(this.ctx);\r\n        };\r\n        const slType3 = getSlider('contrast', 0, 20)\r\n        slType3.slider.defaultValue = '10';\r\n        this.divHost.appendChild(slType3.div);\r\n        slType3.slider.oninput = () => {\r\n            const value = parseInt(slType3.slider.value) * .1;\r\n            // console.log(value);\r\n            this.params.contrast = value;\r\n            this.render(this.ctx);\r\n        };\r\n        const slType4 = getSlider('brightness', 0, 20)\r\n        slType4.slider.defaultValue = '10';\r\n        this.divHost.appendChild(slType4.div);\r\n        slType4.slider.oninput = () => {\r\n            const value = parseInt(slType4.slider.value) * .1;\r\n            // console.log(value);\r\n            this.params.brightness = value;\r\n            this.render(this.ctx);\r\n        };\r\n        const slType5 = getSlider('sepia', 0, 100)\r\n        slType5.slider.defaultValue = '0';\r\n        this.divHost.appendChild(slType5.div);\r\n        slType5.slider.oninput = () => {\r\n            const value = parseInt(slType5.slider.value) * .01;\r\n            // console.log(value);\r\n            this.params.sepia = value;\r\n            this.render(this.ctx);\r\n        };\r\n        this.start();\r\n    }\r\n    public update(img: HTMLImageElement) {\r\n        this.img = img;\r\n        this.canvas.width = this.img.width;\r\n        this.canvas.height = this.img.height;\r\n\r\n        if (this.cFilter) { this.cFilter.destroy() }\r\n        this.cFilter = new CFilter(this.img);\r\n\r\n        this.render(this.ctx);\r\n    }\r\n    public render(ctx: CanvasRenderingContext2D): void {\r\n        if (this.img === undefined || this.cFilter === undefined) { return; }\r\n\r\n        const params = this.params;\r\n\r\n        this.cFilter.applyFilter(ctx, params)\r\n\r\n    }\r\n    public destroyPost() {\r\n        this.cFilter.destroy();\r\n    }\r\n};\r\nconst getSlider = (title: string, min: number, max: number) => {\r\n    // <input type=\"range\" min=\"1\" max=\"100\" value=\"50\" class=\"slider\" id=\"myRange\">\r\n    const div = document.createElement('div');\r\n    div.style.display = 'flex';\r\n\r\n    const slider = document.createElement('input');\r\n    slider.type = 'range';\r\n    slider.min = `${min}`;\r\n    slider.max = `${max}`;\r\n\r\n    const text = document.createElement('div');\r\n    text.textContent = title;\r\n    text.style.color = '#aaa';\r\n    div.appendChild(slider);\r\n    div.appendChild(text);\r\n    return {\r\n        div, slider, text\r\n    }\r\n};"],"names":["CoreWebGL2","constructor","img","vertexShaderSource","fragmentShaderSource","positionBuffer","texCoordBuffer","vertexShader","fragmentShader","texture","canvasGL","program","gl","this","document","createElement","width","height","getContext","init","canvas","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","createShader","VERTEX_SHADER","shaderSource","compileShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","useProgram","positionAttributeLocation","getAttribLocation","texCoordAttributeLocation","textureUniformLocation","getUniformLocation","uniform1i","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","activeTexture","TEXTURE0","destroy","deleteProgram","deleteTexture","deleteShader","deleteBuffer","console","log","CFilter","params","core","applyFilter","ctx","param","sepiaUniformLocation","uniform1f","sepia","saturationUniformLocation","saturate","brightnessUniformLocation","brightness","contrastUniformLocation","contrast","hueRotationUniformLocation","hueRotate","blurUniformLocation","resolutionUniform","uniform2f","drawArrays","TRIANGLE_STRIP","clearRect","drawImage","ColorCorrection","Solution","divHost","renderer","style","display","alignItems","div","marginLeft","marginRight","backgroundColor","margin","background","appendChild","Renderer","lastElementChild","removeChild","RendererCanvas","super","undefined","rotation","m","switch","isDithering","typeCorrection","AutoContrast","cFilter","willReadFrequently","isStatic","position","getImgFromURL","then","onload","ev","update","divInput","value","addEventListener","e","code","slType","getSlider","slider","defaultValue","oninput","parseInt","render","slType2","slType3","slType4","slType5","start","destroyPost","title","min","max","type","text","textContent","color"],"sourceRoot":""}