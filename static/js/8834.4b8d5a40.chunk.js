"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[8834],{28834:function(t,e,s){s.r(e),s.d(e,{Solution:function(){return I}});var i=s(87968);class o{constructor(t){this.scene=void 0,this.isHovered=!1,this.type=void 0,this.scene=t,this.scene.area=this}isInside(t,e){return!1}translate(t,e){}update(){}onMouseUp(){}render(t){this.update(),this.renderPost(t)}renderPost(t){}}var r=s(82953),n=s(86641);const a=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t.replace("#","");let s=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);if(e){let t=.58*s+.17*i+.8*o;return[t,t,t]}return[s,i,o]},h={text:"Residential",color:"#ffff6e"},p={text:"Business",color:"#f59700"},c={text:"Default",color:"#5287E6"},l={text:"Assigned",color:"#A355D4"};class d{constructor(t){this.host=void 0,this.host=t}renderPost(t){this.renderAreaBounding(t),this.renderCroppedArea(t),this.renderProperties(t),this.host.isHovered&&this.renderControlPoint(t)}renderCroppedArea(t){const e=u(this.host.polygonTurf,this.host.scene.polygonsDifference);for(let i=0;i<e.geometry.coordinates[0].length;++i){const s=e.geometry.coordinates[0][i];if(0===i){t.beginPath();const e=this.host.scene.ac.toScreen(s[0],s[1]);t.moveTo(e[0],e[1])}else{const e=this.host.scene.ac.toScreen(s[0],s[1]);t.lineTo(e[0],e[1])}}t.setLineDash([5,7]),t.lineDashOffset=this.host.t,t.lineWidth=2,t.strokeStyle="#fff";const s=.2+.09*Math.sin(.1*this.host.t);t.fillStyle="rgba(0, 255, 255, ".concat(s," )"),t.fill(),t.stroke(),t.setLineDash([])}renderControlPoint(t){t.fillStyle="rgba(200, 200, 200, 1.0)",t.strokeStyle="rgba(50, 50, 50, 1.0)",t.lineWidth=3,this.host.pts.forEach((e=>{t.beginPath(),t.arc(e.x,e.y,8,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}))}renderAreaBounding(t){t.beginPath(),"circle"===this.host.type?t.ellipse(this.host.cp.x,this.host.cp.y,.5*this.host.width,.55*this.host.height,0,0,2*Math.PI):"rect"===this.host.type&&t.rect(this.host.pts[3].x,this.host.pts[3].y,this.host.width,this.host.height),t.lineWidth=1,t.strokeStyle="rgba(255, 255, 255, 0.9)",t.stroke()}renderProperties(t){const e=n.hXg(n.SOn(this.host.polygonTurf),"meters","miles");t.textAlign="center",t.font="18px arial",t.fillStyle="#fff",t.fillText("Area in square miles: ".concat(e.toFixed(5)),this.host.cp.x,this.host.cp.y-60-.5*this.host.height);const s=n.jfw(this.host.scene.points,this.host.polygonTurf);let i=0,o=0,r=0;for(let n=0;n<s.features.length;++n)"R"===s.features[n].properties.landuse?i+=1:"B"===s.features[n].properties.landuse?o+=1:r+=1;t.fillStyle=h.color,t.fillText("".concat(h.text,": ").concat(i,","),this.host.cp.x-120,this.host.cp.y-25-.5*this.host.height),t.fillStyle=p.color,t.fillText("".concat(p.text,": ").concat(o,","),this.host.cp.x+28,this.host.cp.y-25-.5*this.host.height),t.fillStyle="rgb(0, 128, 0)",t.fillText("Other: ".concat(r),this.host.cp.x+140,this.host.cp.y-25-.5*this.host.height)}}const u=(t,e)=>{for(let s=0;s<e.length;++s)t=n.e50(t,e[s]);return t};class m extends o{constructor(t){super(t),this.renderer=void 0,this.cp=void 0,this.pts=[],this.width=200,this.height=200,this.capturedVecId=-1,this.t=.1,this.polygonTurf=void 0,this.renderer=new d(this),this.type="rect",this.cp=new r.h(.5*t.solution.rendererWrapper.renderer.canvas.width,.5*t.solution.rendererWrapper.renderer.canvas.height);const e=.5*this.width,s=.5*this.height;this.pts.push(new r.h(this.cp.x-e,this.cp.y+s)),this.pts.push(new r.h(this.cp.x+e,this.cp.y+s)),this.pts.push(new r.h(this.cp.x+e,this.cp.y-s)),this.pts.push(new r.h(this.cp.x-e,this.cp.y-s)),this.updateProjection()}updateProjection(){const t=this.scene.ac.toMap(this.cp.x,this.cp.y);this.cp.long=t[0],this.cp.lat=t[1];for(let e=0;e<this.pts.length;++e){let t=this.scene.ac.toMap(this.pts[e].x,this.pts[e].y);this.pts[e].long=t[0],this.pts[e].lat=t[1]}this.updatePolygonTurf()}isInside(t,e){const s=new r.h(t,e);if("circle"===this.type){if((0,r.x)(this.cp,s,.5*this.width,.5*this.height))return this.isHovered=!0,!0}else if(r.h.IsInsideOfVecs(s,this.pts))return this.isHovered=!0,!0;this.capturedVecId=-1;for(let i=0;i<this.pts.length;++i)if(this.pts[i].Distance(s)<20)return this.capturedVecId=i,this.isHovered=!0,!0;return this.isHovered=!1,!1}translate(t,e){const s=this.scene.solution.activeCommander.mp[0]-this.scene.solution.activeCommander.mpPre[0],i=this.scene.solution.activeCommander.mp[1]-this.scene.solution.activeCommander.mpPre[1];if(this.capturedVecId>-1)return this.pts[this.capturedVecId].x+=s,this.pts[this.capturedVecId].y+=i,0===this.capturedVecId?(this.pts[3].x=this.pts[0].x,this.pts[1].y=this.pts[0].y):1===this.capturedVecId?(this.pts[2].x=this.pts[1].x,this.pts[0].y=this.pts[1].y):2===this.capturedVecId?(this.pts[1].x=this.pts[2].x,this.pts[3].y=this.pts[2].y):3===this.capturedVecId&&(this.pts[0].x=this.pts[3].x,this.pts[2].y=this.pts[3].y),this.updateCenterVec(),void this.updateProjection();this.cp.x+=s,this.cp.y+=i;for(let o=0;o<this.pts.length;++o)this.pts[o].x+=s,this.pts[o].y+=i;this.updateProjection()}updateCenterVec(){let t=0,e=0;for(let s=0;s<this.pts.length;++s)t+=this.pts[s].x,e+=this.pts[s].y;this.cp.x=t/this.pts.length,this.cp.y=e/this.pts.length}update(){if(this.scene.solution.rendererWrapper.mapBoxWrapper.map.isMoving()){let t=this.scene.ac.toScreen(this.cp.long,this.cp.lat);this.cp.x=t[0],this.cp.y=t[1];for(let e=0;e<this.pts.length;++e)t=this.scene.ac.toScreen(this.pts[e].long,this.pts[e].lat),this.pts[e].x=t[0],this.pts[e].y=t[1]}}onMouseUp(){this.capturedVecId=-1}renderPost(t){this.width=Math.abs(this.pts[0].x-this.pts[2].x),this.height=Math.abs(this.pts[0].y-this.pts[2].y),this.renderer.renderPost(t),this.t+=.2}updatePolygonTurf(){const t=[];for(let e=0;e<this.pts.length;e++)t.push([this.pts[e].long,this.pts[e].lat]);t.push([this.pts[0].long,this.pts[0].lat]),this.polygonTurf=n.yue([t])}}class y{constructor(t){var e=this;this.solution=void 0,this.mp=[0,0,0,0],this.mpPre=[0,0,0,0],this.mouseDown=t=>{this.updateMousePos(t),this.checkHoverArea(this.mp[0],this.mp[1])&&(this.disablePan(),this.solution.scene.captured=this.solution.scene.area)},this.mouseUp=t=>{var e;this.updateMousePos(t),this.enablePan(),this.solution.scene.captured=void 0,null===(e=this.solution.scene.area)||void 0===e||e.onMouseUp()},this.mouseDrag=t=>{this.updateMousePos(t),this.solution.scene.captured&&this.solution.scene.captured.translate(t.point.x,t.point.y),this.updateMousePrePos()},this.mouseClick=t=>{this.updateMousePos(t),this.solution.rendererWrapper.renderer.pts.push([t.lngLat.lng,t.lngLat.lat])},this.mouseMove=t=>{this.updateMousePos(t),this.checkHoverArea(this.mp[0],this.mp[1]),this.updateMousePrePos()},this.zoom=t=>this.solution.rendererWrapper.mapBoxWrapper.zoom(t),this.flyTo=(t,e)=>this.solution.rendererWrapper.mapBoxWrapper.flyTo(t,e),this.center=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-99.292649,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:39.043903;return e.solution.rendererWrapper.mapBoxWrapper.center(t,s)},this.toMap=(t,e)=>this.solution.rendererWrapper.mapBoxWrapper.toMap(t,e),this.toScreen=(t,e)=>this.solution.rendererWrapper.mapBoxWrapper.toScreen(t,e),this.solution=t}updateMousePos(t){this.mp[0]=t.point.x,this.mp[1]=t.point.y,this.mp[2]=t.lngLat.lng,this.mp[3]=t.lngLat.lat}updateMousePrePos(){this.mpPre[0]=this.mp[0],this.mpPre[1]=this.mp[1],this.mpPre[2]=this.mp[2],this.mpPre[3]=this.mp[3]}keyDown(t){console.log(t),"c"===t.key.toLocaleLowerCase()&&this.solution.scene.captured&&(this.solution.scene.captured.type="circle"),"r"===t.key.toLowerCase()&&this.solution.scene.captured&&(this.solution.scene.captured.type="rect")}downloadScreen(){return this.solution.rendererWrapper.downloadScreen()}enablePan(){this.solution.rendererWrapper.mapBoxWrapper.map.dragPan.enable()}disablePan(){this.solution.rendererWrapper.mapBoxWrapper.map.dragPan.disable()}async loadDataLocal(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"funded_census_blocks.geojson";return(0,i.getJSONFromURL)("/njs-lab-public/static/dataDummyReady/"+t)}addScatterLayer(t){return this.solution.rendererWrapper.deckGL.addScatterLayer(t)}addArcLayer(t){return this.solution.rendererWrapper.deckGL.addArcLayer(t)}addPolygonLayer(t){return this.solution.rendererWrapper.deckGL.addPolygonLayer(t)}addShape(){new m(this.solution.scene)}shiftShapeType(){this.solution.scene.area&&("circle"===this.solution.scene.area.type?this.solution.scene.area.type="rect":"rect"===this.solution.scene.area.type&&(this.solution.scene.area.type="circle"))}checkHoverArea(t,e){var s;return null===(s=this.solution.scene.area)||void 0===s?void 0:s.isInside(t,e)}}var v=s(5483),g=s.n(v);class f{constructor(t){var e=this;this.rendererWrapper=void 0,this.map=void 0,this.canvasMapbox=void 0,this.isPressed=!1,this.zoom=t=>this.map.zoomTo(t),this.flyTo=(t,e)=>this.map.flyTo({center:[t,e]}),this.center=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-99.292649,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:39.043903;return e.map.setCenter({lat:s,lng:t})},this.toMap=(t,e)=>{const s=this.map.unproject({x:t,y:e});return[s.lng,s.lat]},this.toScreen=(t,e)=>{const s=this.map.project([t,e]);return[s.x,s.y]},this.mouseDown=t=>{},this.mouseUp=t=>{},this.mouseMove=t=>{},this.mouseDrag=t=>{},this.mouseClick=t=>{},this.mouseDClick=t=>{},this.keyDown=t=>{},this.rendererWrapper=t,this.initMap(t.solution.divHost.id)}initMap(t){g().accessToken="pk.eyJ1IjoiZGVzaWduanUiLCJhIjoiY2xhNGU0YWo4MDlhYzNwdHBwenVvang4eiJ9.P3sX4l_3KjdPeRRbVS1VVg",this.map=new(g().Map)({preserveDrawingBuffer:!0,container:t,zoom:3,center:[-77.430815,37.801833],style:"mapbox://styles/mapbox/dark-v10"}),this.map.dragRotate.disable(),this.map.on("mousemove",(t=>{this.isPressed?this.mouseDrag(t):this.mouseMove(t)})),this.map.on("click",(t=>{this.mouseClick(t)})),this.map.on("mousedown",(t=>{this.isPressed=!0,this.mouseDown(t)})),this.map.on("dblclick",(t=>{this.mouseDClick(t)})),this.map.on("mouseup",(t=>{this.isPressed=!1,this.mouseUp(t)})),window.addEventListener("keydown",(t=>{this.keyDown(t)}));let e=document.getElementsByClassName("mapboxgl-canvas")[0];e.style.position="absolute",e=document.getElementsByClassName("mapboxgl-control-container")[0],e.style.display="none",this.map.on("load",(()=>{this.initPost()}))}initPost(){this.rendererWrapper.initPost(),this.canvasMapbox=this.map.getCanvas()}initCustomCanvas(){this.rendererWrapper.renderer.canvas.width=this.canvasMapbox.width,this.rendererWrapper.renderer.canvas.height=this.canvasMapbox.height,this.rendererWrapper.renderer.canvas.style.display="none";this.map.getBounds();this.map.addSource("canvas-source",{type:"canvas",canvas:this.rendererWrapper.renderer.canvas,coordinates:[[-125.618336,48.944262],[-125.618336,24.786775],[-65.591812,24.786775],[-65.591812,48.944262]],animate:!0}),this.map.addLayer({id:"canvas-layer",type:"raster",source:"canvas-source"})}downloadImage(){return function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"map.png",i=document.createElement("canvas");i.width=t.width,i.height=t.height;let o=i.getContext("2d");o.globalAlpha=1,o.drawImage(t,0,0),o.drawImage(e,0,0,t.width,t.height);let r=new Image;r.width=t.width,r.height=t.height,r.src=i.toDataURL();let n=document.createElement("a");n.download=s,n.href=i.toDataURL(),n.click()}(this.map.getCanvas(),this.rendererWrapper.renderer.canvas)}}var x=s(31034),w=s(88410),P=s(69624),C=s(99764);class W{constructor(t){this.rendererWrapper=void 0,this.map=void 0,this.layers=[],this.rendererWrapper=t,this.map=this.rendererWrapper.mapBoxWrapper.map}initPost(){}addScatterLayer(t){const e=new x.Z({id:"scatter-".concat(this.layers.length),type:w.Z,data:t,getPosition:t=>t.position,getRadius:t=>t.size,getFillColor:t=>void 0!==t.color?t.color:[255,255,0],getLineColor:t=>[255,255,255],onClick:(t,e)=>console.log("Clicked:",t,e)});this.addLayer(e,"waterway-label")}addPolygonLayer(t){const e=new x.Z({id:"polygon-".concat(this.layers.length),type:P.Z,data:t,pickable:!0,stroked:!0,filled:!0,wireframe:!0,lineWidthMinPixels:1,getPolygon:t=>t.contour,getElevation:t=>1,getFillColor:t=>t.color,getLineColor:t=>[0,0,0],getLineWidth:1,onClick:(t,e)=>console.log("Clicked:",t,e)});this.addLayer(e,"waterway-label")}addArcLayer(t){const e=new x.Z({id:"arc-".concat(this.layers.length),type:C.Z,data:t,getSourcePosition:t=>t.pickup,getTargetPosition:t=>t.dropoff,getSourceColor:t=>[255,128,0],getTargetColor:t=>[0,128,255],strokeWidth:5});this.addLayer(e,"waterway-label")}addLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"waterway-label";this.map.addLayer(t,e),this.layers.push(t)}pick(){}}var k=s(55913);class b extends k.bb{constructor(t,e){super(t),this.rendererWrapper=void 0,this.time=0,this.pts=[],this.isActive=!1,this.rendererWrapper=e,this.canvas.id="mapboxCustom",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.start()}initPost(){this.isActive=!0}render(t){if(!this.isActive)return;this.time+=.1;const e=this.rendererWrapper.mapBoxWrapper.map.getZoom(),s=.1*Math.pow(2,e);for(let i=0;i<this.pts.length;++i){const e=this.pts[i],o=this.rendererWrapper.mapBoxWrapper.toScreen(e[0],e[1]),r=.001*s;t.beginPath(),t.arc(o[0],o[1],r+(Math.sin(this.time+i)+3)/s,0,2*Math.PI),t.closePath(),t.fillStyle="rgba(0, 255, 0, 0.7)",t.fill()}this.rendererWrapper.solution.scene.renderCanvas(t),t.textAlign="center",t.font="14px arial",t.fillStyle="#fff",t.fillText("Lat: ".concat(this.rendererWrapper.solution.activeCommander.mp[1].toFixed(5),",  Lng: ").concat(this.rendererWrapper.solution.activeCommander.mp[0].toFixed(5)),.5*this.canvas.width,50)}}class L{constructor(t){this.solution=void 0,this.mapBoxWrapper=void 0,this.deckGL=void 0,this.renderer=void 0,this.solution=t,this.mapBoxWrapper=new f(this),this.mapBoxWrapper.mouseDown=t=>{this.solution.activeCommander.mouseDown(t)},this.mapBoxWrapper.mouseUp=t=>{this.solution.activeCommander.mouseUp(t)},this.mapBoxWrapper.mouseClick=t=>this.solution.activeCommander.mouseClick(t),this.mapBoxWrapper.mouseMove=t=>{this.solution.activeCommander.mouseMove(t)},this.mapBoxWrapper.mouseDrag=t=>{this.solution.activeCommander.mouseDrag(t)},this.mapBoxWrapper.keyDown=t=>{this.solution.activeCommander.keyDown(t)},this.deckGL=new W(this),this.renderer=new b(this.solution.divHost,this)}initPost(){this.renderer.initPost(),this.deckGL.initPost()}downloadScreen(){return this.mapBoxWrapper.downloadImage()}destroy(){this.renderer.destroy()}}class S{constructor(t){this.solution=void 0,this.divHost=void 0,this.div=void 0,this.solution=t,this.divHost=t.divHost,this.divHost.style.position="absolute";const e=document.createElement("div");this.divHost.appendChild(e),this.div=document.createElement("div"),this.div.style.width="150px",this.div.style.height="300px",this.divHost.appendChild(this.div),this.initUI()}async initUI(){const t=new Image;t.src="/njs-lab-public/static/dataDummyReady/readyLabs.png",t.style.position="relative",t.style.width="150px",t.style.margin="15px",t.style.marginTop="30px",t.style.marginBottom="0px";let e=document.createElement("a");e.href="https://ready.net/",e.appendChild(t),this.div.appendChild(e);let s=document.createElement("div");s.textContent="Capture Map",s.style.color="#fff",s.style.position="relative",s.style.margin="20px",s.onclick=()=>{this.solution.activeCommander.downloadScreen()},this.div.appendChild(s),s=document.createElement("div"),s.textContent="Set Extent",s.style.color="#fff",s.style.position="relative",s.style.margin="20px",s.onclick=()=>{this.solution.activeCommander.flyTo(-112.188375,35.267735)},this.div.appendChild(s),s=document.createElement("div"),s.textContent="Add Shape",s.style.color="#fff",s.style.position="relative",s.style.margin="20px",s.onclick=()=>{this.solution.activeCommander.addShape()},this.div.appendChild(s),s=document.createElement("div"),s.textContent="Shape Type",s.style.color="#fff",s.style.position="relative",s.style.margin="20px",s.onclick=()=>{this.solution.activeCommander.shiftShapeType()},this.div.appendChild(s)}}class M{constructor(t){this.solution=void 0,this.ac=void 0,this.pts=[],this.area=void 0,this.captured=void 0,this.points=void 0,this.polygonsDifference=[],this.solution=t,this.ac=t.activeCommander}async init(){this.ac.center(-112.190375,35.257177),this.ac.zoom(13);const t=await this.ac.loadDataLocal("funded_census_blocks.geojson"),e=[],s=a(c.color),i=a(l.color);for(let n of t.features){const t=n.geometry.coordinates;let o;o="default"===n.properties.grant_long_status?s:i,e.push({contour:t[0],size:15,color:o})}this.ac.addPolygonLayer(e);const o=await this.ac.loadDataLocal("funded_census_blocks.geojson");this.polygonsDifference=[];for(let a of o.features){const t=a.geometry.coordinates;this.polygonsDifference.push(n.yue(t[0]))}this.ac.addScatterLayer([{position:[-74.5,40],size:1e4},{position:[-74.5,40.5],size:5e3},{position:[-74.6,40.5],size:5800},{position:[-74.7,40.5],size:100}]);this.ac.addArcLayer([{pickup:[-122.42,37.8],dropoff:[-74.5,40.5]},{pickup:[-122.43,37.8],dropoff:[-122.42,37.75]}]);const r=await this.ac.loadDataLocal("underserved_locations.geojson"),d=a(h.color),u=a(p.color),m=[];for(let n of r.features){const t=n.geometry.coordinates,e=n.properties.landuse;let s;s="R"===e?d:"B"===e?u:[0,128,0],m.push({position:[t[0],t[1]],size:15,color:s})}this.ac.addScatterLayer(m),this.points=r}renderCanvas(t){this.area&&this.area.render(t),t.fillStyle="#f00";for(let e=0;e<this.pts.length;++e){const s=this.pts[e];D(t,s[0],s[1])}}}const D=(t,e,s)=>{t.beginPath(),t.arc(e,s,10,0,2*Math.PI),t.closePath(),t.fill()};class I{constructor(t){this.divHost=void 0,this.activeCommander=void 0,this.uiWrapper=void 0,this.rendererWrapper=void 0,this.scene=void 0,this.divHost=t,this.divHost.style.position="relative",this.init(),this.initPost()}init(){this.activeCommander=new y(this),this.scene=new M(this),this.rendererWrapper=new L(this),this.uiWrapper=new S(this)}destroy(){for(this.rendererWrapper.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}async initPost(){await this.scene.init()}}}}]);
//# sourceMappingURL=8834.4b8d5a40.chunk.js.map