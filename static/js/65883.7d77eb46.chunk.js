"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[65883],{54078:(t,e,s)=>{s.d(e,{B:()=>o});var i=s(458);class o{constructor(t){this.gl=void 0,this.program=void 0,this.fragmentShader=void 0,this.vertexShader=void 0,this.matrixLocation=void 0,this.posBuffer=void 0,this.colBuffer=void 0,this.vertexs=void 0,this.posLocAtt=void 0,this.colLocAtt=void 0,this.matLoc=void 0,this.colLoc=void 0,this.cVecLoc=void 0,this.mouseLoc=void 0,this.timeGL=void 0,this.vShader=void 0,this.fShader=void 0,this.v="\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    \n    varying vec4 f_color;\n\n    void main() {\n\n        vec2 mouse_distance = vec2(0,0) - (a_position.xy /vec2(2,2));\n        float red = 1.0 - length(mouse_distance);\n        f_color = vec4(a_position, 0, 1.0);\n    \n        // float dis = distance(vec2(a_position.xy), vec2(0,0));\n\n        // f_color = vec4(dis * 0.6, 0,0,1);\n        gl_Position = vec4( a_position, 0, 1);\n    }\n    ",this.f="\n    precision highp float;\n\n    varying vec4 f_color;\n    \n    void main() {\n        vec2 mouse_distance = vec2(0,0) - (f_color.xy /vec2(5,5));\n\n        float col =  length(mouse_distance*5.);\n        float val = 1.0 - length(mouse_distance*8.);\n        \n        gl_FragColor = vec4(0.19,0.19,0.19, col);\n\n    }\n    ",this.positionAttribLocation=void 0,this.colorAttribLocation=void 0,this.translation=void 0,this.color=void 0,this.colArray=void 0,this.gl=t,this.color=[Math.random(),Math.random(),Math.random(),1],this.InitShader()}InitShader(){let t=i.Ui.CreateShader(this.gl,this.gl.VERTEX_SHADER,this.v),e=i.Ui.CreateShader(this.gl,this.gl.FRAGMENT_SHADER,this.f);if(t&&e){this.vShader=t,this.fShader=e;let s=i.Ui.CreateProgram(this.gl,t,e);s&&(this.program=s)}}Render(t){let e=[.1,0,0,1];this.vertexs=new Float32Array([-1,-1,1,1,1,1,-1,1,e[0],e[1],e[2],e[3],1,-1,e[0],e[1],e[2],e[3],-1,1,1,1,1,1,1,-1,e[0],e[1],e[2],e[3],1,1,e[0],e[1],e[2],e[3]]),this.posBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.posBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertexs),t.STATIC_DRAW),this.posLocAtt=this.gl.getAttribLocation(this.program,"a_position");let s=t.FLOAT,i=6*Float32Array.BYTES_PER_ELEMENT,o=0;t.vertexAttribPointer(this.posLocAtt,2,s,!1,i,o),t.enableVertexAttribArray(this.posLocAtt),t.useProgram(this.program);let n=t.TRIANGLES;o=0;t.drawArrays(n,o,6)}}},65883:(t,e,s)=>{s.r(e),s.d(e,{MercatorProjection:()=>u,Solution:()=>d});var i=s(17760),o=s(55913),n=s(54078);class r{constructor(t){this.solution=void 0,this.streetOSM=[],this.routesTreated=[],this.routesControl=[],this.zones30=[],this.zones15=[],this.routesMain=[],this.meshTwitter=void 0,this.meshStreetOSM=void 0,this.meshNode=void 0,this.meshTreated=void 0,this.meshControl=void 0,this.meshMainStreet=void 0,this.meshZones30=void 0,this.meshPolygon=void 0,this.polygonRingID={},this.polygonRings=void 0,this.yearForPolygonMesh=void 0,this.selectedYear=2009,this.renderMultiPolygon=(t,e,s)=>{const o=[],n=[];for(let r=0;r<e.length;++r){const h=e[r];for(let e=0;e<h.length;++e){const r=h[e];if(1===r.length){const e=r[0],h=[];for(let t=0;t<e.length;++t){const[s,o]=this.solution.projectionToMercator(e[t][0],e[t][1]);n.push(s,0,o),h.push(new i.FM8(s,o))}let a=new i.oa8(new i.bnF(h)),l=new i.vBJ({side:i.ehD,color:new i.Ilk(s[0],s[1],s[2]),transparent:!0,opacity:.3}),c=new i.Kj0(a,l);t.add(c),o.push(c),c.rotateOnAxis(new i.Pa4(1,0,0),.5*Math.PI)}}}return o},this.renderPoints=(t,e)=>{const s=new i.u9r,o=new i.UY4({vertexColors:!0,size:.5}),n=[],r=[];for(let i=0;i<t.length;++i){const s=t[i];for(let t=0;t<s.length;++t)for(let i=0;i<s[t].length;++i){const[o,h]=this.solution.projectionToMercator(s[t][i][0],s[t][i][1]);n.push(o,0,h),r.push(e[0],e[1],e[2])}}s.setAttribute("position",new i.a$l(n,3)),s.setAttribute("color",new i.a$l(r,3)),s.computeBoundingSphere();const h=new i.woe(s,o);return this.solution.scene.add(h),h},this.solution=t,(0,o._N)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson").then((t=>{for(let s=0;s<t.features.length;++s)this.streetOSM.push(t.features[s].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorSOMStreet&&(e=(0,o.p6)("#"+this.solution.PARAM.colorSOMStreet),this.solution.ui.isActive_streetOSM=!0),this.meshStreetOSM=this.LineSeg(this.streetOSM,e,-.01),this.solution.start()})),(0,o._N)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/Paris-main-st.geojson").then((t=>{for(let s=0;s<t.features.length;++s)this.routesMain.push(t.features[s].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorMainStreet&&(e=(0,o.p6)("#"+this.solution.PARAM.colorMainStreet),this.solution.ui.isActiveMainStreet=!0),this.meshMainStreet=this.LineSeg(this.routesMain,e)})),(0,o._N)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/treated-st.geojson").then((t=>{for(let s=0;s<t.features.length;++s)this.routesTreated.push(t.features[s].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorTreatedStreet&&(e=(0,o.p6)("#"+this.solution.PARAM.colorTreatedStreet),this.solution.ui.isActive_treated_st=!0),this.meshTreated=this.LineSeg(this.routesTreated,e)})),(0,o._N)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/control-st.geojson").then((t=>{for(let s=0;s<t.features.length;++s)this.routesControl.push(t.features[s].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorControlStreet&&(e=(0,o.p6)("#"+this.solution.PARAM.colorControlStreet),this.solution.ui.isActive_control_st=!0),this.meshControl=this.LineSeg(this.routesControl,e)})),(0,o._N)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones-30.geojson").then((t=>{for(let s=0;s<t.features.length;++s)this.zones30.push(t.features[s].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorZones30&&(e=(0,o.p6)("#"+this.solution.PARAM.colorZones30),this.solution.ui.isActive_zones_30=!0),this.meshZones30=this.renderMultiPolygon(this.solution.scene,this.zones30,e)}));let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones_15_innerouter_byyr_rings.json";(0,o._N)(e).then((t=>{let e=[0,1,1];this.solution.PARAM.colorYearPolygon&&(e=(0,o.p6)("#"+this.solution.PARAM.colorYearPolygon)),this.solution.PARAM.year&&(this.selectedYear=this.solution.PARAM.year),this.polygonRings=this.renderCustomPolygon(t,e),this.updateYear(this.selectedYear)}))}updateYear(t){if(this.selectedYear=t+1,void 0!==this.yearForPolygonMesh)for(let e=2010;e<2016;++e){this.yearForPolygonMesh[e].forEach((t=>{e<this.selectedYear?t.visible=!0:t.visible=!1}))}}updateColor(t){const e=(0,o.p6)(t);if(void 0!==this.meshMainStreet&&this.solution.ui.isActiveMainStreet){let t=this.meshMainStreet.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshStreetOSM&&this.solution.ui.isActive_streetOSM){let t=this.meshStreetOSM.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshTreated&&this.solution.ui.isActive_treated_st){let t=this.meshTreated.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshControl&&this.solution.ui.isActive_control_st){let t=this.meshControl.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}void 0!==this.meshZones30&&this.solution.ui.isActive_zones_30&&this.meshZones30.forEach((t=>{let s=t.material;s.color.r=e[0],s.color.g=e[1],s.color.b=e[2]})),void 0!==this.solution.dataTwitter&&this.solution.ui.isActive_twitter&&this.solution.dataTwitter.updateColor(e[0],e[1],e[2])}update(){void 0!==this.meshMainStreet&&(this.solution.ui.isActiveMainStreet?this.meshMainStreet.visible=!0:this.meshMainStreet.visible=!1),void 0!==this.meshStreetOSM&&(this.solution.ui.isActive_streetOSM?this.meshStreetOSM.visible=!0:this.meshStreetOSM.visible=!1),void 0!==this.meshTreated&&(this.solution.ui.isActive_treated_st?this.meshTreated.visible=!0:this.meshTreated.visible=!1),void 0!==this.meshControl&&(this.solution.ui.isActive_control_st?this.meshControl.visible=!0:this.meshControl.visible=!1),void 0!==this.meshZones30&&(this.solution.ui.isActive_zones_30?this.meshZones30.forEach((t=>{t.visible=!0})):this.meshZones30.forEach((t=>{t.visible=!1}))),void 0!==this.solution.dataTwitter.mesh&&(this.solution.ui.isActive_twitter?this.solution.dataTwitter.mesh.visible=!0:this.solution.dataTwitter.mesh.visible=!1)}renderCustomPolygon(t,e){const s={};for(const[i,o]of Object.entries(t.yr)){const t=o;t in s?s[t].push(+i):s[t]=[+i]}const n={};this.polygonRingID=s;let r=0;for(const[h,a]of Object.entries(this.polygonRingID)){const s=[];for(let n=0;n<a.length;++n){const h=a[n],l=(t.value_mn_rescale[h],[]);for(let e=0;e<t.outer_ring[h].length;++e){const[s,i]=this.solution.projectionToMercator(t.outer_ring[h][e][0],t.outer_ring[h][e][1]);l.push(new o.P(s,i))}const c=new i.bnF(l);for(let e=0;e<t.inner_rings[h].length;++e){const s=new i.y$t;let[o,n]=this.solution.projectionToMercator(t.inner_rings[h][e][0][0],t.inner_rings[h][e][0][1]);s.moveTo(o,n);for(let i=1;i<t.inner_rings[h][e].length;++i){let[o,n]=this.solution.projectionToMercator(t.inner_rings[h][e][i][0],t.inner_rings[h][e][i][1]);s.lineTo(o,n)}c.holes.push(s)}let d=new i.oa8(c);const u=new i.Ilk(16777215);u.setRGB(e[0],e[1],e[2]);let v=new i.vBJ({side:i.ehD,color:u,transparent:!0,opacity:.85}),p=new i.Kj0(d,v);p.translateY(1e-4*r++),p.visible=!0,this.solution.scene.add(p),p.rotateOnAxis(new i.Pa4(1,0,0),.5*Math.PI),s.push(p)}n[h]=s}this.yearForPolygonMesh=n}LineSeg(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=new i.u9r,n=new i.nls;n.color.r=e[0],n.color.g=e[1],n.color.b=e[2];const r=[],h=[],a=[];for(let i=0;i<t.length;++i){const o=t[i];for(let t=0;t<o.length;++t)for(let i=0;i<o[t].length;++i){const[n,l]=this.solution.projectionToMercator(o[t][i][0],o[t][i][1]);r.push(n,s,l),h.push(e[0],e[1],e[2]),i<o[t].length-1&&a.push(Math.floor(r.length/3)-1,Math.floor(r.length/3))}}o.setIndex(a),o.setAttribute("position",new i.a$l(r,3)),o.setAttribute("color",new i.a$l(h,3)),o.computeBoundingSphere();const l=new i.ejS(o,n);return this.solution.scene.add(l),l}}class h{constructor(t){this.solution=void 0,this.active=!1,this.dataRaw=void 0,this.mesh=void 0,this.t=0,this.dataScale=1,this.colorScale=1,this.pos=void 0,this.color="#0ff",this.material=void 0,this.dotG=0,this.dotB=0,this.solution=t;let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/real_data_buffersonly.json";(0,o._N)(e).then((t=>{this.dataRaw=t,this.initMesh("noNeighbsLog"),this.solution.updateParam()}))}initMesh(t){const e=[],s=[];this.dataRaw.meta["domain_"+t];for(let i=0;i<this.dataRaw.cells.length;++i){const o=this.dataRaw.cells[i],[n,r]=this.solution.projectionToMercator(+o.lon,+o.lat);let h=+o[t];h/=2;const a=[h,h,0];e.push(n,h*this.dataScale,r),s.push(a[0],a[1],a[2])}const o=new i.u9r,n=new i.UY4({vertexColors:!0,size:.5});this.material=n,this.pos=new Float32Array(e),o.setAttribute("position",new i.a$l(this.pos,3)),o.setAttribute("color",new i.a$l(s,3)),o.computeBoundingSphere(),this.mesh=new i.woe(o,n),this.solution.scene.add(this.mesh),this.active=!0}updateColor(t,e,s){this.material.color.setRGB(t,e,s)}updateMesh(t){this.active=!1,this.removeMesh(),this.initMesh(t)}removeMesh(){this.solution.scene.remove(this.mesh)}update(){this.active&&(this.t+=.05,this.updateAnimation())}updateAnimation(){let t=this.mesh.geometry.attributes.position.count;for(let e=0;e<t;e++){let t=this.mesh.geometry.attributes.position,s=t.getX(e),o=t.getZ(e),n=this.pos[3*e+1]*this.dataScale;n*=1+Math.sin(s+n+this.t)*Math.cos(s+n+this.t),n=n<.1?.1:n;let r=new i.Pa4(s,n,o);this.mesh.geometry.attributes.position.setXYZ(e,r.x,r.y,r.z);const h=n/this.colorScale;this.mesh.geometry.attributes.color.setXYZ(e,h,this.dotG,this.dotB)}this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.attributes.color.needsUpdate=!0,this.mesh.geometry.computeVertexNormals()}}class a{constructor(t){this.solution=void 0,this.hostDiv=void 0,this.isActiveMainStreet=!0,this.isActive_streetOSM=!1,this.isActive_treated_st=!1,this.isActive_control_st=!1,this.isActive_zones_30=!1,this.isActive_zones_buffer=!1,this.isActive_twitter=!1,this.year=2010,this.divCameraPos=void 0,this.solution=t,this.hostDiv=t.hostDiv,void 0!==this.solution.PARAM.local_ui?!0===this.solution.PARAM.local_ui&&this.appendUI():this.appendUI()}appendUI(){const t=document.createElement("div");t.style.position="absolute",t.style.margin="5px",this.hostDiv.append(t);const e=document.createElement("dv");e.style.display="flex",e.style.marginBottom="10px",e.textContent="pos target",this.divCameraPos=e,t.append(e);const s=document.createElement("input");t.append(s),s.type="color",s.oninput=()=>{this.solution.drawing.updateColor(s.value)};let i=l("main street");t.append(i.div),i.checkBox.checked=!0,i.checkBox.onchange=()=>{!0===i.checkBox.checked?this.isActiveMainStreet=!0:this.isActiveMainStreet=!1};let o=l("OSM street");t.append(o.div),o.checkBox.onchange=()=>{!0===o.checkBox.checked?this.isActive_streetOSM=!0:this.isActive_streetOSM=!1};let n=l("treated street");t.append(n.div),n.checkBox.onchange=()=>{!0===n.checkBox.checked?this.isActive_treated_st=!0:this.isActive_treated_st=!1};let r=l("control street");t.append(r.div),r.checkBox.onchange=()=>{!0===r.checkBox.checked?this.isActive_control_st=!0:this.isActive_control_st=!1};let h=l("zones 30");t.append(h.div),h.checkBox.onchange=()=>{!0===h.checkBox.checked?this.isActive_zones_30=!0:this.isActive_zones_30=!1};let a=c("Year");a.div.style.marginTop="25px",a.text.textContent="Year: 2019",t.append(a.div),a.slider.oninput=()=>{this.year=+a.slider.value,a.text.textContent="Year: "+a.slider.value,this.solution.drawing.updateYear(+a.slider.value)};let d=l("twitter data");d.div.style.marginTop="25px",t.append(d.div),d.checkBox.onchange=()=>{!0===d.checkBox.checked?this.isActive_twitter=!0:this.isActive_twitter=!1};let u=c("Scale","1","10");u.text.textContent="Scale: 1",t.append(u.div),u.slider.defaultValue="1",u.slider.oninput=()=>{this.year=+u.slider.value,u.text.textContent="Scale: "+u.slider.value,this.solution.dataTwitter.dataScale=+u.slider.value};let v=c("Color","1.","50.");v.text.textContent="Color: 1",t.append(v.div),v.slider.defaultValue="1",v.slider.oninput=()=>{this.year=+v.slider.value,v.text.textContent="Color: "+v.slider.value,this.solution.dataTwitter.colorScale=+v.slider.value};let p=l("Animation");p.checkBox.defaultChecked=!0,t.append(p.div),p.checkBox.onchange=()=>{!0===p.checkBox.checked?this.solution.dataTwitter.active=!0:this.solution.dataTwitter.active=!1,this.solution.dataTwitter.updateAnimation()};const m={noNeighbsLog:"noNeighbsLog",noNeighbsLogDensity:"noNeighbsLogDensity",noNeighbsRaw:"noNeighbsRaw",noNeighbsWins:"noNeighbsWins",noTwtsLog:"noTwtsLog",noTwtsLogDensity:"noTwtsLogDensity",noTwtsRaw:"noTwtsRaw",noTwtsWins:"noTwtsWins",noUsersLog:"noUsersLog",noUsersLogDensity:"noUsersLogDensity",noUsersRaw:"noUsersRaw",noUsersWins:"noUsersWins",treatmentCategory:"treatmentCategory"},g=document.createElement("select");t.append(g);for(let l in m){const t=document.createElement("option");t.value=l,t.textContent=l,g.appendChild(t)}g.onchange=t=>{this.solution.dataTwitter.updateMesh(t.target.value)}}}const l=t=>{const e=document.createElement("div");e.style.display="flex";const s=document.createElement("input");s.type="checkbox";const i=document.createElement("div");return i.textContent=t,i.style.color="#aaa",e.appendChild(s),e.appendChild(i),{div:e,checkBox:s}},c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2009",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2015";const i=document.createElement("div");i.style.display="flex";const o=document.createElement("input");o.type="range",o.min=e,o.max=s;const n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",i.appendChild(o),i.appendChild(n),{div:i,slider:o,text:n}};class d extends o.TF{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main"),this.drawing=void 0,this.ui=void 0,this.meshAreaGon=void 0,this.meshPolygon2=void 0,this.pts=[],this.dataTwitter=void 0,this.xOFf=-15478803.88731685,this.yOFf=-4766681.448690384,this.scale=.01,this.PARAM=void 0;let t=o.P8.R7.getAllUrlParams();this.PARAM=JSON.parse(JSON.stringify(t)),this.drawing=new r(this),this.dataTwitter=new h(this);const e=new i.cek(16777215,.8);this.camera.add(e),this.scene.add(e);const s=document.createElement("canvas");s.style.position="absolute",s.style.pointerEvents="none",s.style.mixBlendMode="darken",s.width=this.hostDiv.clientWidth,s.height=this.hostDiv.clientHeight,this.hostDiv.appendChild(s);const l=s.getContext("webgl");if(new n.B(l,.5,5).Render(l),this.ui=new a(this),this.PARAM.posCamera){const t=this.PARAM.posCamera.split(",");this.camera.position.set(+t[0],+t[1],+t[2]),this.controls.enablePan=!1,this.controls.enableRotate=!1,this.controls.enableZoom=!1}else this.camera.position.set(0,100,100);if(this.PARAM.posTarget){const t=this.PARAM.posTarget.split(",");this.controls.target.set(+t[0],+t[1],+t[2])}}projectionToMercator(t,e){const[s,i]=u(t,e);return[(s+this.xOFf)*this.scale,(i+this.yOFf)*this.scale*-1]}updateParam(){this.PARAM.scale&&(this.ui.isActive_twitter=!0,this.dataTwitter.dataScale=+this.PARAM.scale),this.PARAM.colorScale&&(this.ui.isActive_twitter=!0,this.dataTwitter.colorScale=+this.PARAM.colorScale),this.PARAM.dataLayer&&(this.ui.isActive_twitter=!0,this.dataTwitter.updateMesh(this.PARAM.dataLayer))}update(t){var e;this.drawing.update(),null===(e=this.dataTwitter)||void 0===e||e.update();const s="Pos: ".concat(this.camera.position.x,", ").concat(this.camera.position.y,", ").concat(this.camera.position.z,"; Target: ").concat(this.controls.target.x,", ").concat(this.controls.target.y,", ").concat(this.controls.target.z);void 0!==this.ui.divCameraPos&&(this.ui.divCameraPos.textContent=s)}}const u=(t,e)=>{const s=30559983.333,i=(t+180)*(s/360),o=e*Math.PI/180;return[i,223-s*Math.log(Math.tan(Math.PI/4+o/2))/(2*Math.PI)*-1]}}}]);
//# sourceMappingURL=65883.7d77eb46.chunk.js.map