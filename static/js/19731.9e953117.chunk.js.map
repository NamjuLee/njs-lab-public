{"version":3,"file":"static/js/19731.9e953117.chunk.js","mappings":"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","sources":["njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Core/ActiveCommandController.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Core/DefinitionIndeCanvasCore.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/Blank.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/JSLinearRegression01.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/JSLinearRegressionGradientDescent02.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFLinearRegressionGradientDescent01.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFMnist.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFModel01.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFModel01HorsepowerAndMilesPerGallon.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFModel02XOR.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFModel03Iris.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFModel03SmartDrawing.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFPlayground01.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFPolynomialRegressionGradientDescent02.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFPolynomialRegressionGradientDescent03Interaction.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/Definition/TFPolynomialRegressionGradientDescent05Interaction.ts","njslab/Workshop/workshop-ml/AppTFEnv/Implementation/TFProject/index.ts"],"sourcesContent":["import { CLICK_TYPE } from '../../../lib';\r\n\r\nimport { MouseEventData } from '../../../Model/AppCoreWrapper/IOWrapper/EventInteraction/MouseInteraction';\r\n\r\nimport { TFProject } from '..';\r\n\r\nexport class ActiveCommandController {\r\n    scene: TFProject;\r\n\r\n    constructor(scene: TFProject) {\r\n        this.scene = scene;\r\n    }\r\n    MouseEventController(e: MouseEventData) {\r\n\r\n        if (e.CLICK_TYPE === CLICK_TYPE.LEFT) {\r\n            this.MouseLeftClickPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.MIDDLE) {\r\n            this.MouseMiddleClickPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.DOWN_RIGHT) {\r\n            this.MouseRightClickPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.DOUBLE) {\r\n            this.MouseDoubleClickPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.MOVE) {\r\n            this.MouseMovePre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.DRAG) {\r\n            this.MouseDragPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.DOWN) {\r\n            this.MouseDownPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.WHEEL) {\r\n            this.MouseWheelPre(e); return;\r\n        } else if (e.CLICK_TYPE === CLICK_TYPE.UP) { this.MouseUpPre(e); return; }\r\n    }\r\n\r\n    // .......................................................\r\n    MouseDown(e: MouseEventData) {/* */ }\r\n    MouseDownPre(e: MouseEventData) {\r\n        this.scene.MouseDown(e.x, e.y);\r\n        this.MouseDown(e);\r\n    }\r\n    MouseLeftClick(e: MouseEventData) {/* */ }\r\n    MouseLeftClickPre(e: MouseEventData) {\r\n        this.scene.MouseLeftClick(e.x, e.y);\r\n        this.MouseLeftClick(e);\r\n    }\r\n    MouseMiddleClick(e: MouseEventData) {/* */ }\r\n    MouseMiddleClickPre(e: MouseEventData) {\r\n        this.scene.MouseMiddleClick(e.x, e.y);\r\n        this.MouseMiddleClick(e);\r\n    }\r\n    MouseRightClick(e: MouseEventData) { /* */ }\r\n    MouseRightClickPre(e: MouseEventData) {\r\n        this.scene.MouseRightClick(e.x, e.y);\r\n        this.MouseRightClick(e);\r\n    }\r\n    MouseUp(e: MouseEventData) { /* */ }\r\n    MouseUpPre(e: MouseEventData) {\r\n        this.scene.MouseUp(e.x, e.y);\r\n        this.MouseUp(e);\r\n\r\n    }\r\n    MouseDoubleClick(e: MouseEventData) {/* */ }\r\n    MouseDoubleClickPre(e: MouseEventData) {\r\n        this.scene.MouseDoubleClick(e.x, e.y);\r\n        this.MouseDoubleClick(e);\r\n    }\r\n    MouseMove(e: MouseEventData) {/* */ }\r\n    MouseMovePre(e: MouseEventData) {\r\n        this.scene.MouseMove(e.x, e.y);\r\n        this.MouseMove(e);\r\n    }\r\n    MouseDrag(e: MouseEventData) {/* */ }\r\n    MouseDragPre(e: MouseEventData) {\r\n        this.scene.MouseDrag(e.x, e.y);\r\n        this.MouseDrag(e);\r\n    }\r\n    MouseWheel(e: MouseEventData) {/* */ }\r\n    MouseWheelPre(e: MouseEventData) {\r\n        this.scene.MouseWheel(e.x, e.y, e.wheel);\r\n        // console.log(\"drag\");\r\n        this.MouseWheel(e);\r\n    }\r\n}","import { IndependentPanelCanvas } from '../../../../../../../lib/NJSCore/App/NUI/WrapperIndependentPanel/Panel/Common/IndependentPanelCanvas';\r\n\r\nimport { TFProject } from '..';\r\nexport class DefinitionIndeCanvasCore {\r\n    scene: TFProject;\r\n    indeCanvas: IndependentPanelCanvas;\r\n    mOffX = -12;\r\n    mOffY = -12;\r\n    constructor(scene: TFProject, width: number = 650, height: number = 350) {\r\n        this.scene = scene;\r\n        this.scene.definitions.push(this);\r\n        this.InitIndeCanvas(width, height);\r\n    }\r\n    InitIndeCanvas(width: number = 650, height: number = 350) {\r\n        if (this.scene.implementation.app.needUI) {\r\n            this.indeCanvas = new IndependentPanelCanvas(this.scene.implementation.app.viewController.NUIWrapper.NUI.independentPanelWrapper, 50, 50, width, height, true);\r\n        } else {\r\n            this.indeCanvas = new IndependentPanelCanvas(this.scene.implementation.app.viewController.NUIWrapper.NUI.independentPanelWrapper, 1, -25, width, height, true);\r\n        }\r\n        this.indeCanvas.title = 'TF Env';\r\n        this.indeCanvas.btnHam.isHidden = true;\r\n        this.indeCanvas.btnMini.isHidden = true;\r\n        this.indeCanvas.RenderIndependentCanvas = (ctx: CanvasRenderingContext2D) => (this.RenderIndependentCanvas(ctx));\r\n    }\r\n    get width() {\r\n        return this.indeCanvas.canvas.width;\r\n    }\r\n    get height() {\r\n        return this.indeCanvas.canvas.height;\r\n    }\r\n    Init(ctx: CanvasRenderingContext2D) {\r\n        //\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        //\r\n    }\r\n    MouseMove(x: number, y: number) { /* */ }\r\n    MouseMovePre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseMove(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseDown(x: number, y: number) { /* */ }\r\n    MouseDownPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseDown(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseUp(x: number, y: number) { /* */ }\r\n    MouseUpPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseUp(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseDrag(x: number, y: number) { /* */ }\r\n    MouseDragPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseDrag(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseLeftClick(x: number, y: number) { /* */ }\r\n    MouseLeftClickPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseLeftClick(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseMiddleClick(x: number, y: number) { /* */ }\r\n    MouseMiddleClickPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseMiddleClick(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseRightClick(x: number, y: number) { /* */ }\r\n    MouseRightClickPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseRightClick(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseDoubleClick(x: number, y: number) { /* */ }\r\n    MouseDoubleClickPre(x: number, y: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseDoubleClick(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY);\r\n    }\r\n    MouseWheel(x: number, y: number, v: number) { /* */ }\r\n    MouseWheelPre(x: number, y: number, v: number) {\r\n        if (!this.indeCanvas.IsMouseInsidePanel(x, y)) { return; }\r\n        this.MouseWheel(x - this.indeCanvas.vec.x + this.mOffX, y - this.indeCanvas.vec.y - this.indeCanvas.HeadHeight + this.mOffY, v);\r\n    }\r\n\r\n}","import { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { TFProject } from '..';\r\nimport * as tf from '@tensorflow/tfjs';\r\nexport class Blank extends DefinitionIndeCanvasCore {\r\n    p: number[] = [0, 0];\r\n    constructor(tfProject: TFProject) {\r\n        super(tfProject);\r\n\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        console.log(tf.version);\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        ctx.fillStyle = '#ff0000';\r\n        ctx.beginPath();\r\n        ctx.arc(this.p[0], this.p[1], 5, 0, 3.14 * 2);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        this.p = [x, y];\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        this.p = [x, y];\r\n    }\r\n}","import { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { TFProject } from '..';\r\n\r\n// import * as tf from '@tensorflow/tfjs';\r\nimport { NVector3, MathUtility } from '../../../lib';\r\nexport class JSLinearRegression01 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n\r\n    a: number = 1;\r\n    bias: number = 0;\r\n\r\n    constructor(tfProjct: TFProject) {\r\n        super(tfProjct);\r\n        this.indeCanvas.title = 'LinearRegression';\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, 0, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, 0);\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.LinearRegression();\r\n        this.RenderLine(ctx);\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(MathUtility.Remap(this.vs[i].x, 0, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, 0, 1, this.height, 0), 5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        let x0 = 0;\r\n        let y0 = this.a * x0 + this.bias;\r\n\r\n        let x1 = 1;\r\n        let y1 = this.a * x1 + this.bias;\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(x0, 0, 1, 0, this.width), MathUtility.Remap(y0, 0, 1, this.height, 0));\r\n        ctx.lineTo(MathUtility.Remap(x1, 0, 1, 0, this.width), MathUtility.Remap(y1, 0, 1, this.height, 0));\r\n        ctx.stroke();\r\n    }\r\n    public LinearRegression() {\r\n        let xSum = 0;\r\n        let ySum = 0;\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            xSum += this.vs[i].x;\r\n            ySum += this.vs[i].y;\r\n        }\r\n        let xMean = xSum / this.vs.length;\r\n        let yMean = ySum / this.vs.length;\r\n\r\n        let num = 0;\r\n        let den = 0;\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            num += (this.vs[i].x - xMean) * (this.vs[i].y - yMean);\r\n            den += (this.vs[i].x - xMean) * (this.vs[i].x - xMean);\r\n        }\r\n        this.a = num / den;\r\n        this.bias = yMean - this.a * xMean;\r\n    }\r\n}","import { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { TFProject } from '..';\r\n\r\n// import * as tf from '@tensorflow/tfjs';\r\nimport { NVector3, MathUtility } from '../../../lib';\r\nexport class JSLinearRegressionGradientDescent02 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n\r\n    weight: number = 1;\r\n    bias: number = 0;\r\n\r\n    constructor(tfProjct: TFProject) {\r\n        super(tfProjct);\r\n        this.indeCanvas.title = 'LinearRegression';\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, 0, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, 0);\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(MathUtility.Remap(this.vs[i].x, 0, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, 0, 1, this.height, 0), 5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        let x0 = 0;\r\n        let y0 = this.weight * x0 + this.bias;\r\n\r\n        let x1 = 1;\r\n        let y1 = this.weight * x1 + this.bias;\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(x0, 0, 1, 0, this.width), MathUtility.Remap(y0, 0, 1, this.height, 0));\r\n        ctx.lineTo(MathUtility.Remap(x1, 0, 1, 0, this.width), MathUtility.Remap(y1, 0, 1, this.height, 0));\r\n        ctx.stroke();\r\n    }\r\n    public GradientDescent() {\r\n        let learningRate = 0.1;\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let x = this.vs[i].x;\r\n            let y = this.vs[i].y;\r\n            let hypothesis = this.weight * x + this.bias;\r\n            let error = y - hypothesis;\r\n\r\n            this.weight = this.weight + (error * x) * learningRate;\r\n            this.bias = this.bias + (error) * learningRate;\r\n            // console.log(error);\r\n        }\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\n// import { TFUtility } from '../../../../../../NJSCore/ML/NMacineLearning';\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n\r\nexport class TFLinearRegressionGradientDescent01 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    vsTemp: NVector3[] = [];\r\n\r\n    tfLinearRegression: TFLinearRegression;\r\n    t: number = 0.0;\r\n    constructor(tfProjct: TFProject) {\r\n        super(tfProjct);\r\n        this.indeCanvas.title = 'TF LinearRegression GradientDescent 01';\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n\r\n        this.tfLinearRegression = new TFLinearRegression();\r\n\r\n        this.InitData();\r\n        this.InitUI();\r\n    }\r\n    public InitUI() {\r\n        const div = document.createElement('div');\r\n        // div.style.background = '#dddddd';\r\n        div.style.position = 'absolute';\r\n        div.style.left = '400px';\r\n        div.style.color = '#ffffff';\r\n\r\n        const t = document.createElement('p');\r\n        t.textContent = 'click on this screen to add data';\r\n        div.append(t);\r\n\r\n        const divHost = document.getElementById('indePanel');\r\n        if (divHost) {\r\n            divHost.append(div);\r\n        }\r\n        // this.scene.canvas.canvas.\r\n    }\r\n    InitData() {\r\n        TFDataUtility.getData().then((d: any) => {\r\n            let xMin = Number.MAX_SAFE_INTEGER;\r\n            let xMax = Number.MIN_SAFE_INTEGER;\r\n            let yMin = Number.MAX_SAFE_INTEGER;\r\n            let yMax = Number.MIN_SAFE_INTEGER;\r\n\r\n            d.map((data: any) => {\r\n                let x = (data['horsepower']);\r\n                if (x > xMax) { xMax = x; }\r\n                if (x < xMin) { xMin = x; }\r\n\r\n                let y = (data['mpg']);\r\n                if (y > yMax) { yMax = y; }\r\n                if (y < yMin) { yMin = y; }\r\n                return 0\r\n            });\r\n\r\n            for (let data of d) {\r\n                let x = (data['horsepower']);\r\n                let y = (data['mpg']);\r\n                this.vsTemp.push(new NVector3(\r\n                    MathUtility.Remap(x, xMin, xMax, 0.1, 0.9),\r\n                    MathUtility.Remap(y, yMin, yMax, 0.1, 0.9)));\r\n            }\r\n        });\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, 0, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, 0);\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        if ((this.t & 2) === 0) {\r\n            const v = this.vsTemp.pop();\r\n            if (v) {\r\n                this.vs.push(v);\r\n            }\r\n        }\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n\r\n            // ............................ train\r\n            this.tfLinearRegression.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(MathUtility.Remap(this.vs[i].x, 0, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, 0, 1, this.height, 0), 5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        this.t += 0.3;\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        const lineX = [0, 1];\r\n\r\n        // ............................ predict\r\n        const ys = tf.tidy(() => {\r\n            return this.tfLinearRegression.predict(tf.tensor1d(lineX));\r\n        });\r\n\r\n        let lineY = ys.dataSync();\r\n        ys.dispose();\r\n        // ............................ end predict\r\n\r\n        let x0 = 0;\r\n        let y0 = lineY[0];\r\n\r\n        let x1 = 1;\r\n        let y1 = lineY[1];\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(x0, 0, 1, 0, this.width), MathUtility.Remap(y0, 0, 1, this.height, 0));\r\n        ctx.lineTo(MathUtility.Remap(x1, 0, 1, 0, this.width), MathUtility.Remap(y1, 0, 1, this.height, 0));\r\n        ctx.stroke();\r\n\r\n    }\r\n}\r\nclass TFLinearRegression {\r\n    weight: tf.Variable;\r\n    bias: tf.Variable;\r\n\r\n    leraningRate: number = 0.5;\r\n    optimizer: tf.Optimizer;\r\n    constructor() {\r\n        this.weight = tf.variable(tf.scalar(Math.random()));\r\n        this.bias = tf.variable(tf.scalar(Math.random()));\r\n\r\n        this.optimizer = tf.train.sgd(this.leraningRate);\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return x.mul(this.weight).add(this.bias);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}","import * as tf from '@tensorflow/tfjs';\r\n\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFMnist extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    col: string[] = ['#ff0000', '#00ff00', '#0000ff', '#00fff0', '#ff0000', '#fff000', '#0fff00'];\r\n\r\n    tfLinearRegression: PolynomialRegression[] = [];\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF MNist ';\r\n        this.Init();\r\n        this.InitUI();\r\n    }\r\n    Init() {\r\n        this.tfLinearRegression.push(new PolynomialRegression(1));\r\n        this.tfLinearRegression.push(new PolynomialRegression(2));\r\n        this.tfLinearRegression.push(new PolynomialRegression(3));\r\n        this.tfLinearRegression.push(new PolynomialRegression(4));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(2));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(3));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(4));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(5));\r\n\r\n        this.indeCanvas.canvas.style.zIndex = '-1';\r\n\r\n        TFDataUtility.getData().then((d: any) => {\r\n            // console.log(d);\r\n        });\r\n\r\n        // tfData.\r\n\r\n        const data = new MnistData();\r\n        console.log(data.getTrainData());\r\n\r\n    }\r\n    public InitUI() {\r\n        const div = document.createElement('div');\r\n        // div.style.background = '#dddddd';\r\n        div.style.position = 'absolute';\r\n        div.style.left = '40px';\r\n        div.style.color = '#ffffff';\r\n\r\n        let t = document.createElement('p');\r\n        t.textContent = 'click on this screen to add data';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.textContent = 'LinearRegression';\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[0];\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[1];\r\n        t.textContent = 'Degree of polynomial - 2';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[2];\r\n        t.textContent = 'Degree of polynomial - 3';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[3];\r\n        t.textContent = 'Degree of polynomial - 4';\r\n        div.append(t);\r\n\r\n        const divHost = document.getElementById('indePanel');\r\n        if (divHost) {\r\n            divHost.append(div);\r\n\r\n            //     const b = document.createElement('button');\r\n            //     b.textContent = 'run';\r\n            //     b.style.position = 'absolute';\r\n            //     b.style.left = '650px';\r\n            //     b.onclick = () => {\r\n            //         console.log(this);\r\n            //     };\r\n            //     this.scene.implementation.app.model.modelViewCoreWrapper.viewWrapper.div.append(b);\r\n        }\r\n        // this.scene.canvas.canvas.\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n\r\n            for (let m = 0; m < this.tfLinearRegression.length; ++m) {\r\n                const xx = [], yy = [];\r\n                for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n                // console.log(xx);\r\n                // console.log(yy);\r\n                // ............................ train\r\n                this.tfLinearRegression[m].train(xx, yy);\r\n                // ............................ end train\r\n\r\n                this.RenderLine(ctx);\r\n            }\r\n        }\r\n\r\n\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        for (let m = 0; m < this.tfLinearRegression.length; ++m) {\r\n            const curveX: number[] = [];\r\n            for (let x = -1; x <= 1; x += 0.08) {\r\n                curveX.push(x);\r\n            }\r\n\r\n            // ............................ predict\r\n            const ys = tf.tidy(() => {\r\n                return this.tfLinearRegression[m].predict(tf.tensor1d(curveX));\r\n            });\r\n\r\n            let curveY = ys.dataSync();\r\n            ys.dispose();\r\n            // ............................ end predict\r\n\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeStyle = this.col[m]; // '#00fff0';\r\n            ctx.beginPath();\r\n            ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n            for (let i = 1; i < curveX.length; ++i) {\r\n                ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n            }\r\n            ctx.stroke();\r\n        }\r\n    }\r\n}\r\nclass PolynomialRegression {\r\n    weights: tf.Variable[] = [];\r\n    bias: tf.Variable;\r\n\r\n    dim: number = 3;\r\n    leraningRate: number = 0.2;\r\n    optimizer: tf.AdamOptimizer;\r\n    constructor(dim: number = 0) {\r\n        this.dim = dim;\r\n        for (let i = 0; i < 5; ++i) {\r\n            const weight = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n            weight.print();\r\n            this.weights.push(weight);\r\n        }\r\n\r\n        this.bias = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n        this.optimizer = tf.train.adam(this.leraningRate);\r\n\r\n    }\r\n\r\n    public predict1d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.mul(this.weights[0])\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict2d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.square().mul(this.weights[1])\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict3d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(3)).mul(this.weights[2])\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict4d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(4)).mul(this.weights[3])\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict5d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(5)).mul(this.weights[4])\r\n            .add(x.pow(tf.scalar(4)).mul(this.weights[3]))\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        if (this.dim === 5) { return this.predict5d(x); }\r\n        if (this.dim === 4) { return this.predict4d(x); }\r\n        if (this.dim === 3) { return this.predict3d(x); }\r\n        if (this.dim === 2) { return this.predict2d(x); }\r\n        if (this.dim === 1) { return this.predict1d(x); }\r\n        return this.predict1d(x);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}\r\n\r\n\r\n// ..............................................................................................................................\r\n\r\nexport const IMAGE_H = 28;\r\nexport const IMAGE_W = 28;\r\nconst IMAGE_SIZE = IMAGE_H * IMAGE_W;\r\nconst NUM_CLASSES = 10;\r\nconst NUM_DATASET_ELEMENTS = 65000;\r\n\r\nconst NUM_TRAIN_ELEMENTS = 55000;\r\n// const NUM_TEST_ELEMENTS = NUM_DATASET_ELEMENTS - NUM_TRAIN_ELEMENTS;\r\n\r\nconst MNIST_IMAGES_SPRITE_PATH =\r\n    'https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png';\r\nconst MNIST_LABELS_PATH =\r\n    'https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8';\r\n\r\n/**\r\n * A class that fetches the sprited MNIST dataset and provide data as\r\n * tf.Tensors.\r\n */\r\nexport class MnistData {\r\n    testLabels: Uint8Array;\r\n    trainLabels: Uint8Array;\r\n    testImages: Float32Array;\r\n    trainImages: Float32Array;\r\n    datasetImages: Float32Array;\r\n    datasetLabels: Uint8Array;\r\n    constructor() { }\r\n\r\n    async load() {\r\n        // Make a request for the MNIST sprited image.\r\n        const img = new Image();\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\r\n        const imgRequest = new Promise<void>((resolve, reject) => {\r\n            img.crossOrigin = '';\r\n            img.onload = () => {\r\n                img.width = img.naturalWidth;\r\n                img.height = img.naturalHeight;\r\n\r\n                const datasetBytesBuffer =\r\n                    new ArrayBuffer(NUM_DATASET_ELEMENTS * IMAGE_SIZE * 4);\r\n\r\n                const chunkSize = 5000;\r\n                canvas.width = img.width;\r\n                canvas.height = chunkSize;\r\n\r\n                for (let i = 0; i < NUM_DATASET_ELEMENTS / chunkSize; i++) {\r\n                    const datasetBytesView = new Float32Array(\r\n                        datasetBytesBuffer, i * IMAGE_SIZE * chunkSize * 4,\r\n                        IMAGE_SIZE * chunkSize);\r\n                    ctx.drawImage(\r\n                        img, 0, i * chunkSize, img.width, chunkSize, 0, 0, img.width,\r\n                        chunkSize);\r\n\r\n                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n                    for (let j = 0; j < imageData.data.length / 4; j++) {\r\n                        // All channels hold an equal value since the image is grayscale, so\r\n                        // just read the red channel.\r\n                        datasetBytesView[j] = imageData.data[j * 4] / 255;\r\n                    }\r\n                }\r\n                this.datasetImages = new Float32Array(datasetBytesBuffer);\r\n\r\n                resolve();\r\n            };\r\n            img.src = MNIST_IMAGES_SPRITE_PATH;\r\n        });\r\n\r\n        const labelsRequest = fetch(MNIST_LABELS_PATH);\r\n        // const [imgResponse, labelsResponse] = await Promise.all([imgRequest, labelsRequest]);\r\n        const result = await Promise.all([imgRequest, labelsRequest]);\r\n        const labelsResponse: any = result[1];\r\n        this.datasetLabels = new Uint8Array(await labelsResponse.arrayBuffer());\r\n\r\n        // Slice the the images and labels into train and test sets.\r\n        this.trainImages = this.datasetImages.slice(0, IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\r\n        this.testImages = this.datasetImages.slice(IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\r\n        this.trainLabels = this.datasetLabels.slice(0, NUM_CLASSES * NUM_TRAIN_ELEMENTS);\r\n        this.testLabels = this.datasetLabels.slice(NUM_CLASSES * NUM_TRAIN_ELEMENTS);\r\n    }\r\n\r\n    /**\r\n     * Get all training data as a data tensor and a labels tensor.\r\n     *\r\n     * @returns\r\n     *   xs: The data tensor, of shape `[numTrainExamples, 28, 28, 1]`.\r\n     *   labels: The one-hot encoded labels tensor, of shape\r\n     *     `[numTrainExamples, 10]`.\r\n     */\r\n    getTrainData() {\r\n        const xs = tf.tensor4d(\r\n            this.trainImages,\r\n            [this.trainImages.length / IMAGE_SIZE, IMAGE_H, IMAGE_W, 1]);\r\n        const labels = tf.tensor2d(\r\n            this.trainLabels, [this.trainLabels.length / NUM_CLASSES, NUM_CLASSES]);\r\n        return { xs, labels };\r\n    }\r\n\r\n    /**\r\n     * Get all test data as a data tensor a a labels tensor.\r\n     *\r\n     * @param {number} numExamples Optional number of examples to get. If not\r\n     *     provided,\r\n     *   all test examples will be returned.\r\n     * @returns\r\n     *   xs: The data tensor, of shape `[numTestExamples, 28, 28, 1]`.\r\n     *   labels: The one-hot encoded labels tensor, of shape\r\n     *     `[numTestExamples, 10]`.\r\n     */\r\n    getTestData(numExamples: any) {\r\n        let xs = tf.tensor4d(\r\n            this.testImages,\r\n            [this.testImages.length / IMAGE_SIZE, IMAGE_H, IMAGE_W, 1]);\r\n        let labels = tf.tensor2d(\r\n            this.testLabels, [this.testLabels.length / NUM_CLASSES, NUM_CLASSES]);\r\n\r\n        if (numExamples != null) {\r\n            xs = xs.slice([0, 0, 0, 0], [numExamples, IMAGE_H, IMAGE_W, 1]);\r\n            labels = labels.slice([0, 0], [numExamples, NUM_CLASSES]);\r\n        }\r\n        return { xs, labels };\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n// import { LayersModel } from '@tensorflow/tfjs-layers';\r\nimport { ModelCompileArgs, ModelFitArgs } from '@tensorflow/tfjs';\r\n\r\n// import { TFDataUtility } from '../../../../../../NJSCore/ML/NMacineLearning';\r\n\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\n\r\nexport class TFModel01 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    tfModel: TFModel;\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Horsepower and Miles Per Gallon';\r\n        this.Init();\r\n\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n        this.tfModel = new TFModel();\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n            // console.log(xx);\r\n            // console.log(yy);\r\n            // ............................ train\r\n            // this.tfModel.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        // const curveX: number[] = [];\r\n        // for (let x = -1; x <= 1; x += 0.05) {\r\n        //     curveX.push(x);\r\n        // }\r\n\r\n        // // ............................ predict\r\n        // const ys = tf.tidy(() => {\r\n        //     return this.tfModel.predict(tf.tensor1d(curveX));\r\n        // });\r\n\r\n        // let curveY = ys.dataSync();\r\n        // ys.dispose();\r\n        // // ............................ end predict\r\n\r\n        // ctx.lineWidth = 3;\r\n        // ctx.strokeStyle = '#00fff0';\r\n        // ctx.beginPath();\r\n        // ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n        // for (let i = 1; i < curveX.length; ++i) {\r\n        //     ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n        // }\r\n        // ctx.stroke();\r\n\r\n    }\r\n}\r\nclass TFModel {\r\n    model: tf.Sequential;\r\n    constructor() {\r\n        this.model = tf.sequential();\r\n\r\n        const hidden = tf.layers.dense({\r\n            inputShape: [2],\r\n            units: 4,\r\n            activation: 'sigmoid',\r\n        });\r\n        const output = tf.layers.dense({\r\n            units: 1,\r\n            activation: 'sigmoid',\r\n\r\n        });\r\n\r\n        this.model.add(hidden);\r\n        this.model.add(output);\r\n\r\n        const compileArgs: ModelCompileArgs = {\r\n            optimizer: tf.train.sgd(0.1),\r\n            loss: tf.losses.meanSquaredError,\r\n        };\r\n\r\n        this.model.compile(compileArgs);\r\n\r\n        // const data = tf.tensor2d([\r\n        //     [0.25, 0.92]\r\n        // ]);\r\n        this.train1().then(() => {\r\n            const x = tf.tensor2d([\r\n                [0, 0],\r\n                [0.5, 0.5],\r\n                [1, 1],\r\n            ]);\r\n            const result = this.model.predict(x);\r\n            (result as tf.Tensor).print();\r\n        });\r\n    }\r\n    train0() {\r\n        const x = tf.tensor2d([\r\n            [0, 0],\r\n            [0.5, 0.5],\r\n            [1, 1],\r\n            // [0.1, 0.22],\r\n        ]);\r\n        const y = tf.tensor2d([\r\n            [1],\r\n            [0.5],\r\n            [0],\r\n        ]);\r\n        const config = {\r\n            epochs: 10\r\n        };\r\n        this.model.fit(x, y, config).then((response) => console.log(response.history));\r\n        const outResult: tf.Tensor<tf.Rank> | tf.Tensor<tf.Rank>[] = this.model.predict(x);\r\n        // console.log(outResult);\r\n        (outResult as tf.Tensor).print();\r\n    }\r\n    async train1() {\r\n        const xTrain = tf.tensor2d([\r\n            [0, 0],\r\n            [0.5, 0.5],\r\n            [1, 1],\r\n            // [0.1, 0.22],\r\n        ]);\r\n        const yTrain = tf.tensor2d([\r\n            [1],\r\n            [0.5],\r\n            [0],\r\n        ]);\r\n        const config: ModelFitArgs = {\r\n            epochs: 10,\r\n            shuffle: true,\r\n        };\r\n\r\n        for (let i = 0; i < 500; ++i) {\r\n            const response = await this.model.fit(xTrain, yTrain, config);\r\n            // response;\r\n            console.log(i, response.history.loss);\r\n        }\r\n\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport * as tfvis from '@tensorflow/tfjs-vis';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n// // https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFModel01HorsepowerAndMilesPerGallon extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    // tfModel: ModelForHorsepowerGallon;\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Horsepower and Miles Per Gallon';\r\n        this.Init();\r\n\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n\r\n        TFDataUtility.getData().then((d: any) => {\r\n            // this.tfModel = new ModelForHorsepowerGallon();\r\n            // this.train(d);\r\n            this.train(d);\r\n\r\n\r\n        });\r\n\r\n    }\r\n    async train(d: any) {\r\n        const tensorData = convertToTensor(d);\r\n        // console.log(tensorData);\r\n        const { inputs, labels } = tensorData;\r\n        // console.log(inputs, labels);\r\n        const model = createModel();\r\n\r\n        tfvis.show.modelSummary({ name: 'Model Summary' }, model);\r\n        // Train the model\r\n        await trainModel(model, inputs, labels);\r\n        // console.log('Done Training');\r\n        testModel(model, d, tensorData);\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n            // console.log(xx);\r\n            // console.log(yy);\r\n            // ............................ train\r\n            // this.tfModel.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        const curveX: number[] = [];\r\n        for (let x = -1; x <= 1; x += 0.05) {\r\n            curveX.push(x);\r\n        }\r\n    }\r\n}\r\n\r\nfunction testModel(model: tf.Sequential, inputData: any, normalizationData: any) {\r\n    const { inputMax, inputMin, labelMin, labelMax } = normalizationData;\r\n\r\n    // Generate predictions for a uniform range of numbers between 0 and 1;\r\n    // We un-normalize the data by doing the inverse of the min-max scaling\r\n    // that we did earlier.\r\n    const [xs, preds] = tf.tidy(() => {\r\n\r\n        const xs = tf.linspace(0, 1, 100);\r\n        const preds = model.predict(xs.reshape([100, 1])) as any;\r\n\r\n        const unNormXs = xs\r\n            .mul(inputMax.sub(inputMin))\r\n            .add(inputMin);\r\n\r\n        const unNormPreds = preds.mul(labelMax.sub(labelMin))\r\n            .add(labelMin);\r\n\r\n        // Un-normalize the data\r\n        return [unNormXs.dataSync(), unNormPreds.dataSync()];\r\n    });\r\n\r\n\r\n    const predictedPoints = Array.from(xs).map((val, i) => {\r\n        return { x: val, y: preds[i] };\r\n    });\r\n\r\n    const originalPoints = inputData.map((d: any) => ({\r\n        x: d.horsepower, y: d.mpg,\r\n    }));\r\n\r\n    tfvis.render.scatterplot(\r\n        { name: 'Model Predictions vs Original Data' },\r\n        { values: [originalPoints, predictedPoints], series: ['original', 'predicted'] },\r\n        {\r\n            xLabel: 'Horsepower',\r\n            yLabel: 'MPG',\r\n            height: 300\r\n        }\r\n    );\r\n}\r\n\r\n\r\nasync function trainModel(model: tf.Sequential, inputs: tf.Tensor<tf.Rank>, labels: tf.Tensor<tf.Rank>) {\r\n    // Prepare the model for training.\r\n    model.compile({\r\n        optimizer: tf.train.adam(),\r\n        loss: tf.losses.meanSquaredError,\r\n        metrics: ['mse'],\r\n    });\r\n\r\n    const batchSize = 32;\r\n    const epochs = 50;\r\n\r\n    return await model.fit(inputs, labels, {\r\n        batchSize,\r\n        epochs,\r\n        shuffle: true,\r\n        callbacks: tfvis.show.fitCallbacks(\r\n            { name: 'Training Performance' },\r\n            ['loss', 'mse'],\r\n            { height: 200, callbacks: ['onEpochEnd'] }\r\n        )\r\n    });\r\n}\r\n\r\n\r\nexport const createModel = () => {\r\n    // Create a sequential model\r\n    const model = tf.sequential();\r\n    // Add a single hidden layer\r\n    model.add(tf.layers.dense({\r\n        inputShape: [1],\r\n        units: 16,\r\n        useBias: true\r\n    }));\r\n    // Add an output layer\r\n    model.add(tf.layers.dense({\r\n        units: 1,\r\n        useBias: true\r\n    }));\r\n    return model;\r\n};\r\nexport const convertToTensor = (data: any) => {\r\n    // Wrapping these calculations in a tidy will dispose any\r\n    // intermediate tensors.\r\n\r\n    return tf.tidy(() => {\r\n        // Step 1. Shuffle the data\r\n        tf.util.shuffle(data);\r\n\r\n        // Step 2. Convert data to Tensor\r\n        const inputs = data.map((d: any) => d.horsepower);\r\n        const labels = data.map((d: any) => d.mpg);\r\n\r\n        const inputTensor = tf.tensor2d(inputs, [inputs.length, 1]);\r\n        const labelTensor = tf.tensor2d(labels, [labels.length, 1]);\r\n\r\n        // Step 3. Normalize the data to the range 0 - 1 using min-max scaling\r\n        const inputMax = inputTensor.max();\r\n        const inputMin = inputTensor.min();\r\n        const labelMax = labelTensor.max();\r\n        const labelMin = labelTensor.min();\r\n\r\n        const normalizedInputs = inputTensor.sub(inputMin).div(inputMax.sub(inputMin));\r\n        const normalizedLabels = labelTensor.sub(labelMin).div(labelMax.sub(labelMin));\r\n\r\n        return {\r\n            inputs: normalizedInputs,\r\n            labels: normalizedLabels,\r\n            // Return the min/max bounds so we can use them later.\r\n            inputMax,\r\n            inputMin,\r\n            labelMax,\r\n            labelMin,\r\n        };\r\n    });\r\n};","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\n// import { TFDataUtility } from '../../../../../../NJSCore/ML/NMacineLearning';\r\n\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\n\r\nexport class TFModel02XOR extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    tfModel: TFModel;\r\n    xPredict: any; // tf.Tensor<tf.Rank>;\r\n    inputs: number[] = [];\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF XOR';\r\n        this.Init();\r\n        this.InitUI();\r\n    }\r\n    public InitUI() {\r\n        const div = document.createElement('div');\r\n        // div.style.background = '#dddddd';\r\n        div.style.position = 'absolute';\r\n        div.style.left = '10px';\r\n        div.style.color = '#ffffff';\r\n\r\n        const t = document.createElement('p');\r\n        t.textContent = 'ref: Coding Challenge #106: XOR Problem with TensorFlow.js by The Cording Train';\r\n        t.style.fontSize = '11px';\r\n        div.append(t);\r\n\r\n        const divHost = document.getElementById('indePanel');\r\n        if (divHost) {\r\n            divHost.append(div);\r\n        }\r\n        // this.scene.canvas.canvas.\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n        this.tfModel = new TFModel();\r\n\r\n        let inputs = [];\r\n        for (let i = 0; i <= 10; ++i) {\r\n            for (let j = 0; j <= 10; ++j) {\r\n                // let x1 = i / 10;\r\n                // let x2 = j / 10;\r\n                inputs.push([j * 0.1, i * 0.1]);\r\n            }\r\n        }\r\n        // console.log(inputs);\r\n        // console.log(;)\r\n        this.xPredict = tf.tensor2d(inputs);\r\n        // console.log(xPredict);\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // let ys = this.tfModel.model.predict(this.xPredict);\r\n\r\n        // (ys as tf.Tensor<tf.Rank.R2>).print();\r\n        // let y_values = ys.dataSync();\r\n\r\n        tf.tidy(() => {\r\n            const d = this.tfModel.model.predict(this.xPredict);\r\n            const result = (d as tf.Tensor2D).dataSync();\r\n\r\n\r\n            // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n            ctx.fillStyle = '#000000';\r\n            ctx.beginPath();\r\n            ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n\r\n\r\n\r\n            let index = 0;\r\n            for (let i = 0; i <= 10; i++) {\r\n                for (let j = 0; j <= 10; j++) {\r\n                    this.inputs.push(i);\r\n                    let offset = 42;\r\n                    let x = i * offset;\r\n                    let y = j * offset;\r\n                    const out = result[index];\r\n\r\n                    ctx.fillStyle = `rgba(${out * 255},${0},${0},1)`;\r\n                    // console.log(out);\r\n                    ctx.beginPath();\r\n                    ctx.rect(x, y, offset, offset);\r\n                    ctx.closePath();\r\n                    ctx.fill();\r\n\r\n                    index++;\r\n                }\r\n            }\r\n            // console.log(index);\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n    }\r\n}\r\nclass TFModel {\r\n    model: tf.Sequential;\r\n    xTrain = tf.tensor2d([\r\n        [0.0, 0.0],\r\n        [1.0, 0.0],\r\n        [0.0, 1.0],\r\n        [1.0, 1.0]\r\n    ]);\r\n    yTrain = tf.tensor2d([\r\n        [0.0],\r\n        [1.0],\r\n        [1.0],\r\n        [0.0]\r\n    ]);\r\n    constructor() {\r\n        this.model = tf.sequential();\r\n\r\n        const hidden = tf.layers.dense({\r\n            inputShape: [2],\r\n            units: 16,\r\n            activation: 'sigmoid',\r\n        });\r\n        const output = tf.layers.dense({\r\n            units: 1,\r\n            activation: 'sigmoid',\r\n        });\r\n        this.model.add(hidden);\r\n        this.model.add(output);\r\n        this.model.compile({\r\n            optimizer: tf.train.adam(0.05),\r\n            loss: tf.losses.meanSquaredError,\r\n        });\r\n        this.trainLoop();\r\n    }\r\n    public trainLoop() {\r\n        this.train().then((result: any) => {\r\n            // console.log(result.history.loss[0]);\r\n            setTimeout(() => this.trainLoop(), 1);\r\n        });\r\n    }\r\n    public async train() {\r\n        return await this.model.fit(this.xTrain, this.yTrain, {\r\n            epochs: 10,\r\n            shuffle: true,\r\n        });\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\n// import * as tfvis from '@tensorflow/tfjs-vis';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\n// import { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\n\r\nexport class TFModel03Iris extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    // vs: NVector3[] = [];\r\n    // selVec: NVector3 | undefined = undefined;\r\n\r\n    tfModel: TFModel;\r\n    xPredict: any; // tf.Tensor<tf.Rank>;\r\n    inputs: number[] = [];\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Horsepower and Miles Per Gallon';\r\n        this.Init();\r\n\r\n    }\r\n    Init() {\r\n        this.tfModel = new TFModel();\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n\r\n        tf.tidy(() => {\r\n            //\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n    }\r\n}\r\nclass TFModel {\r\n    model: tf.Sequential;\r\n    inputsTensor: tf.Tensor<tf.Rank.R2>;\r\n    labelsTensor: tf.Tensor<tf.Rank.R2>;\r\n\r\n    // xTrain = tf.tensor2d([\r\n    //     [0.0, 0.0],\r\n    //     [1.0, 0.0],\r\n    //     [0.0, 1.0],\r\n    //     [1.0, 1.0]\r\n    // ]);\r\n    // yTrain = tf.tensor2d([\r\n    //     [0.0],\r\n    //     [1.0],\r\n    //     [1.0],\r\n    //     [0.0]\r\n    // ]);\r\n    constructor() {\r\n        const d = TFDataUtility.GetIrisData();\r\n        tf.util.shuffle(d);\r\n        // console.log(d);\r\n\r\n        const inputs = [];\r\n        for (let i = 0; i < d.length; ++i) {\r\n            let row = [];\r\n            for (let j = 0; j < d[i].length - 1; ++j) {\r\n                row.push(d[i][j]);\r\n            }\r\n            inputs.push(row);\r\n        }\r\n\r\n        const labels = []; //  d.map((d: number[]) => [d[d.length - 1]]);\r\n        for (let i = 0; i < d.length; ++i) {\r\n            if (d[i][d[i].length - 1] === 0) {\r\n                labels.push([1, 0, 0]);\r\n            } else if (d[i][d[i].length - 1] === 1) {\r\n                labels.push([0, 1, 0]);\r\n            } else if (d[i][d[i].length - 1] === 2) {\r\n                labels.push([0, 0, 1]);\r\n            }\r\n\r\n        }\r\n\r\n        // console.log(inputs);\r\n        // console.log(labels);\r\n\r\n        // console.log('tensor......................');\r\n        this.inputsTensor = tf.tensor2d(inputs);\r\n        this.labelsTensor = tf.tensor2d(labels);\r\n        // console.log(this.inputsTensor);\r\n        // console.log(this.labelsTensor);\r\n        this.inputsTensor.print();\r\n        this.labelsTensor.print();\r\n\r\n        this.model = tf.sequential();\r\n\r\n        // console.log(this.inputsTensor.shape[1]);\r\n\r\n        const hidden = tf.layers.dense({\r\n            inputShape: [this.inputsTensor.shape[1]],\r\n            units: 10,\r\n            activation: 'sigmoid',\r\n        });\r\n        const output = tf.layers.dense({\r\n            // inputShape: [10],\r\n            units: 3,\r\n            activation: 'softmax',\r\n        });\r\n        this.model.add(hidden);\r\n        this.model.add(output);\r\n        this.model.compile({\r\n            optimizer: tf.train.adam(),\r\n            // loss: tf.losses.meanSquaredError,\r\n            // metrics: ['mse'],\r\n            loss: tf.losses.softmaxCrossEntropy,  // 'categoricalCrossentropy',\r\n            metrics: ['accuracy'],\r\n        });\r\n        this.model.summary();\r\n        // tfvis.show.modelSummary({ name: 'Model Summary' }, this.model);\r\n\r\n        this.trainLoop();\r\n    }\r\n    public async trainLoop() {\r\n        await this.model.save('downloads://my-model');\r\n        const saveResults = await this.model.save('localstorage://ml/my-model-1');\r\n        console.log(saveResults);\r\n        this.train().then((result: any) => {\r\n            console.log(result.history.loss[0]);\r\n            setTimeout(() => this.trainLoop(), 1);\r\n        });\r\n    }\r\n    public async train() {\r\n        return await this.model.fit(this.inputsTensor, this.labelsTensor, {\r\n            // batchSize: 100,\r\n            epochs: 50,\r\n            shuffle: true,\r\n            validationData: [this.inputsTensor, this.labelsTensor],\r\n        });\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\n// import * as tfvis from '@tensorflow/tfjs-vis';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\n// import { NVector3, MathUtility } from '../../../lib';\r\n\r\n// import { csv } from './smartDrawingTrainData.csv';\r\n\r\n// import { TFDataUtility } from '../../../../../../NJSCore/ML/NMacineLearning';\r\n\r\n// const csv = require('./smartDrawingTrainData.csv');\r\n\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\n\r\nexport class TFModel03SmartDrawing extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    // vs: NVector3[] = [];\r\n    // selVec: NVector3 | undefined = undefined;\r\n\r\n    tfModel: TFModel;\r\n    xPredict: any; // tf.Tensor<tf.Rank>;\r\n    inputs: number[] = [];\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Horsepower and Miles Per Gallon';\r\n        this.Init();\r\n\r\n    }\r\n    async Init() {\r\n        const d = new DataProcess();\r\n        await d.Init().then(() => {\r\n            this.tfModel = new TFModel('model1', d.inputsTensor, d.labelsTensor);\r\n            this.tfModel.CreateModel01();\r\n\r\n            this.tfModel = new TFModel('model2', d.inputsTensor, d.labelsTensor);\r\n            this.tfModel.CreateModel02();\r\n\r\n        });\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n\r\n        tf.tidy(() => {\r\n            //\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n    }\r\n}\r\n\r\nclass DataProcess {\r\n    raw: any;\r\n    inputsTensor: tf.Tensor<tf.Rank.R2>;\r\n    labelsTensor: tf.Tensor<tf.Rank.R2>;\r\n    constructor() {\r\n        //\r\n    }\r\n    async Init() {\r\n        const d = await this.OpenCSV();\r\n        if (d) {\r\n            this.raw = this.processData(d);\r\n            tf.util.shuffle(this.raw);\r\n            // console.log(this.raw);\r\n\r\n            const inputs = [];\r\n            const labelsTemp = [];\r\n            for (let i = 0; i < this.raw.length; ++i) {\r\n                let row = [];\r\n                for (let j = 0; j < this.raw[i].length - 1; ++j) { row.push(this.raw[i][j]); }\r\n                inputs.push(row);\r\n                labelsTemp.push(this.raw[i][this.raw[i].length - 1]);\r\n            }\r\n            console.log(inputs);\r\n            console.log(labelsTemp);\r\n            const max = tf.max(labelsTemp);\r\n            const maxNum = max.dataSync();\r\n\r\n            const labels = [];\r\n            for (let i = 0; i < labelsTemp.length; ++i) {\r\n                const label = [];\r\n                for (let j = 0; j <= maxNum[0]; ++j) {\r\n                    if (j === labelsTemp[i]) {\r\n                        label.push(1);\r\n                    } else {\r\n                        label.push(0);\r\n                    }\r\n                }\r\n                labels.push(label);\r\n            }\r\n            console.log(labels);\r\n\r\n            this.inputsTensor = tf.tensor2d(inputs);\r\n            this.labelsTensor = tf.tensor2d(labels);\r\n\r\n            this.inputsTensor.print();\r\n            this.labelsTensor.print();\r\n        }\r\n    }\r\n    private processData(allText: any) {\r\n        const allTextLines = allText.split(/\\r\\n|\\n/);\r\n        const headers = allTextLines[0].split(',');\r\n        const lines = [];\r\n\r\n        for (let i = 1; i < allTextLines.length; i++) {\r\n            const data = allTextLines[i].split(',');\r\n            if (data.length === headers.length) {\r\n\r\n                const tarr = [];\r\n                for (let j = 0; j < headers.length; j++) {\r\n                    const dataTemp = +data[j];\r\n                    if (isNaN(dataTemp)) {\r\n                        tarr.push(data[j]);\r\n                    } else {\r\n                        tarr.push(dataTemp);\r\n                    }\r\n                }\r\n                lines.push(tarr);\r\n            }\r\n        }\r\n        return lines;\r\n    }\r\n    public async OpenCSV() {\r\n        // if (njslabSandboxStatic.app) { if (njslabSandboxStatic.app.isProduction) { return; } }\r\n        let file = 'smartDrawingTrainData.csv';\r\n        // console.log(location.host);\r\n        return fetch(`njslabSandboxStatic/ML/SmartDrawing/${file}`)\r\n            .then((response: Response) => {\r\n                console.log(response);\r\n                return response.text();\r\n            })\r\n            .catch((err: Error) => {\r\n                console.log(err);\r\n            });\r\n    }\r\n}\r\n\r\nclass TFModel {\r\n    t0: number;\r\n    t1: number;\r\n    name: string;\r\n    model: tf.Sequential;\r\n    inputsTensor: tf.Tensor<tf.Rank.R2>;\r\n    labelsTensor: tf.Tensor<tf.Rank.R2>;\r\n    constructor(name: string, inputsTensor: tf.Tensor<tf.Rank.R2>, labelsTensor: tf.Tensor<tf.Rank.R2>) {\r\n        this.name = name;\r\n        this.inputsTensor = inputsTensor;\r\n        this.labelsTensor = labelsTensor;\r\n    }\r\n    CreateModel01() {\r\n        this.model = tf.sequential();\r\n        const hidden01 = tf.layers.dense({\r\n            inputShape: [this.inputsTensor.shape[1]],\r\n            units: 20,\r\n            activation: 'sigmoid',\r\n        });\r\n        const output = tf.layers.dense({\r\n            // inputShape: [10],\r\n            units: this.labelsTensor.shape[1],\r\n            activation: 'softmax',\r\n        });\r\n        this.model.add(hidden01);\r\n        this.model.add(output);\r\n        this.Compile();\r\n    }\r\n    CreateModel02() {\r\n        this.model = tf.sequential();\r\n        const hidden01 = tf.layers.dense({\r\n            inputShape: [this.inputsTensor.shape[1]],\r\n            units: 20,\r\n            activation: 'sigmoid',\r\n        });\r\n        const hidden02 = tf.layers.dense({\r\n            // inputShape: [this.inputsTensor.shape[1]],\r\n            units: 15,\r\n            activation: 'sigmoid',\r\n        });\r\n        const output = tf.layers.dense({\r\n            // inputShape: [10],\r\n            units: this.labelsTensor.shape[1],\r\n            activation: 'softmax',\r\n        });\r\n        this.model.add(hidden01);\r\n        this.model.add(hidden02);\r\n        this.model.add(output);\r\n        this.Compile();\r\n    }\r\n    Compile() {\r\n        this.model.compile({\r\n            optimizer: tf.train.adam(),\r\n            // loss: tf.losses.meanSquaredError,\r\n            // metrics: ['mse'],\r\n            loss: tf.losses.softmaxCrossEntropy,  // 'categoricalCrossentropy',\r\n            metrics: ['accuracy'],\r\n        });\r\n        this.model.summary();\r\n        // tfvis.show.modelSummary({ name: 'Model Summary' }, this.model);\r\n\r\n        this.trainLoop();\r\n    }\r\n    public async trainLoop() {\r\n        this.t0 = performance.now();\r\n\r\n        await this.model.save('downloads://my-model');\r\n        // const saveResults = await this.model.save('localstorage://ml/my-model-1');\r\n        // console.log(saveResults);\r\n        this.train().then((result: any) => {\r\n            this.t1 = performance.now();\r\n            console.log(`${this.name}: ${result.history.loss[0]}, ${this.t1 - this.t0} `);\r\n            setTimeout(() => this.trainLoop(), 1);\r\n        });\r\n    }\r\n    public async train() {\r\n        // return await this.model.fit(this.inputsTensor, this.labelsTensor, {\r\n        //     batchSize: 100,\r\n        //     epochs: 10,\r\n        //     shuffle: true,\r\n        //     validationData: [this.inputsTensor, this.labelsTensor],\r\n        // });\r\n    }\r\n}","import { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { TFProject } from '..';\r\n\r\n// import * as tf from '@tensorflow/tfjs';\r\nimport { NVector3 } from '../../../lib';\r\nimport { TFUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\nexport class TFPlayground01 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n\r\n    a: number = 1;\r\n    bias: number = 0;\r\n\r\n    constructor(tfProjct: TFProject) {\r\n        super(tfProjct);\r\n        this.indeCanvas.title = 'TF Playground';\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n        // this.Tensor01();\r\n        // this.Tensor02();\r\n        // this.Tensor03();\r\n        TFUtility.Playground();\r\n    }\r\n\r\n    MouseDown(x: number, y: number) {\r\n        //\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n    }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n\r\n// import { TFUtility } from '../../../../../../NJSCore/ML/NMacineLearning';\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFPolynomialRegressionGradientDescent02 extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    vsTemp: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    tfLinearRegression: PolynomialRegression;\r\n    t: number = 0.0;\r\n    constructor(tfProjct: TFProject) {\r\n        super(tfProjct);\r\n        this.indeCanvas.title = 'TF LinearRegression GradientDescent 01';\r\n        this.Init();\r\n        this.InitData();\r\n        this.InitUI();\r\n    }\r\n    public InitUI() {\r\n        const div = document.createElement('div');\r\n        // div.style.background = '#dddddd';\r\n        div.style.position = 'absolute';\r\n        div.style.left = '400px';\r\n        div.style.color = '#ffffff';\r\n\r\n        const t = document.createElement('p');\r\n        t.textContent = 'click on this screen to add data';\r\n        div.append(t);\r\n\r\n\r\n        const divHost = document.getElementById('indePanel');\r\n        if (divHost) {\r\n            divHost.append(div);\r\n\r\n            const b = document.createElement('button');\r\n            b.textContent = 'run';\r\n            b.style.position = 'absolute';\r\n            b.style.left = '650px';\r\n            b.onclick = () => {\r\n                console.log(this);\r\n            };\r\n            this.scene.implementation.app.model.modelViewCoreWrapper.viewWrapper.div.append(b);\r\n        }\r\n        // this.scene.canvas.canvas.\r\n    }\r\n    InitData() {\r\n        TFDataUtility.getData().then((d: any) => {\r\n            let xMin = Number.MAX_SAFE_INTEGER;\r\n            let xMax = Number.MIN_SAFE_INTEGER;\r\n            let yMin = Number.MAX_SAFE_INTEGER;\r\n            let yMax = Number.MIN_SAFE_INTEGER;\r\n\r\n            d.map((data: any) => {\r\n                let x = (data['horsepower']);\r\n                if (x > xMax) { xMax = x; }\r\n                if (x < xMin) { xMin = x; }\r\n\r\n                let y = (data['mpg']);\r\n                if (y > yMax) { yMax = y; }\r\n                if (y < yMin) { yMin = y; }\r\n                return 0\r\n            });\r\n\r\n            for (let data of d) {\r\n                let x = (data['horsepower']);\r\n                let y = (data['mpg']);\r\n                this.vsTemp.push(new NVector3(\r\n                    MathUtility.Remap(x, xMin, xMax, -0.9, 0.9),\r\n                    MathUtility.Remap(y, yMin, yMax, -0.9, 0.9)));\r\n            }\r\n        });\r\n    }\r\n    Init() {\r\n        console.log(tf.version);\r\n\r\n        this.tfLinearRegression = new PolynomialRegression();\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    Grid(ctx: CanvasRenderingContext2D) {\r\n        // for (let i = -10; i < 10; ++i) {\r\n        //     for (let j = -10; j < 10; ++j) {\r\n        //         ctx.beginPath();\r\n        //         ctx.fillStyle = 'rgba(255, 0, 0, 0.9)';\r\n        //         ctx.arc(i, j, 0.05, 0, Math.PI * 2);\r\n        //         ctx.closePath();\r\n        //         ctx.fill();\r\n        //     }\r\n        // }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        this.Grid(ctx);\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        if ((this.t & 2) === 0) {\r\n            const v = this.vsTemp.pop();\r\n            if (v) {\r\n                this.vs.push(v);\r\n            }\r\n        }\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n            // console.log(xx);\r\n            // console.log(yy);\r\n            // ............................ train\r\n            this.tfLinearRegression.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        this.t += 0.3;\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        const curveX: number[] = [];\r\n        for (let x = -1; x <= 1; x += 0.05) {\r\n            curveX.push(x);\r\n        }\r\n\r\n        // ............................ predict\r\n        const ys = tf.tidy(() => {\r\n            // return this.tfLinearRegression.predict(tf.tensor1d(curveX));\r\n            return this.tfLinearRegression.predict2d(tf.tensor1d(curveX));\r\n        });\r\n\r\n        let curveY = ys.dataSync();\r\n        ys.dispose();\r\n        // ............................ end predict\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n        for (let i = 1; i < curveX.length; ++i) {\r\n            ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n        }\r\n        ctx.stroke();\r\n\r\n    }\r\n}\r\nclass PolynomialRegression {\r\n    weights: tf.Variable[] = [];\r\n    bias: tf.Variable;\r\n\r\n    dim: number = 1;\r\n    leraningRate: number = 0.2;\r\n    optimizer: tf.AdamOptimizer;\r\n    constructor() {\r\n        for (let i = 0; i < 5; ++i) {\r\n            const weight = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n            weight.print();\r\n            this.weights.push(weight);\r\n        }\r\n\r\n        this.bias = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n        this.optimizer = tf.train.adam(this.leraningRate);\r\n    }\r\n\r\n    public predict1d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.mul(this.weights[0])\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict2d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.square().mul(this.weights[1])\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict3d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(3)).mul(this.weights[2])\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict4d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(4)).mul(this.weights[3])\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict5d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(5)).mul(this.weights[4])\r\n            .add(x.pow(tf.scalar(4)).mul(this.weights[3]))\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        if (this.dim === 5) { return this.predict5d(x); }\r\n        if (this.dim === 4) { return this.predict4d(x); }\r\n        if (this.dim === 3) { return this.predict3d(x); }\r\n        if (this.dim === 2) { return this.predict2d(x); }\r\n\r\n        return this.predict1d(x);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFPolynomialRegressionGradientDescent03Interaction extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    tfLinearRegression: PolynomialRegression;\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF LinearRegression GradientDescent 01';\r\n        this.Init();\r\n\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n\r\n        this.tfLinearRegression = new PolynomialRegression();\r\n\r\n        this.indeCanvas.canvas.style.zIndex = '-1';\r\n        // this.indeCanvas.bodyDiv.divHost.style.pointerEvents = 'auto';\r\n        // this.indeCanvas.bodyDiv.div.style.pointerEvents = 'auto';\r\n\r\n        // const div = document.createElement('div');\r\n        // div.style.background = '#ff0000';\r\n        // div.style.width = '100px';\r\n        // div.style.height = '100px';\r\n        // div.style.position = 'absolute';\r\n        // div.style.zIndex = '1';\r\n        // div.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.preventDefault();\r\n        // };\r\n        // console.log(this.indeCanvas);\r\n\r\n        // let input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // this.indeCanvas.bodyDiv.div.append(div);\r\n\r\n        TFDataUtility.getData().then((d: any) => {\r\n            // console.log(d);\r\n        });\r\n\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n            // console.log(xx);\r\n            // console.log(yy);\r\n            // ............................ train\r\n            this.tfLinearRegression.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        const curveX: number[] = [];\r\n        for (let x = -1; x <= 1; x += 0.05) {\r\n            curveX.push(x);\r\n        }\r\n\r\n        // ............................ predict\r\n        const ys = tf.tidy(() => {\r\n            return this.tfLinearRegression.predict(tf.tensor1d(curveX));\r\n        });\r\n\r\n        let curveY = ys.dataSync();\r\n        ys.dispose();\r\n        // ............................ end predict\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n        for (let i = 1; i < curveX.length; ++i) {\r\n            ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n        }\r\n        ctx.stroke();\r\n\r\n    }\r\n}\r\nclass PolynomialRegression {\r\n    weights: tf.Variable[] = [];\r\n    bias: tf.Variable;\r\n\r\n    dim: number = 3;\r\n    leraningRate: number = 0.2;\r\n    optimizer: tf.AdamOptimizer;\r\n    constructor() {\r\n        for (let i = 0; i < 5; ++i) {\r\n            const weight = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n            weight.print();\r\n            this.weights.push(weight);\r\n        }\r\n\r\n        this.bias = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n        this.optimizer = tf.train.adam(this.leraningRate);\r\n    }\r\n\r\n    public predict1d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.mul(this.weights[0])\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict2d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.square().mul(this.weights[1])\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict3d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(3)).mul(this.weights[2])\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict4d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(4)).mul(this.weights[3])\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict5d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(5)).mul(this.weights[4])\r\n            .add(x.pow(tf.scalar(4)).mul(this.weights[3]))\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        if (this.dim === 5) { return this.predict5d(x); }\r\n        if (this.dim === 4) { return this.predict4d(x); }\r\n        if (this.dim === 3) { return this.predict3d(x); }\r\n        if (this.dim === 2) { return this.predict2d(x); }\r\n\r\n        return this.predict1d(x);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    tfLinearRegression: PolynomialRegression;\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Horsepower and Miles Per Gallon';\r\n        this.Init();\r\n\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n\r\n        this.tfLinearRegression = new PolynomialRegression();\r\n\r\n        this.indeCanvas.canvas.style.zIndex = '-1';\r\n        // this.indeCanvas.bodyDiv.divHost.style.pointerEvents = 'auto';\r\n        // this.indeCanvas.bodyDiv.div.style.pointerEvents = 'auto';\r\n\r\n        // const div = document.createElement('div');\r\n        // div.style.background = '#ff0000';\r\n        // div.style.width = '100px';\r\n        // div.style.height = '100px';\r\n        // div.style.position = 'absolute';\r\n        // div.style.zIndex = '1';\r\n        // div.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.preventDefault();\r\n        // };\r\n        // console.log(this.indeCanvas);\r\n\r\n        // let input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // this.indeCanvas.bodyDiv.div.append(div);\r\n\r\n        TFDataUtility.getData().then((d: any) => {\r\n            let xMin = Number.MAX_SAFE_INTEGER;\r\n            let xMax = Number.MIN_SAFE_INTEGER;\r\n            let yMin = Number.MAX_SAFE_INTEGER;\r\n            let yMax = Number.MIN_SAFE_INTEGER;\r\n\r\n            d.map((data: any) => {\r\n                let x = (data['horsepower']);\r\n                if (x > xMax) { xMax = x; }\r\n                if (x < xMin) { xMin = x; }\r\n\r\n                let y = (data['mpg']);\r\n                if (y > yMax) { yMax = y; }\r\n                if (y < yMin) { yMin = y; }\r\n                return 0\r\n            });\r\n\r\n            for (let data of d) {\r\n                let x = (data['horsepower']);\r\n                let y = (data['mpg']);\r\n                this.vs.push(new NVector3(\r\n                    MathUtility.Remap(x, xMin, xMax, -0.9, 0.9),\r\n                    MathUtility.Remap(y, yMin, yMax, -0.9, 0.9)));\r\n            }\r\n        });\r\n\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n            const xx = [], yy = [];\r\n            for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n            // console.log(xx);\r\n            // console.log(yy);\r\n            // ............................ train\r\n            this.tfLinearRegression.train(xx, yy);\r\n            // ............................ end train\r\n\r\n            this.RenderLine(ctx);\r\n        }\r\n\r\n\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        const curveX: number[] = [];\r\n        for (let x = -1; x <= 1; x += 0.05) {\r\n            curveX.push(x);\r\n        }\r\n\r\n        // ............................ predict\r\n        const ys = tf.tidy(() => {\r\n            return this.tfLinearRegression.predict(tf.tensor1d(curveX));\r\n        });\r\n\r\n        let curveY = ys.dataSync();\r\n        ys.dispose();\r\n        // ............................ end predict\r\n\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = '#00fff0';\r\n        ctx.beginPath();\r\n        ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n        for (let i = 1; i < curveX.length; ++i) {\r\n            ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n        }\r\n        ctx.stroke();\r\n\r\n    }\r\n}\r\nclass PolynomialRegression {\r\n    weights: tf.Variable[] = [];\r\n    bias: tf.Variable;\r\n\r\n    dim: number = 3;\r\n    leraningRate: number = 0.2;\r\n    optimizer: tf.AdamOptimizer;\r\n    constructor() {\r\n        for (let i = 0; i < 5; ++i) {\r\n            const weight = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n            weight.print();\r\n            this.weights.push(weight);\r\n        }\r\n\r\n        this.bias = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n        this.optimizer = tf.train.adam(this.leraningRate);\r\n    }\r\n\r\n    public predict1d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.mul(this.weights[0])\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict2d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.square().mul(this.weights[1])\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict3d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(3)).mul(this.weights[2])\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict4d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(4)).mul(this.weights[3])\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict5d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(5)).mul(this.weights[4])\r\n            .add(x.pow(tf.scalar(4)).mul(this.weights[3]))\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        if (this.dim === 5) { return this.predict5d(x); }\r\n        if (this.dim === 4) { return this.predict4d(x); }\r\n        if (this.dim === 3) { return this.predict3d(x); }\r\n        if (this.dim === 2) { return this.predict2d(x); }\r\n\r\n        return this.predict1d(x);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}","import * as tf from '@tensorflow/tfjs';\r\nimport { TFProject } from '..';\r\nimport { DefinitionIndeCanvasCore } from '../Core/DefinitionIndeCanvasCore';\r\n\r\nimport { NVector3, MathUtility } from '../../../lib';\r\n\r\nimport { TFDataUtility } from '../../../../../../../lib/NJSCore/ML/NMacineLearning';\r\n// https://editor.p5js.org/codingtrain/sketches/UdXRZxF7e\r\nexport class TFPolynomialRegressionGradientDescent05Interaction extends DefinitionIndeCanvasCore {\r\n\r\n    xpos: number = 100;\r\n    ypos: number = 100;\r\n\r\n    xspeed: number = 10;\r\n    yspeed: number = 10;\r\n\r\n    xdirection: number = 1;\r\n    ydirection: number = 1;\r\n\r\n    rad: number = 50;\r\n    vs: NVector3[] = [];\r\n    selVec: NVector3 | undefined = undefined;\r\n\r\n    col: string[] = ['#ff0000', '#00ff00', '#0000ff', '#00fff0', '#ff0000', '#fff000', '#0fff00'];\r\n\r\n    tfLinearRegression: PolynomialRegression[] = [];\r\n\r\n    constructor(tfProjct: TFProject, width: number = 650, height: number = 350) {\r\n        super(tfProjct, width, height);\r\n        this.indeCanvas.title = 'TF Regression ';\r\n        this.Init();\r\n        this.InitUI();\r\n    }\r\n    Init() {\r\n        // console.log(tf.version);\r\n\r\n        this.tfLinearRegression.push(new PolynomialRegression(1));\r\n        this.tfLinearRegression.push(new PolynomialRegression(2));\r\n        this.tfLinearRegression.push(new PolynomialRegression(3));\r\n        this.tfLinearRegression.push(new PolynomialRegression(4));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(2));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(3));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(4));\r\n        // this.tfLinearRegression.push(new PolynomialRegression(5));\r\n\r\n        this.indeCanvas.canvas.style.zIndex = '-1';\r\n        // this.indeCanvas.bodyDiv.divHost.style.pointerEvents = 'auto';\r\n        // this.indeCanvas.bodyDiv.div.style.pointerEvents = 'auto';\r\n\r\n        // const div = document.createElement('div');\r\n        // div.style.background = '#ff0000';\r\n        // div.style.width = '100px';\r\n        // div.style.height = '100px';\r\n        // div.style.position = 'absolute';\r\n        // div.style.zIndex = '1';\r\n        // div.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.preventDefault();\r\n        // };\r\n        // console.log(this.indeCanvas);\r\n\r\n        // let input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // input = document.createElement('input');\r\n        // input.type = 'radio';\r\n\r\n        // input.onclick = (e: MouseEvent) => {\r\n        //     console.log(e);\r\n        //     // e.cancelBubble = true;\r\n        //     // e.stopPropagation();\r\n        // };\r\n        // div.append(input);\r\n\r\n        // this.indeCanvas.bodyDiv.div.append(div);\r\n\r\n        TFDataUtility.getData().then((d: any) => {\r\n            // console.log(d);\r\n        });\r\n\r\n    }\r\n    public InitUI() {\r\n        const div = document.createElement('div');\r\n        // div.style.background = '#dddddd';\r\n        div.style.position = 'absolute';\r\n        div.style.left = '40px';\r\n        div.style.color = '#ffffff';\r\n\r\n        let t = document.createElement('p');\r\n        t.textContent = 'click on this screen to add data';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.textContent = 'LinearRegression';\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[0];\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[1];\r\n        t.textContent = 'Degree of polynomial - 2';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[2];\r\n        t.textContent = 'Degree of polynomial - 3';\r\n        div.append(t);\r\n\r\n        t = document.createElement('p');\r\n        t.style.marginTop = '0px';\r\n        t.style.marginBottom = '0px';\r\n        t.style.color = this.col[3];\r\n        t.textContent = 'Degree of polynomial - 4';\r\n        div.append(t);\r\n\r\n        const divHost = document.getElementById('indePanel');\r\n        if (divHost) {\r\n            divHost.append(div);\r\n\r\n            //     const b = document.createElement('button');\r\n            //     b.textContent = 'run';\r\n            //     b.style.position = 'absolute';\r\n            //     b.style.left = '650px';\r\n            //     b.onclick = () => {\r\n            //         console.log(this);\r\n            //     };\r\n            //     this.scene.implementation.app.model.modelViewCoreWrapper.viewWrapper.div.append(b);\r\n        }\r\n        // this.scene.canvas.canvas.\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            if (NVector3.Distance(m, this.vs[i]) < 0.05) {\r\n                this.selVec = this.vs[i];\r\n                return;\r\n            }\r\n        }\r\n        this.vs.push(new NVector3(this.MapX(x), this.MapY(y)));\r\n        // console.log(this.vs);\r\n    }\r\n    MouseDoubleClick() {\r\n        // console.log(this.tfLinearRegression.dim);\r\n        // this.tfLinearRegression.dim++;\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        let selVec: undefined | NVector3 = undefined;\r\n        const m = new NVector3(this.MapX(x), this.MapY(y));\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            let theDis = NVector3.Distance(m, this.vs[i]);\r\n            if (theDis < 0.05) {\r\n                selVec = this.vs[i];\r\n            }\r\n        }\r\n        if (selVec) {\r\n            this.selVec = selVec;\r\n        } else {\r\n            this.selVec = undefined;\r\n        }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        if (this.selVec) {\r\n            this.selVec.x = this.MapX(x);\r\n            this.selVec.y = this.MapY(y);\r\n        }\r\n    }\r\n    MouseUp() {\r\n        this.selVec = undefined;\r\n    }\r\n    MapX(v: number) {\r\n        return MathUtility.Remap(v, 0, this.width, -1, 1);\r\n    }\r\n    MapY(v: number) {\r\n        return MathUtility.Remap(v, 0, this.height, 1, -1);\r\n    }\r\n    GridLine(ctx: CanvasRenderingContext2D) {\r\n        ctx.strokeStyle = '#555555';\r\n        const xInterval = this.width / 20 - 1;\r\n        const yInterval = this.height / 20 - 1;\r\n        for (let i = 0; i < 20; i += 1) {\r\n            if (i === 10) {\r\n                ctx.lineWidth = 3;\r\n            } else {\r\n                ctx.lineWidth = 1;\r\n            }\r\n            let x0 = xInterval * i;\r\n            let y0 = 0;\r\n            let x1 = x0;\r\n            let y1 = this.height;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n\r\n            x0 = 0;\r\n            y0 = yInterval * i;\r\n            x1 = this.width;\r\n            y1 = y0;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x0, y0);\r\n            ctx.lineTo(x1, y1);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    RenderIndependentCanvas(ctx: CanvasRenderingContext2D) {\r\n        // ctx.translate(ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);\r\n\r\n        ctx.fillStyle = '#000000';\r\n        ctx.beginPath();\r\n        ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        this.GridLine(ctx);\r\n\r\n        // this.GradientDescent();\r\n        if (this.vs.length > 1) {\r\n\r\n            for (let m = 0; m < this.tfLinearRegression.length; ++m) {\r\n                const xx = [], yy = [];\r\n                for (let i = 0; i < this.vs.length; ++i) { xx.push(this.vs[i].x); yy.push(this.vs[i].y); }\r\n                // console.log(xx);\r\n                // console.log(yy);\r\n                // ............................ train\r\n                this.tfLinearRegression[m].train(xx, yy);\r\n                // ............................ end train\r\n\r\n                this.RenderLine(ctx);\r\n            }\r\n        }\r\n\r\n\r\n\r\n        ctx.fillStyle = '#00ff00';\r\n        for (let i = 0; i < this.vs.length; ++i) {\r\n            ctx.beginPath();\r\n            ctx.arc(\r\n                MathUtility.Remap(this.vs[i].x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.vs[i].y, -1, 1, this.height, 0),\r\n                5, 0, Math.PI * 2);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n\r\n        if (this.selVec) {\r\n            ctx.fillStyle = '#ffffff';\r\n            ctx.font = '15px Arial';\r\n            ctx.textAlign = 'center';\r\n            ctx.fillText(`x:${this.selVec.x.toFixed(3)}, y${this.selVec.y.toFixed(3)}`,\r\n                MathUtility.Remap(this.selVec.x, -1, 1, 0, this.width),\r\n                MathUtility.Remap(this.selVec.y, -1, 1, this.height, 0) - 9,\r\n            );\r\n        }\r\n\r\n    }\r\n    public RenderLine(ctx: CanvasRenderingContext2D) {\r\n        for (let m = 0; m < this.tfLinearRegression.length; ++m) {\r\n            const curveX: number[] = [];\r\n            for (let x = -1; x <= 1; x += 0.08) {\r\n                curveX.push(x);\r\n            }\r\n\r\n            // ............................ predict\r\n            const ys = tf.tidy(() => {\r\n                return this.tfLinearRegression[m].predict(tf.tensor1d(curveX));\r\n            });\r\n\r\n            let curveY = ys.dataSync();\r\n            ys.dispose();\r\n            // ............................ end predict\r\n\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeStyle = this.col[m]; // '#00fff0';\r\n            ctx.beginPath();\r\n            ctx.moveTo(MathUtility.Remap(curveX[0], -1, 1, 0, this.width), MathUtility.Remap(curveY[0], -1, 1, this.height, 0));\r\n\r\n            for (let i = 1; i < curveX.length; ++i) {\r\n                ctx.lineTo(MathUtility.Remap(curveX[i], -1, 1, 0, this.width), MathUtility.Remap(curveY[i], -1, 1, this.height, 0));\r\n            }\r\n            ctx.stroke();\r\n        }\r\n    }\r\n}\r\nclass PolynomialRegression {\r\n    weights: tf.Variable[] = [];\r\n    bias: tf.Variable;\r\n\r\n    dim: number = 3;\r\n    leraningRate: number = 0.2;\r\n    optimizer: tf.AdamOptimizer;\r\n    constructor(dim: number = 0) {\r\n        this.dim = dim;\r\n        for (let i = 0; i < 5; ++i) {\r\n            const weight = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n            weight.print();\r\n            this.weights.push(weight);\r\n        }\r\n\r\n        this.bias = tf.variable(tf.scalar((Math.random() * 2) - 1));\r\n        this.optimizer = tf.train.adam(this.leraningRate);\r\n    }\r\n\r\n    public predict1d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.mul(this.weights[0])\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict2d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.square().mul(this.weights[1])\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict3d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(3)).mul(this.weights[2])\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict4d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(4)).mul(this.weights[3])\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict5d(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        // y = ax^3 + bx^2 + cx + d\r\n        const ys = x.pow(tf.scalar(5)).mul(this.weights[4])\r\n            .add(x.pow(tf.scalar(4)).mul(this.weights[3]))\r\n            .add(x.pow(tf.scalar(3)).mul(this.weights[2]))\r\n            .add(x.square().mul(this.weights[1]))\r\n            .add(x.mul(this.weights[0]))\r\n            .add(this.bias);\r\n        return ys;\r\n    }\r\n    public predict(x: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        if (this.dim === 5) { return this.predict5d(x); }\r\n        if (this.dim === 4) { return this.predict4d(x); }\r\n        if (this.dim === 3) { return this.predict3d(x); }\r\n        if (this.dim === 2) { return this.predict2d(x); }\r\n        if (this.dim === 1) { return this.predict1d(x); }\r\n        return this.predict1d(x);\r\n    }\r\n    public loss(pred: tf.Tensor<tf.Rank>, label: tf.Tensor<tf.Rank>): tf.Tensor<tf.Rank> {\r\n        return pred.sub(label).square().mean();\r\n    }\r\n    public train(xVal: number[], yVal: number[]) {\r\n\r\n        tf.tidy(() => {\r\n            const xs = tf.tensor1d(xVal);\r\n            const ys = tf.tensor1d(yVal);\r\n            this.optimizer.minimize((): any => this.loss(this.predict(xs), ys));\r\n        });\r\n        // console.log(tf.memory().numTensors);\r\n        // console.log('b:', this.bias, ', w:', this.weight);\r\n        // this.bias.print();\r\n        // this.weight.print();\r\n    }\r\n    // public train(x: tf.Tensor, y: tf.Tensor) {\r\n    //     tf.tidy((): any => {\r\n    //         return this.optimizer.minimize((): any => {\r\n    //             return this.loss(this.predict(x), y);\r\n    //         });\r\n    //     });\r\n    // }\r\n}","import { Canvas } from '../../Model/GraphicsCoreWrapper/CanvasWrapper/Canvas/Canvas';\r\nimport { ActiveCommandController } from './Core/ActiveCommandController';\r\n\r\nimport { DefinitionIndeCanvasCore } from './Core/DefinitionIndeCanvasCore';\r\nimport { JSLinearRegression01 } from './Definition/JSLinearRegression01';\r\nimport { JSLinearRegressionGradientDescent02 } from './Definition/JSLinearRegressionGradientDescent02';\r\n\r\nimport { TFPlayground01 } from './Definition/TFPlayground01';\r\nimport { TFLinearRegressionGradientDescent01 } from './Definition/TFLinearRegressionGradientDescent01';\r\nimport { TFPolynomialRegressionGradientDescent02 } from './Definition/TFPolynomialRegressionGradientDescent02';\r\nimport { TFPolynomialRegressionGradientDescent03Interaction } from './Definition/TFPolynomialRegressionGradientDescent03Interaction';\r\nimport { TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon } from './Definition/TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon';\r\nimport { TFModel01 } from './Definition/TFModel01';\r\nimport { TFModel02XOR } from './Definition/TFModel02XOR';\r\nimport { TFModel03Iris } from './Definition/TFModel03Iris';\r\nimport { TFModel03SmartDrawing } from './Definition/TFModel03SmartDrawing';\r\n\r\nimport { TFModel01HorsepowerAndMilesPerGallon } from './Definition/TFModel01HorsepowerAndMilesPerGallon';\r\nimport { TFPolynomialRegressionGradientDescent05Interaction } from './Definition/TFPolynomialRegressionGradientDescent05Interaction';\r\nimport { TFMnist } from './Definition/TFMnist';\r\n\r\nimport { Blank } from './Definition/Blank';\r\nimport { Implementation } from '..';\r\nexport class TFProject {\r\n    implementation: Implementation;\r\n    canvas: Canvas;\r\n    activeCommandController: ActiveCommandController;\r\n\r\n    definitions: DefinitionIndeCanvasCore[] = [];\r\n\r\n    constructor(implementation: Implementation) {\r\n        this.implementation = implementation;\r\n        this.canvas = implementation.app.model.graphicsCoreWrapper.canvasWrapper.canvas;\r\n\r\n        console.log('--')\r\n\r\n        this.activeCommandController = new ActiveCommandController(this);\r\n        this.Init();\r\n        this.InitDefinition();\r\n        this.InitDefault();\r\n        this.InitPullDown();\r\n    }\r\n    public Init() {\r\n        this.definitions = [];\r\n    }\r\n    get width() {\r\n        return this.implementation.app.model.graphicsCoreWrapper.canvasWrapper.canvas.canvas.width;\r\n    }\r\n    get height() {\r\n        return this.implementation.app.model.graphicsCoreWrapper.canvasWrapper.canvas.canvas.height;\r\n    }\r\n    InitDefinition() {\r\n        for (let d of this.definitions) { d.Init(this.implementation.app.model.graphicsCoreWrapper.canvasWrapper.canvas.ctx); }\r\n    }\r\n    Render(ctx: CanvasRenderingContext2D) {\r\n        // for (let d of this.definitions) {d.Render(ctx); }\r\n    }\r\n    MouseMove(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseMovePre(x, y); }\r\n    }\r\n    MouseLeftClick(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseLeftClickPre(x, y); }\r\n    }\r\n    MouseDown(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseDownPre(x, y); }\r\n    }\r\n    MouseUp(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseUpPre(x, y); }\r\n    }\r\n    MouseDrag(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseDragPre(x, y); }\r\n    }\r\n    MouseMiddleClick(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseMiddleClickPre(x, y); }\r\n    }\r\n    MouseRightClick(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseRightClickPre(x, y); }\r\n    }\r\n    MouseDoubleClick(x: number, y: number) {\r\n        for (let d of this.definitions) { d.MouseDoubleClickPre(x, y); }\r\n    }\r\n    MouseWheel(x: number, y: number, v: number) {\r\n        for (let d of this.definitions) { d.MouseWheelPre(x, y, v); }\r\n    }\r\n    Dispose() {\r\n        this.definitions = [];\r\n    }\r\n    InitDefault() {\r\n        // new TFModel03SmartDrawing(this);\r\n\r\n    }\r\n    LoadDefinition(v: string) {\r\n        console.log('project code', v);\r\n        if (v === 'blank') { new Blank(this); }\r\n        if (v === 'TFPlayground01') { new TFPlayground01(this); }\r\n\r\n        // ...............................................................................\r\n\r\n        if (v === 'TFModel02XOR') { new TFModel02XOR(this, 480, 500); }\r\n        if (v === 'TFModel03Iris') { new TFModel03Iris(this, 480, 500); }\r\n        if (v === 'TFModel03SmartDrawing') { new TFModel03SmartDrawing(this, 480, 500); }\r\n\r\n        if (v === 'TFModel01HorsepowerAndMilesPerGallon') { new TFModel01HorsepowerAndMilesPerGallon(this, 500, 500); }\r\n\r\n        // ...............................................................................\r\n        if (v === 'TFModel01') { new TFModel01(this, 500, 500); }\r\n\r\n        if (v === 'JSLinearRegression') { new JSLinearRegression01(this); }\r\n        if (v === 'JSLinearRegressionGD') { new JSLinearRegressionGradientDescent02(this); }\r\n        if (v === 'TFLinearRegressionGD') { new TFLinearRegressionGradientDescent01(this); }\r\n\r\n        if (v === 'TFPolynomialRegression GD') { new TFPolynomialRegressionGradientDescent02(this); }\r\n        if (v === 'TFPolyRegress Interaction') { new TFPolynomialRegressionGradientDescent03Interaction(this, 500, 500); }\r\n        if (v === 'TFPolyRegress Miles/Gallon') { new TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon(this, 500, 500); }\r\n\r\n        if (v === 'TF Regression') { new TFPolynomialRegressionGradientDescent05Interaction(this, 500, 500); }\r\n\r\n        if (v === 'TFMnist') { new TFMnist(this, 500, 500); }\r\n\r\n        console.log(v);\r\n        // ...............................................................................\r\n    }\r\n    public InitPullDown() {\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@TFModel01');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@TFModel02XOR');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@TFModel03Iris');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@--');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@TFModel03SmartDrawing');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('mlProject@TFModel01HorsepowerAndMilesPerGallon');\r\n\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TFPlayground01');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@JSLinearRegression');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@JSLinearRegressionGD');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TFLinearRegressionGD');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@--');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TFPolynomialRegression GD');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TFPolyRegress Interaction');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TFPolyRegress Miles/Gallon');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@--');\r\n        this.implementation.app.viewController.NUIWrapper.NUI.pullDownMenuWrapper.menus[1].AddApp('tfProject@TF Regression');\r\n    }\r\n}"],"names":["ActiveCommandController","constructor","scene","this","MouseEventController","e","CLICK_TYPE","MouseUpPre","MouseWheelPre","MouseDownPre","MouseDragPre","MouseMovePre","MouseDoubleClickPre","MouseRightClickPre","MouseMiddleClickPre","MouseLeftClickPre","MouseDown","x","y","MouseLeftClick","MouseMiddleClick","MouseRightClick","MouseUp","MouseDoubleClick","MouseMove","MouseDrag","MouseWheel","wheel","DefinitionIndeCanvasCore","width","height","indeCanvas","mOffX","mOffY","definitions","push","InitIndeCanvas","implementation","app","needUI","IndependentPanelCanvas","viewController","NUIWrapper","NUI","independentPanelWrapper","title","btnHam","isHidden","btnMini","RenderIndependentCanvas","ctx","canvas","Init","IsMouseInsidePanel","vec","HeadHeight","v","Blank","tfProject","super","p","console","log","tf","fillStyle","beginPath","arc","closePath","fill","JSLinearRegression01","tfProjct","xpos","ypos","xspeed","yspeed","xdirection","ydirection","rad","vs","a","bias","NVector3","MapX","MapY","MathUtility","rect","LinearRegression","RenderLine","i","length","Math","PI","y0","y1","lineWidth","strokeStyle","moveTo","lineTo","stroke","xSum","ySum","xMean","yMean","num","den","JSLinearRegressionGradientDescent02","weight","GradientDescent","error","TFLinearRegressionGradientDescent01","vsTemp","tfLinearRegression","t","TFLinearRegression","InitData","InitUI","div","document","createElement","style","position","left","color","textContent","append","divHost","getElementById","TFDataUtility","then","d","xMin","Number","MAX_SAFE_INTEGER","xMax","MIN_SAFE_INTEGER","yMin","yMax","map","data","pop","xx","yy","train","lineX","ys","predict","lineY","dataSync","dispose","leraningRate","optimizer","random","mul","add","loss","pred","label","sub","square","mean","xVal","yVal","xs","minimize","TFMnist","selVec","undefined","col","PolynomialRegression","zIndex","MnistData","getTrainData","marginTop","marginBottom","m","GridLine","xInterval","yInterval","x0","x1","font","textAlign","fillText","toFixed","curveX","curveY","dim","weights","print","predict1d","predict2d","predict3d","pow","predict4d","predict5d","IMAGE_H","IMAGE_W","IMAGE_SIZE","NUM_CLASSES","NUM_TRAIN_ELEMENTS","testLabels","trainLabels","testImages","trainImages","datasetImages","datasetLabels","async","img","Image","getContext","imgRequest","Promise","resolve","reject","crossOrigin","onload","naturalWidth","naturalHeight","datasetBytesBuffer","ArrayBuffer","chunkSize","NUM_DATASET_ELEMENTS","datasetBytesView","Float32Array","drawImage","imageData","getImageData","j","src","labelsRequest","fetch","labelsResponse","all","Uint8Array","arrayBuffer","slice","labels","getTestData","numExamples","TFModel01","tfModel","TFModel","model","hidden","inputShape","units","activation","output","compileArgs","compile","train1","train0","fit","epochs","response","history","xTrain","yTrain","config","shuffle","TFModel01HorsepowerAndMilesPerGallon","tensorData","convertToTensor","inputs","createModel","tfvis","name","metrics","batchSize","callbacks","trainModel","inputData","normalizationData","inputMax","inputMin","labelMin","labelMax","preds","reshape","unNormXs","unNormPreds","predictedPoints","Array","from","val","originalPoints","horsepower","mpg","values","series","xLabel","yLabel","testModel","useBias","inputTensor","labelTensor","max","min","TFModel02XOR","xPredict","fontSize","result","index","offset","out","trainLoop","setTimeout","TFModel03Iris","inputsTensor","labelsTensor","row","shape","summary","save","saveResults","validationData","TFModel03SmartDrawing","DataProcess","CreateModel01","CreateModel02","raw","OpenCSV","processData","labelsTemp","maxNum","allText","allTextLines","split","headers","lines","tarr","dataTemp","isNaN","text","catch","err","t0","t1","hidden01","Compile","hidden02","performance","now","TFPlayground01","TFUtility","TFPolynomialRegressionGradientDescent02","b","onclick","modelViewCoreWrapper","viewWrapper","Grid","numTensors","TFPolynomialRegressionGradientDescent03Interaction","TFPolynomialRegressionGradientDescent04TFHorsepowerAndMilesPerGallon","TFPolynomialRegressionGradientDescent05Interaction","TFProject","activeCommandController","graphicsCoreWrapper","canvasWrapper","InitDefinition","InitDefault","InitPullDown","Render","Dispose","LoadDefinition","pullDownMenuWrapper","menus","AddApp"],"sourceRoot":""}