"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[60944],{89739:(t,i,e)=>{e.d(i,{Du:()=>s});const s=(t,i,e)=>{const s=document.createElement("div");s.style.display="flex";const o=document.createElement("input");o.type="range",o.min="".concat(i),o.max="".concat(e);const n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",s.appendChild(o),s.appendChild(n),{div:s,slider:o,text:n}}},60944:(t,i,e)=>{e.r(i),e.d(i,{Solution:()=>m});const s=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]);class o{constructor(t){this.solution=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.commandEncoder=void 0,this.view=void 0,this.renderPassDescriptor=void 0,this.passEncoder=void 0,this.uniformBuffer=void 0,this.requestAni=void 0,this.loop=()=>{this.solution.scene.render(),this.requestAni=requestAnimationFrame(this.loop)},this.solution=t,this.canvas=t.canvas}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("No Adapter Found");const i=await t.requestDevice();this.ctx=this.canvas.getContext("webgpu");const e=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(t);window.devicePixelRatio;this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.ctx.configure({device:i,format:e,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=i,this.format=e,this.loop()}draw(t){void 0!==t&&(this.solution.camera.update(),this.commandEncoder=this.device.createCommandEncoder(),this.view=this.ctx.getCurrentTexture().createView(),this.renderPassDescriptor={colorAttachments:[{view:this.view,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},this.passEncoder=this.commandEncoder.beginRenderPass(this.renderPassDescriptor),this.passEncoder.setPipeline(t.pipeline),this.passEncoder.setBindGroup(0,t.uniformGroup),this.passEncoder.setVertexBuffer(0,t.vertexBuffer),this.passEncoder.draw(3),this.passEncoder.end(),this.device.queue.submit([this.commandEncoder.finish()]))}destroy(){this.device.destroy(),cancelAnimationFrame(this.requestAni)}}var n=e(88679);class r{constructor(){this.pipeline=void 0}}class a extends r{constructor(t){super(),this.scene=void 0,this.vertex=new Float32Array([0,.1,0,-.5,-.5,0,.5,-.5,0]),this.vertexCount=3,this.position=n.al(0,0,0),this.scene=t,this.position[0]=.5;const i=Math.random();this.vertex[1]+=i,this.initPipeline(this.scene.solution.renderer.device,this.scene.solution.renderer.format)}async initPipeline(t,i){const e=await t.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:t.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}"}),entryPoint:"main",targets:[{format:i}]},primitive:{topology:"triangle-list"}}),s=t.createBuffer({label:"GPUBuffer store vertex",size:this.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(s,0,this.vertex);const o=t.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(o,0,new Float32Array([1,0,0,1]));const n=t.createBindGroup({label:"Uniform Group with colorBuffer",layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:o}}]});this.pipeline={pipeline:e,vertexBuffer:s,colorBuffer:o,uniformGroup:n},this.scene.geometries.push(this)}}class h{constructor(t){this.solution=void 0,this.geometries=[],this.index=0,this.solution=t}init(){this.geometries.push(new a(this))}render(){for(this.index=0;this.index<this.geometries.length;++this.index)this.solution.renderer.draw(this.geometries[this.index].pipeline);console.log("rendering...",this.geometries.length)}}class d{constructor(t){this.solution=void 0,this.solution=t,this.appendEvent()}appendEvent(){this.solution.divHost.addEventListener("mousedown",(t=>{console.log(t),this.solution.controller.addTri()}))}}class c{constructor(t){this.solution=void 0,this.solution=t}addTri(){new a(this.solution.scene)}}var v=e(89739);class l{constructor(t){this.divHost=void 0,this.solution=void 0,this.divColor=void 0,this.divRange=void 0,this.solution=t,this.divHost=t.divHost,this.divColor=document.createElement("input"),this.divColor.type="color",this.divColor.defaultValue="#ff0000",this.divHost.appendChild(this.divColor),this.divRange=(0,v.Du)("size",0,100),this.divHost.appendChild(this.divRange.div),this.appendEvent()}appendEvent(){this.divColor.addEventListener("input",(t=>{const i=t.target.value;i.slice(1,3),i.slice(3,5),i.slice(5,7)})),this.divRange.slider.addEventListener("input",(t=>{const i=+t.target.value;console.log(i),s[0]=0,s[3]=-.01*i-.5,s[6]=.5+.01*i})),window.addEventListener("resize",(()=>{this.solution.canvas.width=this.solution.divHost.clientWidth,this.solution.canvas.height=this.solution.divHost.clientHeight}))}}var u=e(39880);const p=e(27089);class f{constructor(t){this.solution=void 0,this.canvas=void 0,this.modelMatrix=void 0,this.mvpMatrix=void 0,this.vMatrix=void 0,this.vpMatrix=void 0,this.rotation=n.al(0,0,0),this.translation=n.al(0,0,0),this.camera=void 0,this.vp=void 0,this.solution=t,this.canvas=t.canvas,this.modelMatrix=u.Ue(),this.mvpMatrix=u.Ue(),this.vMatrix=u.Ue(),this.vpMatrix=u.Ue(),this.vp=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0];const o=u.Ue(),n=u.Ue(),r=u.Ue();return u.G3(n,2*Math.PI/5,t,.1,100),u.zB(o,i,e,s),u.Jp(r,n,o),{viewMatrix:o,projectionMatrix:n,viewProjectionMatrix:r,cameraOption:{eye:i,center:e,zoomMax:100,zoomSpeed:2}}}(this.canvas.width/this.canvas.height),this.vpMatrix=this.vp.viewProjectionMatrix,this.camera=p(this.canvas,this.vp.cameraOption)}update(){const t=this.vp.projectionMatrix;this.vMatrix=this.camera.matrix,u.Jp(this.vpMatrix,t,this.vMatrix),function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const o=u.Ue(),n=u.Ue(),r=u.Ue(),a=u.Ue(),h=u.Ue();u.vc(a,i),u.aC(o,e[0]),u.gT(n,e[1]),u.QO(r,e[2]),u.xJ(h,s),u.Jp(t,o,h),u.Jp(t,n,t),u.Jp(t,r,t),u.Jp(t,a,t)}(this.modelMatrix,this.translation,this.rotation),u.Jp(this.mvpMatrix,this.vpMatrix,this.modelMatrix)}}class m{constructor(t){this.divHost=void 0,this.canvas=void 0,this.scene=void 0,this.renderer=void 0,this.camera=void 0,this.ui=void 0,this.eventListener=void 0,this.controller=void 0,this.init=async()=>{this.camera=new f(this),this.scene=new h(this),this.ui=new l(this),this.eventListener=new d(this),this.controller=new c(this),this.renderer=new o(this),await this.initRenderer(),this.scene.init(),this.initPost()},this.initRenderer=async()=>this.renderer.initWebGPU(),this.divHost=document.getElementById(t),this.divHost.style.position="relative",this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.canvas.style.background="rgba(0,0,0,0)",this.init()}initPost(){}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}},88679:(t,i,e)=>{e.d(i,{$X:()=>a,Fv:()=>d,IH:()=>r,Ue:()=>o,al:()=>n,kC:()=>c,od:()=>h});var s=e(50907);function o(){var t=new s.WT(3);return s.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t,i,e){var o=new s.WT(3);return o[0]=t,o[1]=i,o[2]=e,o}function r(t,i,e){return t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function a(t,i,e){return t[0]=i[0]-e[0],t[1]=i[1]-e[1],t[2]=i[2]-e[2],t}function h(t,i,e,s){return t[0]=i[0]+e[0]*s,t[1]=i[1]+e[1]*s,t[2]=i[2]+e[2]*s,t}function d(t,i){var e=i[0],s=i[1],o=i[2],n=e*e+s*s+o*o;return n>0&&(n=1/Math.sqrt(n)),t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function c(t,i,e){var s=i[0],o=i[1],n=i[2],r=e[0],a=e[1],h=e[2];return t[0]=o*h-n*a,t[1]=n*r-s*h,t[2]=s*a-o*r,t}!function(){var t=o()}()}}]);
//# sourceMappingURL=60944.c018cd1b.chunk.js.map