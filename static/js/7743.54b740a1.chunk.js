"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[7743],{87743:function(t,i,s){s.r(i),s.d(i,{Renderer:function(){return b},Solution:function(){return x}});var e,o=s(60136),h=s(29388),n=s(15671),r=s(43144),d=s(26943),l=function(){function t(i,s,e,o){(0,n.Z)(this,t),this.distort=void 0,this.width=20,this.height=20,this.id=void 0,this.x=void 0,this.y=void 0,this.dom=void 0,this.distort=i,this.id=s,this.x=e,this.y=o,this.dom=a(this.width,this.height,5),this.dom.style.pointerEvents="none",this.distort.hostDiv.appendChild(this.dom),this.move(e,o)}return(0,r.Z)(t,[{key:"translation",value:function(t,i){this.x=parseInt(this.dom.style.left)+t,this.y=parseInt(this.dom.style.top)+i,this.dom.style.left=this.x+"px",this.dom.style.top=this.y+"px"}},{key:"move",value:function(t,i){this.x=t-.5*this.width,this.y=i-.5*this.height,this.dom.style.left=this.x+"px",this.dom.style.top=this.y+"px"}},{key:"destroy",value:function(){this.dom.parentElement.removeChild(this.dom)}}]),t}(),a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#CBDAE2",n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x","1"),n.setAttribute("y","1"),n.setAttribute("width","".concat(t)),n.setAttribute("height","".concat(i)),n.setAttribute("stroke-width","".concat(o)),n.setAttribute("rx","".concat(s)),n.setAttribute("fill","".concat(e)),n.setAttribute("stroke","".concat(h));var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.appendChild(n),r.setAttribute("width","".concat(t+2*o)),r.setAttribute("height","".concat(i+2*o)),r.style.position="absolute",r},u=s(29439),c=function(){function t(){(0,n.Z)(this,t),this.distort=void 0}return(0,r.Z)(t,[{key:"distortPerspective",value:function(t){this.distort.Controllers[0].translation(t,0),this.distort.Controllers[1].translation(-t,0),this.distort.Controllers[2].translation(t,0),this.distort.Controllers[3].translation(-t,0)}},{key:"renderDistortion",value:function(t,i){}}]),t}(),v=function(t,i,s,e){return Math.sqrt((t-s)*(t-s)+(i-e)*(i-e))},m=function(t){(0,o.Z)(s,t);var i=(0,h.Z)(s);function s(t){var e;return(0,n.Z)(this,s),(e=i.call(this)).distort=t,e}return(0,r.Z)(s,[{key:"renderDistortion",value:function(t,i){for(var s=[],e=0,o=0,h=0;h<this.distort.Controllers.length;++h){var n=(this.distort.Controllers[h].x-this.distort.domRect.x)*this.distort.domRect.width/this.distort.hostImg.width,r=(this.distort.Controllers[h].y-this.distort.domRect.y)*this.distort.domRect.height/this.distort.hostImg.height;e+=n,o+=r,s.push([n,r])}s.push([e/this.distort.Controllers.length,o/this.distort.Controllers.length]);var d=this.distort.hosCanvas.width,l=this.distort.hosCanvas.height;f(t,i,[0,0],[d/2,l/2],[0,l],s[0],s[4],s[3]),f(t,i,[0,0],[d/2,l/2],[d,0],s[0],s[4],s[1]),f(t,i,[d,0],[d/2,l/2],[d,l],s[1],s[4],s[2]),f(t,i,[0,l],[d/2,l/2],[d,l],s[3],s[4],s[2])}}]),s}(c),f=function(t,i,s,e,o,h,n,r){var d=y(h,n,r,.3),l=(0,u.Z)(d,3),a=l[0],c=l[1],v=l[2],m=y(s,e,o,.3),f=(0,u.Z)(m,3);!function(t,i,s,e,o,h,n,r){var d=w(s[0],s[1],h[0],e[0],e[1],n[0],o[0],o[1],r[0]),l=w(s[0],s[1],h[1],e[0],e[1],n[1],o[0],o[1],r[1]);t.save(),t.setTransform(d[0],l[0],d[1],l[1],d[2],l[2]),t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(e[0],e[1]),t.lineTo(o[0],o[1]),t.closePath(),t.clip(),t.drawImage(i,0,0,i.width,i.height),t.restore()}(t,i,f[0],f[1],f[2],a,c,v)},g=function(t,i,s){var e=t[0]-i[0],o=t[1]-i[1];return[e*s+i[0],o*s+i[1]]},y=function(t,i,s,e){var o=p(t,i,s),h=(o[2]+e)/o[2];return[g(t,o,h),g(i,o,h),g(s,o,h)]},p=function(t,i,s){var e=v(i[0],i[1],s[0],s[1]),o=v(s[0],s[1],t[0],t[1]),h=v(t[0],t[1],i[0],i[1]),n=e+o+h,r=n/2,d=Math.sqrt(r*(r-e)*(r-o)*(r-h))/r,l=(e*t[0]+o*i[0]+h*s[0])/n,a=(e*t[1]+o*i[1]+h*s[1])/n;return new Float32Array([l,a,d])},w=function(t,i,s,e,o,h,n,r,d){var l=((h-d)*(i-o)-(s-h)*(o-r))/((e-n)*(i-o)-(t-e)*(o-r)),a=((h-d)*(t-e)-(s-h)*(e-n))/((o-r)*(t-e)-(i-o)*(e-n));return[l,a,s-t*l-i*a]},C=function(t){(0,o.Z)(s,t);var i=(0,h.Z)(s);function s(t){var e;return(0,n.Z)(this,s),(e=i.call(this)).distort=t,e}return(0,r.Z)(s,[{key:"renderDistortion",value:function(t,i){for(var s=[],e=0,o=0,h=0;h<this.distort.Controllers.length;++h){var n=(this.distort.Controllers[h].x-this.distort.domRect.x)*this.distort.domRect.width/this.distort.hostImg.width,r=(this.distort.Controllers[h].y-this.distort.domRect.y)*this.distort.domRect.height/this.distort.hostImg.height;e+=n,o+=r,s.push([n,r])}s.push([e/this.distort.Controllers.length,o/this.distort.Controllers.length]);this.distort.hosCanvas.width,this.distort.hosCanvas.height}}]),s}(c);!function(t){t.Projection="projection",t.Subdivision="subdivision"}(e||(e={}));var k=function(){function t(i,s,o){var h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Subdivision;(0,n.Z)(this,t),this.projection=void 0,this.Controllers=[],this.hostDiv=void 0,this.hosCanvas=void 0,this.hostImg=void 0,this.domRect=void 0,this.id=-1,this.DISTORTION_TYPE=void 0,this.mPre=[0,0],this.DISTORTION_TYPE=h,this.hostDiv=i,this.hosCanvas=o,this.hostImg=s,this.DISTORTION_TYPE===e.Projection?this.projection=new C(this):this.projection=new m(this),this.init()}return(0,r.Z)(t,[{key:"reset",value:function(){this.destroy(),this.init()}},{key:"init",value:function(){var t=this.hostDiv.getBoundingClientRect();this.domRect=t,this.Controllers=[new l(this,0,t.x,t.y),new l(this,1,t.x+t.width,t.y),new l(this,2,t.x+t.width,t.y+t.height),new l(this,3,t.x,t.y+t.height)]}},{key:"distortPerspective",value:function(t){this.projection.distortPerspective(t),this.renderForce()}},{key:"updateCaptured",value:function(t,i){this.id=-1;for(var s=0;s<this.Controllers.length;++s)v(t+this.domRect.x,i+this.domRect.y,this.Controllers[s].x,this.Controllers[s].y)<50&&(this.id=this.Controllers[s].id)}},{key:"mouseDown",value:function(t,i){this.updateCaptured(t,i),this.mPre=[t,i]}},{key:"mouseUp",value:function(t,i){this.id=-1}},{key:"mouseMove",value:function(t,i){if(this.id>-1){var s=t-this.mPre[0],e=i-this.mPre[1];this.Controllers[this.id].translation(s,e),this.mPre=[t,i]}}},{key:"render",value:function(t){this.projection.renderDistortion(t,this.hostImg)}},{key:"renderForce",value:function(){}},{key:"destroy",value:function(){this.Controllers.forEach((function(t){t.destroy()}))}}]),t}(),x=function(){function t(i){(0,n.Z)(this,t),this.divHost=void 0,this.renderer=void 0,this.divHost=i,this.divHost.style.display="flex",this.divHost.style.alignItems="center";var s=document.createElement("div");s.style.marginLeft="auto",s.style.marginRight="auto",s.style.backgroundColor="#555",s.style.width="1200px",s.style.height="1000px",this.divHost.appendChild(s),this.renderer=new b(s)}return(0,r.Z)(t,[{key:"destroy",value:function(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}]),t}(),b=function(t){(0,o.Z)(s,t);var i=(0,h.Z)(s);function s(t){var e;return(0,n.Z)(this,s),(e=i.call(this,t)).img=void 0,e.rotation=0,e.x=void 0,e.y=void 0,e.width=void 0,e.height=void 0,e.m=[0,0],e.distort=void 0,(0,d.t4)("https://raw.githubusercontent.com/NamjuLee/data/master/img/MITBuilding7_small.jpg").then((function(i){i.onload=function(){e.img=i,e.x=100,e.y=100,e.width=i.width,e.height=i.height,e.distort=new k(t,i,e.canvas)}})),e.start(),e}return(0,r.Z)(s,[{key:"render",value:function(t){this.ctx.save(),this.ctx.translate(.5*this.canvas.width,.5*this.canvas.height),this.ctx.rotate(this.rotation),this.img&&this.ctx.drawImage(this.img,.5*-this.img.width,.5*-this.img.height),this.ctx.restore(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.closePath(),t.lineWidth=5,t.stroke(),t.beginPath(),t.arc(this.m[0],this.m[1],5,0,2*Math.PI),t.closePath(),t.lineWidth=5,t.stroke(),this.distort&&this.distort.render(t)}},{key:"mouseDown",value:function(t,i){this.distort.mouseDown(t,i)}},{key:"mouseUp",value:function(t,i){this.distort.mouseUp(t,i)}},{key:"mouseDrag",value:function(t,i){}},{key:"mouseClick",value:function(t,i){}},{key:"mouseMove",value:function(t,i){this.m=[t,i],this.distort.mouseMove(t,i)}},{key:"keyDown",value:function(t){}}]),s}(d.bb)}}]);
//# sourceMappingURL=7743.54b740a1.chunk.js.map