"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[4370],{89739:function(e,t,i){i.d(t,{Du:function(){return s}});const s=(e,t,i)=>{const s=document.createElement("div");s.style.display="flex";const n=document.createElement("input");n.type="range",n.min="".concat(t),n.max="".concat(i);const o=document.createElement("div");return o.textContent=e,o.style.color="#aaa",s.appendChild(n),s.appendChild(o),{div:s,slider:n,text:o}}},57957:function(e,t,i){i.r(t),i.d(t,{Solution:function(){return u}});const s=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]);class n{constructor(e){this.solution=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.commandEncoder=void 0,this.view=void 0,this.renderPassDescriptor=void 0,this.passEncoder=void 0,this.requestAni=void 0,this.loop=()=>{this.solution.scene.render(),this.requestAni=requestAnimationFrame(this.loop)},this.solution=e,this.canvas=e.canvas}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!e)throw new Error("No Adapter Found");const t=await e.requestDevice();this.ctx=this.canvas.getContext("webgpu");const i=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(e);window.devicePixelRatio;this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.ctx.configure({device:t,format:i,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=t,this.format=i,this.loop()}draw(e){void 0!==e&&(this.commandEncoder=this.device.createCommandEncoder(),this.view=this.ctx.getCurrentTexture().createView(),this.renderPassDescriptor={colorAttachments:[{view:this.view,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},this.passEncoder=this.commandEncoder.beginRenderPass(this.renderPassDescriptor),this.passEncoder.setPipeline(e.pipeline),this.passEncoder.setBindGroup(0,e.uniformGroup),this.passEncoder.setVertexBuffer(0,e.vertexBuffer),this.passEncoder.draw(3),this.passEncoder.end(),this.device.queue.submit([this.commandEncoder.finish()]))}destroy(){this.device.destroy(),cancelAnimationFrame(this.requestAni)}}class o{constructor(){this.pipeline=void 0}}class r extends o{constructor(e){super(),this.scene=void 0,this.vertex=new Float32Array([0,.1,0,-.5,-.5,0,.5,-.5,0]),this.vertexCount=3,this.scene=e;const t=Math.random();this.vertex[1]+=t,this.initPipeline(this.scene.solution.renderer.device,this.scene.solution.renderer.format)}async initPipeline(e,t){const i=await e.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:e.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:e.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}"}),entryPoint:"main",targets:[{format:t}]},primitive:{topology:"triangle-list"}}),s=e.createBuffer({label:"GPUBuffer store vertex",size:this.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(s,0,this.vertex);const n=e.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(n,0,new Float32Array([1,0,0,1]));const o=e.createBindGroup({label:"Uniform Group with colorBuffer",layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}}]});this.pipeline={pipeline:i,vertexBuffer:s,colorBuffer:n,uniformGroup:o},this.scene.geometries.push(this)}}class a{constructor(e){this.solution=void 0,this.geometries=[],this.index=0,this.solution=e}init(){this.geometries.push(new r(this))}render(){for(this.index=0;this.index<this.geometries.length;++this.index)this.solution.renderer.draw(this.geometries[this.index].pipeline);console.log("rendering...",this.geometries.length)}}class d{constructor(e){this.solution=void 0,this.solution=e,this.appendEvent()}appendEvent(){this.solution.divHost.addEventListener("mousedown",(e=>{console.log(e),this.solution.controller.addTri()}))}}class h{constructor(e){this.solution=void 0,this.solution=e}addTri(){new r(this.solution.scene)}}var c=i(89739);class l{constructor(e){this.divHost=void 0,this.solution=void 0,this.divColor=void 0,this.divRange=void 0,this.solution=e,this.divHost=e.divHost,this.divColor=document.createElement("input"),this.divColor.type="color",this.divColor.defaultValue="#ff0000",this.divHost.appendChild(this.divColor),this.divRange=(0,c.Du)("size",0,100),this.divHost.appendChild(this.divRange.div),this.appendEvent()}appendEvent(){this.divColor.addEventListener("input",(e=>{const t=e.target.value;t.slice(1,3),t.slice(3,5),t.slice(5,7)})),this.divRange.slider.addEventListener("input",(e=>{const t=+e.target.value;console.log(t),s[0]=0,s[3]=-.01*t-.5,s[6]=.5+.01*t})),window.addEventListener("resize",(()=>{this.solution.canvas.width=this.solution.divHost.clientWidth,this.solution.canvas.height=this.solution.divHost.clientHeight}))}}class u{constructor(e){this.divHost=void 0,this.canvas=void 0,this.scene=void 0,this.renderer=void 0,this.ui=void 0,this.eventListener=void 0,this.controller=void 0,this.init=async()=>{this.scene=new a(this),this.ui=new l(this),this.eventListener=new d(this),this.controller=new h(this),this.renderer=new n(this),await this.initRenderer(),this.scene.init(),this.initPost()},this.initRenderer=async()=>this.renderer.initWebGPU(),this.divHost=document.getElementById(e),this.divHost.style.position="relative",this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.canvas.style.background="rgba(0,0,0,0)",this.init()}initPost(){}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}}}]);
//# sourceMappingURL=4370.6f62197f.chunk.js.map