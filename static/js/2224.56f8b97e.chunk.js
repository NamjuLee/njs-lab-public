"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[2224],{15909:function(e,t,r){r.d(t,{D:function(){return n}});var a=r(80292);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{let{target:t,propName:r,newOrigin:n}=e;(0,a.l)(t)&&n&&t.originOf(r)!==n&&t.updateOrigin(r,n)}))}},80292:function(e,t,r){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,{l:function(){return a}})},2224:function(e,t,r){r.r(t),r.d(t,{save:function(){return D},saveAll:function(){return J},saveAs:function(){return T}});var a=r(63780),n=r(10064),o=r(32718),l=r(92026),i=r(66978),s=r(15909),u=r(64326),c=r(25899),d=r(74368),f=r(37933),y=r(70032),p=r(98995),m=r(32698),v=r(73117);const w=o.Z.getLogger("esri.layers.FeatureLayer"),h="Feature Service";function b(e,t){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(t)}function S(e,t){if(t.type!==h)throw new n.Z("feature-layer:portal-item-wrong-type",b(e,'should have portal item of type "'.concat(h,'"')))}async function g(e){if(await e.load(),(0,f.rQ)(e))throw new n.Z("feature-layer:save",b(e,"using an in-memory source cannot be saved to a portal item"))}async function I(e,t,r){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return function(e,t){var r;let a=(null!==(r=e.messages)&&void 0!==r?r:[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:r,details:a}=e;return new n.Z(t,r,a)}));if(null!==t&&void 0!==t&&t.ignoreUnsupported&&(a=a.filter((e=>{let{name:t}=e;return"layer:unsupported"!==t&&"symbol:unsupported"!==t&&"symbol-layer:unsupported"!==t&&"property:unsupported"!==t&&"url:unsupported"!==t}))),a.length>0)throw new n.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}(t,r),a}function A(e){const{layer:t,layerJSON:r}=e;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function O(e){(0,v.qj)(e,v.Kz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function E(e,t){var r;return/\/\d+\/?$/.test(null!==(r=e.url)&&void 0!==r?r:"")?A(t[0]):async function(e,t){const{layer:{url:r,customParameters:a,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await async function(e,t,r){var a,n;e||(e={}),(a=e).layers||(a.layers=[]),(n=e).tables||(n.tables=[]);const{url:o,customParameters:s,apiKey:c}=t,{serviceJSON:f,layersJSON:y}=await(0,d.V)(o,{customParameters:s,apiKey:c}),p=K(e.layers,f.layers,r),m=K(e.tables,f.tables,r);e.layers=p.itemResources,e.tables=m.itemResources;const v=[...p.added,...m.added],w=y?[...y.layers,...y.tables]:[];return await async function(e,t,r,a){const n=t.map((e=>{let{id:t}=e;return new u.default({url:r,layerId:t,sourceJSON:a.find((e=>{let{id:r}=e;return r===t}))})}));await(0,i.as)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:r,loaded:a,defaultPopupTemplate:n}=t;a&&!(0,l.Wi)(n)&&N(t,{id:r,popupInfo:n.toJSON()},e)}))}(e,v,o,w),e}(o,{url:null!==r&&void 0!==r?r:"",customParameters:a,apiKey:n},t.map((e=>e.layer.layerId))));for(const l of t)N(l.layer,l.layerJSON,o);return o}(e,t)}function K(e,t,r){const n=(0,a.e5)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const o=n.added.map((e=>{let{id:t}=e;return{id:t}}));return o.forEach((t=>{let{id:r}=t;e.push({id:r})})),{itemResources:e,added:o.filter((e=>{let{id:t}=e;return!r.includes(t)}))}}function N(e,t,r){e.isTable?P(r.tables,t):P(r.layers,t)}function P(e,t){if(!e)return;const r=e.findIndex((e=>{let{id:r}=e;return r===t.id}));-1===r?e.push(t):e[r]=t}function L(e){const{portalItem:t}=e;return(0,f.y2)(e)&&!e.dynamicDataSource&&!(null===t||void 0===t||!t.loaded)&&t.type===h}const D=(0,i.Ds)((async function(e,t){await g(e),function(e){const t=e.portalItem;if(!t)throw w.error("save: requires the portalItem property to be set"),new n.Z("feature-layer:portal-item-not-set",b(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.Z("feature-layer:portal-item-not-loaded",b(e,"cannot be saved to a portal item that does not exist or is inaccessible"));S(e,t)}(e);const r=e.portalItem,a=(0,m.Y)(r),o=await I(e,a,t),l=await E(r,[{layer:e,layerJSON:o}]);return O(r),await r.update({data:l}),(0,s.D)(a),r}));const J=(0,i.Ds)((async(e,t)=>{await async function(e){if(null===e||void 0===e||!e.length)throw new n.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const a of e)if(!L(a))throw new n.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(b(a,"does not conform")),{layer:a});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const r=e.map((e=>e.layerId));if(new Set(r).size!==r.length)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const r=e[0].portalItem,a=(0,m.Y)(r),o=await Promise.all(e.map((e=>I(e,a,t)))),l=await E(r,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return O(r),await r.update({data:l}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,s.D)(a),r.clone()})),T=(0,i.Ds)((async function(e,t,r){await g(e);const a=function(e,t){var r,a,n,o;let l=p.default.from(t);return l.id&&(l=l.clone(),l.id=null),null!==(r=(n=l).type)&&void 0!==r||(n.type=h),null!==(a=(o=l).portal)&&void 0!==a||(o.portal=y.Z.getDefault()),S(e,l),l}(e,t),n=(0,m.Y)(a),o=A({layer:e,layerJSON:await I(e,n,r)});return await async function(e,t){const{url:r,layerId:a,title:n,fullExtent:o,isTable:i}=e,s=(0,c.Qc)(r),u=(0,l.pC)(s)&&"FeatureServer"===s.serverType;t.url=u?r:"".concat(r,"/").concat(a),t.title||(t.title=n),t.extent=null,!i&&(0,l.pC)(o)&&(t.extent=await(0,v.$o)(o)),(0,v.ck)(t,v.Kz.METADATA),(0,v.ck)(t,v.Kz.MULTI_LAYER),(0,v.qj)(t,v.Kz.SINGLE_LAYER),i&&(0,v.qj)(t,v.Kz.TABLE),O(t)}(e,a),await async function(e,t,r){var a;const n=e.portal;await(null===n||void 0===n?void 0:n._signIn()),await(null===n||void 0===n||null===(a=n.user)||void 0===a?void 0:a.addItem({item:e,data:t,folder:null===r||void 0===r?void 0:r.folder}))}(a,o,r),e.portalItem=a,(0,s.D)(n),a}))},74368:function(e,t,r){r.d(t,{C:function(){return l},V:function(){return n}});var a=r(76200);async function n(e,t){var r,a,n;let i=await l(e,t);i=i||{},i.layers=(null===(r=i.layers)||void 0===r?void 0:r.filter(o))||[];const s={serviceJSON:i};if((null!==(a=i.currentVersion)&&void 0!==a?a:0)<10.5)return s;const u=await l(e+"/layers",t);return s.layersJSON={layers:(null===u||void 0===u||null===(n=u.layers)||void 0===n?void 0:n.filter(o))||[],tables:(null===u||void 0===u?void 0:u.tables)||[]},s}function o(e){return!e.type||"Feature Layer"===e.type}async function l(e,t){return(await(0,a.default)(e,{responseType:"json",query:{f:"json",...null===t||void 0===t?void 0:t.customParameters,token:null===t||void 0===t?void 0:t.apiKey}})).data}},32698:function(e,t,r){r.d(t,{Y:function(){return l},h:function(){return o}});var a=r(35995),n=r(70032);function o(e){return{origin:"portal-item",url:(0,a.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function l(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,a.mN)(e.itemUrl):null,portal:e.portal||n.Z.getDefault(),portalItem:e}}},73117:function(e,t,r){r.d(t,{$o:function(){return u},Kz:function(){return c},_$:function(){return i},ck:function(){return s},qj:function(){return l}});var a=r(52587),n=r(78952),o=r(81753);function l(e,t){if(!i(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function i(e,t){var r;return!(null===(r=e.typeKeywords)||void 0===r||!r.includes(t))}function s(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}async function u(e){const t=e.clone().normalize();let r;if(t.length>1)for(const a of t)r?a.width>r.width&&(r=a):r=a;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,o.Sx)(e);const r=n.Z.WGS84;return await(0,a.iQ)(t,r),(0,a.iV)(e,r)}(r)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}}]);
//# sourceMappingURL=2224.56f8b97e.chunk.js.map