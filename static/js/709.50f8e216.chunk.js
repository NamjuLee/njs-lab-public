"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[709],{10709:function(t,i,e){e.r(i),e.d(i,{BindingNNA:function(){return Pt}});var n=e(74165),s=e(15861),o=e(15671),a=e(43144),h=function(){function t(i){(0,o.Z)(this,t),this.window=void 0,this.window=i}return(0,a.Z)(t,[{key:"addIconTopPanel",value:function(t){var i=document.createElement("button");i.style.width="".concat(t.width,"px"),i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.textContent=t.text,i.onclick=function(){return t.callBack()},this.window.builder.divFulldownArea.appendChild(i)}},{key:"addToggleTopPanel",value:function(t){var i=document.createElement("button");i.style.width="".concat(t.width,"px"),i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.textContent=t.text,i.onclick=function(){return t.callBack()},this.window.builder.divFulldownArea.appendChild(i)}},{key:"addIconLeftPanel",value:function(t){var i=document.createElement("button");i.style.height="50px",i.style.width="50px",i.style.zIndex="13;",i.style.position="relative",i.style.border="none",i.style.color="#000000",i.style.background="#fafafa",i.textContent=t.text,i.onclick=function(){return t.callBack()},i.onmouseenter=function(){i.style.color="#ffffff",i.style.background="#888888"},i.onmouseleave=function(){i.style.color="#000000",i.style.background="#fafafa"},this.window.builder.divLeftUI.appendChild(i)}},{key:"addIconLeft",value:function(){}}]),t}(),r=function(){function t(i){(0,o.Z)(this,t),this.window=void 0,this.divMain=void 0,this.divMainBody=void 0,this.divTopArea=void 0,this.divFulldownArea=void 0,this.divLeftUI=void 0,this.divBottomArea=void 0,this.divForGraphicContext=void 0,this.colorTopMenu="#dfdfdf",this.colorBGmenu="#f3f3f3",this.window=i}return(0,a.Z)(t,[{key:"initPanel",value:function(t){var i=this;this.initDivMain(),this.initDivTopArea(),this.initDivFulldownArea();var e=document.createElement("div");e.style.float="left",e.style.height="100%",e.style.padding="10px",e.style.background="#ff0000",this.divTopArea.appendChild(e);var n=document.createElement("div");n.style.float="left",n.style.padding="10px",n.textContent=t,this.divTopArea.appendChild(n),this.initDivContextArea(),this.initDivLeftArea(),this.divForGraphicContext=document.createElement("div"),this.divForGraphicContext.style.height="100%",this.divForGraphicContext.id="divForGraphicContext",this.divMainBody.appendChild(this.divForGraphicContext);var s=document.createElement("button");s.style.top="0px",s.style.left="0px",s.style.height="20px",s.style.width="20px",s.style.zIndex="13",s.style.float="right",s.style.padding="0px",s.style.zIndex="20",s.textContent="X",s.onclick=function(){i.window.remove()},this.divTopArea.appendChild(s),this.initBottomArea(this.divMain);var o=document.createElement("div");o.style.height="100%",o.style.width="100px",o.style.float="left",this.divBottomArea.appendChild(o);var a=document.createElement("div");a.style.height="100%",a.style.width="80%",a.style.float="left",this.divBottomArea.appendChild(a)}},{key:"initDivTopArea",value:function(){var t=this,i=document.createElement("div");i.style.width="100%",i.style.height="40px",i.style.background=this.colorTopMenu,i.style.zIndex="11";var e=!1,n=[0,0];i.ondrag=function(t){},i.onmouseenter=function(t){},i.ondrag=function(t){},i.onmousemove=function(i){if(e){var s=i.clientX-n[0],o=i.clientY-n[1];t.divMain.style.top=parseFloat(t.divMain.style.top)+o+"px",t.divMain.style.left=parseFloat(t.divMain.style.left)+s+"px",n[0]=i.clientX,n[1]=i.clientY}},i.onmousedown=function(i){n[0]=i.clientX,n[1]=i.clientY,e=!0,t.window.updateZindex()},i.onmouseup=function(t){e=!1},i.onmouseout=function(i){if(e){var s=i.clientX-n[0],o=i.clientY-n[1];t.divMain.style.top=parseFloat(t.divMain.style.top)+o+"px",t.divMain.style.left=parseFloat(t.divMain.style.left)+s+"px",n[0]=i.clientX,n[1]=i.clientY}},this.divTopArea=i,this.divMain.appendChild(i)}},{key:"appendCloseTop",value:function(){}},{key:"initBottomArea",value:function(t){var i=this,e=document.createElement("div");e.style.top=parseFloat(t.style.height)-parseFloat(t.style.top)-10+"px",e.style.width="100%",e.style.height="40px",e.style.background=this.colorBGmenu,e.style.zIndex="11";var n=!1,s=[0,0];e.ondrag=function(t){},e.onmouseenter=function(t){},e.ondrag=function(t){},e.onmousemove=function(i){if(n){var o=i.clientX-s[0],a=i.clientY-s[1];t.style.width=parseFloat(t.style.width)+o+"px",t.style.height=parseFloat(t.style.height)+a+"px",e.style.top=parseFloat(e.style.top)+a+"px",e.style.left=parseFloat(e.style.left)+o+"px",s[0]=i.clientX,s[1]=i.clientY}},e.onmousedown=function(t){s[0]=t.clientX,s[1]=t.clientY,n=!0},e.onmouseup=function(t){n=!1},e.onmouseout=function(o){if(i.window.updateResize=setTimeout((function(){if(n){var i=o.clientX-s[0],a=o.clientY-s[1];t.style.width=parseFloat(t.style.width)+i+"px",t.style.height=parseFloat(t.style.height)+a+"px",e.style.top=parseFloat(e.style.top)+a+"px",e.style.left=parseFloat(e.style.left)+i+"px",s[0]=o.clientX,s[1]=o.clientY}}),300),n){var a=o.clientX-s[0],h=o.clientY-s[1];t.style.width=parseFloat(t.style.width)+a+"px",t.style.height=parseFloat(t.style.height)+h+"px",e.style.top=parseFloat(e.style.top)+h+"px",e.style.left=parseFloat(e.style.left)+a+"px",s[0]=o.clientX,s[1]=o.clientY}},this.divBottomArea=e,t.appendChild(e)}},{key:"initDivMain",value:function(){this.divMain=document.createElement("div"),this.divMain.style.width="".concat(this.window.width,"px"),this.divMain.style.height="".concat(this.window.height,"px"),this.divMain.style.position="absolute",this.divMain.style.zIndex="10",this.divMain.id="NWindow",this.divMain.style.top="100px",this.divMain.style.left="200px",this.window.divHost.appendChild(this.divMain)}},{key:"initDivFulldownArea",value:function(){this.divFulldownArea=document.createElement("div"),this.divFulldownArea.style.height="50px",this.divFulldownArea.style.width="100%",this.divFulldownArea.style.background=this.colorBGmenu,this.divMain.appendChild(this.divFulldownArea)}},{key:"initDivContextArea",value:function(){this.divMainBody=document.createElement("div"),this.divMainBody.style.height="100%",this.divMainBody.style.width="100%",this.divMainBody.id="divContext",this.divMainBody=this.divMainBody,this.divMain.appendChild(this.divMainBody)}},{key:"initDivLeftArea",value:function(){this.divLeftUI=document.createElement("div"),this.divLeftUI.style.height="100%",this.divLeftUI.style.width="100px",this.divLeftUI.style.background=this.colorBGmenu,this.divLeftUI.style.float="left",this.divMainBody.appendChild(this.divLeftUI)}}]),t}(),l=function(){function t(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NJS Sandbox",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;(0,o.Z)(this,t),this.divHost=void 0,this.updateResize=void 0,this.width=600,this.height=400,this.controller=void 0,this.builder=void 0,this.divHost=i,this.width=n,this.height=s,this.controller=new h(this),this.builder=new r(this),this.builder.initPanel(e)}return(0,a.Z)(t,[{key:"addIconTopPanel",value:function(t){this.controller.addIconTopPanel(t)}},{key:"addToggleTopPanel",value:function(t){this.controller.addToggleTopPanel(t)}},{key:"addIconLeftPanel",value:function(t){this.controller.addIconLeftPanel(t)}},{key:"addIconLeft",value:function(){this.controller.addIconLeft()}},{key:"getContext",value:function(){return this.builder.divForGraphicContext}},{key:"remove",value:function(){this.divHost.removeChild(this.builder.divMain)}},{key:"updateZindex",value:function(){}}]),t}(),d=e(92621),c=e(14404),u=e(78952),v=function(){function t(i){(0,o.Z)(this,t),this.app=void 0,this.app=i,this.OpenGeoJsonEx01("")}return(0,a.Z)(t,[{key:"OpenGeoJsonEx01",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(i){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(i){return t.apply(this,arguments)}}()}]),t}(),p=function(){function t(i){(0,o.Z)(this,t),this.app=void 0,this.app=i,this.AppendMapViewEvent()}return(0,a.Z)(t,[{key:"AppendMapViewEvent",value:function(){var t=this;this.app.mapView.watch("extent",(function(){})),this.app.mapView.watch("stationary",(function(i){t.app.renderer.isPanning=!i})),this.app.mapView.watch("ready",(function(t){})),this.app.mapView.on("resize",(function(i){t.app.canvas.ResizeCanvas(i.width,i.height)}))}}]),t}(),g=function(){function t(i){var e=this;(0,o.Z)(this,t),this.app=void 0,this.ToMap=function(t,i){var n=e.app.mapView.toMap({x:t,y:i}).clone();return[n.longitude,n.latitude,n.x,n.y]},this.ToScreen=function(t,i){e.app.mPoint.longitude=t,e.app.mPoint.latitude=i,e.app.mPoint.spatialReference=e.app.mapView.spatialReference;var n=e.app.mapView.toScreen(e.app.mPoint);return[n.x,n.y]},this.app=i}return(0,a.Z)(t,[{key:"ToScreenFromProjected",value:function(t,i){this.app.mPoint.x=t,this.app.mPoint.y=i,this.app.mPoint.spatialReference=this.app.mapView.spatialReference;var e=this.app.mapView.toScreen(this.app.mPoint);return[e.x,e.y]}},{key:"ToScreenFromGeoPos",value:function(t,i){var e=this.app.mapView.toMap({x:t,y:i}).clone();e.longitude=t,e.latitude=i;var n=this.app.mapView.toScreen(e);return[n.x,n.y]}},{key:"ToScreenFromProjectedPos",value:function(t,i){var e=this.app.mapView.toMap({x:t,y:i}).clone(),n=this.app.mapView.toScreen(e);return[n.x,n.y]}},{key:"ToScreenOld",value:function(t,i){var e=this.app.mapView.toMap({x:t,y:i}).clone();e.spatialReference.wkid=102100,e.longitude=t,e.latitude=i;var n=this.app.mapView.toScreen(e);return[n.x,n.y]}}]),t}(),f=function(){function t(i){(0,o.Z)(this,t),this.t=void 0,this.frameRate=void 0,this.canvas=void 0,this.hostDiv=void 0,this.id=void 0,this.ctx=void 0,this.xOff=void 0,this.yOff=void 0,this.xOffCurrent=void 0,this.yOffCurrent=void 0,this.xOffPre=void 0,this.yOffPre=void 0,this.zoomFactor=void 0,this.zoomFactorPre=void 0,this.zoomFactorCurrent=void 0,this.div3d=void 0,this.smoothingEnabled=!0,this.dropRate=void 0,this.isRenderSkip=void 0,this.isLoop=void 0,this.timeLastRender=void 0,this.delta=void 0,this.now=void 0,this.then=0,this.interval=0,this.last=0,this.frameVisTimer=void 0,this.theDate=void 0,this.asyncSafeGuard=0,this.App=void 0,this.App=i,this.canvas=document.createElement("canvas"),this.canvas.id="App",this.canvas.style.zIndex="1",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),i.divHost.appendChild(this.canvas),this.ctx.globalCompositeOperation="source-over",this.canvas.width=i.divHost.clientWidth,this.canvas.height=i.divHost.clientHeight,this.Start(this.ctx)}return(0,a.Z)(t,[{key:"Start",value:function(t){this.App.renderer.Init(t),this.Draw(this.ctx)}},{key:"Draw",value:function(t){var i=this;requestAnimationFrame((function(){i.Draw(t)})),this.Clear(t),this.Render(t)}},{key:"Clear",value:function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"Render",value:function(t){this.App.renderer.Render(t)}},{key:"ResizeCanvas",value:function(t,i){this.ctx.canvas.width=t,this.ctx.canvas.height=i}}]),t}(),y=e(26004),m=function(){function t(i){(0,o.Z)(this,t),this.app=void 0,this.app=i,t.mouseEventDataPre=new y.$E,this.InitArcGISMapEventV4x()}return(0,a.Z)(t,[{key:"InitArcGISMapEventV4x",value:function(){var t=this;this.app.mapView.on("click",(function(i){var e=t.CommonEventBuilderArcGIS(i);e.type=y.zK.LEFT,2==i.native.button?e.type=y.zK.RIGHT:1==i.native.button&&(e.type=y.zK.MIDDLE),t.app.MouseEvent(e)})),this.app.mapView.on("pointer-down",(function(i){var e=t.CommonEventBuilderArcGIS(i);e.type=y.zK.DOWN,t.app.MouseEvent(e)})),this.app.mapView.on("pointer-up",(function(i){var e=t.CommonEventBuilderArcGIS(i);e.type=y.zK.UP,t.app.MouseEvent(e)})),this.app.mapView.on("pointer-move",(function(i){var e=t.CommonEventBuilderArcGIS(i);e.type=y.zK.MOVE,t.app.MouseEvent(e)})),this.app.mapView.on("drag",(function(i){var e=t.CommonEventBuilderArcGIS(i);e.type=y.zK.DRAG,t.app.MouseEvent(e),t.app.ableToPan||i.stopPropagation()})),this.app.mapView.on("key-down",(function(i){"Arrow"!==i.key.slice(0,5)&&"-"!==i.key&&"="!==i.key&&"d"!==i.key||i.stopPropagation(),t.KeyDownJSAPI4X(i.native)})),this.app.mapView.on("key-up",(function(i){"Arrow"!==i.key.slice(0,5)&&"-"!==i.key&&"="!==i.key&&"d"!==i.key||i.stopPropagation(),t.KeyDownJSAPI4X(i.native)}))}},{key:"MouseClickLeftArcGIS",value:function(t){var i=this.CommonEventBuilderArcGIS(t);this.app.MouseEvent(i)}},{key:"CommonEventBuilderArcGIS",value:function(i){var e=new y.$E;return e.preX=t.mouseEventDataPre.x,e.preY=t.mouseEventDataPre.y,e.x=i.x,e.y=i.y,e.yGLPicking=i.native.target.getBoundingClientRect().bottom-i.native.clientY,e.pressedShift=i.native.shiftKey,e.pressedAlt=i.native.altKey,e.pressedCtrl=i.native.ctrlKey,e.native=i.native,t.mouseEventDataPre=e,e}},{key:"KeyDownJSAPI4X",value:function(t){var i=this.CommonEventBuilder(t);this.app.KeyEvent(i)}},{key:"CommonEventBuilder",value:function(t){var i=new y.ON;return i.key=t.key,i.keyCode=t.keyCode,i.code=t.code,i.hasCtrlKey=t.ctrlKey,i.hasShiftKey=t.shiftKey,i.hasAltKey=t.altKey,i.hasMetaCommand=t.metaKey,i}}]),t}();m.mouseEventDataPre=void 0;var x=function(){function t(i){(0,o.Z)(this,t),this.sandbox=void 0,this.p=[],this.num=0,this.isPanning=!1,this.renderer=[],this.sandbox=i}return(0,a.Z)(t,[{key:"Init",value:function(t){}},{key:"Render",value:function(t){for(var i=0;i<this.renderer.length;++i)this.renderer[i](t,this.isPanning)}}]),t}(),w=function(){function t(i){var e=this;(0,o.Z)(this,t),this.mapView=void 0,this.map=void 0,this.mPoint=void 0,this.divHost=void 0,this.arcGIS=void 0,this.io=void 0,this.canvas=void 0,this.projection=void 0,this.eventInteraction=void 0,this.renderer=void 0,this.ableToPan=!0,this.keyEvents=[],this.MouseEvents=[],this.renderer=new x(this);var n=new c.Z({basemap:"dark-gray-vector"});this.map=n,new d.Z({map:n,container:i,center:[-73.989502,40.741286],zoom:13}).when((function(t){e.mapView=t,e.mapView.spatialReference=u.Z.WebMercator,e.mPoint=e.mapView.toMap({x:0,y:0}),e.divHost=e.mapView.container,e.io=new v(e),e.eventInteraction=new m(e),e.projection=new g(e),e.canvas=new f(e),e.arcGIS=new p(e)}))}return(0,a.Z)(t,[{key:"appendRenderer",value:function(t){this.renderer.renderer.push(t)}},{key:"appendEventListener",value:function(t){this.MouseEvents.push(t.mouse),this.keyEvents.push(t.keyboard)}},{key:"MouseEvent",value:function(t){for(var i=0;i<this.MouseEvents.length;++i)this.MouseEvents[i](t)}},{key:"KeyEvent",value:function(t){for(var i=0;i<this.keyEvents.length;++i)this.keyEvents[i](t)}}],[{key:"start",value:function(i){new t(i)}}]),t}(),k=e(39890),C=function(t,i,e,n,s){return(t-i)*(s-n)/(e-i)+n},P=function(t,i){return Math.random()*(i-t)+t},E=function(t){var i=4294967295,e=123456789+t&i,n=987654321-t&i;return function(){var t=((n=36969*(65535&n)+(n>>>16)&i)<<16)+(65535&(e=18e3*(65535&e)+(e>>>16)&i))>>>0;return t/=4294967296}},b=e(44945),M=function(){function t(i){(0,o.Z)(this,t),this.HTMLView=void 0,this.div=void 0,this.HTMLView=i,this.initPanel()}return(0,a.Z)(t,[{key:"remove",value:function(){this.HTMLView.networkUI=void 0}},{key:"initPanel",value:function(){var t=this,i=document.createElement("div");i.style.width="200px",i.style.height="400px",i.style.background="#ffffff",i.style.position="absolute",i.style.zIndex="10",i.style.top="100px";var e=document.createElement("div");e.style.width="100%",e.style.height="60px",e.style.background="#efefef",e.style.position="relative",e.style.zIndex="11",e.textContent="NNA V3 controller";var n=!1,s=[0,0];e.ondrag=function(t){},e.onmouseenter=function(t){},e.ondrag=function(t){},e.onmousemove=function(t){if(n){var e=t.clientX-s[0],o=t.clientY-s[1];i.style.top=parseFloat(i.style.top)+o+"px",i.style.left=parseFloat(i.style.left)+e+"px",s[0]=t.clientX,s[1]=t.clientY}},e.onmousedown=function(t){s[0]=t.clientX,s[1]=t.clientY,n=!0},e.onmouseup=function(t){n=!1},e.onmouseout=function(t){if(n){var e=t.clientX-s[0],o=t.clientY-s[1];i.style.top=parseFloat(i.style.top)+o+"px",i.style.left=parseFloat(i.style.left)+e+"px",s[0]=t.clientX,s[1]=t.clientY}},i.appendChild(e);var o=document.createElement("button");o.style.height="70px",o.style.width="60px",o.style.zIndex="13;",o.style.position="relative",o.textContent="Import",o.onclick=function(){},i.appendChild(o),(o=document.createElement("button")).style.height="70px",o.style.width="60px",o.style.zIndex="13;",o.style.position="relative",o.textContent="Origin",o.onclick=function(){t.HTMLView.app.apiCall(k.lw.NETWORK,"addOrigin",void 0)},i.appendChild(o),(o=document.createElement("button")).style.height="70px",o.style.width="60px",o.style.zIndex="13;",o.style.position="relative",o.textContent="Destin",o.onclick=function(){},i.appendChild(o),(o=document.createElement("button")).style.height="70px",o.style.width="60px",o.style.zIndex="13;",o.style.position="relative",o.textContent="Destin",o.onclick=function(){},i.appendChild(o),(o=document.createElement("button")).style.height="70px",o.style.width="60px",o.style.zIndex="13;",o.style.position="relative",o.textContent="Destin",o.onclick=function(){},i.appendChild(o),(o=document.createElement("button")).style.top="0px",o.style.left="180px",o.style.height="20px",o.style.width="20px",o.style.zIndex="13",o.style.position="absolute",o.style.padding="0px",o.style.zIndex="20",o.textContent="X",o.onclick=function(){t.remove()},i.appendChild(o),this.div=i}}]),t}(),I=function(){function t(i){(0,o.Z)(this,t),this.app=void 0,this.networkUI=void 0,this.app=i}return(0,a.Z)(t,[{key:"reset",value:function(){this.removePanelNetwork()}},{key:"initPanelNetwork",value:function(){this.networkUI||(this.networkUI=new M(this))}},{key:"removePanelNetwork",value:function(){this.networkUI&&this.networkUI.remove()}}]),t}(),S=function(){function t(i){(0,o.Z)(this,t),this.nnaEngine=void 0,this.inspection=!0,this.m=new b.h9(0,0),this.dataOrigins=void 0,this.destinationOrigins=void 0,this.nnaEngine=i}return(0,a.Z)(t,[{key:"execution",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(i,e,s){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i===k.lw.NETWORK&&("initPanel"===e&&this.nnaEngine.view.initPanelNetwork(),"addOrigin"===e&&(this.dataOrigins=s,this.nnaEngine.core.graphSystem.initByCPoint(s)),"addOrigins"===e&&(this.dataOrigins=s,this.dataOrigins&&this.nnaEngine.core.graphSystem.initByCPoints(this.dataOrigins)),"addDestinations"===e&&(this.destinationOrigins=s,this.destinationOrigins&&this.nnaEngine.core.graphSystem.initByCPointsBackpro(this.destinationOrigins))),i===k.lw.AGENCY&&"runAgent"===e&&this.nnaEngine.core.graphSystem.initAgentVis(),i===k.lw.GA&&"pathOptimization"===e&&s&&this.nnaEngine.core.agencySystem.gaSystem.initByCPoint(s);case 3:case"end":return t.stop()}}),t,this)})));return function(i,e,n){return t.apply(this,arguments)}}()},{key:"mouseEvent",value:function(t){switch(this.m.x=t.x,this.m.y=t.y,t.type){case k.zK.DOWN:break;case k.zK.LEFT:this.nnaEngine.core.graphSystem.getPath(t.x,t.y);break;case k.zK.MOVE:break;case k.zK.DRAG:this.dataOrigins&&this.nnaEngine.core.graphSystem.initByCPoints(this.dataOrigins),this.destinationOrigins&&this.nnaEngine.core.graphSystem.initByCPointsBackpro(this.destinationOrigins),this.nnaEngine.core.agencySystem.gaSystem.pointData&&this.nnaEngine.core.agencySystem.update()}}}]),t}(),A=function(){function t(i,e,n,s){(0,o.Z)(this,t),this.vec=void 0,this.id=-1,this.vec=new b.h9(i,e,0),this.vec.long=n,this.vec.lat=s}return(0,a.Z)(t,[{key:"distanceTo",value:function(t){return this.vec.distanceTo(t.vec)}}]),t}(),D=function(){function t(i){(0,o.Z)(this,t),this.pathsOrigin=[],this.nodes=[],this.fitness=0,this.distance=0,this.pathsOrigin=i,this.nodes=[],this.fitness=0,this.distance=0;for(var e=0;e<this.pathsOrigin.length;++e)this.nodes.push(void 0)}return(0,a.Z)(t,[{key:"generateIndividual",value:function(){for(var t=0;t<this.pathsOrigin.length;++t)this.setCityInit(t,this.pathsOrigin[t]);!function(t){for(var i,e,n=t.length;0!==n;)e=Math.floor(Math.random()*n),i=t[n-=1],t[n]=t[e],t[e]=i}(this.nodes)}},{key:"setCityInit",value:function(t,i){this.nodes[t]=i,this.fitness=0,this.distance=0}},{key:"getFitness",value:function(){return 0===this.fitness&&(this.fitness=1/this.getDistance()),this.fitness}},{key:"getDistance",value:function(){if(0===this.distance){for(var t=0,i=0;i<this.nodes.length;++i){var e=this.nodes[i];if(e){var n=void 0;(n=i===this.nodes.length-1?this.nodes[0]:this.nodes[i+1])&&(t+=e.distanceTo(n))}}this.distance=t}return this.distance}},{key:"containsCity",value:function(t){for(var i=0;i<this.nodes.length;++i)if(this.nodes[i]===t)return!0;return!1}}]),t}(),B=function(){function t(i,e,n){(0,o.Z)(this,t),this.paths=[],this.paths=[];for(var s=0;s<e;++s)this.paths.push(void 0);if(n)for(var a=0;a<e;++a){var h=new D(i);h.generateIndividual(),this.paths[a]=h}}return(0,a.Z)(t,[{key:"getFittestPath",value:function(){for(var t=this.paths[0],i=0;i<this.paths.length;++i){var e=this.paths[i];t&&e&&t.getFitness()<=e.getFitness()&&(t=e)}return t}}]),t}(),G=function(){function t(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,o.Z)(this,t),this.nodes=void 0,this.mutationRate=void 0,this.nodeSize=void 0,this.elitism=void 0,this.nodes=i,this.mutationRate=e,this.nodeSize=n,this.elitism=s}return(0,a.Z)(t,[{key:"evolvePopulation",value:function(t){var i=new B(this.nodes,t.paths.length,!1),e=0;if(this.elitism){var n=t.getFittestPath();n&&(i.paths[0]=n,e=1)}for(var s=e;s<i.paths.length;++s){var o=this.tournamentSelection(t),a=this.tournamentSelection(t);if(o&&a){var h=this.crossover(o,a);i.paths[s]=h}}for(var r=e;r<i.paths.length;++r){var l=i.paths[r];l&&this.mutate(l)}return i}},{key:"crossover",value:function(t,i){for(var e=new D(this.nodes),n=Math.floor(Math.random()*t.nodes.length),s=Math.floor(Math.random()*t.nodes.length),o=0;o<e.nodes.length;++o){var a=t.nodes[o];a&&(n<s&&o>n&&o<s||n>s&&0==(o<n&&o>s))&&e.setCityInit(o,a)}for(var h=0;h<i.nodes.length;++h){var r=i.nodes[h];if(r&&0==e.containsCity(r))for(var l=0;l<e.nodes.length;++l)if(void 0==e.nodes[l]){e.setCityInit(l,r);break}}return e}},{key:"mutate",value:function(t){for(var i=0;i<t.nodes.length;++i)if(Math.random()<this.mutationRate){var e=Math.floor(t.nodes.length*Math.random()),n=t.nodes[i],s=t.nodes[e];n&&s&&(t.setCityInit(e,n),t.setCityInit(i,s))}}},{key:"tournamentSelection",value:function(t){for(var i=new B(this.nodes,this.nodeSize,!1),e=0;e<this.nodeSize;++e){var n=Math.floor(Math.random()*t.paths.length);i.paths[e]=t.paths[n]}return i.getFittestPath()}}]),t}(),R=function(){function t(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,t),this.agencySystem=void 0,this.cities=void 0,this.placesAll=void 0,this.ga=void 0,this.pop=void 0,this.pathFittest=void 0,this.timer=0,this.cost=Number.MAX_VALUE,this.pos=[],this.pointData=void 0,this.random=void 0,this.agencySystem=i,this.random=E(e),this.pos=[],this.init()}return(0,a.Z)(t,[{key:"mouseClick",value:function(t,i){}},{key:"init",value:function(){var t=this.pos.length;this.placesAll=[];for(var i=0;i<this.pos.length;++i);this.pop=new B(this.placesAll,5,!0),this.pathFittest=this.pop.getFittestPath(),this.pathFittest,this.ga=new G(this.placesAll,.1,t)}},{key:"initByCPoint",value:function(t){if(void 0!==t&&(this.pointData=t),this.pointData){var i=this.pointData.length;this.placesAll=[];for(var e=0;e<this.pointData.length;++e){var n=this.pointData[e],s=this.agencySystem.nnaEngine.app.toMap(n[0],n[1]),o=new A(n[0],n[1],s[0],s[1]);o.vec=n.v,o.id=this.placesAll.length,this.placesAll.push(o)}this.pop=new B(this.placesAll,5,!0),this.pathFittest=this.pop.getFittestPath(),this.pathFittest,this.ga=new G(this.placesAll,.1,i)}}},{key:"optimize",value:function(){if(this.pop=this.ga.evolvePopulation(this.pop),this.pathFittest=this.pop.getFittestPath(),this.pathFittest){var t=this.pathFittest.getDistance();t<this.cost&&(this.cost=t),this.timer++}}},{key:"render",value:function(t,i){if(this.optimize(),t.fillStyle="#ff0000",t.strokeStyle="#ff0000",t.lineWidth=1,i)for(var e=0;e<this.placesAll.length;++e);if(this.pathFittest)for(var n=0;n<this.pathFittest.nodes.length-1;n++){var s=this.pathFittest.nodes[n],o=this.pathFittest.nodes[n+1];s&&o&&(t.beginPath(),t.moveTo(s.vec.x,s.vec.y),t.lineTo(o.vec.x,o.vec.y),t.closePath(),t.stroke())}for(var a=0;a<this.placesAll.length;++a){t.beginPath();var h=this.placesAll[a];t.arc(h.vec.x,h.vec.y,10,0,2*Math.PI),t.closePath(),t.fill()}}}]),t}(),N=function(){function t(i){(0,o.Z)(this,t),this.nnaEngine=void 0,this.gaSystem=void 0,this.nnaEngine=i,this.gaSystem=new R(this)}return(0,a.Z)(t,[{key:"render",value:function(t,i){this.gaSystem.render(t,i)}},{key:"mouseClick",value:function(t,i){this.gaSystem.mouseClick(t,i)}},{key:"update",value:function(){this.gaSystem.initByCPoint(void 0)}}]),t}(),T=(0,a.Z)((function t(i){(0,o.Z)(this,t),this.gs=void 0,this.gs=i})),Z=function(){function t(i){(0,o.Z)(this,t),this.graphCore=void 0,this.nodes=[],this.edges=[],this.minPt=new b.h9(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxPt=new b.h9(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this.nodeOrigin=void 0,this.graphCore=i}return(0,a.Z)(t,[{key:"initGraph",value:function(t){return this.nodes=[],this.edges=[],this.AddEdgeByLines(t),!0}},{key:"AddEdgeByLines",value:function(t){for(var i=[],e=0;e<t.length;++e){var n=t[e].p0,s=t[e].p1;this.minPt.long>n.long&&(this.minPt.long=n.long),this.minPt.lat>n.lat&&(this.minPt.lat=n.lat),this.minPt.elevation>n.elevation&&(this.minPt.elevation=n.elevation),this.maxPt.long<n.long&&(this.maxPt.long=n.long),this.maxPt.lat<n.lat&&(this.maxPt.lat=n.lat),this.maxPt.elevation<n.elevation&&(this.maxPt.elevation=n.elevation),this.minPt.long>s.long&&(this.minPt.long=s.long),this.minPt.lat>s.lat&&(this.minPt.lat=s.lat),this.minPt.elevation>s.elevation&&(this.minPt.elevation=s.elevation),this.maxPt.long<s.long&&(this.maxPt.long=s.long),this.maxPt.lat<s.lat&&(this.maxPt.lat=s.lat),this.maxPt.elevation<s.elevation&&(this.maxPt.elevation=s.elevation),i.push(this.AddNode(n)),i.push(this.AddNode(s))}for(var o=0;o<i.length;o+=2)this.AddEdge(i[o],i[o+1])}},{key:"AddEdge",value:function(t,i){if(t!==i){var e=this.FindEdge(t,i);if(void 0!==e)return e;var n=new V(t,i);return n.id=this.edges.length,this.edges.push(n),n}}},{key:"AddNode",value:function(t){for(var i=0;i<this.nodes.length;++i)if(t.distanceTo(this.nodes[i].point)<.1)return this.nodes[i];var e=new L(t);return e.id=this.nodes.length,this.nodes.push(e),e}},{key:"FindEdge",value:function(t,i){for(var e=0;e<this.edges.length;++e)if(this.edges[e].n0===t&&this.edges[e].n1===i||this.edges[e].n0===i&&this.edges[e].n1===t)return this.edges[e]}},{key:"FindClosestNode",value:function(t){if(0!==this.nodes.length){for(var i=-1,e=Number.MAX_VALUE,n=0;n<this.nodes.length;++n){var s=this.nodes[n].point.distanceTo(t);s<e&&(i=n,e=s)}return this.nodes[i]}}},{key:"updatePropagation",value:function(t,i,e){for(var n=0;n<this.nodes.length;++n)this.nodes[n].networkDistance=-1,this.nodes[n].euclideanDistance=-1;for(var s=0;s<t.length;++s){var o=this.nodes[t[s].nodeOrigin.id];o.networkDistance=0,o.euclideanDistance=0,this.updatePropagationByNode(o,i,e)}}},{key:"updatePropagationByNodes",value:function(t,i,e){for(var n=0;n<this.nodes.length;++n)this.nodes[n].reset();for(var s=0;s<t.length;++s){var o=t[s];o.networkDistance=0,o.euclideanDistance=0;var a=[];a.push(t[s]);for(var h=0;h<1e6&&0!==a.length;++h){var r=a[0],l=r.point.distanceToGeo(o.point);(-1===r.euclideanDistance||l<r.euclideanDistance)&&(r.euclideanDistance=r.point.distanceToGeo(o.point)),a.shift();for(var d=0;d<r.nodes.length;++d){var c=r.nodes[d],u=i(r,c,e),v=r.networkDistance+u;(-1===c.networkDistance||v<c.networkDistance)&&(c.networkDistance=v,a.push(c))}}}}},{key:"updatePropagationByNode",value:function(t,i,e){this.nodeOrigin=t;for(var n=0;n<this.nodes.length;++n)this.nodes[n].reset();var s=[];s.push(t);for(var o=0;o<1e6&&0!==s.length;++o){var a=s[0],h=a.point.distanceToGeo(t.point);(-1===a.euclideanDistance||h<a.euclideanDistance)&&(a.euclideanDistance=a.point.distanceToGeo(t.point)),s.shift();for(var r=0;r<a.nodes.length;++r){var l=a.nodes[r],d=i(a,l,e),c=a.networkDistance+d;(-1===l.networkDistance||c<l.networkDistance)&&(l.networkDistance=c,s.push(l))}}}},{key:"updateBackpropagation",value:function(t){var i=[],e=0,n=0,s=0;for(e=0;e<t.length;++e){var o=this.FindClosestNode(t[e]),a=[];if(-1!=o.networkDistance){a.push(this.nodes[o.id]);var h=o;for(n=0;n<1e5;++n){var r=h;for(r.countVisit++,s=0;s<h.nodes.length;++s){var l=h.nodes[s];l.networkDistance<r.networkDistance&&(r=l)}if(r===h){a.push(this.nodeOrigin),i.push(a);break}h=r,a.push(this.nodes[h.id])}}}return i}}]),t}(),V=function(){function t(i,e){(0,o.Z)(this,t),this.id=-1,this.n0=void 0,this.n1=void 0,this.mp=void 0,this.CONNECTIVITY=void 0,this.n0=i,this.n1=e,this.n0.edges.push(this),this.n1.edges.push(this),i.nodes.push(e),e.nodes.push(i),this.mp=this.GetMidPoint(),this.CONNECTIVITY=k._6.CONNECTED}return(0,a.Z)(t,[{key:"GetMidPoint",value:function(){return b.h9.getMidVec(this.n0.point,this.n1.point)}},{key:"updateScreenPos",value:function(t){this.n0.updateScreenPos(t),this.n1.updateScreenPos(t)}}]),t}(),L=function(){function t(i){(0,o.Z)(this,t),this.id=-1,this.point=void 0,this.edges=[],this.nodes=[],this.networkDistance=-1,this.euclideanDistance=0,this.countVisit=0,this.countOrigin=1,this.countDestination=1,this.countVisitTemp=0,this.point=new b.h9(i.x,i.y,i.z),this.point.lat=i.lat,this.point.long=i.long}return(0,a.Z)(t,[{key:"reset",value:function(){this.networkDistance=-1,this.euclideanDistance=0,this.countVisit=0,this.countVisitTemp=0}},{key:"deepCopy",value:function(){var i=new t(this.point);return i.id=this.id,i}},{key:"updateScreenPos",value:function(t){var i=t(this.point.long,this.point.lat);this.point.x=i[0],this.point.y=i[1]}}]),t}(),F=function(){function t(i,e){(0,o.Z)(this,t),this.gc=void 0,this.Optimizer=void 0,this.edges=[],this.nodes=[],this.nodeDestinations=[],this.nodeOrigin=void 0,this.pointOrigin=void 0,this.polylines=[],this.paths=[],this.gc=i,this.duplicateGraph(),this.updateOriginByPt(e)}return(0,a.Z)(t,[{key:"updateOriginByPt",value:function(t){var i=this.gc.graph.FindClosestNode(t);i&&(this.nodeOrigin=this.nodes[i.id],this.pointOrigin=new b.h9(t.x,t.y,t.z))}},{key:"updatePropagation",value:function(t,i){this.Optimizer=t;for(var e=0;e<this.nodes.length;++e)this.nodes[e].networkDistance=-1;var n=[];this.nodeOrigin.networkDistance=0,n.push(this.nodeOrigin);for(var s=0;s<1e6&&0!=n.length;++s){var o=n[0];o.euclideanDistance=o.point.distanceTo(this.nodeOrigin.point),n.shift();for(var a=0;a<o.nodes.length;++a){var h=o.nodes[a],r=t(o,h,i),l=o.networkDistance+r;(-1==h.networkDistance||l<h.networkDistance)&&(h.networkDistance=l,n.push(h))}}}},{key:"updateBackpropagation",value:function(t){this.nodeDestinations=new L[t.length];var i=[],e=0,n=0,s=0;for(e=0;e<t.length;++e){var o=this.nodes[t[e]];this.nodeDestinations[e]=o;var a=[];if(-1!=o.networkDistance){a.push(this.nodes[o.id]);var h=o;for(n=0;n<1e5;++n){var r=h;for(r.countVisit++,s=0;s<h.nodes.length;++s){var l=h.nodes[s];l.networkDistance<r.networkDistance&&(r=l)}if(r==h){a.push(this.nodeOrigin),a[0].euclideanDistance=a[0].point.distanceTo(this.nodeOrigin.point),i.push(a);break}h=r,a.push(this.nodes[h.id])}}}return this.paths=i,i}},{key:"GetPathsPolylines",value:function(t,i){for(var e=[],n=0;n<this.paths.length;++n){for(var s=new y.W7,o=0;o<this.paths[n].length;++o)s.push(this.paths[n][o].point);t<this.paths[n][0].networkDistance&&this.paths[n][0].networkDistance<i&&e.push(s)}return this.polylines=e,this.polylines}},{key:"duplicateGraph",value:function(){var t=0,i=-1,e=-1;for(this.nodes=[],this.edges=[],t=0;t<this.gc.graph.nodes.length;++t)this.nodes.push(this.gc.graph.nodes[t].deepCopy());for(t=0;t<this.gc.graph.edges.length;++t){i=this.gc.graph.edges[t].n0.id,e=this.gc.graph.edges[t].n1.id;var n=new V(this.nodes[i],this.nodes[e]);n.id=this.gc.graph.edges[t].id,this.edges.push(n)}}}]),t}(),O=function(t,i){return(0,b.MX)(i.point,t.point)},z=function(){function t(i){(0,o.Z)(this,t),this.gs=void 0,this.trees=[],this.destinations=[],this.idDestination=[],this.graph=void 0,this.gs=i,this.trees=[],this.destinations=[],this.idDestination=[]}return(0,a.Z)(t,[{key:"initGraph",value:function(t){this.graph=new Z(this),this.graph.initGraph(t)}},{key:"setUnit",value:function(t){}},{key:"computePath",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.trees=[];var n=[],s=[];this.computePathWeighted(t,n,i,s,e)}},{key:"computePathWeighted",value:function(t,i,e,n){for(;t.length<i.length;)i.push(1);for(;e.length<n.length;)n.push(1);this.updatePropagation(t,i),this.updateBackpropagation(e,n),this.mergeAgents()}},{key:"updatePropagation",value:function(t,i){for(var e=0;e<t.length;++e){var n=t[e];if(e==this.trees.length-1)this.trees[e].pointOrigin.distanceToGeo(n)<.1||this.trees[e].updateOriginByPt(n),this.trees[e].updatePropagation(O,.002);else{var s=new F(this,n);s.updatePropagation(O,.002),this.trees.push(s)}}}},{key:"updateBackpropagation",value:function(t,i){for(var e=0;e<t.length;++e)if(e==this.destinations.length-1)if(t[e].distanceToGeo(this.destinations[e])<.1)this.idDestination.push(this.idDestination[e]);else{var n=this.graph.FindClosestNode(t[e]);n&&(this.idDestination[e]=n.id,this.destinations[e]=t[e])}else{var s=this.graph.FindClosestNode(t[e]);s&&(this.idDestination.push(s.id),this.destinations.push(t[e]))}for(var o=0;o<this.trees.length;++o){var a=this.trees[o];a.updateBackpropagation(this.idDestination)}}},{key:"mergeAgents",value:function(){this.graph.updatePropagation(this.trees,O,.002);for(var t=0;t<this.trees.length;++t)for(var i=0;i<this.trees[t].nodes.length;++i)this.graph.nodes[i].countVisit+=this.trees[t].nodes[i].countVisit,this.graph.nodes[i].countOrigin+=this.trees[t].nodes[i].countOrigin,this.graph.nodes[i].countDestination+=this.trees[t].nodes[i].countDestination}}]),t}(),_=(0,a.Z)((function t(){(0,o.Z)(this,t),this.lineWidth=.5,this.strokeStyle="rgba(0, 255, 0, 0.5)"})),j=function(){function t(i){(0,o.Z)(this,t),this.gs=void 0,this.BoidsBehaviors=void 0,this.start=void 0,this.end=void 0,this.path=[],this.selPath=void 0,this.time=0,this.properties=new _,this.gs=i}return(0,a.Z)(t,[{key:"render",value:function(t,i){var e;if(t.lineWidth=this.properties.lineWidth,t.strokeStyle=this.properties.strokeStyle,null!==(e=this.gs.graphCore.graph)&&void 0!==e&&e.edges)for(var n=0;n<this.gs.graphCore.graph.edges.length;++n){var s=this.gs.graphCore.graph.edges[n];i&&s.updateScreenPos(this.gs.nnaEngine.app.toScreen),t.beginPath();var o=(0,y.GM)(.001*s.n0.networkDistance);t.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1.0) "),t.moveTo(s.n0.point.x,s.n0.point.y),t.lineTo(s.n1.point.x,s.n1.point.y),t.stroke();var a=s.n0.point.distanceToGeo(s.n1.point);!i&&this.gs.nnaEngine.app.controller.inspection&&(t.font="10px Arial",t.fillStyle="#000000",t.fillText("".concat(a.toFixed(2)),s.n0.point.x+.5*(s.n1.point.x-s.n0.point.x),s.n0.point.y+.5*(s.n1.point.y-s.n0.point.y)))}t.fillStyle="#ffffff",this.start&&(t.beginPath(),t.arc(this.start.x,this.start.y,5,0,2*Math.PI),t.closePath(),t.fill()),this.end&&(t.beginPath(),t.arc(this.end.x,this.end.y,15,0,2*Math.PI),t.closePath(),t.fill());var h=-1,r=Number.MAX_SAFE_INTEGER,l=this.gs.nnaEngine.app.controller.m.x,d=this.gs.nnaEngine.app.controller.m.y;t.globalCompositeOperation=k.kz.COLOR_DODGE;for(var c=0;c<this.path.length;++c){t.strokeStyle="rgba(255, 255, 10, 1)",t.lineWidth=2.4,t.setLineDash([5,4]),t.beginPath(),t.moveTo(this.path[c][0].point.x,this.path[c][0].point.y);var u=(0,b.tl)(this.path[c][0].point.x,this.path[c][0].point.y,l,d);u<r&&(r=u,h=c);for(var v=1;v<this.path[c].length;++v)this.path[c][v]&&(t.lineTo(this.path[c][v].point.x,this.path[c][v].point.y),(u=(0,b.tl)(this.path[c][v].point.x,this.path[c][v].point.y,l,d))<r&&(r=u,h=c));t.stroke(),t.lineDashOffset=-5*this.time,t.setLineDash([])}if(this.path.length>0&&r<10){this.selPath=this.path[h],t.beginPath(),t.moveTo(this.selPath[0].point.x,this.selPath[0].point.y);for(var p=1;p<this.selPath.length;++p)this.selPath[p]&&t.lineTo(this.selPath[p].point.x,this.selPath[p].point.y);t.lineWidth=4.4,t.stroke(),t.lineDashOffset=-5*this.time,t.setLineDash([])}else this.selPath=void 0;t.globalCompositeOperation=k.kz.SOURCE_OVER,this.time+=.1,this.BoidsBehaviors&&(this.BoidsBehaviors.Update(),this.BoidsBehaviors.Render(t))}},{key:"getPath",value:function(t,i){this.selPath}}]),t}(),U=e(37762),X=function(){function t(i){(0,o.Z)(this,t),this.r=5,this.nodes=void 0,this.nodes=[],this.r=i}return(0,a.Z)(t,[{key:"AddNode",value:function(t){this.nodes.push(t)}},{key:"GetNodes",value:function(){for(var t=[],i=0;i<this.nodes.length;++i)t.push(new b.h9(this.nodes[i].x,this.nodes[i].y,0));return t}}]),t}(),K=function(){function t(i,e,n){(0,o.Z)(this,t),this.MAX_FORCE=void 0,this.position=void 0,this.velocity=void 0,this.maxVelocity=void 0,this.desired=void 0,this.steering=void 0,this.mass=void 0,this.boidsPath=void 0,this.currentNode=void 0,this.pathDir=void 0,this.rotation=void 0,this.vec=void 0,this.preVec=void 0,this.avoidance=void 0,this.ahead=void 0,this.alpha=void 0,this.isOriented=void 0,this.activeBase64ID=" ",this.angle=void 0,t.MAX_FORCE=t.MAX_VELOCITY,this.MAX_FORCE=t.MAX_FORCE,this.position=new b.h9(i,e),this.velocity=new b.h9(-1,-2),this.desired=new b.h9(0,0),this.steering=new b.h9(0,0),this.vec=new b.h9(0,0),this.rotation=0,this.mass=n,this.currentNode=0,this.pathDir=1,this.angle=0,this.isOriented=!1,this.avoidance=new b.h9(0,0),this.maxVelocity=this.MAX_FORCE*(.8+.6*Math.random()),this.Truncate(this.velocity,this.maxVelocity),this.preVec=[]}return(0,a.Z)(t,[{key:"CollisionAvoidance",value:function(){var i=this.velocity.Clone();i.normalize(),i.scale(t.MAX_AVOID_AHEAD*this.velocity.Length()/this.maxVelocity),this.ahead=this.position.Clone().Add(i);return this.alpha=1,this.avoidance.scale(0),this.avoidance}},{key:"Distance",value:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))}},{key:"Truncate",value:function(t,i){var e=i/t.Length();e=e<1?e:1,t.scale(e)}},{key:"GetAngle",value:function(t){return Math.atan2(t.y,t.x)}},{key:"Update",value:function(){if(this.steering=this.PathFollowing(),this.steering=this.steering.Add(this.CollisionAvoidance()),this.Truncate(this.steering,this.MAX_FORCE),this.steering.scale(1/this.mass),this.velocity=this.velocity.Add(this.steering),this.Truncate(this.velocity,this.maxVelocity),this.position=this.position.Add(this.velocity),this.isOriented){var t=new b.h9(this.velocity.x,this.velocity.y);this.rotation=t.GetAngle()}this.vec=new b.h9(this.position.x,this.position.y),this.AddVecHistory()}},{key:"AddVecHistory",value:function(){this.preVec.push(new b.h9(this.vec.x,this.vec.y)),this.preVec.length>20&&this.preVec.shift()}},{key:"Render",value:function(t){if(this.DrawTail(t)," "!==this.activeBase64ID){t.globalCompositeOperation="source-over";var i=new Image;i.src=this.activeBase64ID,t.save(),t.globalAlpha=.85,t.translate(this.vec.x,this.vec.y),t.rotate(this.rotation),t.drawImage(i,-i.width/2,-i.width/2),t.restore(),t.globalCompositeOperation="lighter"}else t.beginPath(),t.fillStyle="rgba(0,255,0,0.7)",t.arc(this.vec.x,this.vec.y,5,0,6.28);t.closePath(),t.fill()}},{key:"DrawTail",value:function(t){for(var i=this.preVec.length;i--;)t.beginPath(),t.fillStyle="rgba(0,255,0,".concat(C(i,0,this.preVec.length,.01,.175),")"),t.arc(this.preVec[i].x,this.preVec[i].y,C(i,0,this.preVec.length,.1,10),0,6.28),t.closePath(),t.fill()}},{key:"DrawShape",value:function(t){t.fillStyle="#FF0000",t.lineWidth=.1,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-20),t.lineTo(10,20),t.lineTo(-10,20),t.lineTo(0,-20),t.closePath(),t.moveTo(0,0)}},{key:"DrawForces",value:function(t){var i=this.velocity.Clone(),e=this.steering.Clone(),n=this.desired.Clone();i.normalize(),e.normalize(),n.normalize(),this.DrawForceVector(t,i,"#00FF00"),this.DrawForceVector(t,n,"#0000FF")}},{key:"DrawForceVector",value:function(t,i,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;t.strokeStyle=e,t.beginPath(),t.moveTo(this.vec.x,this.vec.y),t.lineTo(this.vec.x+i.x*n,this.vec.y+i.y*n),t.closePath(),t.stroke()}},{key:"Seek",value:function(t){return this.desired=t.Sub(this.position),this.desired.normalize(),this.desired.scale(this.maxVelocity),this.desired.Sub(this.velocity)}},{key:"PathFollowing",value:function(){var t,i=this.boidsPath.GetNodes();return t=i[this.currentNode],this.Distance(this.position,t)<=this.boidsPath.r&&(this.currentNode+=this.pathDir,(this.currentNode>=i.length||this.currentNode<0)&&(this.pathDir*=-1,this.currentNode+=this.pathDir)),void 0!==t?this.Seek(t):new b.h9(0,0,0)}}]),t}();K.MAX_VELOCITY=5,K.MAX_FORCE=3,K.MAX_AVOID_AHEAD=50,K.AVOID_FORCE=600,K.MAX_QUEUE_AHEAD=30,K.MAX_QUEUE_RADIUS=30,K.MAX_SEPARATION=2,K.SEPARATION_RADIUS=30;var H=function(){function t(i,e){(0,o.Z)(this,t),this.boids=[],this.boidsPath=void 0,this.t=void 0,this.isOriented=void 0,this.activeBase64ID=void 0,t.instance=this,t.width=i,t.height=e,this.isOriented=!1,this.t=0}return(0,a.Z)(t,[{key:"InitPathByAPolyline",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;this.boidsPath=t,this.InitBoid(i)}},{key:"InitPathByNode",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;this.boidsPath=new X(10);for(var e=0;e<t.length;++e)t[e]&&this.boidsPath.AddNode(t[e].point);this.InitBoid(i)}},{key:"InitPath",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;this.boidsPath=t,this.Init(i,e)}},{key:"Init",value:function(i,e){this.reset(),this.boidsPath.r=30;for(var n=i,s=0;s<n;s++){var o=new b.h9(t.width*s/n+50,t.height*Math.random()*.8+20,0);this.boidsPath.AddNode(o)}this.InitBoid(e)}},{key:"InitBoid",value:function(){for(var i,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,n=0;n<e;n++)(i=new K(t.width/2+50*Math.random(),20*Math.random(),20+20*Math.random())).activeBase64ID=this.activeBase64ID,i.boidsPath=this.boidsPath,this.boids.push(i)}},{key:"ShiftSpeed",value:function(t,i){var e,n=(0,U.Z)(this.boids);try{for(n.s();!(e=n.n()).done;){e.value.maxVelocity=P(t,i)}}catch(s){n.e(s)}finally{n.f()}}},{key:"IncreasePathRadius",value:function(){t.showForces=!0,this.boidsPath.r+=2}},{key:"DecreasePathRadius",value:function(){t.showForces=!0,this.boidsPath.r-=2}},{key:"ToggleShowForces",value:function(){t.showForces=!t.showForces}},{key:"ShiftRadius",value:function(t){this.boidsPath.r=t}},{key:"ShiftForce",value:function(t,i){var e,n=(0,U.Z)(this.boids);try{for(n.s();!(e=n.n()).done;){e.value.maxVelocity=P(t,i)}}catch(s){n.e(s)}finally{n.f()}}},{key:"ShiftOriented",value:function(t){var i,e=(0,U.Z)(this.boids);try{for(e.s();!(i=e.n()).done;){i.value.isOriented=t}}catch(n){e.e(n)}finally{e.f()}}},{key:"reset",value:function(){}},{key:"Update",value:function(){for(var t=0;t<this.boids.length;t++)this.boids[t].Update();this.t>16&&(this.t=0),this.t+=.5}},{key:"Render",value:function(t){t.globalCompositeOperation="lighter",this.drawPath(t);for(var i=0;i<this.boids.length;i++)this.boids[i].Render(t);t.globalCompositeOperation="source-over"}},{key:"drawPath",value:function(i){for(var e=this.boidsPath.GetNodes(),n=0;n<e.length;++n)this.drawPathPoint(i,e[n],"#FF00CC"),t.showForces&&this.drawCircle(i,e[n],"gray",this.boidsPath.r);i.beginPath(),i.lineWidth=.2,i.strokeStyle="#ffffff",i.setLineDash([4,4]),i.lineDashOffset=-this.t,i.moveTo(e[0].x,e[0].y);for(var s=1;s<e.length;++s)i.lineTo(e[s].x,e[s].y);i.stroke(),i.setLineDash([0,0]),i.beginPath(),i.lineWidth=.3,i.strokeStyle="#000000",i.setLineDash([4,8]),i.lineDashOffset=-this.t,i.moveTo(e[0].x,e[0].y);for(var o=1;o<e.length;++o)i.lineTo(e[o].x,e[o].y);i.stroke(),i.setLineDash([0,0])}},{key:"drawPathPoint",value:function(t,i,e){t.fillStyle="rgba(255,0,0,0.6)",t.beginPath(),t.arc(i.x,i.y,2.5,0,6.28),t.closePath(),t.fill(),t.stroke()}},{key:"drawCircle",value:function(t,i,e,n){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,2,0,6.28),t.closePath(),t.fill(),t.stroke()}},{key:"IsOrient",get:function(){return this.isOriented},set:function(t){this.isOriented=t,this.ShiftOriented(t)}}]),t}();H.mouse=new b.h9(100,100,0),H.width=400,H.height=400,H.showForces=!1,H.instance=void 0;var W=function(){function t(i){(0,o.Z)(this,t),this.nnaEngine=void 0,this.analysis=void 0,this.graphCore=void 0,this.renderGraph=void 0,this.nnaEngine=i,this.analysis=new T(this),this.graphCore=new z(this),this.renderGraph=new j(this)}return(0,a.Z)(t,[{key:"initGraph",value:function(t){this.graphCore.initGraph(t)}},{key:"setUnit",value:function(t){this.graphCore.setUnit(t)}},{key:"computePath",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.graphCore.computePath(t,i,e)}},{key:"render",value:function(t,i){this.renderGraph.render(t,i)}},{key:"mouseClick",value:function(t,i){this.initTwoPoint();var e=this.graphCore.graph.FindClosestNode(this.renderGraph.start);e&&this.graphCore.graph.updatePropagationByNode(e,(function(t,i){return.5*i.point.distanceTo(t.point)}),.02)}},{key:"getPath",value:function(t,i){this.renderGraph.getPath(t,i)}},{key:"initByCPoints",value:function(t){for(var i=[],e=0;e<t.length;++e){var n=this.graphCore.graph.FindClosestNode(t[e].v);i.push(n)}this.graphCore.graph.updatePropagationByNodes(i,O,.02)}},{key:"initByCPointsBackpro",value:function(t){for(var i=[],e=0;e<t.length;++e)i.push(t[e].v);var n=this.graphCore.graph.updateBackpropagation(i);this.renderGraph.path=n}},{key:"initByCPoint",value:function(t){if(t.length>0){for(var i=t[0].v,e=[],n=1;n<t.length;++n)e.push(t[n].v);var s=this.graphCore.graph.FindClosestNode(i);if(this.renderGraph.start=s.point,s){this.graphCore.graph.updatePropagationByNode(s,O,.02);var o=this.graphCore.graph.updateBackpropagation(e);this.renderGraph.path=o,this.initAgentVis()}}}},{key:"initAgentVis",value:function(){var t;this.renderGraph.path[0]&&void 0===this.renderGraph.BoidsBehaviors&&(this.renderGraph.BoidsBehaviors=new H(500,500),null===(t=this.renderGraph.BoidsBehaviors)||void 0===t||t.InitPathByNode(this.renderGraph.path[0],10))}},{key:"initTwoPoint",value:function(){var t=this.graphCore.graph.maxPt.x-this.graphCore.graph.minPt.x,i=this.graphCore.graph.maxPt.y-this.graphCore.graph.minPt.y;this.graphCore.graph.minPt.x,Math.random(),this.graphCore.graph.minPt.y,Math.random();this.renderGraph.start=this.graphCore.graph.nodes[Math.floor((this.graphCore.graph.nodes.length-1)*Math.random())].point,this.graphCore.graph.minPt.x,Math.random(),this.graphCore.graph.minPt.y,Math.random(),this.renderGraph.end=this.graphCore.graph.nodes[Math.floor((this.graphCore.graph.nodes.length-1)*Math.random())].point}}]),t}(),Y=(0,a.Z)((function t(i){(0,o.Z)(this,t),this.nnaEngine=void 0,this.nnaEngine=i})),J=function(){function t(i){(0,o.Z)(this,t),this.app=void 0,this.agencySystem=void 0,this.graphSystem=void 0,this.voxelSystem=void 0,this.app=i,this.agencySystem=new N(this),this.graphSystem=new W(this),this.voxelSystem=new Y(this)}return(0,a.Z)(t,[{key:"initGraph",value:function(t){this.graphSystem.initGraph(t)}},{key:"setUnit",value:function(t){this.graphSystem.setUnit(t)}},{key:"computePath",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.graphSystem.computePath(t,i,e)}},{key:"render",value:function(t,i){this.graphSystem.render(t,i),this.agencySystem.render(t,i),t.fillStyle="#ffffff",t.font="12px Arial";var e=this.app.toMap(this.app.controller.m.x,this.app.controller.m.y);t.fillText("Lat: ".concat(e[0],", Lon: ").concat(e[1],", Zoom level: "),150,20)}}]),t}(),Q=function(){function t(i){(0,o.Z)(this,t),this.NNAEngineV3=void 0,this.NNAEngineV3=i}return(0,a.Z)(t,[{key:"importCSV",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(i){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(i).then((function(t){return t.text()})).then((function(t){return t})).catch((function(t){})));case 1:case"end":return t.stop()}}),t)})));return function(i){return t.apply(this,arguments)}}()}]),t}(),q=function(){function t(){(0,o.Z)(this,t),this.view=void 0,this.core=void 0,this.io=void 0,this.controller=void 0,this.data=void 0,this.lastCalledTime=Date.now(),this.fps=30,this.delta=1,this.controller=new S(this),this.view=new I(this),this.core=new J(this),this.io=new Q(this);(0,y.Mo)()}return(0,a.Z)(t,[{key:"toScreen",value:function(t,i){return[t,i]}},{key:"toMap",value:function(t,i){return[t,i]}},{key:"importDummyData",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://raw.githubusercontent.com/NamjuLee/data/master/NYC/NY_street_lat_long.csv";this.io.importCSV(i).then((function(i){t.data=new y.UO,t.data.ComputeCSV(i),t.data.initLines((function(i,e){return t.toScreen(i,e)})),t.core.graphSystem.initGraph(t.data.lineTest)}))}},{key:"updateProjection",value:function(t){this.toScreen=t.toScreen,this.toMap=t.toMap}},{key:"apiCall",value:function(t,i,e){this.controller.execution(t,i,e)}},{key:"initGraph",value:function(t){this.core.initGraph(t)}},{key:"reset",value:function(){this.view.reset()}},{key:"setUnit",value:function(t){this.core.setUnit(t)}},{key:"computePath",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.core.computePath(t,i,e)}},{key:"mouseEvent",value:function(t){this.controller.mouseEvent(t)}},{key:"keyEvent",value:function(t){}},{key:"render",value:function(t,i){this.core.render(t,i),this.ComputeFPS()}},{key:"ComputeFPS",value:function(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}}]),t}(),$=e(60136),tt=e(29388),it=function(){function t(i){(0,o.Z)(this,t),this.activeCommandController=void 0,this.type=k.NI.SELECT,this.activeCommandController=i}return(0,a.Z)(t,[{key:"mouseEvent",value:function(t){switch(t.type){case k.zK.LEFT:return void this.MouseLeftClickPre(t);case k.zK.MIDDLE:return void this.MouseMiddleClickPre(t);case k.zK.RIGHT:return void this.MouseRightClickPre(t);case k.zK.DOUBLE:return void this.MouseDoubleClickPre(t);case k.zK.MOVE:return void this.MouseMovePre(t);case k.zK.DRAG:return void this.MouseDragPre(t);case k.zK.DOWN:return void this.MouseDownPre(t);case k.zK.UP:return void this.MouseUpPre(t);case k.zK.WHEEL:return void this.MouseWheelPre(t)}}},{key:"MouseDown",value:function(t){}},{key:"MouseDownPre",value:function(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.MouseDown(t)}},{key:"MouseLeftClick",value:function(t){}},{key:"MouseLeftClickPre",value:function(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.activeCommandController.drawingEngine.scene.capture?this.activeCommandController.drawingEngine.scene.capture.isSelected=!this.activeCommandController.drawingEngine.scene.capture.isSelected:this.activeCommandController.drawingEngine.geometryCommon.resetSelections(),this.MouseLeftClick(t)}},{key:"MouseMiddleClick",value:function(t){}},{key:"MouseMiddleClickPre",value:function(t){this.MouseMiddleClick(t)}},{key:"MouseRightClick",value:function(t){}},{key:"MouseRightClickPre",value:function(t){this.MouseRightClick(t)}},{key:"MouseUp",value:function(t){}},{key:"MouseUpPre",value:function(t){this.activeCommandController.drawingEngine.scene.capture=void 0,this.MouseUp(t)}},{key:"MouseDoubleClick",value:function(t){}},{key:"MouseDoubleClickPre",value:function(t){this.MouseDoubleClick(t)}},{key:"MouseMove",value:function(t){}},{key:"MouseMovePre",value:function(t){this.activeCommandController.drawingEngine.geometryCommon.updateHover(t.x,t.y),this.MouseMove(t)}},{key:"MouseDrag",value:function(t){}},{key:"MouseDragPre",value:function(t){if(this.activeCommandController.drawingEngine.scene.capture){var i=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);this.activeCommandController.drawingEngine.scene.capture.translate(t.x,t.y,i[0],i[1])}this.MouseDrag(t)}},{key:"MouseWheel",value:function(t){}},{key:"MouseWheelPre",value:function(t){this.MouseWheel(t)}}]),t}(),et=function(){function t(i){(0,o.Z)(this,t),this.geometryBase=void 0,this.isCollided=!1,this.neighborShapes=[],this.minVec=void 0,this.maxVec=void 0,this.isVisited=!1,this.numOrder=-1,this.geometryBase=i;this.minVec=new b.h9(this.geometryBase.v.x-5,this.geometryBase.v.y-5,0),this.maxVec=new b.h9(this.geometryBase.v.x+5,this.geometryBase.v.y+5,0)}return(0,a.Z)(t,[{key:"Reset",value:function(){this.neighborShapes=[],this.numOrder=-1,this.geometryBase.numVisit=0,this.geometryBase.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}}]),t}(),nt=function(t){(0,$.Z)(e,t);var i=(0,tt.Z)(e);function e(t,n){var s;return(0,o.Z)(this,e),(s=i.call(this,t,n.x,n.y)).r=5,s.id=void 0,s.t=0,s.color="#00ff00",s.colorHover="#0ffff0",s.collision=void 0,s.type=k.mB.point,s.v=new b.h9(n.x,n.y,n.z),s}return(0,a.Z)(e,[{key:"translate",value:function(t,i,e,n){this.v.x=t,this.v.y=i,this.v.long=e,this.v.lat=n}},{key:"isInside",value:function(t,i){return(0,b.tl)(this.v.x,this.v.y,t,i)<this.r+3?(this.isHover=!0,!0):(this.isHover=!1,!1)}},{key:"update",value:function(t,i){if(t&&this.scene.drawingEngine.projection.isCustom){var e=i(this.v.long,this.v.lat);this.v.x=e[0],this.v.y=e[1]}}},{key:"toJson",value:function(){return{x:this.v.x,y:this.v.y}}},{key:"renderPost",value:function(t,i){var e=this.r+Math.sin(this.t);this.isHover?(e+=3,t.fillStyle=this.colorHover):t.fillStyle=this.color,t.beginPath(),t.arc(this.v.x,this.v.y,e,0,2*Math.PI),t.closePath(),t.fill(),this.isSelected&&(t.lineWidth=3,t.strokeStyle="#ffffff",t.stroke()),this.t+=.06}}]),e}(function(){function t(i,e,n){(0,o.Z)(this,t),this.scene=void 0,this.v=void 0,this.type=void 0,this.id="",this.numVisit=0,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.collision=void 0,this.scene=i,this.v=new b.h9(e,n,0),this.id=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var e=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===i?e:3&e|8).toString(16)}))}(),this.collision=new et(this)}return(0,a.Z)(t,[{key:"toJson",value:function(){return{}}},{key:"translate",value:function(t,i,e,n){}},{key:"isInside",value:function(t,i){return!1}},{key:"update",value:function(t,i){}},{key:"render",value:function(t,i){}},{key:"renderPost",value:function(t,i){}}]),t}()),st=function(t){(0,$.Z)(e,t);var i=(0,tt.Z)(e);function e(t){var n;return(0,o.Z)(this,e),(n=i.call(this,t)).type=k.NI.SELECT,n}return(0,a.Z)(e,[{key:"MouseLeftClick",value:function(t){}}]),e}(it),ot=function(t){(0,$.Z)(e,t);var i=(0,tt.Z)(e);function e(t){var n;return(0,o.Z)(this,e),(n=i.call(this,t)).type=k.NI.POINT,n}return(0,a.Z)(e,[{key:"MouseLeftClick",value:function(t){var i=new nt(this.activeCommandController.drawingEngine.scene,{x:t.x,y:t.y,z:0}),e=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);i.v.long=e[0],i.v.lat=e[1],this.activeCommandController.drawingEngine.scene.addGeometry(i),this.activeCommandController.hasShift||this.activeCommandController.drawingEngine.setCommand()}}]),e}(it),at=function(t){(0,$.Z)(e,t);var i=(0,tt.Z)(e);function e(t){var n;return(0,o.Z)(this,e),(n=i.call(this,t)).type=k.NI.LINE,n}return(0,a.Z)(e,[{key:"MouseLeftClick",value:function(t){}}]),e}(it),ht=e(59475),rt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.activeCommand=void 0,this.commands={},this.hasShift=!1,this.inspection=!1,this.drawingEngine=i,this.commands={SELECT:new st(this),POINT:new ot(this),LINE:new at(this)},this.activeCommand=this.commands[k.NI.SELECT]}return(0,a.Z)(t,[{key:"setCommander",value:function(t){switch(t){case k.NI.SELECT:case k.NI.POINT:case k.NI.LINE:this.activeCommand=this.commands[t]}}},{key:"apiCall",value:function(t){switch(t){case"getSelectedCPoint":return this.drawingEngine.geometryCommon.getSelCPoint();case"importZipData":return this.popZipData();case"importClustering":return this.drawingEngine.addon.InitClustering();case"importClusteringCollision":return this.drawingEngine.addon.InitClusteringCollision();case"save":return this.drawingEngine.geometryCommon.toJson()}}},{key:"popZipData",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(){var i,e,s,o,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ht.rd)("https://raw.githubusercontent.com/NamjuLee/data/master/US/zip.json");case 2:i=t.sent,e=0,s=(0,U.Z)(i.pos),t.prev=5,s.s();case 7:if((o=s.n()).done){t.next=15;break}if(a=o.value,this.greatePointByGeoPos(a[0],a[1]).t+=10*Math.random(),!(e++>2e3)){t.next=13;break}return t.abrupt("return");case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),s.e(t.t0);case 20:return t.prev=20,s.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[5,17,20,23]])})));return function(){return t.apply(this,arguments)}}()},{key:"greatePointByGeoPos",value:function(t,i){var e=this.drawingEngine.projection.toScreen(t,i),n=new nt(this.drawingEngine.scene,{x:e[0],y:e[1],z:0});return n.v.long=t,n.v.lat=i,this.drawingEngine.scene.addGeometry(n),n}}]),t}(),lt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.isCustom=!1,this.drawingEngine=i}return(0,a.Z)(t,[{key:"updateProjection",value:function(t){this.toMap=t.toMap,this.toScreen=t.toScreen,this.isCustom=!0}},{key:"toScreen",value:function(t,i){return[t,i]}},{key:"toMap",value:function(t,i){return[t,i]}}]),t}(),dt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.firebaseConfig={apiKey:"AIzaSyA1yKg85WGZoshbk8xR23cXr3SwpqXVgIc",authDomain:"njs-data.firebaseapp.com",projectId:"njs-data",storageBucket:"njs-data.appspot.com",messagingSenderId:"635991152770",appId:"1:635991152770:web:722f5356e0d14cea50fc9b"},this.getData=function(t){var i=t.val();for(var e in i);},this.getError=function(t){console.error(t)},this.drawingEngine=i}return(0,a.Z)(t,[{key:"sendData",value:function(t){}}]),t}(),ct=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.drawingEngine=i}return(0,a.Z)(t,[{key:"find",value:function(t,i){for(var e in this.drawingEngine.scene.geoDict)if(this.drawingEngine.scene.geoDict[e].isInside(t,i))return this.drawingEngine.scene.geoDict[e]}},{key:"resetSelections",value:function(){for(var t=0;t<this.drawingEngine.scene.geometryList.length;++t)this.drawingEngine.scene.geometryList[t].isSelected=!1}},{key:"getAllVecFromCPoint",value:function(){for(var t=[],i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i].v);return t}},{key:"getAllFromCPoint",value:function(){for(var t=[],i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i]);return t}},{key:"getSelCPoint",value:function(){for(var t=[],i=0;i<this.drawingEngine.scene.pointList.length;++i)this.drawingEngine.scene.pointList[i].isSelected&&t.push(this.drawingEngine.scene.pointList[i]);return t}},{key:"updateHover",value:function(t,i){for(var e=0;e<this.drawingEngine.scene.geometryList.length;++e)this.drawingEngine.scene.geometryList[e].isInside(t,i)}},{key:"toJson",value:function(){for(var t=[],i=0;i<this.drawingEngine.scene.geometryList.length;++i)t.push(this.drawingEngine.scene.geometryList[i].toJson());return t}}]),t}(),ut=e(92522),vt=e(43891),pt=function(){function t(i,e){(0,o.Z)(this,t),this.renderer=void 0,this.points=void 0,this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new vt.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new vt.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.minVec=void 0,this.maxVec=void 0,this.vec=new vt.h9(0,0,0),this.t=1,this.GridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=i,this.points=e;for(var n=0;n<this.points.length;++n)this.vec.x+=this.points[n].v.x,this.vec.y+=this.points[n].v.y,this.UpdateBoundingBox(this.points[n].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new vt.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new vt.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}return(0,a.Z)(t,[{key:"IsInside",value:function(t){return(0,vt.TE)(this.vec,t)<this.r1?(this.isHover=!0,!0):(this.isHover=!1,!1)}},{key:"AddPost",value:function(t){if(!this.points.includes(t)){this.points.push(t),this.vec=new vt.h9(0,0,0);for(var i=0;i<this.points.length;++i)this.vec.x+=this.points[i].v.x,this.vec.y+=this.points[i].v.y,this.UpdateBoundingBox(this.points[i].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new vt.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new vt.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}},{key:"NeedDecompose",value:function(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.GridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.GridResolution}},{key:"Split",value:function(){this.DeepRemove();var t=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution,i=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution,e=this.buildGrid(t,i);this.BuildSubCluster(e,t,i)}},{key:"Merge",value:function(t){this.points.concat(t.points),this.vec=new vt.h9(0,0,0);for(var i=0;i<this.points.length;++i)this.vec.x+=this.points[i].v.x,this.vec.y+=this.points[i].v.y,this.UpdateBoundingBox(this.points[i].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new vt.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new vt.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),t.DeepRemove()}},{key:"DeepRemove",value:function(){this.renderer.RemoveCluster(this)}},{key:"buildGrid",value:function(t,i){this.tempGeoGridList=[];for(var e=[],n=0;n<i;++n){for(var s=this.boundingBoxMin.y+n*this.GridResolution,o=[],a=0;a<t;++a){var h=this.boundingBoxMin.x+a*this.GridResolution;e.push(new vt.h9(h,s));o.push([])}this.tempGeoGridList.push(o)}return this.tempVecGridList=e,e}},{key:"BuildSubCluster",value:function(i,e,n){for(var s=0;s<this.points.length;++s)this.GetCellAtPoint(this.points[s].v,e,n).push(this.points[s]);for(var o=0;o<this.tempGeoGridList.length;++o)for(var a=0;a<this.tempGeoGridList[o].length;++a)this.tempGeoGridList[o][a]&&(1===this.tempGeoGridList[o][a].length?this.tempGeoGridList[o][a][0].collision.Reset():this.tempGeoGridList[o][a].length>1&&this.renderer.clustersRPoint.push(new t(this.renderer,this.tempGeoGridList[o][a])))}},{key:"GetCellAtPoint",value:function(t,i,e){var n=new vt.h9(t.x-this.boundingBoxMin.x,t.y-this.boundingBoxMin.y),s=Math.round(n.x/this.GridResolution),o=Math.round(n.y/this.GridResolution);return s>=i&&(s=i-1),o>=e&&(o=e-1),s<0&&(s=0),o<0&&(o=0),s=Math.round(s),o=Math.round(o),this.tempGeoGridList[o][s]}},{key:"Draw",value:function(t,i,e){if(this.UpdateTimeer(),e){this.vec=new vt.h9(0,0,0),this.boundingBoxMin=new vt.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new vt.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(var n=0;n<this.points.length;++n)this.vec.x+=this.points[n].v.x,this.vec.y+=this.points[n].v.y,this.UpdateBoundingBox(this.points[n].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new vt.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new vt.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(i.optimizer.inspection&&(t.beginPath(),t.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),t.closePath(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(),t.lineWidth=.5,t.beginPath(),t.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),t.closePath(),t.stroke(),this.tempVecGridList.length>0))for(var s=0;s<this.tempVecGridList.length;++s)t.beginPath(),t.rect(this.tempVecGridList[s].x,this.tempVecGridList[s].y,this.GridResolution,this.GridResolution),t.closePath(),t.stroke()}},{key:"UpdateTimeer",value:function(){this.t-=.1,this.t=this.t<.4?.4:this.t}},{key:"UpdateBoundingBox",value:function(t){this.boundingBoxMin.x=t.x<this.boundingBoxMin.x?t.x:this.boundingBoxMin.x,this.boundingBoxMin.y=t.y<this.boundingBoxMin.y?t.y:this.boundingBoxMin.y,this.boundingBoxMax.x=t.x>this.boundingBoxMax.x?t.x:this.boundingBoxMax.x,this.boundingBoxMax.y=t.y>this.boundingBoxMax.y?t.y:this.boundingBoxMax.y}}]),t}(),gt=function(){function t(i){(0,o.Z)(this,t),this.clustersRPoint=[],this.optimizer=void 0,this.optimizer=i}return(0,a.Z)(t,[{key:"InitGeometry",value:function(){this.clustersRPoint=[]}},{key:"addClusterByGeometries",value:function(t){for(var i=0;i<t.length;++i)this.clustersRPoint.push(new pt(this,t[i]))}},{key:"RemoveCluster",value:function(t){this.clustersRPoint.splice(this.clustersRPoint.indexOf(t),1)}},{key:"Render",value:function(t,i){if(this.clustersRPoint.length>0)for(var e=0;e<this.clustersRPoint.length;++e)this.clustersRPoint[e].Draw(t,this,i)}}]),t}(),ft=e(93433),yt=function(){function t(i){(0,o.Z)(this,t),this.optimizer=void 0,this.pointList=[],this.optimizer=i}return(0,a.Z)(t,[{key:"update",value:function(){this.updatePoints(),this.pointList=this.BuildConnectivity(this.pointList),this.initGeometry();var t=this.buildGraph(this.pointList);if(void 0!==t){this.addClusterByGeometries(t),this.PostUpdateCollisionBasedonGraph();var i=this.NeedDecompose();i.length>0&&(this.SplitClusters(i),this.PostMergeCluster())}}},{key:"initGeometry",value:function(){this.optimizer.renderer.InitGeometry()}},{key:"addClusterByGeometries",value:function(t){this.optimizer.renderer.addClusterByGeometries(t)}},{key:"updatePoints",value:function(){this.pointList=[];for(var t=0;t<this.optimizer.points.length;++t)if(!this.optimizer.points[t].isHidden&&this.optimizer.points[t].isRenderable){var i=this.optimizer.points[t];i.collision.Reset(),this.pointList.push(i)}}},{key:"BuildConnectivity",value:function(t){for(var i=0;i<t.length;++i)for(var e=t[i],n=i+1;n<t.length;++n){var s=t[n];!s.isCollapse&&s!==e&&(0,vt.Y4)([e.collision.minVec,e.collision.maxVec],[s.collision.minVec,s.collision.maxVec])&&(e.collision.isCollided=!0,e.isCollapse=!0,e.numVisit=0,e.collision.neighborShapes.push(s),s.collision.isCollided=!0,s.isCollapse=!0,s.numVisit=0,s.collision.neighborShapes.push(e))}return t}},{key:"buildGraph",value:function(t){for(var i=[],e=0;e<t.length;++e){var n=[],s=[t[e]];s[0].collision.isVisited=!0,n.push(s[0]);for(var o=0,a=void 0;void 0!==(a=s.shift());){for(var h=0;h<a.collision.neighborShapes.length;++h)a.collision.neighborShapes[h].collision.isVisited||(a.collision.neighborShapes[h].collision.isVisited=!0,s.push(a.collision.neighborShapes[h]),n.push(a.collision.neighborShapes[h]));if(o++>1e3)return void console.debug("fail to optimize")}n.length>1&&i.push(n)}return i}},{key:"PostUpdateCollisionBasedonGraph",value:function(){for(var t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.UpdateByQueue(this.optimizer.renderer.clustersRPoint[t],this.pointList)}},{key:"UpdateByQueue",value:function(t,i){for(var e=0,n=(0,ft.Z)(i);n.length;){var s=n.shift();if(s){if(s.numVisit>100){s.numVisit=0;break}if(0===n.length&&i.length<e++)break;s.collision.isCollided||((0,vt.Y4)([s.collision.minVec,s.collision.maxVec],[t.minVec,t.maxVec])?(s.collision.isCollided=!0,s.isCollapse=!0,s.numVisit=0,t.AddPost(s)):(s.numVisit++,n.push(s)))}}}},{key:"NeedDecompose",value:function(){for(var t=[],i=0;i<this.optimizer.renderer.clustersRPoint.length;++i)this.optimizer.renderer.clustersRPoint[i].NeedDecompose()&&t.push(this.optimizer.renderer.clustersRPoint[i]);return t}},{key:"SplitClusters",value:function(t){for(var i=0;i<t.length;++i)t[i].Split()}},{key:"PostMergeCluster",value:function(){this.PostMergeClusterCompute(this.optimizer.renderer.clustersRPoint)}},{key:"PostMergeClusterCompute",value:function(t){for(var i=0;i<t.length-1;++i)for(var e=t[i],n=i+1;n<t.length;++n){var s=t[n];s.isVisited||(0,vt.TE)(e.vec,s.vec)<e.r1+20&&(s.isVisited=!0,e.Merge(s))}}}]),t}(),mt=function(){function t(){(0,o.Z)(this,t),this.graphClustering=void 0,this.renderer=void 0,this.mv=new vt.h9(0,0),this.inspection=!0,this.points=[],this.graphClustering=new yt(this),this.renderer=new gt(this)}return(0,a.Z)(t,[{key:"push",value:function(t){this.points=t,this.update()}},{key:"mouseInteraction",value:function(t,i){}},{key:"update",value:function(){this.graphClustering.update()}},{key:"getCellAtPoint",value:function(t){}},{key:"render",value:function(t,i){this.renderer.Render(t,i)}}]),t}(),xt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.clustering=void 0,this.clusteringCollsionBasedGraph=void 0,this.drawingEngine=i}return(0,a.Z)(t,[{key:"InitClustering",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(){var i=this;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.resolve().then(e.bind(e,92522)).then((function(t){var e=t.Clustering,n=i.drawingEngine.geometryCommon.getAllVecFromCPoint();i.clustering=new e(ut.OPTIMIZER.GRID),i.clustering.optimizer.rx=9,i.clustering.optimizer.ry=5,i.clustering.push(n,i.drawingEngine.renderer.ctx.canvas.width,i.drawingEngine.renderer.ctx.canvas.height)})).catch((function(t){})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"InitClusteringCollision",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(){var i=this;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.resolve().then(e.bind(e,92522)).then((function(t){t.Clustering;var e=i.drawingEngine.geometryCommon.getAllFromCPoint();i.clusteringCollsionBasedGraph=new mt,i.clusteringCollsionBasedGraph.push(e)})).catch((function(t){})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"mouseInteraction",value:function(t){var i;switch(t.type){case k.zK.LEFT:case k.zK.MIDDLE:case k.zK.RIGHT:case k.zK.DOUBLE:break;case k.zK.MOVE:null===(i=this.clustering)||void 0===i||i.mouseInteraction(t.x,t.y);case k.zK.DRAG:case k.zK.DOWN:case k.zK.UP:case k.zK.WHEEL:}}},{key:"render",value:function(t,i){var e,n;null===(e=this.clustering)||void 0===e||e.render(t,i,this.drawingEngine.renderer.ctx.canvas.width,this.drawingEngine.renderer.ctx.canvas.height),null===(n=this.clusteringCollsionBasedGraph)||void 0===n||n.render(t,i)}}]),t}(),wt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this.lastCalledTime=Date.now(),this.delta=1,this.fps=30,this.ctx=void 0,this.drawingEngine=i}return(0,a.Z)(t,[{key:"render",value:function(t,i){this.ctx=t,this.update(i),this.renderPost(t,i)}},{key:"update",value:function(t){for(var i in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[i].update(t,this.drawingEngine.projection.toScreen)}},{key:"renderPost",value:function(t,i){for(var e in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[e].renderPost(t,i);this.ComputeFPS()}},{key:"ComputeFPS",value:function(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}}]),t}(),kt=function(){function t(i){(0,o.Z)(this,t),this.drawingEngine=void 0,this._capture=void 0,this.geometryList=[],this.pointList=[],this.geoDict={},this.drawingEngine=i}return(0,a.Z)(t,[{key:"capture",get:function(){return this._capture},set:function(t){this.drawingEngine.ableToPan=!t,this._capture=t}},{key:"addGeometry",value:function(t){this.geoDict[t.id]=t,this.geometryList.push(t),t.type===k.mB.point&&this.pointList.push(t)}}]),t}(),Ct=function(){function t(){(0,o.Z)(this,t),this.activeCommand=void 0,this.projection=void 0,this.geometryCommon=void 0,this.scene=void 0,this.addon=void 0,this.renderer=void 0,this.io=void 0,this._ableToPan=!0,this.io=new dt(this),this.addon=new xt(this),this.projection=new lt(this),this.geometryCommon=new ct(this),this.activeCommand=new rt(this),this.scene=new kt(this),this.renderer=new wt(this)}return(0,a.Z)(t,[{key:"apiCall",value:function(t){return this.activeCommand.apiCall(t)}},{key:"updateProjection",value:function(t){this.projection.updateProjection(t)}},{key:"setCommand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SELECT";this.activeCommand.setCommander(t)}},{key:"mouseEvent",value:function(t){this.activeCommand.activeCommand.mouseEvent(t),this.addon.mouseInteraction(t)}},{key:"keyEvent",value:function(t){}},{key:"render",value:function(t,i){this.renderer.render(t,i),this.addon.render(t,i)}},{key:"ableToPan",set:function(t){this._ableToPan=t,this.bindAbleToPan(t)}},{key:"bindAbleToPan",value:function(t){}}]),t}(),Pt=function(){function t(i){(0,o.Z)(this,t),this.njsSandbox=void 0,this.drawingEngine=void 0,this.nna=void 0,this.njsSandbox=i}return(0,a.Z)(t,[{key:"initBinding",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(){var i=this;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.njsSandbox.win=new l(this.njsSandbox.div,"NNA Engine V4 by NJSTUDIO",1200,600),t.next=3,new w(this.njsSandbox.win.getContext());case 3:this.njsSandbox.env=t.sent,this.drawingEngine=new Ct,this.drawingEngine.updateProjection({toMap:function(t,e){return i.njsSandbox.env.projection.ToMap(t,e)},toScreen:function(t,e){return i.njsSandbox.env.projection.ToScreen(t,e)}}),this.drawingEngine.bindAbleToPan=function(t){i.njsSandbox.env.ableToPan=t},this.njsSandbox.env.appendEventListener({mouse:function(t){return i.drawingEngine.mouseEvent(t)},keyboard:function(t){return i.drawingEngine.keyEvent(t)}}),this.nna=new q,this.nna.updateProjection({toMap:function(t,e){return i.njsSandbox.env.projection.ToMap(t,e)},toScreen:function(t,e){return i.njsSandbox.env.projection.ToScreen(t,e)}}),this.njsSandbox.env.appendEventListener({mouse:function(t){return i.nna.mouseEvent(t)},keyboard:function(t){return i.nna.keyEvent(t)}}),this.njsSandbox.env.appendRenderer((function(t,e){return i.nna.render(t,e)})),this.njsSandbox.env.appendRenderer((function(t,e){return i.drawingEngine.render(t,e)})),this.njsSandbox.win.addIconLeftPanel({text:"save",callBack:function(){return i.drawingEngine.setCommand("save")}}),this.njsSandbox.win.addIconLeftPanel({text:"load",callBack:function(){return i.drawingEngine.setCommand("load")}}),this.njsSandbox.win.addIconLeftPanel({text:"Select",callBack:function(){return i.drawingEngine.setCommand("SELECT")}}),this.njsSandbox.win.addIconLeftPanel({text:"Point",callBack:function(){return i.drawingEngine.setCommand("POINT")}}),this.njsSandbox.win.addIconLeftPanel({text:"Line",callBack:function(){return i.drawingEngine.setCommand("LINE")}}),this.njsSandbox.win.addIconLeftPanel({text:"Polyl",callBack:function(){return i.drawingEngine.setCommand("POLYLINE")}}),this.njsSandbox.win.addIconLeftPanel({text:"Circle",callBack:function(){return i.drawingEngine.setCommand("CIRCLE")}}),this.njsSandbox.win.addIconLeftPanel({text:"Rect",callBack:function(){return i.drawingEngine.setCommand("RECTANGLE")}}),this.njsSandbox.win.addIconLeftPanel({text:"ZipData",callBack:function(){return i.drawingEngine.apiCall("importZipData")}}),this.njsSandbox.win.addIconLeftPanel({text:"clusterGrid",callBack:function(){return i.drawingEngine.apiCall("importClustering")}}),this.njsSandbox.win.addIconLeftPanel({text:"clusterCol",callBack:function(){return i.drawingEngine.apiCall("importClusteringCollision")}}),this.njsSandbox.win.addIconTopPanel({text:"import",width:60,callBack:function(){return i.nna.importDummyData()}}),this.njsSandbox.win.addIconTopPanel({text:"Origin",width:60,callBack:function(){i.nna.apiCall(y.lw.NETWORK,"addOrigins",i.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Destination",width:90,callBack:function(){i.nna.apiCall(y.lw.NETWORK,"addDestinations",i.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Agent",width:90,callBack:function(){i.nna.apiCall(y.lw.AGENCY,"runAgent",void 0)}}),this.njsSandbox.win.addIconTopPanel({text:"pathOpti",width:90,callBack:function(){i.nna.apiCall(y.lw.GA,"pathOptimization",i.drawingEngine.apiCall("getSelectedCPoint"))}}),this.njsSandbox.win.addIconTopPanel({text:"Inspection",width:90,callBack:function(){i.nna.controller.inspection=!i.nna.controller.inspection,i.drawingEngine.activeCommand.inspection=!i.drawingEngine.activeCommand.inspection}}),this.njsSandbox.win.addIconTopPanel({text:"Capture",width:60,callBack:function(){return i.nna.apiCall(y.lw.NETWORK,"capture",void 0)}}),this.njsSandbox.win.addIconTopPanel({text:"Download",width:60,callBack:function(){return i.nna.apiCall(y.lw.NETWORK,"download",void 0)}});case 32:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()},92522:function(t,i,e){e.r(i),e.d(i,{Clustering:function(){return c},OPTIMIZER:function(){return n}});var n,s=e(15671),o=e(43144),a=e(43891);!function(t){t.NONE="NONE",t.GRID="GRID",t.GRID_SCREEN="GRID_SCREEN",t.COLLISION="COLLISION",t.AGENT="AGENT"}(n||(n={}));var h=function(){function t(){(0,s.Z)(this,t),this.xInterval=0,this.yInterval=0,this.rx=9,this.ry=7,this.cells=[],this.points=[]}return(0,o.Z)(t,[{key:"update",value:function(t,i){this.initGrid(t,i)}},{key:"initGrid",value:function(t,i){this.cells=[],this.xInterval=t/(this.rx-1),this.yInterval=i/(this.ry-1);for(var e=0;e<this.ry;e++){for(var n=[],s=0;s<this.rx;s++)n.push(new r(this,s,e));this.cells.push(n)}for(var o=0;o<this.points.length;++o){var a=this.points[o];this.getCellAtPoint(a).push(a)}for(var h=0;h<this.ry;++h)for(var l=0;l<this.rx;++l)this.cells[h][l].points.length<2&&(this.cells[h][l].isRenderable=!1)}},{key:"getCellAtPoint",value:function(t){var i=Math.round(t.x/this.xInterval),e=Math.round(t.y/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}},{key:"render",value:function(t){for(var i=0;i<this.cells.length;i++)for(var e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t)}}]),t}(),r=function(){function t(i,e,n){(0,s.Z)(this,t),this.grid=void 0,this.r0=16,this.r1=24,this.vec=void 0,this.vecRender=void 0,this.xI=void 0,this.yI=void 0,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=i,this.xI=e,this.yI=n,this.vec=new a.h9(e*this.grid.xInterval,n*this.grid.yInterval)}return(0,o.Z)(t,[{key:"push",value:function(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new a.h9(0,0,0);for(var i=0;i<this.points.length;++i)this.vecRender.x+=this.points[i].x,this.vecRender.y+=this.points[i].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}},{key:"isRenderable",get:function(){return this._isRenderable},set:function(t){if(!t){for(var i=0;i<this.points.length;++i)this.points[i].isRenderable=!0;this.points=[]}this._isRenderable=t}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke(),this.isRenderable){if(i){this.vecRender=new a.h9(0,0,0);for(var e=0;e<this.points.length;++e)this.vecRender.x+=this.points[e].x,this.vecRender.y+=this.points[e].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}var n=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*n,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,n,0,2*Math.PI),t.closePath(),t.fill()}}}]),t}(),l=function(){function t(){(0,s.Z)(this,t),this.xInterval=0,this.yInterval=0,this.width=0,this.height=0,this.rx=9,this.ry=7,this.cells=[],this.points=[],this.minP=new a.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new a.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER)}return(0,o.Z)(t,[{key:"update",value:function(t,i){this.initGrid(t,i)}},{key:"initGrid",value:function(t,i){this.minP=new a.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new a.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(var e=0;e<this.points.length;++e){var n=this.points[e];this.minP.x>n.x&&(this.minP.x=n.x),this.minP.y>n.y&&(this.minP.y=n.y),this.minP.z>n.z&&(this.minP.z=n.z),this.maxP.x<n.x&&(this.maxP.x=n.x),this.maxP.y<n.y&&(this.maxP.y=n.y),this.maxP.z<n.z&&(this.maxP.z=n.z)}this.cells=[],this.width=this.maxP.x-this.minP.x,this.height=this.maxP.y-this.minP.y,this.xInterval=this.width/(this.rx-1),this.yInterval=this.height/(this.ry-1);for(var s=0;s<this.ry;s++){for(var o=[],h=0;h<this.rx;h++)o.push(new d(this,h,s));this.cells.push(o)}for(var r=0;r<this.points.length;++r){var l=this.points[r];this.getCellAtPoint(l).push(l)}for(var c=0;c<this.ry;++c)for(var u=0;u<this.rx;++u)this.cells[c][u].points.length<1&&(this.cells[c][u].isRenderable=!1)}},{key:"getCellAtPoint",value:function(t){var i=Math.round((t.x-this.minP.x)/this.xInterval),e=Math.round((t.y-this.minP.y)/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}},{key:"render",value:function(t){for(var i=0;i<this.cells.length;i++)for(var e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t);t.beginPath(),t.rect(this.minP.x,this.minP.y,this.maxP.x-this.minP.x,this.maxP.y-this.minP.y),t.stroke()}}]),t}(),d=function(){function t(i,e,n){(0,s.Z)(this,t),this.grid=void 0,this.r0=16,this.r1=24,this.vec=void 0,this.vecRender=void 0,this.xI=void 0,this.yI=void 0,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=i,this.xI=e,this.yI=n,this.vec=new a.h9(i.minP.x+e*this.grid.xInterval,i.minP.y+n*this.grid.yInterval)}return(0,o.Z)(t,[{key:"push",value:function(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new a.h9(0,0,0);for(var i=0;i<this.points.length;++i)this.vecRender.x+=this.points[i].x,this.vecRender.y+=this.points[i].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}},{key:"isRenderable",get:function(){return this._isRenderable},set:function(t){if(!t){for(var i=0;i<this.points.length;++i)this.points[i].isRenderable=!0;this.points=[]}this._isRenderable=t}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isRenderable)return t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),void t.stroke();if(i){this.vecRender=new a.h9(0,0,0);for(var e=0;e<this.points.length;++e)this.vecRender.x+=this.points[e].x,this.vecRender.y+=this.points[e].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}var n=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*n,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,n,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke()}}]),t}(),c=function(){function t(i){switch((0,s.Z)(this,t),this.optimizerType=void 0,this.optimizer=void 0,this.mv=new a.h9(0,0),this.inspection=!0,this.optimizerType=i,i){case n.GRID_SCREEN:this.optimizer=new h;break;case n.GRID:this.optimizer=new l}console.debug("clustering... v 0.1.5")}return(0,o.Z)(t,[{key:"push",value:function(t,i,e){this.optimizer.points=t,this.update(i,e)}},{key:"mouseInteraction",value:function(t,i){this.mv=this.optimizer.getCellAtPoint(new a.h9(t,i)).vec}},{key:"update",value:function(t,i){this.optimizer.update(t,i)}},{key:"render",value:function(t,i,e,n){i&&this.update(e,n),this.optimizer.render(t),this.mv&&(t.fillStyle="#00ff00",t.beginPath(),t.arc(this.mv.x,this.mv.y,9,0,6.28),t.closePath(),t.fill())}}]),t}()},43891:function(t,i,e){e.d(i,{TE:function(){return n.TE},Y4:function(){return n.Y4},h9:function(){return n.h9}});var n=e(26004)}}]);
//# sourceMappingURL=709.50f8e216.chunk.js.map