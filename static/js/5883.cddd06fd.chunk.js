"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[5883],{54078:function(t,e,i){i.d(e,{B:function(){return r}});var o=i(15671),s=i(43144),n=i(9936),r=function(){function t(e){(0,o.Z)(this,t),this.gl=void 0,this.program=void 0,this.fragmentShader=void 0,this.vertexShader=void 0,this.matrixLocation=void 0,this.posBuffer=void 0,this.colBuffer=void 0,this.vertexs=void 0,this.posLocAtt=void 0,this.colLocAtt=void 0,this.matLoc=void 0,this.colLoc=void 0,this.cVecLoc=void 0,this.mouseLoc=void 0,this.timeGL=void 0,this.vShader=void 0,this.fShader=void 0,this.v="\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    \n    varying vec4 f_color;\n\n    void main() {\n\n        vec2 mouse_distance = vec2(0,0) - (a_position.xy /vec2(2,2));\n        float red = 1.0 - length(mouse_distance);\n        f_color = vec4(a_position, 0, 1.0);\n    \n        // float dis = distance(vec2(a_position.xy), vec2(0,0));\n\n        // f_color = vec4(dis * 0.6, 0,0,1);\n        gl_Position = vec4( a_position, 0, 1);\n    }\n    ",this.f="\n    precision highp float;\n\n    varying vec4 f_color;\n    \n    void main() {\n        vec2 mouse_distance = vec2(0,0) - (f_color.xy /vec2(5,5));\n\n        float col =  length(mouse_distance*5.);\n        float val = 1.0 - length(mouse_distance*8.);\n        \n        gl_FragColor = vec4(0.19,0.19,0.19, col);\n\n    }\n    ",this.positionAttribLocation=void 0,this.colorAttribLocation=void 0,this.translation=void 0,this.color=void 0,this.colArray=void 0,this.gl=e,this.color=[Math.random(),Math.random(),Math.random(),1],this.InitShader()}return(0,s.Z)(t,[{key:"InitShader",value:function(){var t=n.Ui.CreateShader(this.gl,this.gl.VERTEX_SHADER,this.v),e=n.Ui.CreateShader(this.gl,this.gl.FRAGMENT_SHADER,this.f);if(t&&e){this.vShader=t,this.fShader=e;var i=n.Ui.CreateProgram(this.gl,t,e);i&&(this.program=i)}}},{key:"Render",value:function(t){var e=[.1,0,0,1];this.vertexs=new Float32Array([-1,-1,1,1,1,1,-1,1,e[0],e[1],e[2],e[3],1,-1,e[0],e[1],e[2],e[3],-1,1,1,1,1,1,1,-1,e[0],e[1],e[2],e[3],1,1,e[0],e[1],e[2],e[3]]),this.posBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.posBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertexs),t.STATIC_DRAW),this.posLocAtt=this.gl.getAttribLocation(this.program,"a_position");var i=t.FLOAT,o=6*Float32Array.BYTES_PER_ELEMENT,s=0;t.vertexAttribPointer(this.posLocAtt,2,i,!1,o,s),t.enableVertexAttribArray(this.posLocAtt),t.useProgram(this.program);var n=t.TRIANGLES;s=0;t.drawArrays(n,s,6)}}]),t}()},65883:function(t,e,i){i.r(e),i.d(e,{Solution:function(){return w}});var o=i(29439),s=i(15671),n=i(43144),r=i(97326),a=i(60136),h=i(29388),l=i(17760),c=i(38966),u=i(54078),v=i(87968),d=function(){function t(e){var i=this;(0,s.Z)(this,t),this.solution=void 0,this.streetOSM=[],this.routesTreated=[],this.routesControl=[],this.zones30=[],this.zones15=[],this.routesMain=[],this.meshTwitter=void 0,this.meshStreetOSM=void 0,this.meshNode=void 0,this.meshTreated=void 0,this.meshControl=void 0,this.meshMainStreet=void 0,this.meshZones30=void 0,this.meshPolygon=void 0,this.polygonRingID={},this.polygonRings=void 0,this.yearForPolygonMesh=void 0,this.selectedYear=2009,this.renderMultiPolygon=function(t,e,s){for(var n=[],r=[],a=0;a<e.length;++a)for(var h=e[a],c=0;c<h.length;++c){var u=h[c];if(1===u.length){for(var v=u[0],d=[],g=0;g<v.length;++g){var p=i.solution.projectionToMercator(v[g][0],v[g][1]),m=(0,o.Z)(p,2),f=m[0],y=m[1];r.push(f,0,y),d.push(new l.FM8(f,y))}var w=new l.oa8(new l.bnF(d)),_=new l.vBJ({side:l.ehD,color:65280,transparent:!0,opacity:.3}),A=new l.Kj0(w,_);t.add(A),n.push(A),A.rotateOnAxis(new l.Pa4(1,0,0),.5*Math.PI)}}return n},this.renderPoints=function(t,e){for(var s=new l.u9r,n=new l.UY4({vertexColors:!0,size:.5}),r=[],a=[],h=0;h<t.length;++h)for(var c=t[h],u=0;u<c.length;++u)for(var v=0;v<c[u].length;++v){var d=i.solution.projectionToMercator(c[u][v][0],c[u][v][1]),g=(0,o.Z)(d,2),p=g[0],m=g[1];r.push(p,0,m),a.push(e[0],e[1],e[2])}s.setAttribute("position",new l.a$l(r,3)),s.setAttribute("color",new l.a$l(a,3)),s.computeBoundingSphere();var f=new l.woe(s,n);return i.solution.scene.add(f),f},this.solution=e;var n="/static/research/slow-zone/";(0,v.getJSONFromURL)("/njs-lab-public"+n+"street_osm.geojson").then((function(t){for(var e=0;e<t.features.length;++e)i.streetOSM.push(t.features[e].geometry.coordinates);i.meshStreetOSM=i.LineSeg(i.streetOSM,[0,1,1]),i.solution.start()})),(0,v.getJSONFromURL)("/njs-lab-public"+n+"Paris-main-st.geojson").then((function(t){for(var e=0;e<t.features.length;++e)i.routesMain.push(t.features[e].geometry.coordinates);i.meshMainStreet=i.LineSeg(i.routesMain,[1,1,0])})),(0,v.getJSONFromURL)("/njs-lab-public"+n+"treated-st.geojson").then((function(t){for(var e=0;e<t.features.length;++e)i.routesTreated.push(t.features[e].geometry.coordinates);i.meshTreated=i.LineSeg(i.routesTreated,[1,0,0])})),(0,v.getJSONFromURL)("/njs-lab-public"+n+"control-st.geojson").then((function(t){for(var e=0;e<t.features.length;++e)i.routesControl.push(t.features[e].geometry.coordinates);i.meshControl=i.LineSeg(i.routesControl,[0,1,0])})),(0,v.getJSONFromURL)("/njs-lab-public"+n+"zones-30.geojson").then((function(t){for(var e=0;e<t.features.length;++e)i.zones30.push(t.features[e].geometry.coordinates);i.meshZones30=i.renderMultiPolygon(i.solution.scene,i.zones30,[0,1,0])})),(0,v.getJSONFromURL)("/njs-lab-public"+n+"zones_15_innerouter_byyr_rings.json").then((function(t){i.polygonRings=i.renderCustomPolygon(t),i.updateYear(i.selectedYear)}))}return(0,n.Z)(t,[{key:"updateYear",value:function(t){var e=this;if(this.selectedYear=t+1,void 0!==this.yearForPolygonMesh)for(var i=function(t){e.yearForPolygonMesh[t].forEach((function(i){t<e.selectedYear?i.visible=!0:i.visible=!1}))},o=2010;o<2016;++o)i(o)}},{key:"updateColor",value:function(t){var e=(0,v.hexToRGBANormalized)(t);if(void 0!==this.meshMainStreet&&this.solution.ui.isActiveMainStreet){var i=this.meshMainStreet.material;i.color.r=e[0],i.color.g=e[1],i.color.b=e[2]}if(void 0!==this.meshStreetOSM&&this.solution.ui.isActive_streetOSM){var o=this.meshStreetOSM.material;o.color.r=e[0],o.color.g=e[1],o.color.b=e[2]}if(void 0!==this.meshTreated&&this.solution.ui.isActive_treated_st){var s=this.meshTreated.material;s.color.r=e[0],s.color.g=e[1],s.color.b=e[2]}if(void 0!==this.meshControl&&this.solution.ui.isActive_control_st){var n=this.meshControl.material;n.color.r=e[0],n.color.g=e[1],n.color.b=e[2]}void 0!==this.meshZones30&&this.solution.ui.isActive_zones_30&&this.meshZones30.forEach((function(t){var i=t.material;i.color.r=e[0],i.color.g=e[1],i.color.b=e[2]})),void 0!==this.solution.dataTwitter&&this.solution.ui.isActive_twitter&&this.solution.dataTwitter.updateColor(e[0],e[1],e[2])}},{key:"update",value:function(){void 0!==this.meshMainStreet&&(this.solution.ui.isActiveMainStreet?this.meshMainStreet.visible=!0:this.meshMainStreet.visible=!1),void 0!==this.meshStreetOSM&&(this.solution.ui.isActive_streetOSM?this.meshStreetOSM.visible=!0:this.meshStreetOSM.visible=!1),void 0!==this.meshTreated&&(this.solution.ui.isActive_treated_st?this.meshTreated.visible=!0:this.meshTreated.visible=!1),void 0!==this.meshControl&&(this.solution.ui.isActive_control_st?this.meshControl.visible=!0:this.meshControl.visible=!1),void 0!==this.meshZones30&&(this.solution.ui.isActive_zones_30?this.meshZones30.forEach((function(t){t.visible=!0})):this.meshZones30.forEach((function(t){t.visible=!1}))),void 0!==this.solution.dataTwitter.mesh&&(this.solution.ui.isActive_twitter?this.solution.dataTwitter.mesh.visible=!0:this.solution.dataTwitter.mesh.visible=!1)}},{key:"renderCustomPolygon",value:function(t){for(var e={},i=0,s=Object.entries(t.yr);i<s.length;i++){var n=(0,o.Z)(s[i],2),r=n[0],a=n[1];a in e?e[a].push(+r):e[a]=[+r]}var h={};this.polygonRingID=e;for(var c=0,u=0,d=Object.entries(this.polygonRingID);u<d.length;u++){for(var g=(0,o.Z)(d[u],2),p=g[0],m=g[1],f=[],y=0;y<m.length;++y){for(var w=m[y],_=t.value_mn_rescale[w],A=[],S=0;S<t.outer_ring[w].length;++S){var b=this.solution.projectionToMercator(t.outer_ring[w][S][0],t.outer_ring[w][S][1]),M=(0,o.Z)(b,2),x=M[0],T=M[1];A.push(new v.Vector3(x,T))}for(var k=new l.bnF(A),C=0;C<t.inner_rings[w].length;++C){var R=new l.y$t,L=this.solution.projectionToMercator(t.inner_rings[w][C][0][0],t.inner_rings[w][C][0][1]),B=(0,o.Z)(L,2),Z=B[0],O=B[1];R.moveTo(Z,O);for(var F=1;F<t.inner_rings[w][C].length;++F){var E=this.solution.projectionToMercator(t.inner_rings[w][C][F][0],t.inner_rings[w][C][F][1]),P=(0,o.Z)(E,2),U=P[0],j=P[1];R.lineTo(U,j)}k.holes.push(R)}var N=new l.oa8(k),D=new l.Ilk(16777215);D.setRGB(_,0,0);var z=new l.vBJ({side:l.ehD,color:D,transparent:!0,opacity:1}),Y=new l.Kj0(N,z);Y.translateY(1e-4*c++),Y.visible=!0,this.solution.scene.add(Y),Y.rotateOnAxis(new l.Pa4(1,0,0),.5*Math.PI),f.push(Y)}h[p]=f}this.yearForPolygonMesh=h}},{key:"LineSeg",value:function(t,e){var i=new l.u9r,s=new l.nls;s.color.r=e[0],s.color.g=e[1],s.color.b=e[2];for(var n=[],r=[],a=[],h=0;h<t.length;++h)for(var c=t[h],u=0;u<c.length;++u)for(var v=0;v<c[u].length;++v){var d=this.solution.projectionToMercator(c[u][v][0],c[u][v][1]),g=(0,o.Z)(d,2),p=g[0],m=g[1];n.push(p,0,m),r.push(e[0],e[1],e[2]),v<c[u].length-1&&a.push(Math.floor(n.length/3)-1,Math.floor(n.length/3))}i.setIndex(a),i.setAttribute("position",new l.a$l(n,3)),i.setAttribute("color",new l.a$l(r,3)),i.computeBoundingSphere();var f=new l.ejS(i,s);return this.solution.scene.add(f),f}}]),t}(),g=i(48506),p=function(){function t(e){var i=this;(0,s.Z)(this,t),this.solution=void 0,this.active=!1,this.dataRaw=void 0,this.mesh=void 0,this.t=0,this.dataScale=1,this.colorScale=1,this.pos=void 0,this.color="#0ff",this.material=void 0,this.solution=e;var o="/njs-lab-public/static/research/slow-zone/real_data.json";g.x.url&&(o=g.x.url),(0,v.getJSONFromURL)(o).then((function(t){i.dataRaw=t,i.initMesh("noNeighbsLog")}))}return(0,n.Z)(t,[{key:"initMesh",value:function(t){for(var e=[],i=[],s=(this.dataRaw.meta["domain_"+t][0],0);s<this.dataRaw.cells.length;++s){var n=this.dataRaw.cells[s],r=this.solution.projectionToMercator(+n.lon,+n.lat),a=(0,o.Z)(r,2),h=a[0],c=a[1],u=+n[t],v=[u/=2,u,0];e.push(h,u*this.dataScale,c),i.push(v[0],v[1],v[2])}var d=new l.u9r,g=new l.UY4({vertexColors:!0,size:.5});this.material=g,this.pos=new Float32Array(e),d.setAttribute("position",new l.a$l(this.pos,3)),d.setAttribute("color",new l.a$l(i,3)),d.computeBoundingSphere(),this.mesh=new l.woe(d,g),this.solution.scene.add(this.mesh),this.active=!0}},{key:"updateColor",value:function(t,e,i){this.material.color.setRGB(t,e,i)}},{key:"updateMesh",value:function(t){this.active=!1,this.removeMesh(),this.initMesh(t)}},{key:"removeMesh",value:function(){this.solution.scene.remove(this.mesh)}},{key:"update",value:function(){this.active&&(this.t+=.05,this.updateAnimation())}},{key:"updateAnimation",value:function(){for(var t=this.mesh.geometry.attributes.position.count,e=0;e<t;e++){var i=this.mesh.geometry.attributes.position,o=i.getX(e),s=i.getZ(e),n=this.pos[3*e+1]*this.dataScale;n=(n*=1+Math.sin(o+n+this.t)*Math.cos(o+n+this.t))<.1?.1:n;var r=new l.Pa4(o,n,s);this.mesh.geometry.attributes.position.setXYZ(e,r.x,r.y,r.z);var a=n/this.colorScale;this.mesh.geometry.attributes.color.setXYZ(e,a,1-a,0)}this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.attributes.color.needsUpdate=!0,this.mesh.geometry.computeVertexNormals()}}]),t}(),m=function(){function t(e){(0,s.Z)(this,t),this.solution=void 0,this.hostDiv=void 0,this.isActiveMainStreet=!0,this.isActive_streetOSM=!1,this.isActive_treated_st=!1,this.isActive_control_st=!1,this.isActive_zones_30=!1,this.isActive_zones_buffer=!1,this.isActive_twitter=!1,this.year=2010,this.solution=e,this.hostDiv=e.hostDiv,void 0!==this.solution.PARAM.local_ui?!0===this.solution.PARAM.local_ui&&this.appendUI():this.appendUI()}return(0,n.Z)(t,[{key:"appendUI",value:function(){var t=this,e=document.createElement("div");e.style.position="absolute",this.hostDiv.append(e);var i=document.createElement("input");e.append(i),i.type="color",i.oninput=function(){t.solution.drawing.updateColor(i.value)};var o=f("main street");e.append(o.div),o.checkBox.checked=!0,o.checkBox.onchange=function(){!0===o.checkBox.checked?t.isActiveMainStreet=!0:t.isActiveMainStreet=!1};var s=f("OSM street");e.append(s.div),s.checkBox.onchange=function(){!0===s.checkBox.checked?t.isActive_streetOSM=!0:t.isActive_streetOSM=!1};var n=f("treated street");e.append(n.div),n.checkBox.onchange=function(){!0===n.checkBox.checked?t.isActive_treated_st=!0:t.isActive_treated_st=!1};var r=f("control street");e.append(r.div),r.checkBox.onchange=function(){!0===r.checkBox.checked?t.isActive_control_st=!0:t.isActive_control_st=!1};var a=f("zones 30");e.append(a.div),a.checkBox.onchange=function(){!0===a.checkBox.checked?t.isActive_zones_30=!0:t.isActive_zones_30=!1};var h=y("Year");h.div.style.marginTop="25px",h.text.textContent="Year: 2019",e.append(h.div),h.slider.oninput=function(){t.year=+h.slider.value,h.text.textContent="Year: "+h.slider.value,t.solution.drawing.updateYear(+h.slider.value)};var l=f("twitter data");l.div.style.marginTop="25px",e.append(l.div),l.checkBox.onchange=function(){!0===l.checkBox.checked?t.isActive_twitter=!0:t.isActive_twitter=!1};var c=y("Scale","1","10");c.text.textContent="Scale: 1",e.append(c.div),c.slider.defaultValue="1",c.slider.oninput=function(){t.year=+c.slider.value,c.text.textContent="Scale: "+c.slider.value,t.solution.dataTwitter.dataScale=+c.slider.value};var u=y("Color","1.","50.");u.text.textContent="Color: 1",e.append(u.div),u.slider.defaultValue="1",u.slider.oninput=function(){t.year=+u.slider.value,u.text.textContent="Color: "+u.slider.value,t.solution.dataTwitter.colorScale=+u.slider.value};var v=f("Animation");v.checkBox.defaultChecked=!0,e.append(v.div),v.checkBox.onchange=function(){!0===v.checkBox.checked?t.solution.dataTwitter.active=!0:t.solution.dataTwitter.active=!1,t.solution.dataTwitter.updateAnimation()};var d=document.createElement("select");for(var g in e.append(d),{noNeighbsLog:"noNeighbsLog",noNeighbsLogDensity:"noNeighbsLogDensity",noNeighbsRaw:"noNeighbsRaw",noNeighbsWins:"noNeighbsWins",noTwtsLog:"noTwtsLog",noTwtsLogDensity:"noTwtsLogDensity",noTwtsRaw:"noTwtsRaw",noTwtsWins:"noTwtsWins",noUsersLog:"noUsersLog",noUsersLogDensity:"noUsersLogDensity",noUsersRaw:"noUsersRaw",noUsersWins:"noUsersWins",treatmentCategory:"treatmentCategory"}){var p=document.createElement("option");p.value=g,p.textContent=g,d.appendChild(p)}d.onchange=function(e){t.solution.dataTwitter.updateMesh(e.target.value)}}}]),t}(),f=function(t){var e=document.createElement("div");e.style.display="flex";var i=document.createElement("input");i.type="checkbox";var o=document.createElement("div");return o.textContent=t,o.style.color="#aaa",e.appendChild(i),e.appendChild(o),{div:e,checkBox:i}},y=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2009",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2015",o=document.createElement("div");o.style.display="flex";var s=document.createElement("input");s.type="range",s.min=e,s.max=i;var n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",o.appendChild(s),o.appendChild(n),{div:o,slider:s,text:n}},w=function(t){(0,a.Z)(i,t);var e=(0,h.Z)(i);function i(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";(0,s.Z)(this,i),(t=e.call(this,o)).drawing=void 0,t.ui=void 0,t.meshAreaGon=void 0,t.meshPolygon2=void 0,t.pts=[],t.dataTwitter=void 0,t.xOFf=-15478803.88731685,t.yOFf=-4766681.448690384,t.scale=.01,t.PARAM=void 0;var n=c.P8.R7.getAllUrlParams();t.PARAM=JSON.parse(JSON.stringify(n)),t.drawing=new d((0,r.Z)(t)),t.dataTwitter=new p((0,r.Z)(t));var a=new l.cek(16777215,.8);t.camera.add(a),t.scene.add(a);var h=document.createElement("canvas");h.style.position="absolute",h.style.pointerEvents="none",h.style.mixBlendMode="darken",h.width=t.hostDiv.clientWidth,h.height=t.hostDiv.clientHeight,t.hostDiv.appendChild(h);var v=h.getContext("webgl"),g=new u.B(v,.5,5);return g.Render(v),t.ui=new m((0,r.Z)(t)),t.camera.position.set(0,100,100),t}return(0,n.Z)(i,[{key:"projectionToMercator",value:function(t,e){var i=(0,c._Y)(t,e),s=(0,o.Z)(i,2),n=s[0],r=s[1];return[(n+this.xOFf)*this.scale,(r+this.yOFf)*this.scale]}},{key:"update",value:function(t){var e;this.drawing.update(),null===(e=this.dataTwitter)||void 0===e||e.update()}}]),i}(c.TF)}}]);
//# sourceMappingURL=5883.cddd06fd.chunk.js.map