{"version":3,"file":"static/js/7105.56391816.chunk.js","mappings":"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","sources":["njslab/Tools/WaterQualityInspector/WaterQualityInspector.ts","njslab/Tools/WaterQualityInspector/index.ts"],"sourcesContent":["import { getCSVFromURL } from 'njscore';\r\n\r\nexport class WaterQualityInspector {\r\n    data = {};\r\n\r\n    day = 24;\r\n    scale = 1.0\r\n    offsetData = 4;\r\n    constructor() {\r\n\r\n        document.onkeydown = (k) => {\r\n            this.offsetData++;\r\n            console.log(this.offsetData)\r\n        }\r\n\r\n        getCSVFromURL(process.env.PUBLIC_URL + '/static/data/Watabot/obs_104_1928_d047_15c7.csv').then((d) => {\r\n            const lines = d.split(/\\r\\n|\\r|\\n/g);\r\n            const index = lines[0].split(',');\r\n\r\n            const dataDic = {}\r\n            let needComputeData = true;\r\n            for (let i = 0; i < index.length; ++i) {\r\n                console.log(index[i])\r\n                if (needComputeData && index[i] === 'time (UTC)') {\r\n                    dataDic[index[i]] = [];\r\n                    needComputeData = false;\r\n                } else {\r\n                    dataDic[index[i]] = new Float32Array(lines.length - 1)\r\n                }\r\n            }\r\n\r\n            for (let i = 1; i < lines.length; ++i) {\r\n                const row = lines[i].split(',');\r\n                for (let j = 0; j < index.length; ++j) {\r\n                    const theIndex = index.indexOf(index[j]);\r\n                    if (theIndex !== -1) {\r\n                        dataDic[index[j]][i - 1] = row[theIndex]\r\n                    }\r\n                }\r\n\r\n            }\r\n            this.data = dataDic;\r\n            console.log(dataDic)\r\n        });\r\n    }\r\n    public Offset(v) {\r\n        if (v < 0) {\r\n            // this.offsetData -= this.offsetData * 0.5;\r\n        } else {\r\n            // this.offsetData += this.offsetData * 0.5;\r\n        }\r\n    }\r\n    public wheel(e: WheelEvent) {\r\n        if (e.deltaY < 0) {\r\n            this.scale += this.scale * .25;\r\n        } else {\r\n            this.scale -= this.scale * .25;\r\n        }\r\n        this.scale = this.scale < 0.012 ? 0.012 : this.scale;\r\n        console.log(this.scale)\r\n    }\r\n\r\n    public render(ctx: CanvasRenderingContext2D) {\r\n        let d = this.data['sea_water_temperature (K)']; // sea_water_temperature (K) sea_water_turbidity (1)\r\n\r\n        dd(ctx, d, this.scale, this.day)\r\n\r\n        vizData(ctx, d, '#f00', this.scale, this.day, this.offsetData)\r\n\r\n        d = this.data['sea_water_turbidity (1)'];\r\n        vizData(ctx, d, '#0f0', this.scale, this.day, this.offsetData)\r\n\r\n        d = this.data['chlorophyll_fluorescence (RFU)'];\r\n        vizData(ctx, d, '#00f', this.scale, this.day, this.offsetData)\r\n\r\n        d = this.data['oxidation_reduction_potential (mV)'];\r\n        vizData(ctx, d, '#0ff', this.scale, this.day, this.offsetData)\r\n\r\n    }\r\n}\r\n\r\nconst dd = (ctx: CanvasRenderingContext2D, d, scale, day) => {\r\n    const hourRes = 12\r\n\r\n    for (let i = 0; i < d.length; i++) {\r\n\r\n        ctx.lineWidth = 0.5;\r\n        ctx.strokeStyle = `rgba(200, 200, 200, 1)`;\r\n        if (scale > 0.1) {\r\n            if (i % (hourRes * day) === 0) {\r\n                const x = i * scale;\r\n                ctx.beginPath();\r\n                ctx.moveTo(x, 0);\r\n                ctx.lineTo(x, ctx.canvas.height);\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeStyle = `rgba(0, 0, 255, 1)`;\r\n        if (scale > 0.02) {\r\n            if (i % (hourRes * day * 7) === 0) {\r\n                const x = i * scale;\r\n                ctx.beginPath();\r\n                ctx.moveTo(x, 0);\r\n                ctx.lineTo(x, ctx.canvas.height);\r\n                ctx.stroke();\r\n                // console.log(i)\r\n            }\r\n        }\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeStyle = `rgba(0, 255, 0, 1)`;\r\n        if (i % (hourRes * day * 30) === 0) {\r\n            const x = i * scale;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, 0);\r\n            ctx.lineTo(x, ctx.canvas.height);\r\n            ctx.stroke();\r\n            // console.log(i)\r\n        }\r\n    }\r\n};\r\n\r\nconst vizData = (ctx: CanvasRenderingContext2D, d, color, scale, day, offsetData) => {\r\n\r\n    ctx.lineWidth = 3;\r\n    ctx.strokeStyle = color;\r\n\r\n    ctx.beginPath();\r\n    let x = 0\r\n    ctx.moveTo(x, d[0])\r\n    for (let i = 1; i < d.length; i += offsetData) {\r\n        x += 1\r\n\r\n        const xP = x * scale * offsetData\r\n        let yP = 0;\r\n        let val = 0\r\n        let key = 'max' // max\r\n        switch (key) {\r\n            case 'mean':\r\n                for (let j = 0; j < offsetData; ++j) {\r\n                    val += d[i + j]\r\n                }\r\n\r\n                yP = val / offsetData;\r\n                ctx.lineTo(xP, yP)\r\n                break;\r\n            default:\r\n                for (let j = 0; j < offsetData; ++j) {\r\n                    if (val < d[i + j]) {\r\n                        val = d[i + j]\r\n                    }\r\n                }\r\n                yP = val // / offsetData;\r\n                ctx.lineTo(xP, yP)\r\n                break;\r\n        }\r\n\r\n        // console.log(i)\r\n    }\r\n    // console.log(x)\r\n    ctx.stroke();\r\n};","import { RendererCanvas, remap } from '../../../lib'\r\n\r\nimport { WaterQualityInspector } from './WaterQualityInspector';\r\n\r\nexport class Solution {\r\n    public divHost: HTMLElement;\r\n    public renderer: Renderer;\r\n    constructor(divHost: any) {\r\n        this.divHost = divHost;\r\n\r\n        // Center align\r\n        this.divHost.style.display = 'flex';\r\n        this.divHost.style.alignItems = 'center';\r\n\r\n        const div = document.createElement('div');\r\n        div.style.marginLeft = 'auto';\r\n        div.style.marginRight = 'auto';\r\n        div.style.backgroundColor = '#555';\r\n        div.style.width = '900px';\r\n        div.style.height = '500px';\r\n        this.divHost.appendChild(div);\r\n\r\n        this.renderer = new Renderer(div);\r\n\r\n    }\r\n    public destroy() {\r\n        this.renderer.destroy();\r\n        while (this.divHost.lastElementChild) {\r\n            this.divHost.removeChild(this.divHost.lastElementChild);\r\n        }\r\n    }\r\n}\r\n\r\nexport class Renderer extends RendererCanvas {\r\n    waterQualityInspector: WaterQualityInspector;\r\n    constructor(div: any) {\r\n        super(div);\r\n        this.canvas.style.position = 'relative';\r\n        this.canvas.style.width = '100%';\r\n        this.canvas.style.height = '100%';\r\n        this.canvas.style.background = '#fff';\r\n\r\n        // TODO\r\n        // You code goes here for one time operation\r\n        // \r\n\r\n        this.canvas.onwheel = (e) => {\r\n            // console.log(e.deltaY);\r\n            this.waterQualityInspector.wheel(e);\r\n        }\r\n\r\n\r\n        this.waterQualityInspector = new WaterQualityInspector();\r\n\r\n        this.start();\r\n    }\r\n    public mouseDown(x: number, y: number): void {\r\n\r\n    }\r\n    public mouseUp(x: number, y: number): void {\r\n\r\n    }\r\n    public mouseDrag(x: number, y: number): void {\r\n\r\n    }\r\n    public render(ctx: CanvasRenderingContext2D): void {\r\n        // ctx.beginPath();\r\n        // ctx.arc(0, 0, 10, 0, Math.PI * 2);\r\n        // ctx.closePath();\r\n        // ctx.fill();\r\n\r\n        this.waterQualityInspector.render(this.ctx);\r\n    }\r\n}"],"names":["WaterQualityInspector","constructor","data","day","scale","offsetData","document","onkeydown","k","this","console","log","getCSVFromURL","process","then","d","lines","split","index","dataDic","needComputeData","i","length","Float32Array","row","j","theIndex","indexOf","Offset","v","wheel","e","deltaY","render","ctx","dd","vizData","lineWidth","strokeStyle","x","beginPath","moveTo","lineTo","canvas","height","stroke","color","xP","yP","val","Solution","divHost","renderer","style","display","alignItems","div","createElement","marginLeft","marginRight","backgroundColor","width","appendChild","Renderer","destroy","lastElementChild","removeChild","RendererCanvas","super","waterQualityInspector","position","background","onwheel","start","mouseDown","y","mouseUp","mouseDrag"],"sourceRoot":""}